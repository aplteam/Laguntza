<!DOCTYPE html>
<html lang="en">
<head>
<title>Coverage</title>
<meta charset="utf-8"/>
<style>
@media screen{
    html {background-color: #FFFFF0;}
body {
    font-size: 16px;
    font-family : Verdana, "Bitstream Vera Sans", "DejaVu Sans", Tahoma, Geneva, Arial, Sans-serif;
    margin: 1em;
}
th, td {padding: 5px 10px;}
th {text-align: left;}
h1, h2, h3, h4, h5, h6 {color: #424242;}
h1 {font-size: 22px;}
h2 {font-size: 18px; margin-top: 2em; margin-bottom:0.3em;}
tbody tr:nth-child(even) {background-color: #F0F0F0;}
tbody tr:nth-child(odd) {background-color: #FAFAFA;}
th {background-color: #E6E6E6;color: #424242;}
table {border: silver 1px solid; font-size: 14px;font-family: APLFont, monospace;}
code , code a {font-size: 14px; font-family: APLFont, monospace;}
code.header {
    font-size: 16px; 
    font-family: APLFont, monospace; 
    margin: 1.5em 0.5em 0 0.5em; 
    padding:0;
    display: block;
}
div.code-block {
    border: 1px silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 0.5em 0.5em 0.5em 0.5em;
    padding: 0.5em;
}
div.code-block.missing {
    background-color: #fa605254;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
ul li, ol li {margin: 0.7em 0.2em;}
.float-right {float:right;}
.no-underline {    text-decoration :none;}
.top-links {font-size:20px; padding-left: 0.6em;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5px; padding-top:0; font-size: 9px;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 0.5em; padding: 0.5em;}
}
@media print{@page {size: portrait}
@page {
    margin: 1cm 1cm 1cm 1.75cm;
    @bottom-right {
        content: counter(page) " / " counter(pages);
  }
}
body {
    font: 12pt "Times New Roman", Times, serif;
    line-height: 1.2;
     /* CSS3 filter, at the moment Webkit only. Prefix it for future implementations */
    -webkit-filter: grayscale(100%);
    filter: grayscale(100%); /* future-proof */
}
h1 {font-size: 18pt;}
h2 {font-size: 16pt; margin-top: 10pt; margin-bottom: 3pt;}
th, td {padding: 2pt 3pt;}
th {text-align: left;background-color: #DBDBDB;}
tbody tr:nth-child(odd) {background-color: #EDEDED;}
table {
    color-adjust: exact !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    font-size: 8pt;
    font-family: APLFont, monospace;
}
div.keep-together {break-inside: avoid; break-before:auto;}
table {border: silver 1pt solid;}
code , code a {font-size: 8pt; font-family: APLFont, monospace;}
code.header {
    font-size: 8pt;
    font-family: APLFont, monospace;
    margin: 7pt 3pt 0 10pt;
    padding:0;
    display: block;
}
div.code-block {
    border: 1pt silver dashed;
    background-color: #F2F2F2;
    display: block;
    margin: 4pt 4pt 4pt 4pt;
    padding: 4pt;
}
div.code-block code {display: block; white-space: pre-wrap; margin:0; padding:0; word-wrap: break-word;}
.emphasize { font-weight: 800;}
a {text-decoration: none;color: black;}
ul li, ol li {margin: 8pt 3pt;}
.no-print {display:none;}
.align-right {text-align: right;}
#footer hr {margin-top:1.5em;}
#footer p {margin-top:5pt; padding-top:0; font-size: 6pt;}
@font-face {
        font-family: "APLFont";
    src:
        local("APL385 Unicode"),
        url("https://misc.aplteam.com/apl385.ttf") format("truetype");
}
.info {border: 1px silver dashed; background-color: #F2F2F2;margin: 8px; padding: 8px;}
}
</style>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.css"/>
<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.11.2/b-2.0.0/b-print-2.0.0/fh-3.1.9/r-2.2.9/datatables.min.js"></script>
</head>
<body>
<h1 id="top">Coverage Report</h1>
<p>Watched: 485 fns/opr within <code>#.Laguntza.Laguntza</code></p>
<p>The test suite was executed once:</p>
<table>
<thead>
<tr><th>Executed at</th><th>APLVersion</th><th>Memory (MB)</th></tr>
</thead>
<tbody>
<tr><td>2023-07-18 07:49:50</td><td>Windows-64 ⋄ 18.2.45645.0 ⋄ W ⋄ Development ⋄ Unicode</td><td>41</td></tr>
</tbody>
</table>
<p>Overall 49% of the testable code is covered.</p>
<p>(Comment lines, empty lines, all <code>:End</code>* lines etc. are ignored)</p>
<p>209 of the fns/opr are 100% covered.</p>
<div id="partly-covered" class="keep-together">
<table id="percent">
<thead>
<tr><th style="text-align:left;">Function/Operator</th><th style="text-align:left;">Lines not executed</th><th style="text-align:left;">Coverage</th><th style="text-align:right;">≢</th></tr>
</thead>
<tbody>
<tr class="uncovered"><td><a href="#listing_1" title="Link to listing">#.Laguntza.Laguntza.About</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_2" title="Link to listing">#.Laguntza.Laguntza.AddBookmarkFirst</a></td><td>14←≢1-14</td><td>0</td><td>14</td></tr>
<tr class="uncovered"><td><a href="#listing_3" title="Link to listing">#.Laguntza.Laguntza.AddBookmarkNext</a></td><td>14←≢1-14</td><td>0</td><td>14</td></tr>
<tr class="uncovered"><td><a href="#listing_4" title="Link to listing">#.Laguntza.Laguntza.AddSavedBookmarksToMenu</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_5" title="Link to listing">#.Laguntza.Laguntza.AllowRide</a></td><td>29←≢5-16,18,21-25,27,30-34,36,39-40,42,46</td><td>0</td><td>29</td></tr>
<tr class="uncovered"><td><a href="#listing_6" title="Link to listing">#.Laguntza.Laguntza.AskForEdit1</a></td><td>13←≢4-7,9-10,12-13,15-19</td><td>0</td><td>13</td></tr>
<tr class="uncovered"><td><a href="#listing_7" title="Link to listing">#.Laguntza.Laguntza.AskForEdit2</a></td><td>11←≢4-7,9-15</td><td>0</td><td>11</td></tr>
<tr class="uncovered"><td><a href="#listing_8" title="Link to listing">#.Laguntza.Laguntza.AskForName</a></td><td>46←≢1-16,18-21,23-28,30-37,39-46,48,50-52</td><td>0</td><td>46</td></tr>
<tr class="uncovered"><td><a href="#listing_9" title="Link to listing">#.Laguntza.Laguntza.AskForRename</a></td><td>14←≢1-9,11-14,17</td><td>0</td><td>14</td></tr>
<tr class="uncovered"><td><a href="#listing_10" title="Link to listing">#.Laguntza.Laguntza.AskWhetherSiblingOrChild</a></td><td>45←≢4-14,16-18,20-22,24-29,31-35,37-39,41-45,47-52,54-56</td><td>0</td><td>45</td></tr>
<tr class="uncovered"><td><a href="#listing_11" title="Link to listing">#.Laguntza.Laguntza.Between</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_12" title="Link to listing">#.Laguntza.Laguntza.BoldenTheseTopics</a></td><td>13←≢1-13</td><td>0</td><td>13</td></tr>
<tr class="uncovered"><td><a href="#listing_13" title="Link to listing">#.Laguntza.Laguntza.Bookmark</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_14" title="Link to listing">#.Laguntza.Laguntza.BrowseTree</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_15" title="Link to listing">#.Laguntza.Laguntza.ChangeTreeViewFontSize</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_16" title="Link to listing">#.Laguntza.Laguntza.CheckSinglePageForAmbiguousLink</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_17" title="Link to listing">#.Laguntza.Laguntza.CheckSinglePageForBrokenLink</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_18" title="Link to listing">#.Laguntza.Laguntza.CheckTopIDsForUniqueness</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_19" title="Link to listing">#.Laguntza.Laguntza.Collapse</a></td><td>12←≢1-12</td><td>0</td><td>12</td></tr>
<tr class="uncovered"><td><a href="#listing_20" title="Link to listing">#.Laguntza.Laguntza.CollapseAll</a></td><td>13←≢1-13</td><td>0</td><td>13</td></tr>
<tr class="uncovered"><td><a href="#listing_21" title="Link to listing">#.Laguntza.Laguntza.CollapseFrom</a></td><td>12←≢1-12</td><td>0</td><td>12</td></tr>
<tr class="uncovered"><td><a href="#listing_22" title="Link to listing">#.Laguntza.Laguntza.CompileHelpFileInto</a></td><td>12←≢4-6,8-16</td><td>0</td><td>12</td></tr>
<tr class="uncovered"><td><a href="#listing_23" title="Link to listing">#.Laguntza.Laguntza.CopyFullLinkToClipboard</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_24" title="Link to listing">#.Laguntza.Laguntza.CopyFullPath2Clipboard</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_25" title="Link to listing">#.Laguntza.Laguntza.CopyLinkToClipboard</a></td><td>8←≢0-7</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_26" title="Link to listing">#.Laguntza.Laguntza.CopyToClipboard</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_27" title="Link to listing">#.Laguntza.Laguntza.CreateStubDefaultPage</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_28" title="Link to listing">#.Laguntza.Laguntza.CreateTreeViewContextMenu</a></td><td>47←≢1-21,23,25-26,28-29,31-32,34-35,37,39-40,42-43,45-47,49-50,52,54-58,60</td><td>0</td><td>47</td></tr>
<tr class="uncovered"><td><a href="#listing_29" title="Link to listing">#.Laguntza.Laguntza.DefineSaltHomeFolder</a></td><td>7←≢1-7</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_30" title="Link to listing">#.Laguntza.Laguntza.DelAllBookmarks</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_31" title="Link to listing">#.Laguntza.Laguntza.DelBookmark</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_32" title="Link to listing">#.Laguntza.Laguntza.DelBookmarkSeparator</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_33" title="Link to listing">#.Laguntza.Laguntza.DeleteDefaultPage</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_34" title="Link to listing">#.Laguntza.Laguntza.DeleteFromTopicProperties</a></td><td>7←≢2-8</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_35" title="Link to listing">#.Laguntza.Laguntza.DeleteTopicProperty</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_36" title="Link to listing">#.Laguntza.Laguntza.DisplayCurrentTopicInBrowser</a></td><td>12←≢1-12</td><td>0</td><td>12</td></tr>
<tr class="uncovered"><td><a href="#listing_37" title="Link to listing">#.Laguntza.Laguntza.DisplayHtml</a></td><td>6←≢3-8</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_38" title="Link to listing">#.Laguntza.Laguntza.Edit</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_39" title="Link to listing">#.Laguntza.Laguntza.EditByQED</a></td><td>30←≢4-8,10-15,17,19-21,24-29,31-32,35-36,39-41,43,46</td><td>0</td><td>30</td></tr>
<tr class="uncovered"><td><a href="#listing_40" title="Link to listing">#.Laguntza.Laguntza.EditDefaultPage</a></td><td>15←≢1-9,11-16</td><td>0</td><td>15</td></tr>
<tr class="uncovered"><td><a href="#listing_41" title="Link to listing">#.Laguntza.Laguntza.EditFnsByQED</a></td><td>4←≢2-4,6</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_42" title="Link to listing">#.Laguntza.Laguntza.EditFromIndex</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_43" title="Link to listing">#.Laguntza.Laguntza.EditFromMainMenu</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_44" title="Link to listing">#.Laguntza.Laguntza.EditFromSearch</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_45" title="Link to listing">#.Laguntza.Laguntza.EditFromTv</a></td><td>22←≢3-8,10-12,14-23,27,29-30</td><td>0</td><td>22</td></tr>
<tr class="uncovered"><td><a href="#listing_46" title="Link to listing">#.Laguntza.Laguntza.EditOrDeleteDefaultPage</a></td><td>47←≢2-12,14-16,18-19,21,23-27,29-32,34-36,38-40,42-47,49-54,56-58</td><td>0</td><td>47</td></tr>
<tr class="uncovered"><td><a href="#listing_47" title="Link to listing">#.Laguntza.Laguntza.EditOrDeleteTopicPropertiesPage</a></td><td>47←≢2-12,14-16,18-19,21,23-27,29-32,34-36,38-40,42-47,49-54,56-58</td><td>0</td><td>47</td></tr>
<tr class="uncovered"><td><a href="#listing_48" title="Link to listing">#.Laguntza.Laguntza.EmphasizeHitsInHTML</a></td><td>20←≢1-20</td><td>0</td><td>20</td></tr>
<tr class="uncovered"><td><a href="#listing_49" title="Link to listing">#.Laguntza.Laguntza.EstablishCssFile</a></td><td>2, 3, 4</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_50" title="Link to listing">#.Laguntza.Laguntza.ExecHelpParms</a></td><td>5←≢4-8</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_51" title="Link to listing">#.Laguntza.Laguntza.Expand</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_52" title="Link to listing">#.Laguntza.Laguntza.ExpandAll</a></td><td>19←≢1-19</td><td>0</td><td>19</td></tr>
<tr class="uncovered"><td><a href="#listing_53" title="Link to listing">#.Laguntza.Laguntza.ExpandFrom</a></td><td>15←≢1-15</td><td>0</td><td>15</td></tr>
<tr class="uncovered"><td><a href="#listing_54" title="Link to listing">#.Laguntza.Laguntza.Export2HTML</a></td><td>8←≢11-16,18-19</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_55" title="Link to listing">#.Laguntza.Laguntza.FillRowsInIndicesMatrix</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_56" title="Link to listing">#.Laguntza.Laguntza.GetBookmark</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_57" title="Link to listing">#.Laguntza.Laguntza.GetContextMenuCaptionForDeleteItemFromTreeView</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_58" title="Link to listing">#.Laguntza.Laguntza.GetContextMenuCaptionForHelpPageEdit</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_59" title="Link to listing">#.Laguntza.Laguntza.GetFolder</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_60" title="Link to listing">#.Laguntza.Laguntza.GetHelpFolder</a></td><td>9←≢2-8,10-11</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_61" title="Link to listing">#.Laguntza.Laguntza.GetHelpVarsName</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_62" title="Link to listing">#.Laguntza.Laguntza.GetIndicesFromVarsContent</a></td><td>6←≢2-7</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_63" title="Link to listing">#.Laguntza.Laguntza.GetItemStates</a></td><td>2, 3</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_64" title="Link to listing">#.Laguntza.Laguntza.GetLastError</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_65" title="Link to listing">#.Laguntza.Laguntza.GetPageName</a></td><td>4←≢2-5</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_66" title="Link to listing">#.Laguntza.Laguntza.GetParentAndTopicNameAsRef</a></td><td>7←≢1-7</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_67" title="Link to listing">#.Laguntza.Laguntza.GetSaltPath</a></td><td>9←≢1-4,6-9,11</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_68" title="Link to listing">#.Laguntza.Laguntza.GetStates</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_69" title="Link to listing">#.Laguntza.Laguntza.GoBack</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_70" title="Link to listing">#.Laguntza.Laguntza.GoForward</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_71" title="Link to listing">#.Laguntza.Laguntza.GoToNextBoldTopic</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_72" title="Link to listing">#.Laguntza.Laguntza.GoToRow</a></td><td>42←≢1-10,12-15,17-22,24-29,31-37,39-46,48</td><td>0</td><td>42</td></tr>
<tr class="uncovered"><td><a href="#listing_73" title="Link to listing">#.Laguntza.Laguntza.GoToSearchTab</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_74" title="Link to listing">#.Laguntza.Laguntza.HandleError</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_75" title="Link to listing">#.Laguntza.Laguntza.HelpOnHelp</a></td><td>10←≢2-9,11-12</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_76" title="Link to listing">#.Laguntza.Laguntza.InjectIndices</a></td><td>16←≢4-19</td><td>0</td><td>16</td></tr>
<tr class="uncovered"><td><a href="#listing_77" title="Link to listing">#.Laguntza.Laguntza.IsBookmarkable</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_78" title="Link to listing">#.Laguntza.Laguntza.IsNode</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_79" title="Link to listing">#.Laguntza.Laguntza.LF</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_80" title="Link to listing">#.Laguntza.Laguntza.ListCategoriesAsRefs</a></td><td>8←≢4-11</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_81" title="Link to listing">#.Laguntza.Laguntza.LoadHelpWithSalt</a></td><td>4←≢6-9</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_82" title="Link to listing">#.Laguntza.Laguntza.LoadHelpWithSalt_</a></td><td>8←≢1-5,7-9</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_83" title="Link to listing">#.Laguntza.Laguntza.MakeRelativePathAbsoluteForIMG</a></td><td>13←≢4-10,12-14,16-18</td><td>0</td><td>13</td></tr>
<tr class="uncovered"><td><a href="#listing_84" title="Link to listing">#.Laguntza.Laguntza.ManageTopicProperties</a></td><td>9←≢2-10</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_85" title="Link to listing">#.Laguntza.Laguntza.MethodList</a></td><td>19←≢1-19</td><td>0</td><td>19</td></tr>
<tr class="uncovered"><td><a href="#listing_86" title="Link to listing">#.Laguntza.Laguntza.OnContextMenu</a></td><td>26←≢1-13,15-27</td><td>0</td><td>26</td></tr>
<tr class="uncovered"><td><a href="#listing_87" title="Link to listing">#.Laguntza.Laguntza.OnFind</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_88" title="Link to listing">#.Laguntza.Laguntza.OnItemUpInTreeView</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_89" title="Link to listing">#.Laguntza.Laguntza.OnKeyPressInTreeView</a></td><td>16←≢1-16</td><td>0</td><td>16</td></tr>
<tr class="uncovered"><td><a href="#listing_90" title="Link to listing">#.Laguntza.Laguntza.OnOkInGotoRow</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_91" title="Link to listing">#.Laguntza.Laguntza.OnReport</a></td><td>10←≢3-12</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_92" title="Link to listing">#.Laguntza.Laguntza.OnReportEventMsg</a></td><td>2, 3</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_93" title="Link to listing">#.Laguntza.Laguntza.OnReportLostFocus</a></td><td>2, 3</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_94" title="Link to listing">#.Laguntza.Laguntza.OnRetractingInTreeView</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_95" title="Link to listing">#.Laguntza.Laguntza.OnSelectOkInAskForName</a></td><td>7←≢1-7</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_96" title="Link to listing">#.Laguntza.Laguntza.OnToolbarBtn</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_97" title="Link to listing">#.Laguntza.Laguntza.Or</a></td><td>4←≢3-6</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_98" title="Link to listing">#.Laguntza.Laguntza.PrintCurrentPage</a></td><td>5←≢3-7</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_99" title="Link to listing">#.Laguntza.Laguntza.PrintFullNameToQSE</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_100" title="Link to listing">#.Laguntza.Laguntza.ProgressbarSet</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_101" title="Link to listing">#.Laguntza.Laguntza.Public</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_102" title="Link to listing">#.Laguntza.Laguntza.RenameHelpTopic</a></td><td>33←≢5-12,14-16,18,20-23,25-29,31,33-41,44-45</td><td>0</td><td>33</td></tr>
<tr class="uncovered"><td><a href="#listing_103" title="Link to listing">#.Laguntza.Laguntza.RenameInTopicProperties</a></td><td>11←≢2-11,13</td><td>0</td><td>11</td></tr>
<tr class="uncovered"><td><a href="#listing_104" title="Link to listing">#.Laguntza.Laguntza.Replace</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_105" title="Link to listing">#.Laguntza.Laguntza.ReplaceSearchStringByEmphasizeSpan</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_106" title="Link to listing">#.Laguntza.Laguntza.RunAsStandalone</a></td><td>40←≢2-7,9,11-17,19-22,24-26,28,31-37,39-41,43-48,50,53</td><td>0</td><td>40</td></tr>
<tr class="uncovered"><td><a href="#listing_107" title="Link to listing">#.Laguntza.Laguntza.SaveHelpSystemWithSalt</a></td><td>2, 3</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_108" title="Link to listing">#.Laguntza.Laguntza.SaveNodeWithSalt</a></td><td>13←≢7-10,12,14-16,18-20,22-23</td><td>0</td><td>13</td></tr>
<tr class="uncovered"><td><a href="#listing_109" title="Link to listing">#.Laguntza.Laguntza.SearchThis</a></td><td>14←≢1-14</td><td>0</td><td>14</td></tr>
<tr class="uncovered"><td><a href="#listing_110" title="Link to listing">#.Laguntza.Laguntza.SelectTreeView</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_111" title="Link to listing">#.Laguntza.Laguntza.SetItem</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_112" title="Link to listing">#.Laguntza.Laguntza.SetItemState</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_113" title="Link to listing">#.Laguntza.Laguntza.SetStates</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_114" title="Link to listing">#.Laguntza.Laguntza.Show</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_115" title="Link to listing">#.Laguntza.Laguntza.ShowEmptyPage</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_116" title="Link to listing">#.Laguntza.Laguntza.ShowError</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_117" title="Link to listing">#.Laguntza.Laguntza.ShowHtmlOfCurrentTopic</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_118" title="Link to listing">#.Laguntza.Laguntza.TellAboutMissingDefaultPage</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_119" title="Link to listing">#.Laguntza.Laguntza.TellNotEmpty</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_120" title="Link to listing">#.Laguntza.Laguntza.ToggleNavigationBar</a></td><td>5←≢1-3,5-6</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_121" title="Link to listing">#.Laguntza.Laguntza.UnboldAll</a></td><td>7←≢1-7</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_122" title="Link to listing">#.Laguntza.Laguntza.UpdateFileData</a></td><td>17←≢6-22</td><td>0</td><td>17</td></tr>
<tr class="uncovered"><td><a href="#listing_123" title="Link to listing">#.Laguntza.Laguntza.ViewLaguntzasHelp</a></td><td>27←≢2-5,7-11,13-16,18,20-26,28-30,32-34</td><td>0</td><td>27</td></tr>
<tr class="uncovered"><td><a href="#listing_124" title="Link to listing">#.Laguntza.Laguntza.YesOrNo</a></td><td>11←≢1-11</td><td>0</td><td>11</td></tr>
<tr class="uncovered"><td><a href="#listing_125" title="Link to listing">#.Laguntza.Laguntza.YesOrNoInSession</a></td><td>11←≢1-4,6,8-13</td><td>0</td><td>11</td></tr>
<tr class="uncovered"><td><a href="#listing_126" title="Link to listing">#.Laguntza.Laguntza.QuadVariables.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_127" title="Link to listing">#.Laguntza.Laguntza.API.ListHelpForms</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_128" title="Link to listing">#.Laguntza.Laguntza.API.Reset</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_129" title="Link to listing">#.Laguntza.Laguntza.API.Version</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_130" title="Link to listing">#.Laguntza.Laguntza.AskString.OnCheckNameOfNewNode</a></td><td>7←≢1-7</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_131" title="Link to listing">#.Laguntza.Laguntza.AskString.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_132" title="Link to listing">#.Laguntza.Laguntza.AskString.Run</a></td><td>51←≢1-3,5-12,14-16,18-22,24-31,33-39,41-47,49-53,55-57,59-60</td><td>0</td><td>51</td></tr>
<tr class="uncovered"><td><a href="#listing_133" title="Link to listing">#.Laguntza.Laguntza.Events.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_134" title="Link to listing">#.Laguntza.Laguntza.Events.ReportBrokenLink</a></td><td>3</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_135" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.CreateDefaultIndexPage</a></td><td>20←≢1-20</td><td>0</td><td>20</td></tr>
<tr class="uncovered"><td><a href="#listing_136" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.CreateHomePage</a></td><td>20←≢1-20</td><td>0</td><td>20</td></tr>
<tr class="uncovered"><td><a href="#listing_137" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.CreateIndexPage</a></td><td>19←≢1-19</td><td>0</td><td>19</td></tr>
<tr class="uncovered"><td><a href="#listing_138" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.GetBreadcrumb</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_139" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.GetHead</a></td><td>16←≢3-8,10-19</td><td>0</td><td>16</td></tr>
<tr class="uncovered"><td><a href="#listing_140" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.GetIndex</a></td><td>19←≢1-19</td><td>0</td><td>19</td></tr>
<tr class="uncovered"><td><a href="#listing_141" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.GetRelativePageNameForRow</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_142" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.GetRelativeUrlForRow</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_143" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.GetTOC</a></td><td>15←≢1-8,10-12,14-15,17,19</td><td>0</td><td>15</td></tr>
<tr class="uncovered"><td><a href="#listing_144" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.GetTocCSS</a></td><td>19←≢1-19</td><td>0</td><td>19</td></tr>
<tr class="uncovered"><td><a href="#listing_145" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.HandleImageFolder</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_146" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.HandleImageFolder_</a></td><td>12←≢1-8,10-13</td><td>0</td><td>12</td></tr>
<tr class="uncovered"><td><a href="#listing_147" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.HandleJavaScriptAndCSS</a></td><td>7←≢1-6,8</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_148" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.InjectMainMenu</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_149" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.MakeFrames</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_150" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.MakeFullPageFrom</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_151" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.MarkUpIndexPage</a></td><td>12←≢1-12</td><td>0</td><td>12</td></tr>
<tr class="uncovered"><td><a href="#listing_152" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.PolishAnchors</a></td><td>18←≢5-17,19-23</td><td>0</td><td>18</td></tr>
<tr class="uncovered"><td><a href="#listing_153" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.PolishAnchors_</a></td><td>8←≢4-11</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_154" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_155" title="Link to listing">#.Laguntza.Laguntza.Export2HTML_.Run</a></td><td>22←≢1-15,17-22,25</td><td>0</td><td>22</td></tr>
<tr class="uncovered"><td><a href="#listing_156" title="Link to listing">#.Laguntza.Laguntza.File.DeleteFolder</a></td><td>2, 3, 4</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_157" title="Link to listing">#.Laguntza.Laguntza.File.DoesFileExist</a></td><td>4, 5, 6</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_158" title="Link to listing">#.Laguntza.Laguntza.File.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_159" title="Link to listing">#.Laguntza.Laguntza.GUI.GetItemStates</a></td><td>2, 3</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_160" title="Link to listing">#.Laguntza.Laguntza.GUI.GetProperSize</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_161" title="Link to listing">#.Laguntza.Laguntza.GUI.GetScreenSize</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_162" title="Link to listing">#.Laguntza.Laguntza.GUI.On9994</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_163" title="Link to listing">#.Laguntza.Laguntza.GUI.On9999InIndexKeyword</a></td><td>19←≢2-20</td><td>0</td><td>19</td></tr>
<tr class="uncovered"><td><a href="#listing_164" title="Link to listing">#.Laguntza.Laguntza.GUI.OnDecreaseDefaultFontSizeForTV</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_165" title="Link to listing">#.Laguntza.Laguntza.GUI.OnDelayedUpdate</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_166" title="Link to listing">#.Laguntza.Laguntza.GUI.OnEditFromMainMenu</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_167" title="Link to listing">#.Laguntza.Laguntza.GUI.OnIncreaseDefaultFontSizeForTV</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_168" title="Link to listing">#.Laguntza.Laguntza.GUI.OnIndexTimer</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_169" title="Link to listing">#.Laguntza.Laguntza.GUI.OnKeyPressInForm</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_170" title="Link to listing">#.Laguntza.Laguntza.GUI.OnKeyPressInIndexKeyword</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_171" title="Link to listing">#.Laguntza.Laguntza.GUI.OnMouseWheelInTreeView</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_172" title="Link to listing">#.Laguntza.Laguntza.GUI.OnRestoreDefaultFontSizeForTV</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_173" title="Link to listing">#.Laguntza.Laguntza.GUI.OnSearchAsIs</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_174" title="Link to listing">#.Laguntza.Laguntza.GUI.OnStatusbarContextMenu</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_175" title="Link to listing">#.Laguntza.Laguntza.GUI.OnTimer</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_176" title="Link to listing">#.Laguntza.Laguntza.GUI.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_177" title="Link to listing">#.Laguntza.Laguntza.GUI.ShowListViewItem</a></td><td>5←≢3-7</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_178" title="Link to listing">#.Laguntza.Laguntza.GUI.∆List</a></td><td>9←≢6-14</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_179" title="Link to listing">#.Laguntza.Laguntza.HTML.ComplexLink</a></td><td>15←≢12-18,20-23,25-27,30</td><td>0</td><td>15</td></tr>
<tr class="uncovered"><td><a href="#listing_180" title="Link to listing">#.Laguntza.Laguntza.HTML.FindIn</a></td><td>9←≢6-14</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_181" title="Link to listing">#.Laguntza.Laguntza.HTML.GetBasePath</a></td><td>5←≢7-11</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_182" title="Link to listing">#.Laguntza.Laguntza.HTML.GetSep</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_183" title="Link to listing">#.Laguntza.Laguntza.HTML.MarkUpAsInvalidLink</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_184" title="Link to listing">#.Laguntza.Laguntza.HTML.MaskAplChars</a></td><td>4←≢3-6</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_185" title="Link to listing">#.Laguntza.Laguntza.HTML.MaskAplCharsAndLinks</a></td><td>4←≢2-5</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_186" title="Link to listing">#.Laguntza.Laguntza.HTML.PolishLinkText</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_187" title="Link to listing">#.Laguntza.Laguntza.HTML.ProcessLinks</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_188" title="Link to listing">#.Laguntza.Laguntza.HTML.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_189" title="Link to listing">#.Laguntza.Laguntza.HTML.ReportAmbiguousLink</a></td><td>7←≢2-8</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_190" title="Link to listing">#.Laguntza.Laguntza.HTML.ReportAmbiguousLink_</a></td><td>5←≢2-6</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_191" title="Link to listing">#.Laguntza.Laguntza.HTML.Split</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_192" title="Link to listing">#.Laguntza.Laguntza.HTML.Tag</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_193" title="Link to listing">#.Laguntza.Laguntza.HelpHelp.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_194" title="Link to listing">#.Laguntza.Laguntza.I.Dvlp</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_195" title="Link to listing">#.Laguntza.Laguntza.I.∆List</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_196" title="Link to listing">#.Laguntza.Laguntza.Icons.PolishIconFilename</a></td><td>1, 2</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_197" title="Link to listing">#.Laguntza.Laguntza.Icons.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_198" title="Link to listing">#.Laguntza.Laguntza.Index.DropDoublesFromKeywordsAndTree</a></td><td>7←≢1-7</td><td>0</td><td>7</td></tr>
<tr class="uncovered"><td><a href="#listing_199" title="Link to listing">#.Laguntza.Laguntza.Index.GetIndexNumber</a></td><td>1, 2, 3</td><td>0</td><td>3</td></tr>
<tr class="uncovered"><td><a href="#listing_200" title="Link to listing">#.Laguntza.Laguntza.Index.OnContextMenu</a></td><td>25←≢2-25,27</td><td>0</td><td>25</td></tr>
<tr class="uncovered"><td><a href="#listing_201" title="Link to listing">#.Laguntza.Laguntza.Index.OnHitSelectedIndex</a></td><td>10←≢1-10</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_202" title="Link to listing">#.Laguntza.Laguntza.Index.OnKeyPressInIndex</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_203" title="Link to listing">#.Laguntza.Laguntza.Index.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_204" title="Link to listing">#.Laguntza.Laguntza.Index.QualifyParent</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_205" title="Link to listing">#.Laguntza.Laguntza.Lint_.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_206" title="Link to listing">#.Laguntza.Laguntza.Lint_.ReportAmbiguousLinks</a></td><td>13←≢1-13</td><td>0</td><td>13</td></tr>
<tr class="uncovered"><td><a href="#listing_207" title="Link to listing">#.Laguntza.Laguntza.Lint_.ReportBrokenLinks</a></td><td>13←≢1-13</td><td>0</td><td>13</td></tr>
<tr class="uncovered"><td><a href="#listing_208" title="Link to listing">#.Laguntza.Laguntza.Lint_.Run</a></td><td>2, 3</td><td>0</td><td>2</td></tr>
<tr class="uncovered"><td><a href="#listing_209" title="Link to listing">#.Laguntza.Laguntza.Reports.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_210" title="Link to listing">#.Laguntza.Laguntza.Reports.Run</a></td><td>4←≢1-4</td><td>0</td><td>4</td></tr>
<tr class="uncovered"><td><a href="#listing_211" title="Link to listing">#.Laguntza.Laguntza.Search.CreateContextMenu</a></td><td>22←≢1-2,4-5,7-11,13-14,16,18-19,21-22,24-25,27-28,30-31</td><td>0</td><td>22</td></tr>
<tr class="uncovered"><td><a href="#listing_212" title="Link to listing">#.Laguntza.Laguntza.Search.DisplayCurrentSearchLine</a></td><td>9←≢1-9</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_213" title="Link to listing">#.Laguntza.Laguntza.Search.Find</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_214" title="Link to listing">#.Laguntza.Laguntza.Search.On9999</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_215" title="Link to listing">#.Laguntza.Laguntza.Search.OnColClick</a></td><td>15←≢1-15</td><td>0</td><td>15</td></tr>
<tr class="uncovered"><td><a href="#listing_216" title="Link to listing">#.Laguntza.Laguntza.Search.OnContextMenu</a></td><td>10←≢1-6,8-11</td><td>0</td><td>10</td></tr>
<tr class="uncovered"><td><a href="#listing_217" title="Link to listing">#.Laguntza.Laguntza.Search.OnContextMenuCombo</a></td><td>8←≢1-8</td><td>0</td><td>8</td></tr>
<tr class="uncovered"><td><a href="#listing_218" title="Link to listing">#.Laguntza.Laguntza.Search.OnHitSelected</a></td><td>5←≢1-5</td><td>0</td><td>5</td></tr>
<tr class="uncovered"><td><a href="#listing_219" title="Link to listing">#.Laguntza.Laguntza.Search.OnKeyPress</a></td><td>14←≢1-14</td><td>0</td><td>14</td></tr>
<tr class="uncovered"><td><a href="#listing_220" title="Link to listing">#.Laguntza.Laguntza.Search.Public</a></td><td>1</td><td>0</td><td>1</td></tr>
<tr class="uncovered"><td><a href="#listing_221" title="Link to listing">#.Laguntza.Laguntza.Search.ShowNotFound</a></td><td>6←≢1-6</td><td>0</td><td>6</td></tr>
<tr class="uncovered"><td><a href="#listing_222" title="Link to listing">#.Laguntza.Laguntza.Search.TellInvalidCharInSearchCombo</a></td><td>9←≢4-12</td><td>0</td><td>9</td></tr>
<tr class="uncovered"><td><a href="#listing_223" title="Link to listing">#.Laguntza.Laguntza.Search.TitleSearch</a></td><td>12←≢1-12</td><td>0</td><td>12</td></tr>
<tr><td><a href="#listing_224" title="Link to listing">#.Laguntza.Laguntza.AskForNodeType</a></td><td>55←≢4-16,18-21,23-27,29-34,36-42,44-50,52-60,62-65</td><td>4</td><td>57</td></tr>
<tr><td><a href="#listing_225" title="Link to listing">#.Laguntza.Laguntza.EditTopicProperties</a></td><td>23←≢5-9,11-12,14-16,18-19,21-25,27,29-30,32-34</td><td>12</td><td>26</td></tr>
<tr><td><a href="#listing_226" title="Link to listing">#.Laguntza.Laguntza.GetNameForNewNode</a></td><td>17←≢6,9-15,17-22,24-25,27</td><td>19</td><td>21</td></tr>
<tr><td><a href="#listing_227" title="Link to listing">#.Laguntza.Laguntza.OnMenuCmd</a></td><td>23←≢9-30,32</td><td>23</td><td>30</td></tr>
<tr><td><a href="#listing_228" title="Link to listing">#.Laguntza.Laguntza.PageNotFound</a></td><td>2, 3</td><td>33</td><td>3</td></tr>
<tr><td><a href="#listing_229" title="Link to listing">#.Laguntza.Laguntza.TellHowToArrangeNodes</a></td><td>8←≢5-12</td><td>33</td><td>12</td></tr>
<tr><td><a href="#listing_230" title="Link to listing">#.Laguntza.Laguntza.ReadBookMarksFromRegistry</a></td><td>6←≢5-10</td><td>40</td><td>10</td></tr>
<tr><td><a href="#listing_231" title="Link to listing">#.Laguntza.Laguntza.GUI.OnBeforeNavigate</a></td><td>9←≢7-9,11-13,15-16,18</td><td>40</td><td>15</td></tr>
<tr><td><a href="#listing_232" title="Link to listing">#.Laguntza.Laguntza.HTML.GetCssFileName</a></td><td>3, 4, 5</td><td>40</td><td>5</td></tr>
<tr><td><a href="#listing_233" title="Link to listing">#.Laguntza.Laguntza.Search.HandleNotFound</a></td><td>3, 4, 5</td><td>40</td><td>5</td></tr>
<tr><td><a href="#listing_234" title="Link to listing">#.Laguntza.Laguntza.HTML.PolishImageLinks</a></td><td>6, 7</td><td>50</td><td>4</td></tr>
<tr><td><a href="#listing_235" title="Link to listing">#.Laguntza.Laguntza.ReportAmbiguousLink_</a></td><td>5, 6</td><td>60</td><td>5</td></tr>
<tr><td><a href="#listing_236" title="Link to listing">#.Laguntza.Laguntza.ReportBrokenLink_</a></td><td>5, 6</td><td>60</td><td>5</td></tr>
<tr><td><a href="#listing_237" title="Link to listing">#.Laguntza.Laguntza.InjectNewPageStub</a></td><td>5←≢7-8,10-11,13</td><td>62</td><td>13</td></tr>
<tr><td><a href="#listing_238" title="Link to listing">#.Laguntza.Laguntza.Lint_.ReportTopicProperties</a></td><td>5←≢6,10,15-16,18</td><td>62</td><td>13</td></tr>
<tr><td><a href="#listing_239" title="Link to listing">#.Laguntza.Laguntza.ReportProblem</a></td><td>6, 7, 8</td><td>63</td><td>8</td></tr>
<tr><td><a href="#listing_240" title="Link to listing">#.Laguntza.Laguntza.TellLinkRegardingNew∆TopicProperty</a></td><td>4, 9, 10</td><td>63</td><td>8</td></tr>
<tr><td><a href="#listing_241" title="Link to listing">#.Laguntza.Laguntza.Search.OnKeyPressInCombo</a></td><td>6, 7, 8</td><td>63</td><td>8</td></tr>
<tr><td><a href="#listing_242" title="Link to listing">#.Laguntza.Laguntza.OnUpdate</a></td><td>11←≢7,10,14,32-39</td><td>66</td><td>32</td></tr>
<tr><td><a href="#listing_243" title="Link to listing">#.Laguntza.Laguntza.CheckForAlreadyOpen</a></td><td>3</td><td>67</td><td>3</td></tr>
<tr><td><a href="#listing_244" title="Link to listing">#.Laguntza.Laguntza.GetHome</a></td><td>5, 9</td><td>67</td><td>6</td></tr>
<tr><td><a href="#listing_245" title="Link to listing">#.Laguntza.Laguntza.GetTopicIndexFromCaption</a></td><td>5, 6</td><td>67</td><td>6</td></tr>
<tr><td><a href="#listing_246" title="Link to listing">#.Laguntza.Laguntza.ListNamespaceTree</a></td><td>11, 12, 14</td><td>67</td><td>9</td></tr>
<tr><td><a href="#listing_247" title="Link to listing">#.Laguntza.Laguntza.GUI.On9991</a></td><td>6, 8, 10</td><td>67</td><td>9</td></tr>
<tr><td><a href="#listing_248" title="Link to listing">#.Laguntza.Laguntza.Icons.HandleIcon</a></td><td>5, 7</td><td>67</td><td>6</td></tr>
<tr><td><a href="#listing_249" title="Link to listing">#.Laguntza.Laguntza.ReportMissingIndexEntries</a></td><td>5←≢4,11-13,21</td><td>69</td><td>16</td></tr>
<tr><td><a href="#listing_250" title="Link to listing">#.Laguntza.Laguntza.CompileHelpFile</a></td><td>10, 11, 12</td><td>73</td><td>11</td></tr>
<tr><td><a href="#listing_251" title="Link to listing">#.Laguntza.Laguntza.GetMarkdownVarsContent_</a></td><td>4←≢16,19-20,22</td><td>73</td><td>15</td></tr>
<tr><td><a href="#listing_252" title="Link to listing">#.Laguntza.Laguntza.Markdown2HTML_</a></td><td>5←≢15-19</td><td>74</td><td>19</td></tr>
<tr><td><a href="#listing_253" title="Link to listing">#.Laguntza.Laguntza.CreateStubTopic</a></td><td>9, 10</td><td>75</td><td>8</td></tr>
<tr><td><a href="#listing_254" title="Link to listing">#.Laguntza.Laguntza.Inject∆TopicProperties_</a></td><td>10, 11, 12</td><td>75</td><td>12</td></tr>
<tr><td><a href="#listing_255" title="Link to listing">#.Laguntza.Laguntza.GUI.GetSystemMetrics</a></td><td>6</td><td>75</td><td>4</td></tr>
<tr><td><a href="#listing_256" title="Link to listing">#.Laguntza.Laguntza.Icons.CreateIcon</a></td><td>4</td><td>75</td><td>4</td></tr>
<tr><td><a href="#listing_257" title="Link to listing">#.Laguntza.Laguntza.Search.Search</a></td><td>10</td><td>75</td><td>4</td></tr>
<tr><td><a href="#listing_258" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateBookmarkMenu</a></td><td>12, 13, 14</td><td>79</td><td>14</td></tr>
<tr><td><a href="#listing_259" title="Link to listing">#.Laguntza.Laguntza.TidyUp</a></td><td>6</td><td>80</td><td>5</td></tr>
<tr><td><a href="#listing_260" title="Link to listing">#.Laguntza.Laguntza.DeleteAPL_Object</a></td><td>6</td><td>83</td><td>6</td></tr>
<tr><td><a href="#listing_261" title="Link to listing">#.Laguntza.Laguntza.ComplexLink</a></td><td>17, 18, 19</td><td>86</td><td>21</td></tr>
<tr><td><a href="#listing_262" title="Link to listing">#.Laguntza.Laguntza.InjectNewPageStub_</a></td><td>4←≢16,23-24,27</td><td>86</td><td>29</td></tr>
<tr><td><a href="#listing_263" title="Link to listing">#.Laguntza.Laguntza.CreateStub</a></td><td>4←≢16,41-43</td><td>87</td><td>30</td></tr>
<tr><td><a href="#listing_264" title="Link to listing">#.Laguntza.Laguntza.CloseHelp</a></td><td>12, 13, 19</td><td>88</td><td>26</td></tr>
<tr><td><a href="#listing_265" title="Link to listing">#.Laguntza.Laguntza.ViewHTML</a></td><td>3</td><td>88</td><td>8</td></tr>
<tr><td><a href="#listing_266" title="Link to listing">#.Laguntza.Laguntza.TellLinkAboutChange</a></td><td>13</td><td>89</td><td>9</td></tr>
<tr><td><a href="#listing_267" title="Link to listing">#.Laguntza.Laguntza.New</a></td><td>31, 32, 33</td><td>90</td><td>31</td></tr>
<tr><td><a href="#listing_268" title="Link to listing">#.Laguntza.Laguntza.Create∆TopicProperties</a></td><td>13</td><td>91</td><td>11</td></tr>
<tr><td><a href="#listing_269" title="Link to listing">#.Laguntza.Laguntza.InjectNewNode_</a></td><td>3</td><td>91</td><td>11</td></tr>
<tr><td><a href="#listing_270" title="Link to listing">#.Laguntza.Laguntza.IntitialExpand</a></td><td>12</td><td>92</td><td>12</td></tr>
<tr><td><a href="#listing_271" title="Link to listing">#.Laguntza.Laguntza.HTML.MaskLinks</a></td><td>4</td><td>94</td><td>16</td></tr>
<tr><td><a href="#listing_272" title="Link to listing">#.Laguntza.Laguntza.CreateParms</a></td><td>41, 42</td><td>95</td><td>40</td></tr>
<tr><td><a href="#listing_273" title="Link to listing">#.Laguntza.Laguntza.ExecEmbeddedFns</a></td><td>36</td><td>97</td><td>30</td></tr>
<tr><td><a href="#listing_274" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateIndex</a></td><td>33</td><td>97</td><td>30</td></tr>
<tr><td><a href="#listing_275" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateTabs</a></td><td>42</td><td>97</td><td>34</td></tr>
<tr><td><a href="#listing_276" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateSearch</a></td><td>106</td><td>99</td><td>96</td></tr>
<tr class="fullyCovered"><td><a href="#listing_277" title="Link to listing">#.Laguntza.Laguntza.A</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_278" title="Link to listing">#.Laguntza.Laguntza.AddToHistory</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_279" title="Link to listing">#.Laguntza.Laguntza.AddToTopicProperties</a></td><td></td><td>100</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_280" title="Link to listing">#.Laguntza.Laguntza.AllowContinueWS</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_281" title="Link to listing">#.Laguntza.Laguntza.AllowedChars</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_282" title="Link to listing">#.Laguntza.Laguntza.Alpha</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_283" title="Link to listing">#.Laguntza.Laguntza.AreThereNoBookmarksYet</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_284" title="Link to listing">#.Laguntza.Laguntza.BuildDocFromAllPages</a></td><td></td><td>100</td><td>21</td></tr>
<tr class="fullyCovered"><td><a href="#listing_285" title="Link to listing">#.Laguntza.Laguntza.BuildHelpTree</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_286" title="Link to listing">#.Laguntza.Laguntza.CR</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_287" title="Link to listing">#.Laguntza.Laguntza.CheckBookmarkButton</a></td><td></td><td>100</td><td>11</td></tr>
<tr class="fullyCovered"><td><a href="#listing_288" title="Link to listing">#.Laguntza.Laguntza.CheckCompileFiles</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_289" title="Link to listing">#.Laguntza.Laguntza.CheckItemTitle</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_290" title="Link to listing">#.Laguntza.Laguntza.CheckParms</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_291" title="Link to listing">#.Laguntza.Laguntza.CloseGui</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_292" title="Link to listing">#.Laguntza.Laguntza.CollectChildren</a></td><td></td><td>100</td><td>12</td></tr>
<tr class="fullyCovered"><td><a href="#listing_293" title="Link to listing">#.Laguntza.Laguntza.CollectData</a></td><td></td><td>100</td><td>20</td></tr>
<tr class="fullyCovered"><td><a href="#listing_294" title="Link to listing">#.Laguntza.Laguntza.CollectHelpPages</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_295" title="Link to listing">#.Laguntza.Laguntza.Compile</a></td><td></td><td>100</td><td>15</td></tr>
<tr class="fullyCovered"><td><a href="#listing_296" title="Link to listing">#.Laguntza.Laguntza.CopyAndMassageCSSfiles</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_297" title="Link to listing">#.Laguntza.Laguntza.CopyImages</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_298" title="Link to listing">#.Laguntza.Laguntza.CreateData</a></td><td></td><td>100</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_299" title="Link to listing">#.Laguntza.Laguntza.CreateHelpForm</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_300" title="Link to listing">#.Laguntza.Laguntza.CreateTree</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_301" title="Link to listing">#.Laguntza.Laguntza.DeleteTopicOrNode</a></td><td></td><td>100</td><td>22</td></tr>
<tr class="fullyCovered"><td><a href="#listing_302" title="Link to listing">#.Laguntza.Laguntza.Display</a></td><td></td><td>100</td><td>12</td></tr>
<tr class="fullyCovered"><td><a href="#listing_303" title="Link to listing">#.Laguntza.Laguntza.DisplayParentelInfo</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_304" title="Link to listing">#.Laguntza.Laguntza.DropUnwanted</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_305" title="Link to listing">#.Laguntza.Laguntza.FindForm</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_306" title="Link to listing">#.Laguntza.Laguntza.FindTopic</a></td><td></td><td>100</td><td>48</td></tr>
<tr class="fullyCovered"><td><a href="#listing_307" title="Link to listing">#.Laguntza.Laguntza.GetAllHtmlFromFile</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_308" title="Link to listing">#.Laguntza.Laguntza.GetCurrentItem</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_309" title="Link to listing">#.Laguntza.Laguntza.GetFullRegPath</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_310" title="Link to listing">#.Laguntza.Laguntza.GetIndicesFromMarkdown</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_311" title="Link to listing">#.Laguntza.Laguntza.GetItemNumberFromPattern</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_312" title="Link to listing">#.Laguntza.Laguntza.GetMarkdownVarsContent</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_313" title="Link to listing">#.Laguntza.Laguntza.GetMaskForCode</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_314" title="Link to listing">#.Laguntza.Laguntza.GetNoClose</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_315" title="Link to listing">#.Laguntza.Laguntza.GetParentAndTopicNameAsText</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_316" title="Link to listing">#.Laguntza.Laguntza.GetParentOf</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_317" title="Link to listing">#.Laguntza.Laguntza.GetTempFilename</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_318" title="Link to listing">#.Laguntza.Laguntza.GetTitleFromTopicProperty</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_319" title="Link to listing">#.Laguntza.Laguntza.GetTopicPropertyTemplate</a></td><td></td><td>100</td><td>20</td></tr>
<tr class="fullyCovered"><td><a href="#listing_320" title="Link to listing">#.Laguntza.Laguntza.GetVarsName</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_321" title="Link to listing">#.Laguntza.Laguntza.GetVisible</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_322" title="Link to listing">#.Laguntza.Laguntza.GetWordsFromMarkdown</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_323" title="Link to listing">#.Laguntza.Laguntza.Get∆Ref</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_324" title="Link to listing">#.Laguntza.Laguntza.HandleEnforceCompile</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_325" title="Link to listing">#.Laguntza.Laguntza.HandleTopicProperties</a></td><td></td><td>100</td><td>15</td></tr>
<tr class="fullyCovered"><td><a href="#listing_326" title="Link to listing">#.Laguntza.Laguntza.InjectNewNode</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_327" title="Link to listing">#.Laguntza.Laguntza.Inject∆TopicProperties</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_328" title="Link to listing">#.Laguntza.Laguntza.IsNotOnSearchTab</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_329" title="Link to listing">#.Laguntza.Laguntza.IsRunTime</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_330" title="Link to listing">#.Laguntza.Laguntza.ListHelpForms</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_331" title="Link to listing">#.Laguntza.Laguntza.ListNamespaceTree_</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_332" title="Link to listing">#.Laguntza.Laguntza.Markdown2HTML</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_333" title="Link to listing">#.Laguntza.Laguntza.NoOfChildren</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_334" title="Link to listing">#.Laguntza.Laguntza.OnClose</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_335" title="Link to listing">#.Laguntza.Laguntza.OnExpandingInTreeView</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_336" title="Link to listing">#.Laguntza.Laguntza.OnTabSelect</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_337" title="Link to listing">#.Laguntza.Laguntza.ParentInStatusbar</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_338" title="Link to listing">#.Laguntza.Laguntza.PolishLinkText</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_339" title="Link to listing">#.Laguntza.Laguntza.PolishName</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_340" title="Link to listing">#.Laguntza.Laguntza.PolishPagePattern</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_341" title="Link to listing">#.Laguntza.Laguntza.PopulateGUI</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_342" title="Link to listing">#.Laguntza.Laguntza.PopulateIndexList</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_343" title="Link to listing">#.Laguntza.Laguntza.Posn</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_344" title="Link to listing">#.Laguntza.Laguntza.Power2</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_345" title="Link to listing">#.Laguntza.Laguntza.ProcessEvents</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_346" title="Link to listing">#.Laguntza.Laguntza.ProcessLinks</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_347" title="Link to listing">#.Laguntza.Laguntza.ProcessLinks_</a></td><td></td><td>100</td><td>17</td></tr>
<tr class="fullyCovered"><td><a href="#listing_348" title="Link to listing">#.Laguntza.Laguntza.ProcessLinks__</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_349" title="Link to listing">#.Laguntza.Laguntza.ProgressbarCreate</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_350" title="Link to listing">#.Laguntza.Laguntza.ReadGuiParmsFromRegistry</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_351" title="Link to listing">#.Laguntza.Laguntza.ReformatTopicPropertyResult</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_352" title="Link to listing">#.Laguntza.Laguntza.RegRead</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_353" title="Link to listing">#.Laguntza.Laguntza.RegWrite</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_354" title="Link to listing">#.Laguntza.Laguntza.RemoveCode</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_355" title="Link to listing">#.Laguntza.Laguntza.RemoveCodeBlock</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_356" title="Link to listing">#.Laguntza.Laguntza.RemoveComplexLink</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_357" title="Link to listing">#.Laguntza.Laguntza.RemoveData</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_358" title="Link to listing">#.Laguntza.Laguntza.RemoveEggTimer</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_359" title="Link to listing">#.Laguntza.Laguntza.RemoveFunctinCalls</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_360" title="Link to listing">#.Laguntza.Laguntza.RemoveLinksFromText</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_361" title="Link to listing">#.Laguntza.Laguntza.ReportAmbiguousLink</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_362" title="Link to listing">#.Laguntza.Laguntza.ReportBrokenLink</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_363" title="Link to listing">#.Laguntza.Laguntza.Reset</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_364" title="Link to listing">#.Laguntza.Laguntza.ResetStatusbar</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_365" title="Link to listing">#.Laguntza.Laguntza.SaveAllHtml</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_366" title="Link to listing">#.Laguntza.Laguntza.SaveHelpParms</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_367" title="Link to listing">#.Laguntza.Laguntza.SaveSearchString</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_368" title="Link to listing">#.Laguntza.Laguntza.SelectItemInTreeView</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_369" title="Link to listing">#.Laguntza.Laguntza.Selfie</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_370" title="Link to listing">#.Laguntza.Laguntza.SeparateWords</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_371" title="Link to listing">#.Laguntza.Laguntza.SetInfoBCol</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_372" title="Link to listing">#.Laguntza.Laguntza.SetInfoText</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_373" title="Link to listing">#.Laguntza.Laguntza.SetNoClose</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_374" title="Link to listing">#.Laguntza.Laguntza.SetVisible</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_375" title="Link to listing">#.Laguntza.Laguntza.SetVisibleForTreeAndIndexTab</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_376" title="Link to listing">#.Laguntza.Laguntza.ShowDisplayFormat</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_377" title="Link to listing">#.Laguntza.Laguntza.ShowEggTimer</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_378" title="Link to listing">#.Laguntza.Laguntza.ShowPageNotFound</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_379" title="Link to listing">#.Laguntza.Laguntza.ShowTopic</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_380" title="Link to listing">#.Laguntza.Laguntza.Size</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_381" title="Link to listing">#.Laguntza.Laguntza.Version</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_382" title="Link to listing">#.Laguntza.Laguntza.WhereAreTheChildren</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_383" title="Link to listing">#.Laguntza.Laguntza.WindowStateNormal</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_384" title="Link to listing">#.Laguntza.Laguntza.API.CloseHelp</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_385" title="Link to listing">#.Laguntza.Laguntza.API.CompileHelpFile</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_386" title="Link to listing">#.Laguntza.Laguntza.API.CreateParms</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_387" title="Link to listing">#.Laguntza.Laguntza.API.CreateStub</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_388" title="Link to listing">#.Laguntza.Laguntza.API.FindTopic</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_389" title="Link to listing">#.Laguntza.Laguntza.API.GetNoClose</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_390" title="Link to listing">#.Laguntza.Laguntza.API.GetVisible</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_391" title="Link to listing">#.Laguntza.Laguntza.API.Inject∆TopicProperties</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_392" title="Link to listing">#.Laguntza.Laguntza.API.LoadHelpWithSalt</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_393" title="Link to listing">#.Laguntza.Laguntza.API.New</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_394" title="Link to listing">#.Laguntza.Laguntza.API.SaveHelpSystemWithSalt</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_395" title="Link to listing">#.Laguntza.Laguntza.API.Selfie</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_396" title="Link to listing">#.Laguntza.Laguntza.API.SetNoClose</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_397" title="Link to listing">#.Laguntza.Laguntza.API.SetVisible</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_398" title="Link to listing">#.Laguntza.Laguntza.API.ShowTopic</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_399" title="Link to listing">#.Laguntza.Laguntza.AskString.OnConfigure</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_400" title="Link to listing">#.Laguntza.Laguntza.File.CloseFile</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_401" title="Link to listing">#.Laguntza.Laguntza.File.CopyFilesTo</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_402" title="Link to listing">#.Laguntza.Laguntza.File.DealWithFiles</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_403" title="Link to listing">#.Laguntza.Laguntza.File.DeleteFile</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_404" title="Link to listing">#.Laguntza.Laguntza.File.DoesFolderExist</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_405" title="Link to listing">#.Laguntza.Laguntza.File.EstablishFileIndexVars</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_406" title="Link to listing">#.Laguntza.Laguntza.File.GetHelpFileName</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_407" title="Link to listing">#.Laguntza.Laguntza.File.GetHtmlFromFile</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_408" title="Link to listing">#.Laguntza.Laguntza.File.MakeDir</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_409" title="Link to listing">#.Laguntza.Laguntza.File.OpenFilesAndGetTree</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_410" title="Link to listing">#.Laguntza.Laguntza.GUI.AddPosnAndSizeFor</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_411" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateActiveX</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_412" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateActiveXContainer</a></td><td></td><td>100</td><td>16</td></tr>
<tr class="fullyCovered"><td><a href="#listing_413" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateBrowser</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_414" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateDevelopersMenu</a></td><td></td><td>100</td><td>39</td></tr>
<tr class="fullyCovered"><td><a href="#listing_415" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateEditMenu</a></td><td></td><td>100</td><td>39</td></tr>
<tr class="fullyCovered"><td><a href="#listing_416" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateFileMenu</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_417" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateForm</a></td><td></td><td>100</td><td>24</td></tr>
<tr class="fullyCovered"><td><a href="#listing_418" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateGui</a></td><td></td><td>100</td><td>18</td></tr>
<tr class="fullyCovered"><td><a href="#listing_419" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateHelpMenu</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_420" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateHiddenButtons</a></td><td></td><td>100</td><td>34</td></tr>
<tr class="fullyCovered"><td><a href="#listing_421" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateMenus</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_422" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateReportSubMenu</a></td><td></td><td>100</td><td>31</td></tr>
<tr class="fullyCovered"><td><a href="#listing_423" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateSplitter</a></td><td></td><td>100</td><td>11</td></tr>
<tr class="fullyCovered"><td><a href="#listing_424" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateStatusbar</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_425" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateToolbar</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_426" title="Link to listing">#.Laguntza.Laguntza.GUI.CreateTreeView</a></td><td></td><td>100</td><td>22</td></tr>
<tr class="fullyCovered"><td><a href="#listing_427" title="Link to listing">#.Laguntza.Laguntza.GUI.EstablishTabSelectHandler</a></td><td></td><td>100</td><td>2</td></tr>
<tr class="fullyCovered"><td><a href="#listing_428" title="Link to listing">#.Laguntza.Laguntza.GUI.FullPathToHandler</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_429" title="Link to listing">#.Laguntza.Laguntza.GUI.GetFontSizesOf</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_430" title="Link to listing">#.Laguntza.Laguntza.GUI.On9997InTreeView</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_431" title="Link to listing">#.Laguntza.Laguntza.GUI.OnBuildDocFromAllPages</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_432" title="Link to listing">#.Laguntza.Laguntza.GUI.OnConfigure</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_433" title="Link to listing">#.Laguntza.Laguntza.GUI.OnTitleChangeInWebBrowser</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_434" title="Link to listing">#.Laguntza.Laguntza.GUI.PopulateToolbar</a></td><td></td><td>100</td><td>42</td></tr>
<tr class="fullyCovered"><td><a href="#listing_435" title="Link to listing">#.Laguntza.Laguntza.GUI.Power2</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_436" title="Link to listing">#.Laguntza.Laguntza.HTML.CreateDefaultNodePage</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_437" title="Link to listing">#.Laguntza.Laguntza.HTML.CreateParameterSpace</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_438" title="Link to listing">#.Laguntza.Laguntza.HTML.EnforceSlash</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_439" title="Link to listing">#.Laguntza.Laguntza.HTML.GetTitle</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_440" title="Link to listing">#.Laguntza.Laguntza.HTML.GetTitleFromBody</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_441" title="Link to listing">#.Laguntza.Laguntza.HTML.HtmlBottomCode</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_442" title="Link to listing">#.Laguntza.Laguntza.HTML.HtmlTopCode</a></td><td></td><td>100</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_443" title="Link to listing">#.Laguntza.Laguntza.HTML.HtmlTopCode1</a></td><td></td><td>100</td><td>16</td></tr>
<tr class="fullyCovered"><td><a href="#listing_444" title="Link to listing">#.Laguntza.Laguntza.HTML.HtmlTopCode2</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_445" title="Link to listing">#.Laguntza.Laguntza.HTML.MakeCssForDoc</a></td><td></td><td>100</td><td>48</td></tr>
<tr class="fullyCovered"><td><a href="#listing_446" title="Link to listing">#.Laguntza.Laguntza.HTML.WrapInHtml</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_447" title="Link to listing">#.Laguntza.Laguntza.HelpHelp.∆TopicProperties</a></td><td></td><td>100</td><td>19</td></tr>
<tr class="fullyCovered"><td><a href="#listing_448" title="Link to listing">#.Laguntza.Laguntza.HelpHelp.Links.∆TopicProperties</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_449" title="Link to listing">#.Laguntza.Laguntza.HelpHelp.MarkUp.∆TopicProperties</a></td><td></td><td>100</td><td>12</td></tr>
<tr class="fullyCovered"><td><a href="#listing_450" title="Link to listing">#.Laguntza.Laguntza.HelpHelp.Methods.∆TopicProperties</a></td><td></td><td>100</td><td>20</td></tr>
<tr class="fullyCovered"><td><a href="#listing_451" title="Link to listing">#.Laguntza.Laguntza.HelpHelp.Misc.∆TopicProperties</a></td><td></td><td>100</td><td>8</td></tr>
<tr class="fullyCovered"><td><a href="#listing_452" title="Link to listing">#.Laguntza.Laguntza.HelpHelp.Parameters.∆TopicProperties</a></td><td></td><td>100</td><td>26</td></tr>
<tr class="fullyCovered"><td><a href="#listing_453" title="Link to listing">#.Laguntza.Laguntza.I.Depth</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_454" title="Link to listing">#.Laguntza.Laguntza.I.IsNode</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_455" title="Link to listing">#.Laguntza.Laguntza.I.Parent</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_456" title="Link to listing">#.Laguntza.Laguntza.I.Row</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_457" title="Link to listing">#.Laguntza.Laguntza.I.Title</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_458" title="Link to listing">#.Laguntza.Laguntza.I.TopicName</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_459" title="Link to listing">#.Laguntza.Laguntza.Index.CollectPageDataForKeywords</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_460" title="Link to listing">#.Laguntza.Laguntza.Index.GetIndices</a></td><td></td><td>100</td><td>9</td></tr>
<tr class="fullyCovered"><td><a href="#listing_461" title="Link to listing">#.Laguntza.Laguntza.Index.NormalizeKeywords</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_462" title="Link to listing">#.Laguntza.Laguntza.Lint_.Browse</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_463" title="Link to listing">#.Laguntza.Laguntza.Lint_.CheckAmbiguousLinks</a></td><td></td><td>100</td><td>17</td></tr>
<tr class="fullyCovered"><td><a href="#listing_464" title="Link to listing">#.Laguntza.Laguntza.Lint_.CheckAmbiguousLinks_</a></td><td></td><td>100</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_465" title="Link to listing">#.Laguntza.Laguntza.Lint_.CheckBrokenLinks</a></td><td></td><td>100</td><td>13</td></tr>
<tr class="fullyCovered"><td><a href="#listing_466" title="Link to listing">#.Laguntza.Laguntza.Lint_.CheckBrokenLinks_</a></td><td></td><td>100</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_467" title="Link to listing">#.Laguntza.Laguntza.Lint_.CheckTopicProperty</a></td><td></td><td>100</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_468" title="Link to listing">#.Laguntza.Laguntza.Lint_.GetHelpBody</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_469" title="Link to listing">#.Laguntza.Laguntza.Lint_.IsolateLinks</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_470" title="Link to listing">#.Laguntza.Laguntza.Lint_.LookUpComplexLink</a></td><td></td><td>100</td><td>10</td></tr>
<tr class="fullyCovered"><td><a href="#listing_471" title="Link to listing">#.Laguntza.Laguntza.Lint_.RemoveCode</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_472" title="Link to listing">#.Laguntza.Laguntza.Search.AddTextToItems</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_473" title="Link to listing">#.Laguntza.Laguntza.Search.CR</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_474" title="Link to listing">#.Laguntza.Laguntza.Search.ConvertHtmlEntities</a></td><td></td><td>100</td><td>3</td></tr>
<tr class="fullyCovered"><td><a href="#listing_475" title="Link to listing">#.Laguntza.Laguntza.Search.EnforceCheckOfSearchStringLength</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_476" title="Link to listing">#.Laguntza.Laguntza.Search.EnforceDelay</a></td><td></td><td>100</td><td>0</td></tr>
<tr class="fullyCovered"><td><a href="#listing_477" title="Link to listing">#.Laguntza.Laguntza.Search.FullSearch</a></td><td></td><td>100</td><td>14</td></tr>
<tr class="fullyCovered"><td><a href="#listing_478" title="Link to listing">#.Laguntza.Laguntza.Search.GetFullyQualifiedNamesForDisplay</a></td><td></td><td>100</td><td>7</td></tr>
<tr class="fullyCovered"><td><a href="#listing_479" title="Link to listing">#.Laguntza.Laguntza.Search.GetState</a></td><td></td><td>100</td><td>6</td></tr>
<tr class="fullyCovered"><td><a href="#listing_480" title="Link to listing">#.Laguntza.Laguntza.Search.OnSearch</a></td><td></td><td>100</td><td>36</td></tr>
<tr class="fullyCovered"><td><a href="#listing_481" title="Link to listing">#.Laguntza.Laguntza.Search.PolishLocation</a></td><td></td><td>100</td><td>1</td></tr>
<tr class="fullyCovered"><td><a href="#listing_482" title="Link to listing">#.Laguntza.Laguntza.Search.ReadWords</a></td><td></td><td>100</td><td>4</td></tr>
<tr class="fullyCovered"><td><a href="#listing_483" title="Link to listing">#.Laguntza.Laguntza.Search.ResetList</a></td><td></td><td>100</td><td>5</td></tr>
<tr class="fullyCovered"><td><a href="#listing_484" title="Link to listing">#.Laguntza.Laguntza.Search.SearchAsIs</a></td><td></td><td>100</td><td>16</td></tr>
<tr class="fullyCovered"><td><a href="#listing_485" title="Link to listing">#.Laguntza.Laguntza.Search.SetState</a></td><td></td><td>100</td><td>4</td></tr>
</tbody>
</table>
</div>
<script>
$(document).ready(function() {
    var oTable;
    oTable = $("#percent").DataTable( {
        paging:   false,
        ordering: true,
        info:     true,
        fixedHeader: true,
        order: [2,"asc"],
        dom: "Bft",
        drawCallback: function( settings ) {
             var api = this.api();
             $('.header[id^="listing_"]').next().addBack().css("display","none");
             api.rows( {page:"current"} ).data().each(function(data){
              id = data[0];
              id = id.match(/"(\#.*?)"/);
              if (id){$(id[1]).next().addBack().css("display","block");}
             })
        },      
        buttons: [
        {
            text: "Partly covered (53)",
            titleAttr: "50%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^(?!(0%|100%)).*";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Uncovered (223)",
            titleAttr: "0%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "^0%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "Fully covered (209)",
            titleAttr: "100%",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = "100%";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
        {
            text: "All (485)",
            titleAttr: "all",
            className: "active",
            action: function ( e, dt, node, config ) {
                var text = this.text();
                var search = ".";
                oTable.column(2)
                    .search(search,true,false,false)
                    .draw();
                $(".dt-buttons button").removeClass("active");
                this.active( true );
            }
        },
    ],
 
        columnDefs: [
            {className: "align-right", targets: [2,3]
            },
            {
                render: function ( data, type, row, meta ) {
                            return data+"%" ;        
                        },
                targets: 2
            }
        ]             
    } );
    oTable.button(0).trigger();

} );    
</script>
<h2>Listings</h2>
<code class="header" id="listing_1">#.Laguntza.Laguntza.About &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←About ∆Ref</code>
<code class="emphasize">→[1]   r←{</code>
<code class="emphasize">→[2]       ∆Ref←⍵</code>
<code class="emphasize">→[3]       parms←⎕FREAD ∆Ref.f.tieNo ∆Ref.f.∆parms</code>
<code class="emphasize">→[4]       txt←{(0 1∊⍨|≡⍵):,⊂,⍵ ⋄ ⍵}∆Ref.p.helpAbout</code>
<code class="emphasize">→[5]       flag←~(0=≢,∆Ref.p.helpVersion)∧0=≢∆Ref.p.helpVersionDate</code>
<code class="emphasize">→[6]       txt,←flag/''('Version ',∆Ref.p.helpVersion,' from ',∆Ref.p.helpVersionDate)</code>
<code class="emphasize">→[7]       txt,←''('Location: ',∆Ref.p.folderName)</code>
<code class="emphasize">→[8]       caption←∆Ref.p.helpCaption</code>
<code class="emphasize">→[9]       caption Show txt</code>
<code> [10]  }∆Ref</code>
<code> [11]  ⍝ Called from the menu (About..."); Tells current version</code>
</div>
<code class="header" id="listing_2">#.Laguntza.Laguntza.AddBookmarkFirst &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  AddBookmarkFirst←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       in←⍵                                      ⍝ Item number</code>
<code class="emphasize">→[3]       0=in:⍬                                    ⍝ Nothing to add: get out</code>
<code class="emphasize">→[4]       id←∆Ref.d.tree[in;I.(Parent TopicName)]   ⍝ Parent and name as id</code>
<code class="emphasize">→[5]       ∆Ref.d.bookmark,←⊂id</code>
<code class="emphasize">→[6]       title←2⊃∆Ref.d.tree[↑in;]                 ⍝ Get the title (used as caption)</code>
<code class="emphasize">→[7]       name←'i1'                                 ⍝ Name for the menu item</code>
<code class="emphasize">→[8]       ∆←⊂'MenuItem'</code>
<code class="emphasize">→[9]       ∆,←⊂'Caption'title</code>
<code class="emphasize">→[10]      ∆,←⊂'Event' 'Select' 'OnMenuCmd' 'bookmark'</code>
<code class="emphasize">→[11]      rf←⍎name ∆Ref.n.bookmarkMenu.⎕WC ∆        ⍝ add to "Bookmarks" menu</code>
<code class="emphasize">→[12]      rf.id←id                                  ⍝ For identification (delete etc)</code>
<code class="emphasize">→[13]      rf.onSelect←'OnMenuCmd' 'bookmark'</code>
<code class="emphasize">→[14]      ∆Ref CheckBookmarkButton in</code>
<code> [15] ⍝ Called when the very first entry to the "Bookmarks" menu needs to be created</code>
<code> [16] ⍝ ⍵: Vector of length 2:</code>
<code> [17] ⍝    [0] Topic name</code>
<code> [18] ⍝    [2] Item number</code>
<code> [19]  }</code>
</div>
<code class="header" id="listing_3">#.Laguntza.Laguntza.AddBookmarkNext &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  AddBookmarkNext←{</code>
<code class="emphasize">→[1]       in←⍵</code>
<code class="emphasize">→[2]       0=in:⍬                                         ⍝ Nothing to do: get out</code>
<code class="emphasize">→[3]       0=≢in:⍬                                        ⍝ Nothing to do: get out</code>
<code class="emphasize">→[4]       ∆Ref←⍺</code>
<code class="emphasize">→[5]       id←∆Ref.d.tree[in;I.(Parent TopicName)]        ⍝ Parent+Name as id</code>
<code class="emphasize">→[6]       ∆Ref.d.bookmark,←⊂id                           ⍝ Remember it</code>
<code class="emphasize">→[7]       name←'i',⍕1++/'i'=↑¨∆Ref.n.bookmarkMenu.⎕WN''</code>
<code class="emphasize">→[8]       title←I.Title⊃∆Ref.d.tree[↑in;]                ⍝ Title of the topic</code>
<code class="emphasize">→[9]       ∆←⊂'MenuItem'</code>
<code class="emphasize">→[10]      ∆,←⊂'Caption'title</code>
<code class="emphasize">→[11]      rf←⍎name ∆Ref.n.bookmarkMenu.⎕WC ∆</code>
<code class="emphasize">→[12]      rf.id←id                                       ⍝ For identification (delete etc)</code>
<code class="emphasize">→[13]      rf.onSelect←'OnMenuCmd' 'bookmark'</code>
<code class="emphasize">→[14]      ∆Ref CheckBookmarkButton in</code>
<code> [15] ⍝ Called when entries need to be created in the "Bookmarks" menu.</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_4">#.Laguntza.Laguntza.AddSavedBookmarksToMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  AddSavedBookmarksToMenu←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       ins←⍵                                  ⍝ Item number(s)</code>
<code class="emphasize">→[3]       (0=≢ins):⍬                             ⍝ No Bookmarks: done!</code>
<code class="emphasize">→[4]       _←'sep1'∆Ref.n.bookmarkMenu.⎕WC'Separator'</code>
<code class="emphasize">→[5]       first←0⊃,ins</code>
<code class="emphasize">→[6]       _←∆Ref AddBookmarkFirst first</code>
<code class="emphasize">→[7]       (1=≢ins):⍬                             ⍝ Just one: done!</code>
<code class="emphasize">→[8]       _←∆Ref AddBookmarkNext¨1↓ins           ⍝ All remaining ones</code>
<code class="emphasize">→[9]       ⍬</code>
<code> [10] ⍝ Called at an early stage, after any Bookmarks have been read from the Registry</code>
<code> [11] ⍝ ⍵ are (valid! checked by caller) item numbers pointing into the tree.</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_5">#.Laguntza.Laguntza.AllowRide &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{waitFlag}AllowRide port</code>
<code> [1]  ⍝ If `port` is empty or 0 no action is taken. If it is a positiv integer it is interpreted as the port number</code>
<code> [2]  ⍝ Ride might connect to.\\</code>
<code> [3]  ⍝ The optional left argument defaults to 1 menaing that the function will loop in order to give the user the</code>
<code> [4]  ⍝ opportunity to issue an interrupt in order to take control.</code>
<code class="emphasize">→[5]   r←⍬</code>
<code class="emphasize">→[6]   waitFlag←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 1}'waitFlag'</code>
<code class="emphasize">→[7]   isDev←APLTreeUtils2.IsDevelopment</code>
<code class="emphasize">→[8]   ReturnCodes←⎕NS''</code>
<code class="emphasize">→[9]   ReturnCodes.CONGA_DLL_IS_MISSING←106</code>
<code class="emphasize">→[10]  ReturnCodes.RESETTING_CONNECTION_FAILED←107</code>
<code class="emphasize">→[11]  ReturnCodes.PORT_IN_USE←120</code>
<code class="emphasize">→[12]  ReturnCodes.RIDE_ERROR←109</code>
<code class="emphasize">→[13]  :If ((,0)≢,port)∧0&lt;≢port</code>
<code class="emphasize">→[14]      :If 0=≢FilesAndDirs.Dir'conga??_',((1+∨/'-64'⍷1⊃'#'⎕WG'APLVersion')⊃'32' '64'),'.dll'</code>
<code class="emphasize">→[15]          :If isDev</code>
<code class="emphasize">→[16]              'Conga DLL is missing"'⎕SIGNAL 6</code>
<code> [17]          :Else</code>
<code class="emphasize">→[18]              ⎕OFF ReturnCodes.CONGA_DLL_IS_MISSING</code>
<code> [19]          :EndIf</code>
<code> [20]      :Else</code>
<code class="emphasize">→[21]          {}3502⌶0</code>
<code class="emphasize">→[22]          rc←3502⌶'Serve::',⍕port</code>
<code class="emphasize">→[23]          :If rc≠0</code>
<code class="emphasize">→[24]              :If isDev</code>
<code class="emphasize">→[25]                  11 ⎕SIGNAL⍨'Ride error when resetting connection string to "',('Serve::',⍕port)'"; RC=',⍕rc</code>
<code> [26]              :Else</code>
<code class="emphasize">→[27]                  ⎕OFF ReturnCodes.RESETTING_CONNECTION_FAILED</code>
<code> [28]              :EndIf</code>
<code> [29]          :EndIf</code>
<code class="emphasize">→[30]          rc←3502⌶1</code>
<code class="emphasize">→[31]          :If ~rc∊0 ¯1</code>
<code class="emphasize">→[32]              :If 64≠rc</code>
<code class="emphasize">→[33]                  :If isDev</code>
<code class="emphasize">→[34]                      11 ⎕SIGNAL'Another application seems to use port ',⍕port</code>
<code> [35]                  :Else</code>
<code class="emphasize">→[36]                      ⎕OFF ReturnCodes.PORT_IN_USE</code>
<code> [37]                  :EndIf</code>
<code> [38]              :Else</code>
<code class="emphasize">→[39]                  :If isDev</code>
<code class="emphasize">→[40]                      11 ⎕SIGNAL⍨'Ride error when trying to activate Ride; RC=',⍕rc</code>
<code> [41]                  :Else</code>
<code class="emphasize">→[42]                      ⎕OFF ReturnCodes.RIDE_ERROR</code>
<code> [43]                  :EndIf</code>
<code> [44]              :EndIf</code>
<code> [45]          :EndIf</code>
<code class="emphasize">→[46]          {}{_←⎕DL ⍵ ⋄ ∇ ⍵}⍣(⊃waitFlag)⊣1 ⍝ Endless loop that allows us to have a RIDE and wait for an interrupt</code>
<code> [47]      :EndIf</code>
<code> [48]  :EndIf</code>
<code> [49] ⍝Done</code>
</div>
<code class="header" id="listing_6">#.Laguntza.Laguntza.AskForEdit1 &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←AskForEdit1(fnsName result length depth ticks)</code>
<code> [1]  ⍝ Asks the user whether she wants to fix the problem.</code>
<code> [2]  ⍝ Print some information regarding the lines causing the problem.</code>
<code> [3]  ⍝ r is 1 in case the user made an effort to fix the problem , otherwise 0.</code>
<code class="emphasize">→[4]   ⎕←{⍵↑'--- Attention ',⍵⍴'-'}⎕PW-1</code>
<code class="emphasize">→[5]   ⎕←'The function "',fnsName,' has a problem!'</code>
<code class="emphasize">→[6]   :If 1∊ticks</code>
<code class="emphasize">→[7]       ⎕←'  Odd numbers of ticks (`) in ',(+/ticks),' item(s)'</code>
<code> [8]   :EndIf</code>
<code class="emphasize">→[9]   :If 2∨.≠length</code>
<code class="emphasize">→[10]      ⎕←'  Length of ',(2+.≠length),' item(s) is invalid'</code>
<code> [11]  :EndIf</code>
<code class="emphasize">→[12]  :If ∨/~depth∊3 4</code>
<code class="emphasize">→[13]      ⎕←'  Depth of ',(+/~depth∊3 4),' item(s) is invalid'</code>
<code> [14]  :EndIf</code>
<code class="emphasize">→[15]  bool←(ticks)∨(2≠length)∨(~depth∊3 4)</code>
<code class="emphasize">→[16]  ⎕←'Problems:'</code>
<code class="emphasize">→[17]  ⎕←⍪'  '∘,¨{(70⌊≢⍵)↑⍵}¨∊¨bool/result</code>
<code class="emphasize">→[18]  :If r←YesOrNoInSession'Would you like to edit the function in order to fix the problem? (n=problem is ignored)'</code>
<code class="emphasize">→[19]      EditByQED fnsName</code>
<code> [20]  :EndIf</code>
</div>
<code class="header" id="listing_7">#.Laguntza.Laguntza.AskForEdit2 &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←AskForEdit2(varsName result ticks)</code>
<code> [1]  ⍝ Asks the user whether she wants to fix the problem.</code>
<code> [2]  ⍝ Print some information regarding the lines causing the problem.</code>
<code> [3]  ⍝ r is 1 in case the user made an effort to fix the problem , otherwise 0.</code>
<code class="emphasize">→[4]   ⎕←{⍵↑'--- Attention ',⍵⍴'-'}⎕PW-1</code>
<code class="emphasize">→[5]   ⎕←'The help page (variable) "',varsName,' has a problem!'</code>
<code class="emphasize">→[6]   :If 1∊ticks</code>
<code class="emphasize">→[7]       ⎕←'  Odd numbers of ticks (`) in ',(+/ticks),' item(s)'</code>
<code> [8]   :EndIf</code>
<code class="emphasize">→[9]   ⎕←'Problems:'</code>
<code class="emphasize">→[10]  ⎕←⍪'  '∘,¨{(70⌊≢⍵)↑⍵}¨∊¨ticks/RemoveCodeBlock result</code>
<code class="emphasize">→[11]  msg←''</code>
<code class="emphasize">→[12]  msg,←⊂'Would you like to edit the vars in order to fix the problem? (n=problem is ignored)'</code>
<code class="emphasize">→[13]  msg,←⊂'Note that you can have an odd number of back-ticks, for example a single 1 with ````!'</code>
<code class="emphasize">→[14]  :If r←YesOrNoInSession msg</code>
<code class="emphasize">→[15]      EditByQED varsName</code>
<code> [16]  :EndIf</code>
</div>
<code class="header" id="listing_8">#.Laguntza.Laguntza.AskForName &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{name}AskForName ∆Ref</code>
<code class="emphasize">→[1]   name←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'name'</code>
<code class="emphasize">→[2]   n←⎕NS''</code>
<code class="emphasize">→[3]   ∆←''</code>
<code class="emphasize">→[4]   ∆,←⊂'Caption' 'New help page'</code>
<code class="emphasize">→[5]   ∆,←⊂'Posn'(∆Ref.n.form.Posn+20 20)</code>
<code class="emphasize">→[6]   ∆,←⊂'Icon'∆Ref.n.form.IconObj</code>
<code class="emphasize">→[7]   ∆,←⊂'Coord' 'Pixel'</code>
<code class="emphasize">→[8]   ∆,←⊂'Size'(150 600)</code>
<code class="emphasize">→[9]   ∆,←⊂'MaxButton' 0</code>
<code class="emphasize">→[10]  ∆,←⊂'MinButton' 0</code>
<code class="emphasize">→[11]  ∆,←⊂'Sizeable' 0</code>
<code class="emphasize">→[12]  ∆,←⊂'Event'(9999 1)</code>
<code class="emphasize">→[13]  ∆,←⊂'IconObj'∆Ref.n.form.IconObj</code>
<code class="emphasize">→[14]  ∆,←⊂'FontObj'∆Ref.n.form.FontObj</code>
<code class="emphasize">→[15]  n.∆form←⎕NEW'Form'∆</code>
<code class="emphasize">→[16]  n.∆form.n←n</code>
<code> [17] </code>
<code class="emphasize">→[18]  ∆←''</code>
<code class="emphasize">→[19]  ∆,←⊂'Posn'(15 15)</code>
<code class="emphasize">→[20]  ∆,←⊂'Caption' 'Name of the new help page (must be a valid APL name; blanks become "_"):'</code>
<code class="emphasize">→[21]  n.Label←n.∆form.⎕NEW'Label'∆</code>
<code> [22] </code>
<code class="emphasize">→[23]  ∆←''</code>
<code class="emphasize">→[24]  ∆,←⊂'Posn'((10+↑+⌿⊃n.Label.(Posn Size)),15)</code>
<code class="emphasize">→[25]  ∆,←⊂'Size'(⍬ 370)</code>
<code class="emphasize">→[26]  ∆,←⊂'Text'name</code>
<code class="emphasize">→[27]  n.Name←n.∆form.⎕NEW'Edit'∆</code>
<code class="emphasize">→[28]  n.Name.Size[0]+←5</code>
<code> [29] </code>
<code class="emphasize">→[30]  ∆←''</code>
<code class="emphasize">→[31]  ∆,←⊂'Caption' '&amp;OK'</code>
<code class="emphasize">→[32]  ∆,←⊂'Size'(⍬ 100)</code>
<code class="emphasize">→[33]  ∆,←⊂'Default' 1</code>
<code class="emphasize">→[34]  n.OK←n.∆form.⎕NEW'Button'∆</code>
<code class="emphasize">→[35]  n.OK.Size[0]←⌊1.15×n.OK.Size[0]</code>
<code class="emphasize">→[36]  n.OK.Posn←(n.∆form.Size[0]-n.OK.Size[0]+10),15</code>
<code class="emphasize">→[37]  n.OK.onSelect←'OnSelectOkInAskForName'</code>
<code> [38] </code>
<code class="emphasize">→[39]  ∆←''</code>
<code class="emphasize">→[40]  ∆,←⊂'Caption' '&amp;Cancel'</code>
<code class="emphasize">→[41]  ∆,←⊂'Size'(⍬ 100)</code>
<code class="emphasize">→[42]  ∆,←⊂'Cancel' 1</code>
<code class="emphasize">→[43]  ∆,←⊂'Event'('Select' 1)</code>
<code class="emphasize">→[44]  n.Cancel←n.∆form.⎕NEW'Button'∆</code>
<code class="emphasize">→[45]  n.Cancel.Size[0]←⌊1.15×n.Cancel.Size[0]</code>
<code class="emphasize">→[46]  n.Cancel.Posn←(n.∆form.Size[0]-n.OK.Size[0]+10),15+1⊃+⌿⊃n.OK.(Posn Size)</code>
<code> [47] </code>
<code class="emphasize">→[48]  n.∆result←''</code>
<code> [49] </code>
<code class="emphasize">→[50]  ⎕NQ n.Name'GotFocus' ⋄ res←⎕DQ n.∆form</code>
<code class="emphasize">→[51]  r←n.∆result</code>
<code class="emphasize">→[52]  n.∆form.⎕EX'n'</code>
<code> [53] ⍝Done</code>
</div>
<code class="header" id="listing_9">#.Laguntza.Laguntza.AskForRename &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  newName←∆Ref AskForRename(parent pageName)</code>
<code class="emphasize">→[1]   flag←0</code>
<code class="emphasize">→[2]   newName←''</code>
<code class="emphasize">→[3]   :Repeat</code>
<code class="emphasize">→[4]       newName←pageName AskForName ∆Ref</code>
<code class="emphasize">→[5]       →(0=≢newName)/0</code>
<code class="emphasize">→[6]       newName←' '⎕R'_'⊣newName</code>
<code class="emphasize">→[7]       :If pageName≡newName</code>
<code class="emphasize">→[8]           msg←'You have not changed the name!?'</code>
<code class="emphasize">→[9]           'Rename problem'Show msg</code>
<code> [10]      :Else</code>
<code class="emphasize">→[11]          nc←parent.⎕NC newName</code>
<code class="emphasize">→[12]          :If ~flag←0=nc</code>
<code class="emphasize">→[13]              msg←'Sorry, this name:'('&lt; ',newName,' &gt;')'is already taken.'</code>
<code class="emphasize">→[14]              'Rename problem'Show msg</code>
<code> [15]          :EndIf</code>
<code> [16]      :EndIf</code>
<code class="emphasize">→[17]  :Until flag</code>
<code> [18] ⍝Done</code>
</div>
<code class="header" id="listing_10">#.Laguntza.Laguntza.AskWhetherSiblingOrChild &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref AskWhetherSiblingOrChild name</code>
<code> [1]  ⍝ User wishes to insert a help topic but it is not clear whether she wants it</code>
<code> [2]  ⍝ to be inserted as a sibling or into "name".</code>
<code> [3]  ⍝ Resturns 1 for "sibling" and 0 for "child".</code>
<code class="emphasize">→[4]   r←⍬</code>
<code class="emphasize">→[5]   n2←⎕NS''</code>
<code class="emphasize">→[6]   ∆←⊂'Caption' 'Laguntza - Insert Help Topic'</code>
<code class="emphasize">→[7]   ∆,←⊂'Coord' 'Pixel'</code>
<code class="emphasize">→[8]   ∆,←⊂'Posn'(50+∆Ref.n.form.Posn)</code>
<code class="emphasize">→[9]   ∆,←⊂'Size'(250 430)</code>
<code class="emphasize">→[10]  ∆,←⊂'SysMenu' 0</code>
<code class="emphasize">→[11]  ∆,←⊂'MaxButton' 0</code>
<code class="emphasize">→[12]  ∆,←⊂'MinButton' 0</code>
<code class="emphasize">→[13]  ∆,←⊂'Sizeable' 0</code>
<code class="emphasize">→[14]  n2.Form←⎕NEW'Form'∆</code>
<code> [15] </code>
<code class="emphasize">→[16]  ∆←⊂'Caption' 'Would you like to insert a help topic...'</code>
<code class="emphasize">→[17]  ∆,←⊂'Posn'(15 10)</code>
<code class="emphasize">→[18]  n2.Label1←n2.Form.⎕NEW'Label'∆</code>
<code> [19] </code>
<code class="emphasize">→[20]  ∆←⊂'Posn'((15+↑+⌿⊃n2.Label1.(Posn Size)),10)</code>
<code class="emphasize">→[21]  ∆,←⊂'Size'(90 250)</code>
<code class="emphasize">→[22]  n2.Group←n2.Form.⎕NEW'Group'∆</code>
<code> [23] </code>
<code class="emphasize">→[24]  caption←(0&lt;(⍎name).##.⎕NC'∆TopicProperties')⊃'&amp;as a sibling of' '&amp;after'</code>
<code class="emphasize">→[25]  ∆←⊂'Caption'caption</code>
<code class="emphasize">→[26]  ∆,←⊂'Posn'(15 10)</code>
<code class="emphasize">→[27]  ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[28]  ∆,←⊂'State' 0</code>
<code class="emphasize">→[29]  n2.Sibling←n2.Group.⎕NEW'Button'∆</code>
<code> [30] </code>
<code class="emphasize">→[31]  ∆←⊂'Caption' '&amp;into'</code>
<code class="emphasize">→[32]  ∆,←⊂'Posn'((5+↑+⌿⊃n2.Sibling.(Posn Size)),10)</code>
<code class="emphasize">→[33]  ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[34]  ∆,←⊂'State' 1</code>
<code class="emphasize">→[35]  n2.Into←n2.Group.⎕NEW'Button'∆</code>
<code> [36] </code>
<code class="emphasize">→[37]  ∆←⊂'Caption'(((1+≢⍕∆Ref.p.source)↓name),' ?')</code>
<code class="emphasize">→[38]  ∆,←⊂'Posn'((10+↑+⌿⊃n2.Group.(Posn Size))10)</code>
<code class="emphasize">→[39]  n2.Label2←n2.Form.⎕NEW'Label'∆</code>
<code> [40] </code>
<code class="emphasize">→[41]  ∆←⊂'Caption' 'OK'</code>
<code class="emphasize">→[42]  ∆,←⊂'Default' 1</code>
<code class="emphasize">→[43]  ∆,←⊂'Size'(⍬ 120)</code>
<code class="emphasize">→[44]  n2.OK←n2.Form.⎕NEW'Button'∆</code>
<code class="emphasize">→[45]  n2.OK.Posn←(↑n2.Form.Size-10+n2.OK.Size),10</code>
<code> [46] </code>
<code class="emphasize">→[47]  ∆←⊂'Caption' 'Cancel'</code>
<code class="emphasize">→[48]  ∆,←⊂'Cancel' 1</code>
<code class="emphasize">→[49]  ∆,←⊂'Size'(⍬ 120)</code>
<code class="emphasize">→[50]  n2.Cancel←n2.Form.⎕NEW'Button'∆</code>
<code class="emphasize">→[51]  n2.Cancel.Posn←(↑n2.Form.Size-10+n2.OK.Size),10+1↓+⌿⊃n2.OK.(Posn Size)</code>
<code class="emphasize">→[52]  n2.(OK Cancel).onSelect←1</code>
<code> [53] </code>
<code class="emphasize">→[54]  ⎕NQ n2.Into'GotFocus' ⋄ res←⎕DQ n2.Form</code>
<code class="emphasize">→[55]  :If n2.Cancel≢↑res</code>
<code class="emphasize">→[56]      r←↑n2.(Sibling Into).State/'sibling' 'into'</code>
<code> [57]  :EndIf</code>
<code> [58] ⍝Done</code>
</div>
<code class="header" id="listing_11">#.Laguntza.Laguntza.Between &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Between←{</code>
<code class="emphasize">→[1]      ⍺←'&lt;&gt;'</code>
<code class="emphasize">→[2]      {⍵∨≠\⍵}⍵∊⍺</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_12">#.Laguntza.Laguntza.BoldenTheseTopics &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  BoldenTheseTopics←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       rows←⍵</code>
<code class="emphasize">→[3]       st←∆Ref GetStates 1                    ⍝ Get status for all topics</code>
<code class="emphasize">→[4]       st[;4]←0                               ⍝ First reset ALL</code>
<code class="emphasize">→[5]       st[rows;4]←1                           ⍝ Set the "Bold" flag for the missed ones.</code>
<code class="emphasize">→[6]       ∆Ref.n.tree.Visible←0</code>
<code class="emphasize">→[7]       _←∆Ref SetStates st                    ⍝ Write status back</code>
<code class="emphasize">→[8]       ∆Ref.n.tree.Visible←1</code>
<code class="emphasize">→[9]       plural←1&lt;≢rows</code>
<code class="emphasize">→[10]      _←∆Ref SelectItemInTreeView(0⊃,rows)</code>
<code class="emphasize">→[11]      _←1 ⎕NQ ∆Ref.n.tree 9999               ⍝ Enforce screen update</code>
<code class="emphasize">→[12]      ∆Ref.n.infoSB.Text←(⍕≢rows),' page',(plural/'s'),' emphasized'</code>
<code class="emphasize">→[13]      ⍬</code>
<code> [14] ⍝ Emphasizes all rows given in ⍵ (row numbers for d.tree)</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_13">#.Laguntza.Laguntza.Bookmark &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Bookmark←{</code>
<code class="emphasize">→[1]       (0=≢⍵):⍬</code>
<code class="emphasize">→[2]       ∆Ref←⍺</code>
<code class="emphasize">→[3]       (n d)←∆Ref.(n d)</code>
<code class="emphasize">→[4]       (∧/⍵∊d.bookmark):⍬                             ⍝ Already bookmarked: done</code>
<code class="emphasize">→[5]       ~⍵∊∆Ref.d.tree[;I.Row]:⍬                       ⍝ Yes, this should not happen but it happens anyway</code>
<code class="emphasize">→[6]       f←AreThereNoBookmarksYet ∆Ref                  ⍝ Bookmark menu has just standard entries yet?</code>
<code class="emphasize">→[7]       _←n.bookmarkMenu{~⍵:'s1'⍺.⎕WC'Separator' ⋄ ⍬}f ⍝ Create a separator once</code>
<code class="emphasize">→[8]       0=≢∆Ref.d.bookmark:∆Ref AddBookmarkFirst ⍵     ⍝ Is it the very first?</code>
<code class="emphasize">→[9]       ∆Ref AddBookmarkNext ⍵</code>
<code> [10]      ⍝ Add a menu item to the "Bookmarks" menu. ⍵ Is the "itemNo"</code>
<code> [11]      ⍝ First line is always the most recent one.</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_14">#.Laguntza.Laguntza.BrowseTree &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  BrowseTree←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       data←∆Ref.d.tree</code>
<code class="emphasize">→[3]       colTitles←I.∆List[;0]</code>
<code class="emphasize">→[4]       buf←'='⍴⍨¨↑¨(≢¨colTitles)⌈⌈⌿≢¨⍕¨data</code>
<code class="emphasize">→[5]       data←colTitles⍪buf⍪data</code>
<code class="emphasize">→[6]       data←data[;I.(Row Depth IsNode Parent TopicName Title)]</code>
<code class="emphasize">→[7]       _←{{⍵}(#.⎕NS'').(⎕ED&amp;{'ed'}ed←⍵)}⎕FMT data</code>
<code class="emphasize">→[8]       ⍬</code>
<code> [9]  ⍝ Display the tree in a read-only edit windows with columns</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_15">#.Laguntza.Laguntza.ChangeTreeViewFontSize &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ChangeTreeViewFontSize←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       direction←⍵  ⍝ 1=increase, ¯1=decrease, 0=reset</code>
<code class="emphasize">→[3]       ~(⊂direction)∊0 1 ¯1:'Direction is invalid'⎕SIGNAL 11</code>
<code class="emphasize">→[4]       direction=0:∆Ref.n.treeFont.Size←∆Ref.n.font.Size</code>
<code class="emphasize">→[5]       ind←∆Ref.∆FontSizes⍳∆Ref.n.treeFont.Size       ⍝ Where are we now</code>
<code class="emphasize">→[6]       new←ind+direction</code>
<code class="emphasize">→[7]       new∊0,≢∆Ref.∆FontSizes:0                       ⍝ Max/min is reached</code>
<code class="emphasize">→[8]       ∆Ref.n.treeFont.Size←new⊃∆Ref.∆FontSizes       ⍝ Assign new value</code>
<code class="emphasize">→[9]       1:r←0</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_16">#.Laguntza.Laguntza.CheckSinglePageForAmbiguousLink &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckSinglePageForAmbiguousLink←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       A←∆Ref.d.A</code>
<code class="emphasize">→[3]       in←⍵</code>
<code class="emphasize">→[4]       buf←∆Ref Lint_.CheckAmbiguousLinks_ in</code>
<code class="emphasize">→[5]       (0=≢buf):Show'No ambiguous links found'</code>
<code class="emphasize">→[6]       ⎕←(⎕PW-1)⍴'--- Ambiguous links found in ',(I.TopicName⊃∆Ref.d.tree[in;]),' ',(A.FormatDateTime ⎕TS),⎕PW⍴'-'</code>
<code class="emphasize">→[7]       ⎕←⍪buf</code>
<code class="emphasize">→[8]       ⍬</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_17">#.Laguntza.Laguntza.CheckSinglePageForBrokenLink &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckSinglePageForBrokenLink←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       A←∆Ref.d.A</code>
<code class="emphasize">→[3]       in←⍵</code>
<code class="emphasize">→[4]       buf←∆Ref Lint_.CheckBrokenLinks_ in</code>
<code class="emphasize">→[5]       (0=≢buf):Show'No broken links found'</code>
<code class="emphasize">→[6]       ⎕←(⎕PW-1)⍴'--- Broken links found in ',(I.TopicName⊃∆Ref.d.tree[in;]),' ',(A.FormatDateTime ⎕TS),⎕PW⍴'-'</code>
<code class="emphasize">→[7]       ⎕←⍪buf</code>
<code class="emphasize">→[8]       ⍬</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_18">#.Laguntza.Laguntza.CheckTopIDsForUniqueness &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckTopIDsForUniqueness←{</code>
<code class="emphasize">→[1]       (unique all)←⍵</code>
<code class="emphasize">→[2]       (≢uniqueIds)=≢all:''⍬</code>
<code class="emphasize">→[3]       msg←'Some TopicIDs are not unique: ',↑{⍺,',',⍵}/⍕¨all/⍨~(all⍳all)=⍳≢all</code>
<code class="emphasize">→[4]       msg 11</code>
<code> [5]  ⍝ Returns '' ⍬ in case ⍵ contains just unique numbers</code>
<code> [6]  ⍝ Otherwise it returns 'errorMessage' 11</code>
<code> [7]  ⍝ This can be used in this way:</code>
<code> [8]  ⍝ ⎕SIGNAL/CheckTopIDsForUnique allIDs</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_19">#.Laguntza.Laguntza.Collapse &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Collapse←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       n←∆Ref.n</code>
<code class="emphasize">→[3]       itemNo←⍵</code>
<code class="emphasize">→[4]       state←⌽(32⍴2)⊤n.tree.GetItemState itemNo           ⍝ Get states</code>
<code class="emphasize">→[5]       isParent←&lt;/(∆Ref.d.tree[;I.Depth],¯1)[itemNo+0 1]  ⍝ Is it a parent?</code>
<code class="emphasize">→[6]       (isParent∧5⊃state):0,0/n.tree.Retracting itemNo    ⍝ Is expanded? Collapse!</code>
<code class="emphasize">→[7]       (0=itemNo):0                                       ⍝ It's the very first item? Get out!</code>
<code class="emphasize">→[8]       node←{⍵-{1⍳⍨(0⊃⍵)&gt;⍵}⌽∆Ref.d.tree[1+⍳⍵;I.Depth]}itemNo⍝ Calc next parent...</code>
<code class="emphasize">→[9]       _←n.tree.Retracting node                           ⍝ ... and collapse that one</code>
<code class="emphasize">→[10]      _←∆Ref SetItem node                                ⍝ Select the parent</code>
<code class="emphasize">→[11]      _←⎕NQ n.tree 9999                                  ⍝ Enforce an update</code>
<code class="emphasize">→[12]      0</code>
<code> [13]  ⍝ Called to collapse a branch. If "-" is pressed on something</code>
<code> [14]  ⍝ that is not a node the parent node is collapsed.</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_20">#.Laguntza.Laguntza.CollapseAll &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CollapseAll←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       n←∆Ref.n</code>
<code class="emphasize">→[3]       fu←⍵                                       ⍝ Force update</code>
<code class="emphasize">→[4]       no←≢n.tree.SelItems                        ⍝ No of items</code>
<code class="emphasize">→[5]       states←n.tree.GetItemState¨⍳no             ⍝ Get all states</code>
<code class="emphasize">→[6]       states←⌽⍉(32⍴2)⊤states                     ⍝ convert to Booleans</code>
<code class="emphasize">→[7]       states[;5 6]←0                             ⍝ Collapse all branches</code>
<code class="emphasize">→[8]       states←{2⊥⍉⌽⍵}states                       ⍝ Convert to Int</code>
<code class="emphasize">→[9]       _←states{n.tree.SetItemState ⍵ ⍺}¨⍳no      ⍝ Reset all states</code>
<code class="emphasize">→[10]      _←∆Ref SetItem 0                           ⍝ Select very first item</code>
<code class="emphasize">→[11]      _←{⍵:⎕NQ n.tree 9999 ⋄ ⍬}fu                ⍝ Force update</code>
<code class="emphasize">→[12]      _←⎕NQ n.tree'GotFocus'                     ⍝ Force focus to TreeView</code>
<code class="emphasize">→[13]      0</code>
<code> [14]  ⍝ Called from the menu to collapse literally everything</code>
<code> [15]  ⍝ ⍵ is boolean: 0 (default) = don't force update; 1 = force update</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_21">#.Laguntza.Laguntza.CollapseFrom &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CollapseFrom←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       n←∆Ref.n</code>
<code class="emphasize">→[3]       t←∆Ref.d.tree</code>
<code class="emphasize">→[4]       in←⍵</code>
<code class="emphasize">→[5]       ind←in,in WhereAreTheChildren ∆Ref.d.tree[;I.Depth]  ⍝ Which ones?</code>
<code class="emphasize">→[6]       states←n.tree.GetItemState¨ind             ⍝ Get all states</code>
<code class="emphasize">→[7]       states←⌽⍉(32⍴2)⊤states                     ⍝ convert to Booleans</code>
<code class="emphasize">→[8]       states[;5 6]←0                             ⍝ Collapse all branches</code>
<code class="emphasize">→[9]       states←{2⊥⍉⌽⍵}states                       ⍝ Convert to Int</code>
<code class="emphasize">→[10]      _←states{n.tree.SetItemState ⍵ ⍺}¨ind      ⍝ Reset all states</code>
<code class="emphasize">→[11]      n.tree.SelItems[in]←1                  ⍝ re-select original one</code>
<code class="emphasize">→[12]      0</code>
<code> [13] ⍝ Collapse only ⍵ and all it's it's children</code>
<code> [14]  }</code>
</div>
<code class="header" id="listing_22">#.Laguntza.Laguntza.CompileHelpFileInto &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {∆Ref}←source CompileHelpFileInto folder</code>
<code> [1]  ⍝ Compiles the help file into `folder` which, if empty, defaults to Help\.</code>
<code> [2]  ⍝ `source` is the namespace hosting the help system in question.</code>
<code> [3]  ⍝ The result is normally used by test cases only.</code>
<code class="emphasize">→[4]   A←APLTreeUtils2</code>
<code class="emphasize">→[5]   :If 0=≢folder</code>
<code class="emphasize">→[6]       folder←'help\'</code>
<code> [7]   :EndIf</code>
<code class="emphasize">→[8]   folder←⎕C folder</code>
<code class="emphasize">→[9]   folder←FilesAndDirs.AddTrailingSep folder</code>
<code class="emphasize">→[10]  ps←CreateParms ⍬</code>
<code class="emphasize">→[11]  ps.source←source</code>
<code class="emphasize">→[12]  ps.folderName←folder</code>
<code class="emphasize">→[13]  ∆Ref←CompileHelpFile ps</code>
<code class="emphasize">→[14]  icon←Icons.CreateIcon #</code>
<code class="emphasize">→[15]  icon.File←folder,'\help.ico'</code>
<code class="emphasize">→[16]  icon.FileWrite</code>
<code> [17] ⍝Done</code>
</div>
<code class="header" id="listing_23">#.Laguntza.Laguntza.CopyFullLinkToClipboard &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CopyFullLinkToClipboard←{</code>
<code class="emphasize">→[1]       ⍺←0                            ⍝ 1 = suppress user conformation</code>
<code class="emphasize">→[2]       ∆Ref←⍵</code>
<code class="emphasize">→[3]       row←GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[4]       ~row&lt;≢∆Ref.d.tree:⍬           ⍝ Sometimes something strange happens</code>
<code class="emphasize">→[5]       name←2⊃∆Ref.d.tree[row;]</code>
<code class="emphasize">→[6]       f←name{∆Ref.p.helpCaption YesOrNo'Copy short name of "',⍺,'" to clipboard?'}⍣(~⍺)⊣1</code>
<code class="emphasize">→[7]       link←↑{(⍕⍺),'.',⍵}/∆Ref.d.tree[row;4 1]</code>
<code class="emphasize">→[8]       ~f:⍬</code>
<code class="emphasize">→[9]       ∆Ref CopyToClipboard link</code>
<code class="emphasize">→[10]      ⍬</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_24">#.Laguntza.Laguntza.CopyFullPath2Clipboard &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CopyFullPath2Clipboard←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      in←⍵</code>
<code class="emphasize">→[3]      path←↑{⍺,'.',⍵}/∆Ref.d.tree[in;I.(Parent TopicName)]</code>
<code class="emphasize">→[4]      path↓⍨←1+≢⍕∆Ref.p.source</code>
<code class="emphasize">→[5]      ∆Ref CopyToClipboard path</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_25">#.Laguntza.Laguntza.CopyLinkToClipboard &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code class="emphasize">→CopyLinkToClipboard←{⍺←0            </code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      row←GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[3]      ~row&lt;≢∆Ref.d.tree:⍬            ⍝ Sometimes something strange happens</code>
<code class="emphasize">→[4]      (link name)←∆Ref.d.tree[row;1 2]</code>
<code class="emphasize">→[5]      f←name{∆Ref.p.helpCaption YesOrNo'Copy real name of "',⍺,'" to clipboard?'}⍣(~⍺)⊣1</code>
<code class="emphasize">→[6]      ~f:⍬</code>
<code class="emphasize">→[7]      ∆Ref CopyToClipboard link</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_26">#.Laguntza.Laguntza.CopyToClipboard &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CopyToClipboard←{</code>
<code class="emphasize">→[1]      (∆Ref txt)←2↑⍺,(≢⍺)↓'' 'Copied to clipboard'</code>
<code class="emphasize">→[2]      _←'cl'⎕WC'Clipboard'           ⍝ Create a clipboard object</code>
<code class="emphasize">→[3]      cl.Text←⍵                      ⍝ Write the name of the temp file to clipboard</code>
<code class="emphasize">→[4]      _←∆Ref SetInfoText txt         ⍝ Tell user</code>
<code class="emphasize">→[5]      ⍬</code>
<code> [6]  ⍝ Copies ⍵ onto the clipboard.</code>
<code> [7]  ⍝ Called by more specific Copy{Something}2Clipboard functions.</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_27">#.Laguntza.Laguntza.CreateStubDefaultPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CreateStubDefaultPage←{</code>
<code class="emphasize">→[1]      parent←⍵</code>
<code class="emphasize">→[2]      r←''</code>
<code class="emphasize">→[3]      r,←⊂'# ',A.Last parent</code>
<code class="emphasize">→[4]      r,←⊂''</code>
<code class="emphasize">→[5]      r,←⊂'Default page for node ',parent</code>
<code class="emphasize">→[6]      r</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_28">#.Laguntza.Laguntza.CreateTreeViewContextMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateTreeViewContextMenu←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       n←⎕NS''</code>
<code class="emphasize">→[3]       tree←∆Ref.n.tree                        ⍝ Create reference to GUI tree object</code>
<code class="emphasize">→[4]       tab←⎕UCS 9</code>
<code class="emphasize">→[5]       in←tree.SelItems{(≢⍺)=l←⍺⍳1:⍬ ⋄ l}1     ⍝ Currently selected item</code>
<code class="emphasize">→[6]       hc←0&lt;in NoOfChildren ∆Ref.d.tree[;I.Depth]  ⍝ Has it children?</code>
<code class="emphasize">→[7]       n.menu←⎕NEW⊂'Menu'</code>
<code class="emphasize">→[8]       n.collaps←n.menu.⎕NEW'MenuItem'(('Caption' 'Collapse incl. children')('Active'hc))</code>
<code class="emphasize">→[9]       n.expand←n.menu.⎕NEW'MenuItem'(('Caption' 'Expand incl. children')('Active'hc))</code>
<code class="emphasize">→[10]      bm←∆Ref IsBookmarkable in               ⍝ Gets 1 if item may be bookmarked</code>
<code class="emphasize">→[11]      tx←'Bookmark this item',tab,'Ctrl+D'</code>
<code class="emphasize">→[12]      n.bookmark←n.menu.⎕NEW'MenuItem'(('Caption'tx)('Active'bm))</code>
<code class="emphasize">→[13]      n.sep05←n.menu.⎕NEW⊂'Separator'</code>
<code class="emphasize">→[14]      tx←'Increase font size',tab,'Mouse wheel ↑'</code>
<code class="emphasize">→[15]      n.increaseFontSize←n.menu.⎕NEW'MenuItem'(⊂('Caption'tx))</code>
<code class="emphasize">→[16]      tx←'Decrease font size',tab,'Mouse wheel ↓'</code>
<code class="emphasize">→[17]      n.decreaseFontSize←n.menu.⎕NEW'MenuItem'(⊂('Caption'tx))</code>
<code class="emphasize">→[18]      tx←'Reset font size'</code>
<code class="emphasize">→[19]      n.resetFontSize←n.menu.⎕NEW'MenuItem'(⊂('Caption'tx))</code>
<code class="emphasize">→[20]      ('MenuItem'⎕WN n.menu).onSelect←1</code>
<code class="emphasize">→[21]      ∆Ref.p.userMode:n                       ⍝ Running in user mode? Done!</code>
<code> [22] </code>
<code class="emphasize">→[23]      n.sep10←n.menu.⎕NEW⊂'Separator'</code>
<code> [24] </code>
<code class="emphasize">→[25]      tx←∆Ref GetContextMenuCaptionForHelpPageEdit in</code>
<code class="emphasize">→[26]      n.editHelp←n.menu.⎕NEW'MenuItem'(⊂'Caption'tx)</code>
<code> [27] </code>
<code class="emphasize">→[28]      tx←'Copy short name to clipboard'</code>
<code class="emphasize">→[29]      n.copyShortName←n.menu.⎕NEW'MenuItem'(,⊂'Caption'tx)</code>
<code> [30] </code>
<code class="emphasize">→[31]      tx←'Copy full name to clipboard'</code>
<code class="emphasize">→[32]      n.copyFullName←n.menu.⎕NEW'MenuItem'(,⊂'Caption'tx)</code>
<code> [33] </code>
<code class="emphasize">→[34]      tx←'Print full name to []SE'</code>
<code class="emphasize">→[35]      n.printFullName←n.menu.⎕NEW'MenuItem'(,⊂'Caption'tx)</code>
<code> [36] </code>
<code class="emphasize">→[37]      n.sep15←n.menu.⎕NEW⊂'Separator'</code>
<code> [38] </code>
<code class="emphasize">→[39]      tx←'Inject new help page (stub)'</code>
<code class="emphasize">→[40]      n.injectPage←n.menu.⎕NEW'MenuItem'(⊂('Caption'tx))</code>
<code> [41] </code>
<code class="emphasize">→[42]      tx←'Inject new node'</code>
<code class="emphasize">→[43]      n.injectNode←n.menu.⎕NEW'MenuItem'(⊂('Caption'tx))</code>
<code> [44] </code>
<code class="emphasize">→[45]      n.renameHelp←n.menu.⎕NEW'MenuItem'(('Caption' 'Rename help page...')('Active'((0=∆Ref.d.tree[in;I.IsNode])∧0≠≢↑∆Ref GetVarsName in)))</code>
<code class="emphasize">→[46]      tx←∆Ref GetContextMenuCaptionForDeleteItemFromTreeView in</code>
<code class="emphasize">→[47]      n.deleteHelp←n.menu.⎕NEW'MenuItem'(,⊂('Caption'tx))</code>
<code> [48] </code>
<code class="emphasize">→[49]      tx←'Manage ∆TopicProperties'</code>
<code class="emphasize">→[50]      n.editTopicProperties←n.menu.⎕NEW'MenuItem'(⊂('Caption'tx))</code>
<code> [51] </code>
<code class="emphasize">→[52]      n.sep20←n.menu.⎕NEW⊂'Separator'</code>
<code> [53] </code>
<code class="emphasize">→[54]      tx←'Check for broken links'</code>
<code class="emphasize">→[55]      n.brokenLinks←n.menu.⎕NEW'MenuItem'(,⊂('Caption'tx))</code>
<code class="emphasize">→[56]      tx←'Check for ambiguous links'</code>
<code class="emphasize">→[57]      n.ambiguousLinks←n.menu.⎕NEW'MenuItem'(,⊂('Caption'tx))</code>
<code class="emphasize">→[58]      ('MenuItem'⎕WN n.menu).onSelect←1</code>
<code> [59] </code>
<code class="emphasize">→[60]      n</code>
<code> [61]  }</code>
</div>
<code class="header" id="listing_29">#.Laguntza.Laguntza.DefineSaltHomeFolder &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> path←DefineSaltHomeFolder name</code>
<code class="emphasize">→[1]  path←''</code>
<code class="emphasize">→[2]  BB←⍎'BB'⎕WC'BrowseBox'</code>
<code class="emphasize">→[3]  BB.Caption←'Select folder that will host the SALT folder &lt;',name,'&gt;'</code>
<code class="emphasize">→[4]  BB.(onFileBoxOK onFileBoxCancel)←1</code>
<code class="emphasize">→[5]  res←BB.Wait</code>
<code class="emphasize">→[6]  :If 'FileBoxOK'≡1⊃res</code>
<code class="emphasize">→[7]      path←BB.Target</code>
<code> [8]  :EndIf</code>
</div>
<code class="header" id="listing_30">#.Laguntza.Laguntza.DelAllBookmarks &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  DelAllBookmarks←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       n←∆Ref.n</code>
<code class="emphasize">→[3]       l←{⍵.⍎¨{⍵/⍨'i'=↑¨⍵}'MenuItem'⍵.⎕WN''}∆Ref.n.bookmarkMenu  ⍝ Refs to all bookmark menu item</code>
<code class="emphasize">→[4]       _←{⍵.Close ⍵}¨l</code>
<code class="emphasize">→[5]       n.bookmarkBtn.Active←1         ⍝ The Bookmark button</code>
<code class="emphasize">→[6]       n.addBookmark.Active←1         ⍝ Handle the "Add bookmark" menu item</code>
<code class="emphasize">→[7]       n.delBookmark.Active←0         ⍝ Handle the "Del bookmark" menu item</code>
<code class="emphasize">→[8]       n.delAllBookmarks.Active←0     ⍝ Handle the "Del all bookmarks" menu item</code>
<code class="emphasize">→[9]       ∆Ref.d.bookmark←''</code>
<code class="emphasize">→[10]      DelBookmarkSeparator ∆Ref</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_31">#.Laguntza.Laguntza.DelBookmark &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  DelBookmark←{</code>
<code class="emphasize">→[1]       (0=≢⍵):⍬</code>
<code class="emphasize">→[2]       ∆Ref←⍺</code>
<code class="emphasize">→[3]       all←{⍵.id}¨{⍵.⍎¨{⍵/⍨'i'=↑¨⍵}'MenuItem'⍵.⎕WN''}∆Ref.n.bookmarkMenu</code>
<code class="emphasize">→[4]       no←1+all⍳⊂id←∆Ref.d.tree[⍵;I.(Parent TopicName)]</code>
<code class="emphasize">→[5]       _←∆Ref.n.bookmarkMenu.⎕EX'i',⍕no       ⍝ Delete the menu item</code>
<code class="emphasize">→[6]       ∆Ref.d.bookmark~←⊂id                   ⍝ Remove from "memory"</code>
<code class="emphasize">→[7]       _←∆Ref CheckBookmarkButton ⍵</code>
<code class="emphasize">→[8]       1=AreThereNoBookmarksYet ∆Ref:⍬        ⍝ When there are bookmarks then we are done</code>
<code class="emphasize">→[9]       DelBookmarkSeparator ∆Ref</code>
<code> [10] ⍝ Delete one particular bookmark</code>
<code> [11] ⍝ First line is always the most recent one.</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_32">#.Laguntza.Laguntza.DelBookmarkSeparator &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> DelBookmarkSeparator←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      ⍬⊣{⍵.Close ⍬}'Separator'⎕WN ∆Ref.n.bookmarkMenu</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_33">#.Laguntza.Laguntza.DeleteDefaultPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←∆Ref DeleteDefaultPage(name parentName)</code>
<code class="emphasize">→[1]  r←⍬</code>
<code class="emphasize">→[2]  fnsName←parentName,'.',name</code>
<code class="emphasize">→[3]  DeleteAPL_Object fnsName</code>
<code class="emphasize">→[4]  {}Compile ∆Ref</code>
<code class="emphasize">→[5]  ∆Ref ShowTopic parentName</code>
</div>
<code class="header" id="listing_34">#.Laguntza.Laguntza.DeleteFromTopicProperties &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref DeleteFromTopicProperties(name parent)</code>
<code> [1]  ⍝ Deletes "name" from ∆TopicProiperties.</code>
<code class="emphasize">→[2]   :If r←3=parent.⎕NC'∆TopicProperties'</code>
<code class="emphasize">→[3]       result←parent.⍎'∆TopicProperties ⍬'</code>
<code class="emphasize">→[4]       result⌿⍨←~result[;0]∊⊂name</code>
<code class="emphasize">→[5]       body←⍪GetTopicPropertyTemplate ⍬</code>
<code class="emphasize">→[6]       body⍪←⍪ReformatTopicPropertyResult result</code>
<code class="emphasize">→[7]       parent.⎕FX,body</code>
<code class="emphasize">→[8]       ∆Ref TellLinkAboutChange(⍕parent),'.∆TopicProperties'</code>
<code> [9]   :EndIf</code>
</div>
<code class="header" id="listing_35">#.Laguntza.Laguntza.DeleteTopicProperty &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←∆Ref DeleteTopicProperty parent</code>
<code class="emphasize">→[1]  r←⍬</code>
<code class="emphasize">→[2]  DeleteAPL_Object(⍕parent),'.∆TopicProperties'</code>
<code class="emphasize">→[3]  {}Compile ∆Ref</code>
<code class="emphasize">→[4]  ∆Ref ShowTopic⍕parent</code>
</div>
<code class="header" id="listing_36">#.Laguntza.Laguntza.DisplayCurrentTopicInBrowser &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  DisplayCurrentTopicInBrowser←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       A←∆Ref.d.A</code>
<code class="emphasize">→[3]       (0=≢in←GetCurrentItem ∆Ref.n):0            ⍝ Which item (if any)?</code>
<code class="emphasize">→[4]       body←∆Ref File.GetHtmlFromFile in</code>
<code class="emphasize">→[5]       0=≢body:⍬⊣Show'This is a node without a default page'</code>
<code class="emphasize">→[6]       fs←2                                       ⍝ Font size; may be one of 1,2,3</code>
<code class="emphasize">→[7]       html←HTML.WrapInHtml(∆Ref fs body in)      ⍝ Create the self-contained HTML page</code>
<code class="emphasize">→[8]       f←GetTempFilename''</code>
<code class="emphasize">→[9]       f←(¯4↓f),'.html'</code>
<code class="emphasize">→[10]      _←(⊂html)FilesAndDirs.NPUT f</code>
<code class="emphasize">→[11]      _←A.GoToWebPage'file:///',f</code>
<code class="emphasize">→[12]      ⍬</code>
<code> [13] ⍝ Takes the currently selected topic, writes it into a tmep file and then</code>
<code> [14] ⍝ starts the defult browser on that file.</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_37">#.Laguntza.Laguntza.DisplayHtml &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←∆Ref DisplayHtml(fs c in t)</code>
<code> [1]  ⍝ Prepare HTML code and display it in the appropriate "Edit" control.</code>
<code> [2]  ⍝ Right argument: FontSize, code, itemNo, TestFlag</code>
<code class="emphasize">→[3]   r←⍬</code>
<code class="emphasize">→[4]   HTML.⎕SHADOW'A'</code>
<code class="emphasize">→[5]   HTML.A←A←∆Ref.d.A</code>
<code class="emphasize">→[6]   html←HTML.WrapInHtml(∆Ref fs c in)  ⍝ Create the self-contained HTML page</code>
<code class="emphasize">→[7]   :If ((,1)≢,tf)                      ⍝ testFlag is "on"? Get out!</code>
<code class="emphasize">→[8]       ∆Ref.n.browser.Text←html        ⍝ Assign the HTML to the "Edit"</code>
<code> [9]   :EndIf</code>
</div>
<code class="header" id="listing_38">#.Laguntza.Laguntza.Edit &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Edit←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       (in name)←⍵</code>
<code class="emphasize">→[3]       old←⍎name</code>
<code class="emphasize">→[4]       _←EditByQED name</code>
<code class="emphasize">→[5]       new←⍎name</code>
<code class="emphasize">→[6]       old≡new:0</code>
<code class="emphasize">→[7]       _←∆Ref UpdateFileData in</code>
<code class="emphasize">→[8]       _←PopulateIndexList ∆Ref</code>
<code class="emphasize">→[9]       1</code>
<code> [10]  ⍝ Let the user edit ⍵, checks whether anything has changed compared</code>
<code> [11]  ⍝ with the old version and if so updates the files but not the GUI!</code>
<code> [12]  ⍝ Returns 1 if something has changed, otherwise 0.</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_39">#.Laguntza.Laguntza.EditByQED &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{refToParent}EditByQED name</code>
<code> [1]  ⍝ Allows "edit-through" in version 14.1 and later.</code>
<code> [2]  ⍝ Returns 1 if the user has entered something, otherwise 0 if name points to a vars.</code>
<code> [3]  ⍝ Returns the result of ⎕FX if name points to a function (∆TopicProperties)</code>
<code class="emphasize">→[4]   refToParent←name{0&lt;⎕NC ⍵:⍎⍵ ⋄ ⍎↑{⍺,'.',⍵}/¯1↓'.'A.Split ⍺}'refToParent'</code>
<code class="emphasize">→[5]   flag←0</code>
<code class="emphasize">→[6]   :If 2=refToParent.⎕NC name</code>
<code class="emphasize">→[7]       refToParent.⍎name,'←,¨',name</code>
<code class="emphasize">→[8]       old←refToParent⍎name</code>
<code> [9]   :EndIf</code>
<code class="emphasize">→[10]  :Repeat</code>
<code class="emphasize">→[11]      {}(refToParent.⎕ED⍠('EditName' 'Allow'))name</code>
<code class="emphasize">→[12]      :If 3=refToParent.⎕NC name</code>
<code class="emphasize">→[13]          body←⎕CR name</code>
<code class="emphasize">→[14]          r←refToParent.⎕FX body</code>
<code class="emphasize">→[15]          :Return</code>
<code> [16]      :Else</code>
<code class="emphasize">→[17]          body←refToParent.⍎name</code>
<code> [18]      :EndIf</code>
<code class="emphasize">→[19]      :If r←0≠≢(∊body)~' '</code>
<code class="emphasize">→[20]          :If 1=2|≢'^\s{0,}~{3,} {0,}$'⎕S 0⍠('Mode' 'L')⊣body,⊂'~~~ 1'  ⍝ Odd number of code block fences?!</code>
<code class="emphasize">→[21]              msg←'There is an odd number of code block fences; please fix.'</code>
<code> [22]          :Else</code>
<code> [23]          ⍝ The following line checks for any level-1 headers.</code>
<code class="emphasize">→[24]              noOf←+/(⊂,'#')≡¨{⍵↑⍨⍵⍳' '}¨A.DLB RemoveCodeBlock body</code>
<code class="emphasize">→[25]              :Select noOf</code>
<code class="emphasize">→[26]              :Case 0</code>
<code class="emphasize">→[27]                  msg←'Please make sure that you have a header of level one.'</code>
<code class="emphasize">→[28]              :Case 1</code>
<code class="emphasize">→[29]                  flag←1</code>
<code> [30]              :Else</code>
<code class="emphasize">→[31]                  msg←'Please make sure that you have just one header of level one; you have '</code>
<code class="emphasize">→[32]                  msg,←(⍕noOf),' right now.'</code>
<code> [33]              :EndSelect</code>
<code> [34]          :EndIf</code>
<code class="emphasize">→[35]          :If 0=flag</code>
<code class="emphasize">→[36]              ('Problem with ',name)ShowError msg</code>
<code> [37]          :EndIf</code>
<code> [38]      :Else</code>
<code class="emphasize">→[39]          msg←'You have deleted the contents of the page entirely - are you sure about this?'</code>
<code class="emphasize">→[40]          :If ∆Ref.p.helpCaption YesOrNo msg</code>
<code class="emphasize">→[41]              flag←1</code>
<code> [42]          :Else</code>
<code class="emphasize">→[43]              ⍎(⍕refToParent),'.',name,'←old'</code>
<code> [44]          :EndIf</code>
<code> [45]      :EndIf</code>
<code class="emphasize">→[46]  :Until flag</code>
</div>
<code class="header" id="listing_40">#.Laguntza.Laguntza.EditDefaultPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref EditDefaultPage parent</code>
<code class="emphasize">→[1]   r←⍬</code>
<code class="emphasize">→[2]   ⎕SE.⎕SHADOW'TEMP'</code>
<code class="emphasize">→[3]   'TEMP'⎕SE.⎕NS''</code>
<code class="emphasize">→[4]   ⎕SE.TEMP.buffer←CreateStubDefaultPage parent</code>
<code class="emphasize">→[5]   okFlag←0</code>
<code class="emphasize">→[6]   :Repeat</code>
<code class="emphasize">→[7]       ⎕SE.TEMP EditByQED'buffer'</code>
<code class="emphasize">→[8]       :If 0=≢' '~⍨∊⎕SE.TEMP.buffer</code>
<code class="emphasize">→[9]           :Return</code>
<code> [10]      :EndIf</code>
<code class="emphasize">→[11]      ⍎parent,'.∆DefaultPage←⎕SE.TEMP.buffer'</code>
<code class="emphasize">→[12]      okFlag←1</code>
<code class="emphasize">→[13]  :Until okFlag</code>
<code class="emphasize">→[14]  ∆Ref TellLinkAboutChange parent,'.∆DefaultPage'</code>
<code class="emphasize">→[15]  {}Compile ∆Ref</code>
<code class="emphasize">→[16]  ∆Ref ShowTopic parent</code>
<code> [17] ⍝Done</code>
</div>
<code class="header" id="listing_41">#.Laguntza.Laguntza.EditFnsByQED &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←{refToParent}EditFnsByQED name</code>
<code> [1] ⍝ Allows "edit-through" in version 14.1 and later.</code>
<code class="emphasize">→[2]  refToParent←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ⎕THIS}'refToParent'</code>
<code class="emphasize">→[3]  :If 14.1≤↑(//)⎕VFI{⍵/⍨2&gt;+\'.'=⍵}1⊃'#'⎕WG'APLVersion'</code>
<code class="emphasize">→[4]      r←(refToParent.⎕ED⍠('EditName' 'Allow'))name</code>
<code> [5]  :Else</code>
<code class="emphasize">→[6]      r←refToParent.⎕ED name</code>
<code> [7]  :EndIf</code>
</div>
<code class="header" id="listing_42">#.Laguntza.Laguntza.EditFromIndex &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  EditFromIndex←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       in←⍵</code>
<code class="emphasize">→[3]       (0=≢name←∆Ref GetHelpVarsName in):0</code>
<code class="emphasize">→[4]       0=∆Ref Edit in name:0                  ⍝ Let user edit and get out if nothing got changed</code>
<code class="emphasize">→[5]       _←1 ⎕NQ ∆Ref.n.reportList 9999         ⍝ Enforce screen update</code>
<code class="emphasize">→[6]       0</code>
<code> [7]   ⍝ Let user (developers only) edit item number ⍵.</code>
<code> [8]   ⍝ By default this fns also enforces a screen update and moves the focus to the Index.</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_43">#.Laguntza.Laguntza.EditFromMainMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EditFromMainMenu←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      ∆Ref.p.userMode:⍬</code>
<code class="emphasize">→[3]      ⍬≡in←GetCurrentItem ∆Ref.n:⍬      ⍝ We might not have a current item</code>
<code class="emphasize">→[4]      ⍬⊣∆Ref EditFromTv in</code>
<code> [5] ⍝ This function is called only from the main menu.</code>
<code> [6] ⍝ Because of that we cannot be sure that there is a current item.</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_44">#.Laguntza.Laguntza.EditFromSearch &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  EditFromSearch←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       in←⍵</code>
<code class="emphasize">→[3]       in←∆Ref.n{0=≢⍵:GetCurrentItem ⍺ ⋄ ⍵}in ⍝ If "in" is empty we look it up.</code>
<code class="emphasize">→[4]       (0=≢in):⍬                              ⍝ item in question; empty: no item selected</code>
<code class="emphasize">→[5]       name←∆Ref GetHelpVarsName in</code>
<code class="emphasize">→[6]       0=∆Ref Edit in name:0                  ⍝ Let user edit and get out if nothing got changed</code>
<code class="emphasize">→[7]       _←1 ⎕NQ ∆Ref.n.reportList 9999         ⍝ Enforce screen update</code>
<code class="emphasize">→[8]       0</code>
<code> [9]   ⍝ Let user (developers only) edit item number ⍵</code>
<code> [10]  ⍝ By default this fns also enforces a screen update and moves</code>
<code> [11]  ⍝ the focus to the hit list</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_45">#.Laguntza.Laguntza.EditFromTv &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref EditFromTv in</code>
<code> [1]  ⍝ Let user (developers only) edit item number ⍵.</code>
<code> [2]  ⍝ Enforces a screen and file update.</code>
<code class="emphasize">→[3]   r←⍬</code>
<code class="emphasize">→[4]   changeFlag←0</code>
<code class="emphasize">→[5]   :If 0≠≢in←∆Ref.n{0=≢⍵:GetCurrentItem ⍺ ⋄ ⍵}in      ⍝ If "in" is empty we look it up.</code>
<code class="emphasize">→[6]       {}ResetStatusbar ∆Ref</code>
<code class="emphasize">→[7]       :If 0=≢varsName←∆Ref GetHelpVarsName in</code>
<code class="emphasize">→[8]           varsName←'∆DefaultPage'</code>
<code> [9]       :EndIf</code>
<code class="emphasize">→[10]      :If ∆Ref.d.tree[in;I.IsNode]</code>
<code class="emphasize">→[11]          :If ∆Ref TellAboutMissingDefaultPage in varsName</code>
<code class="emphasize">→[12]              :Return</code>
<code> [13]          :Else</code>
<code class="emphasize">→[14]              :Select ↑∆Ref EditOrDeleteDefaultPage ¯1↓↑'.'A.SplitPath varsName</code>
<code class="emphasize">→[15]              :Case 0                                ⍝ Cancel</code>
<code class="emphasize">→[16]                  :Return</code>
<code class="emphasize">→[17]              :Case 1</code>
<code class="emphasize">→[18]                  parentName←GetParentAndTopicNameAsText ∆Ref.d.tree[in;]</code>
<code class="emphasize">→[19]                  fullName←parentName,'.',varsName</code>
<code class="emphasize">→[20]                  changeFlag←∆Ref Edit in fullName   ⍝ Let user edit and get out if nothing got changed</code>
<code class="emphasize">→[21]              :Case 2</code>
<code class="emphasize">→[22]                  parentName←GetParentAndTopicNameAsText ∆Ref.d.tree[in;]</code>
<code class="emphasize">→[23]                  ∆Ref DeleteDefaultPage varsName parentName</code>
<code> [24]              :EndSelect</code>
<code> [25]          :EndIf</code>
<code> [26]      :Else</code>
<code class="emphasize">→[27]          changeFlag←∆Ref Edit in varsName    ⍝ Let user edit and get out if nothing got changed</code>
<code> [28]      :EndIf</code>
<code class="emphasize">→[29]      :If changeFlag</code>
<code class="emphasize">→[30]          1 ⎕NQ ∆Ref.n.tree 9999                     ⍝ Enforce screen update</code>
<code> [31]      :EndIf</code>
<code> [32]  :EndIf</code>
</div>
<code class="header" id="listing_46">#.Laguntza.Laguntza.EditOrDeleteDefaultPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref EditOrDeleteDefaultPage parentName</code>
<code> [1]  ⍝ Returns 0 for "Cancel", 1 for "Edit" and 2 for "Delete".</code>
<code class="emphasize">→[2]   r←0</code>
<code class="emphasize">→[3]   n2←⎕NS''</code>
<code class="emphasize">→[4]   ∆←⊂'Caption' 'Laguntza - Defaultpage'</code>
<code class="emphasize">→[5]   ∆,←⊂'Coord' 'Pixel'</code>
<code class="emphasize">→[6]   ∆,←⊂'Posn'(50+∆Ref.n.form.Posn)</code>
<code class="emphasize">→[7]   ∆,←⊂'Size'(230 230)</code>
<code class="emphasize">→[8]   ∆,←⊂'SysMenu' 0</code>
<code class="emphasize">→[9]   ∆,←⊂'MaxButton' 0</code>
<code class="emphasize">→[10]  ∆,←⊂'MinButton' 0</code>
<code class="emphasize">→[11]  ∆,←⊂'Sizeable' 0</code>
<code class="emphasize">→[12]  n2.Form←⎕NEW'Form'∆</code>
<code> [13] </code>
<code class="emphasize">→[14]  ∆←⊂'Caption' 'What would you like to do?'</code>
<code class="emphasize">→[15]  ∆,←⊂'Posn'(15 10)</code>
<code class="emphasize">→[16]  n2.Label1←n2.Form.⎕NEW'Label'∆</code>
<code> [17] </code>
<code class="emphasize">→[18]  ∆←⊂'Posn'((5+↑+⌿⊃n2.Label1.(Posn Size)),10)</code>
<code class="emphasize">→[19]  ∆,←⊂'Size'(80 120)</code>
<code> [20] ⍝ ∆,←⊂'Caption' ' Options '</code>
<code class="emphasize">→[21]  n2.Group←n2.Form.⎕NEW'Group'∆</code>
<code> [22] </code>
<code class="emphasize">→[23]  ∆←⊂'Caption' '&amp;Edit'</code>
<code class="emphasize">→[24]  ∆,←⊂'Posn'(20 10)</code>
<code class="emphasize">→[25]  ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[26]  ∆,←⊂'State' 1</code>
<code class="emphasize">→[27]  n2.Edit←n2.Group.⎕NEW'Button'∆</code>
<code> [28] </code>
<code class="emphasize">→[29]  ∆←⊂'Caption' '&amp;Delete'</code>
<code class="emphasize">→[30]  ∆,←⊂'Posn'((5+↑+⌿⊃n2.Edit.(Posn Size)),10)</code>
<code class="emphasize">→[31]  ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[32]  n2.Delete←n2.Group.⎕NEW'Button'∆</code>
<code> [33] </code>
<code class="emphasize">→[34]  ∆←⊂'Caption'('the default page in:')</code>
<code class="emphasize">→[35]  ∆,←⊂'Posn'((10+↑+⌿⊃n2.Group.(Posn Size))10)</code>
<code class="emphasize">→[36]  n2.Label2←n2.Form.⎕NEW'Label'∆</code>
<code> [37] </code>
<code class="emphasize">→[38]  ∆←⊂'Caption'('&lt;',((1+≢⍕∆Ref.p.source)↓parentName),'&gt;')</code>
<code class="emphasize">→[39]  ∆,←⊂'Posn'((2+↑+⌿⊃n2.Label2.(Posn Size))10)</code>
<code class="emphasize">→[40]  n2.Label3←n2.Form.⎕NEW'Label'∆</code>
<code> [41] </code>
<code class="emphasize">→[42]  ∆←⊂'Caption' 'OK'</code>
<code class="emphasize">→[43]  ∆,←⊂'Default' 1</code>
<code class="emphasize">→[44]  ∆,←⊂'Size'(⍬ 100)</code>
<code class="emphasize">→[45]  n2.OK←n2.Form.⎕NEW'Button'∆</code>
<code class="emphasize">→[46]  n2.OK.Posn←(↑n2.Form.Size-14+n2.OK.Size),10</code>
<code class="emphasize">→[47]  n2.OK.Size[0]+←6</code>
<code> [48] </code>
<code class="emphasize">→[49]  ∆←⊂'Caption' 'Cancel'</code>
<code class="emphasize">→[50]  ∆,←⊂'Cancel' 1</code>
<code class="emphasize">→[51]  ∆,←⊂'Size'((n2.OK.Size[0]),100)</code>
<code class="emphasize">→[52]  n2.Cancel←n2.Form.⎕NEW'Button'∆</code>
<code class="emphasize">→[53]  n2.Cancel.Posn←(n2.OK.Posn[0]),10+1↓+⌿⊃n2.OK.(Posn Size)</code>
<code class="emphasize">→[54]  n2.(OK Cancel).onSelect←1</code>
<code> [55] </code>
<code class="emphasize">→[56]  ⎕NQ n2.Edit'GotFocus' ⋄ res←⎕DQ n2.Form</code>
<code class="emphasize">→[57]  :If n2.Cancel≢↑res</code>
<code class="emphasize">→[58]      r←↑n2.(Edit Delete).State/1 2</code>
<code> [59]  :EndIf</code>
<code> [60] ⍝Done</code>
</div>
<code class="header" id="listing_47">#.Laguntza.Laguntza.EditOrDeleteTopicPropertiesPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref EditOrDeleteTopicPropertiesPage parentName</code>
<code> [1]  ⍝ Returns 0 for "Cancel", 1 for "Edit" and 2 for "Delete".</code>
<code class="emphasize">→[2]   r←0</code>
<code class="emphasize">→[3]   n2←⎕NS''</code>
<code class="emphasize">→[4]   ∆←⊂'Caption' 'Laguntza - TopicProperty page'</code>
<code class="emphasize">→[5]   ∆,←⊂'Coord' 'Pixel'</code>
<code class="emphasize">→[6]   ∆,←⊂'Posn'(50+∆Ref.n.form.Posn)</code>
<code class="emphasize">→[7]   ∆,←⊂'Size'(255 300)</code>
<code class="emphasize">→[8]   ∆,←⊂'SysMenu' 0</code>
<code class="emphasize">→[9]   ∆,←⊂'MaxButton' 0</code>
<code class="emphasize">→[10]  ∆,←⊂'MinButton' 0</code>
<code class="emphasize">→[11]  ∆,←⊂'Sizeable' 0</code>
<code class="emphasize">→[12]  n2.Form←⎕NEW'Form'∆</code>
<code> [13] </code>
<code class="emphasize">→[14]  ∆←⊂'Caption' 'What would you like to do?'</code>
<code class="emphasize">→[15]  ∆,←⊂'Posn'(15 10)</code>
<code class="emphasize">→[16]  n2.Label1←n2.Form.⎕NEW'Label'∆</code>
<code> [17] </code>
<code class="emphasize">→[18]  ∆←⊂'Posn'((5+↑+⌿⊃n2.Label1.(Posn Size)),13)</code>
<code class="emphasize">→[19]  ∆,←⊂'Size'(90 150)</code>
<code> [20] ⍝ ∆,←⊂'Caption' ' Options '</code>
<code class="emphasize">→[21]  n2.Group←n2.Form.⎕NEW'Group'∆</code>
<code> [22] </code>
<code class="emphasize">→[23]  ∆←⊂'Caption' '&amp;Edit'</code>
<code class="emphasize">→[24]  ∆,←⊂'Posn'(20 10)</code>
<code class="emphasize">→[25]  ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[26]  ∆,←⊂'State' 1</code>
<code class="emphasize">→[27]  n2.Edit←n2.Group.⎕NEW'Button'∆</code>
<code> [28] </code>
<code class="emphasize">→[29]  ∆←⊂'Caption' '&amp;Delete'</code>
<code class="emphasize">→[30]  ∆,←⊂'Posn'((5+↑+⌿⊃n2.Edit.(Posn Size)),10)</code>
<code class="emphasize">→[31]  ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[32]  n2.Delete←n2.Group.⎕NEW'Button'∆</code>
<code> [33] </code>
<code class="emphasize">→[34]  ∆←⊂'Caption'('the ∆TopicProperty page in:')</code>
<code class="emphasize">→[35]  ∆,←⊂'Posn'((5+↑+⌿⊃n2.Group.(Posn Size))13)</code>
<code class="emphasize">→[36]  n2.Label2←n2.Form.⎕NEW'Label'∆</code>
<code> [37] </code>
<code class="emphasize">→[38]  ∆←⊂'Caption'('&lt; ',((1+≢⍕∆Ref.p.source)↓parentName),' &gt;')</code>
<code class="emphasize">→[39]  ∆,←⊂'Posn'((2+↑+⌿⊃n2.Label2.(Posn Size))13)</code>
<code class="emphasize">→[40]  n2.Label3←n2.Form.⎕NEW'Label'∆</code>
<code> [41] </code>
<code class="emphasize">→[42]  ∆←⊂'Caption' 'OK'</code>
<code class="emphasize">→[43]  ∆,←⊂'Default' 1</code>
<code class="emphasize">→[44]  ∆,←⊂'Size'(⍬ 110)</code>
<code class="emphasize">→[45]  n2.OK←n2.Form.⎕NEW'Button'∆</code>
<code class="emphasize">→[46]  n2.OK.Posn←(↑n2.Form.Size-15+n2.OK.Size),10</code>
<code class="emphasize">→[47]  n2.OK.Size[0]+←5</code>
<code> [48] </code>
<code class="emphasize">→[49]  ∆←⊂'Caption' 'Cancel'</code>
<code class="emphasize">→[50]  ∆,←⊂'Cancel' 1</code>
<code class="emphasize">→[51]  ∆,←⊂'Size'n2.OK.Size</code>
<code class="emphasize">→[52]  n2.Cancel←n2.Form.⎕NEW'Button'∆</code>
<code class="emphasize">→[53]  n2.Cancel.Posn←(n2.OK.Posn[0]),10+1↓+⌿⊃n2.OK.(Posn Size)</code>
<code class="emphasize">→[54]  n2.(OK Cancel).onSelect←1</code>
<code> [55] </code>
<code class="emphasize">→[56]  ⎕NQ n2.Edit'GotFocus' ⋄ res←⎕DQ n2.Form</code>
<code class="emphasize">→[57]  :If n2.Cancel≢↑res</code>
<code class="emphasize">→[58]      r←↑n2.(Edit Delete).State/1 2</code>
<code> [59]  :EndIf</code>
<code> [60] ⍝Done</code>
</div>
<code class="header" id="listing_48">#.Laguntza.Laguntza.EmphasizeHitsInHTML &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  EmphasizeHitsInHTML←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       html←⍺</code>
<code class="emphasize">→[3]       0=≢ss←∆Ref.s.searchString:html         ⍝ Search string</code>
<code class="emphasize">→[4]       fw←∆Ref.s.matchWholeWord               ⍝ Full word</code>
<code class="emphasize">→[5]       ic←↑∆Ref.s.ignoreCase                  ⍝ Ignore case</code>
<code class="emphasize">→[6]       (lf nl)←⎕UCS 10 13                     ⍝ Line feed and new line as separators</code>
<code class="emphasize">→[7]       html2←html←lf,↑,/nl,¨html              ⍝ Add leading lf and make simple</code>
<code class="emphasize">→[8]       mask←{{⍵∨≠\⍵}⍵∊'&lt;&gt;'}html               ⍝ Mask for the HTML as such</code>
<code class="emphasize">→[9]       (mask/html2)←' '                       ⍝ Wipe out HTML</code>
<code class="emphasize">→[10]      html2←⎕C⍣ic⊣html2                      ⍝ Conditional lowercase</code>
<code class="emphasize">→[11]      ss←⎕C⍣ic⊣ss                            ⍝ Conditional lowercase</code>
<code class="emphasize">→[12]      html2←SeparateWords html2              ⍝ Replace anything that separates words by blanks</code>
<code class="emphasize">→[13]      ss2←fw{⍺:' ',⍵,' ' ⋄ ⍵}ss              ⍝ If "Full word" add blanks</code>
<code class="emphasize">→[14]      bool←ss2⍷html2                         ⍝ Booleans indicating the hits</code>
<code class="emphasize">→[15]      0=+/bool:nl{⍵⊂⍨⍺≠⍵}html                ⍝ No hits? Done!</code>
<code class="emphasize">→[16]      ind←fw+{⍵/⍳≢⍵}bool                     ⍝ Where are the hits</code>
<code class="emphasize">→[17]      ind-←0,¯1↓ind</code>
<code class="emphasize">→[18]      html←(ss'&lt;span class="emphasize"&gt;' '&lt;/span&gt;')ReplaceSearchStringByEmphasizeSpan ind html ⍝ Workhorse</code>
<code class="emphasize">→[19]      html({1↓⍺⌽⍨⍺⍳⍵})←lf                    ⍝ Restore order</code>
<code class="emphasize">→[20]      nl{⍵⊂⍨⍺≠⍵}html                         ⍝ Split at newline</code>
<code> [21] ⍝ Emphesizes the search term in the HTML (⍺)</code>
<code> [22]  }</code>
</div>
<code class="header" id="listing_49">#.Laguntza.Laguntza.EstablishCssFile &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EstablishCssFile←{</code>
<code> [1] ⍝ Writes ⍺ (the CSS) to ⍵ (filename)</code>
<code class="emphasize">→[2]      css←⍺</code>
<code class="emphasize">→[3]      fn←⍵</code>
<code class="emphasize">→[4]      (⊂css)FilesAndDirs.NPUT fn</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_50">#.Laguntza.Laguntza.ExecHelpParms &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ExecHelpParms←{</code>
<code> [1]  ⍝ Takes a ref and tries to execute ∆TopicProperties.</code>
<code> [2]  ⍝ If it cannot find ∆TopicProperties it returns a table with default values.</code>
<code> [3]  ⍝ ⍺ is, when specified, the level in the tree view. It defaults to 0.</code>
<code class="emphasize">→[4]       ⍺←0</code>
<code class="emphasize">→[5]       (0&lt;⍵.⎕NC'∆TopicProperties'):(⍵ CheckItemTitle DropUnwanted ⍺{(0=≢⍺):⍵ ⋄ ⍺,⍵}⍵.⍎'∆TopicProperties ⍬'),⍵</code>
<code class="emphasize">→[6]       l←⍵.⎕NL-3.2 9.1</code>
<code class="emphasize">→[7]       l←(~(↑¨l)∊¨⊂'∆_')⌿l</code>
<code class="emphasize">→[8]       (⍺{(0=≢⍺):⍵ ⋄ ⍺,⍵}⊃{(⊂⍵),(⊂PolishName ⍵),1 0}¨l),⍵   ⍝ name, caption, active, dev only, ref</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_51">#.Laguntza.Laguntza.Expand &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Expand←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      0⊣∆Ref.n.tree.Expanding ⍵          ⍝ Expand item ⍵</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_52">#.Laguntza.Laguntza.ExpandAll &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ExpandAll←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       n←∆Ref.n</code>
<code class="emphasize">→[3]       fu←⍵                                       ⍝ Force update</code>
<code class="emphasize">→[4]       ci←GetCurrentItem n                        ⍝ What's the current item?</code>
<code class="emphasize">→[5]       no←≢n.tree.SelItems                        ⍝ How many items?</code>
<code class="emphasize">→[6]       cb←n.tree.onExpanding                      ⍝ Remember callback &amp; argument</code>
<code class="emphasize">→[7]       n.tree.onExpanding←0                       ⍝ Switch off temporarily</code>
<code class="emphasize">→[8]       states←n.tree.GetItemState¨⍳no             ⍝ Get all states</code>
<code class="emphasize">→[9]       states←⌽⍉(32⍴2)⊤states                     ⍝ convert to Booleans</code>
<code class="emphasize">→[10]      states[;5]←1                               ⍝ Expand all branches</code>
<code class="emphasize">→[11]      states←{2⊥⍉⌽⍵}states                       ⍝ Convert to Int</code>
<code class="emphasize">→[12]      n.tree.Visible←0                           ⍝ Avoid flickering by making it invisible</code>
<code class="emphasize">→[13]      _←states{n.tree.SetItemState ⍵ ⍺}¨⍳no      ⍝ Reset all states</code>
<code class="emphasize">→[14]      _←n.tree.ShowItem ci                       ⍝ Bring what was the current item back into sight</code>
<code class="emphasize">→[15]      n.tree.Visible←1                           ⍝ Bring it back</code>
<code class="emphasize">→[16]      n.tree.onExpanding←cb                      ⍝ Re-establish the callback</code>
<code class="emphasize">→[17]      _←{⍵:⎕NQ n.tree 9999 ⋄ ⍬}fu                ⍝ Force update</code>
<code class="emphasize">→[18]      _←⎕NQ n.tree'GotFocus'                     ⍝ Force focus to TreeView</code>
<code class="emphasize">→[19]      0</code>
<code> [20]  ⍝ Called from the menu to collapse literally everything</code>
<code> [21]  ⍝ ⍵ is boolean: 0 (default) = don't force update; 1 = force update</code>
<code> [22]  }</code>
</div>
<code class="header" id="listing_53">#.Laguntza.Laguntza.ExpandFrom &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ExpandFrom←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       n←∆Ref.n</code>
<code class="emphasize">→[3]       in←⍵                                   ⍝ Item number</code>
<code class="emphasize">→[4]       ind←in,in WhereAreTheChildren ∆Ref.d.tree[;I.Depth]  ⍝ Which ones?</code>
<code class="emphasize">→[5]       states←n.tree.GetItemState¨ind         ⍝ Get all states</code>
<code class="emphasize">→[6]       states←⌽⍉(32⍴2)⊤states                 ⍝ convert to Booleans</code>
<code class="emphasize">→[7]       states[;5]←1                           ⍝ Expand all branches</code>
<code class="emphasize">→[8]       states←{2⊥⍉⌽⍵}states                   ⍝ Convert to Int</code>
<code class="emphasize">→[9]       n.tree.Visible←0                       ⍝ Make invisible</code>
<code class="emphasize">→[10]      _←states{n.tree.SetItemState ⍵ ⍺}¨ind  ⍝ Reset all states</code>
<code class="emphasize">→[11]      n.tree.SelItems[in]←1                  ⍝ re-select original one</code>
<code class="emphasize">→[12]      _←n.tree.ShowItem in                   ⍝ Force it back, just in case</code>
<code class="emphasize">→[13]      n.tree.Visible←1                       ⍝ Bring it back</code>
<code class="emphasize">→[14]      _←⎕NQ n.tree'GotFocus'                 ⍝ Force focus back to TreeView</code>
<code class="emphasize">→[15]      0</code>
<code> [16]  ⍝ Expand only ⍵ and all it's children</code>
<code> [17]  }</code>
</div>
<code class="header" id="listing_54">#.Laguntza.Laguntza.Export2HTML &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←Export2HTML ∆Ref</code>
<code> [1]  ⍝ Called from the "File" menu. Used to export the current help system</code>
<code> [2]  ⍝ as an independent HTML web site.\\</code>
<code> [3]  ⍝ `index.html` is the  entry page. Any sub namespaces in `ref` will become</code>
<code> [4]  ⍝ sub folders in `folder`. They all will have a page `index.html` as well.\\</code>
<code> [5]  ⍝ This functions creates a mixture of HTML files and folders that act as</code>
<code> [6]  ⍝ a simplified representation of the help system in pure HTML. It lacks</code>
<code> [7]  ⍝ any other functionality than links: no search feature in particular.\\</code>
<code> [8]  ⍝ However, with a proper index it might still be useful.\\</code>
<code> [9]  ⍝ The reason for having this is that it's the only way to make the help</code>
<code> [10] ⍝ system available under Linux.</code>
<code class="emphasize">→[11]  :If 0≠≢folder←GetFolder ⍬</code>
<code class="emphasize">→[12]  :AndIf 1=1 ⎕NINFO folder</code>
<code class="emphasize">→[13]      :If 0=≢↑0 ⎕NINFO⍠('Follow' 1)('Wildcard' 1)⊣folder,'*'</code>
<code class="emphasize">→[14]          ShowEggTimer ∆Ref</code>
<code class="emphasize">→[15]          Export2HTML_.Run ∆Ref folder</code>
<code class="emphasize">→[16]          RemoveEggTimer ∆Ref</code>
<code> [17]      :Else</code>
<code class="emphasize">→[18]          'Export folder'Show'Folder is not empty'</code>
<code class="emphasize">→[19]          :Return</code>
<code> [20]      :EndIf</code>
<code> [21]  :EndIf</code>
</div>
<code class="header" id="listing_55">#.Laguntza.Laguntza.FillRowsInIndicesMatrix &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←FillRowsInIndicesMatrix vec</code>
<code class="emphasize">→[1]  emptyRows←⍸0=≢¨vec</code>
<code class="emphasize">→[2]  r←emptyRows{0=≢e←⍺:⍵ ⋄ m←⍵ ⋄ m[e]←m[e-1] ⋄ (1↓e)∇ m}vec</code>
</div>
<code class="header" id="listing_56">#.Laguntza.Laguntza.GetBookmark &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetBookmark←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       id←{⍵.id}∆Ref.n.bookmarkMenu.⍎⍵</code>
<code class="emphasize">→[3]       in←1⍳⍨↑∧/id{⍺∘≡¨⍵}¨↓⍉∆Ref.d.tree[;I.(Parent TopicName)]</code>
<code class="emphasize">→[4]       _←Display ∆Ref in                  ⍝ Display it</code>
<code class="emphasize">→[5]       _←SelectTreeView ∆Ref              ⍝ Force TreeView to be THE tab</code>
<code class="emphasize">→[6]       0</code>
<code> [7]   ⍝ Called by selecting an item from the "Bookmarked" menu, if there is any.</code>
<code> [8]   ⍝ Forces also the TreeView to be the current tab if it is not.</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_57">#.Laguntza.Laguntza.GetContextMenuCaptionForDeleteItemFromTreeView &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetContextMenuCaptionForDeleteItemFromTreeView←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      in←⍵</code>
<code class="emphasize">→[3]      (I.IsNode⊃∆Ref.d.tree[in;]):'Delete node...'</code>
<code> [4]      'Delete help page...'</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_58">#.Laguntza.Laguntza.GetContextMenuCaptionForHelpPageEdit &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetContextMenuCaptionForHelpPageEdit←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       in←⍵</code>
<code class="emphasize">→[3]       caption←↑∆Ref GetVarsName in</code>
<code class="emphasize">→[4]       0=∆Ref.d.tree[in;I.IsNode]:'Edit help page',(⎕UCS 9),'Ctrl+Enter'</code>
<code class="emphasize">→[5]       'Managing ∆DefaultPage',(⎕UCS 9),'Ctrl+Enter'</code>
<code> [6]  ⍝ Returns different captions for the context menu command regarding editing the</code>
<code> [7]  ⍝ underlying help page: for non-nodes it's "Edit Help Page", for nodes is</code>
<code> [8]  ⍝ "Managing ∆DefaultPage" because the user might want to edit, create or delete it.</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_59">#.Laguntza.Laguntza.GetFolder &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetFolder←{</code>
<code class="emphasize">→[1]      ∆←''</code>
<code class="emphasize">→[2]      ∆,←⊂'BrowseFor' 'Directory'</code>
<code class="emphasize">→[3]      ∆,←⊂'Caption' 'Select (empty) folder to export to'</code>
<code class="emphasize">→[4]      ref←⎕NEW'BrowseBox'∆</code>
<code class="emphasize">→[5]      _←⎕DQ ref</code>
<code class="emphasize">→[6]      ref.Target</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_60">#.Laguntza.Laguntza.GetHelpFolder &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  helpFolder←GetHelpFolder dummy</code>
<code> [1]  ⍝ Checks the command line for "helpfolder" but returns a default folder otherwise.</code>
<code class="emphasize">→[2]   cla←⎕C 2 ⎕NQ'#' 'GetCommandLineArgs'</code>
<code class="emphasize">→[3]   cla←{⍵↓⍨¨'-'=↑¨⍵}cla   ⍝ Drop leading hyphens</code>
<code class="emphasize">→[4]   searchFor←'helpfolder='</code>
<code class="emphasize">→[5]   :If 0=≢helpFolder←↑1↑{⍵/⍨0&lt;≢¨⍵}searchFor∘{0=⍺≡(≢⍺)↑⍵:'' ⋄ (≢⍺)↓⍵}¨cla</code>
<code class="emphasize">→[6]       cl←A.DLB 2 ⎕NQ'#' 'GetCommandLine'         ⍝ Command line</code>
<code class="emphasize">→[7]       cf←↑⎕NPARTS{⍵↓⍨'"'=↑⍵}{⍵/⍨2&gt;+\'"'=⍵}cl     ⍝ called from</code>
<code class="emphasize">→[8]       helpFolder←cf</code>
<code> [9]   :EndIf</code>
<code class="emphasize">→[10]  helpFolder,←(~(¯1↑helpFolder)∊'/\')/'\'</code>
<code class="emphasize">→[11]  helpFolder←{0=+/b←'\\'⍷⍵:⍵ ⋄ ∇(~b)/⍵}helpFolder</code>
<code> [12] ⍝Done</code>
</div>
<code class="header" id="listing_61">#.Laguntza.Laguntza.GetHelpVarsName &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetHelpVarsName←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       in←⍵</code>
<code class="emphasize">→[3]       (¯1=in):''</code>
<code class="emphasize">→[4]       (name parent nodeFlag)←∆Ref.d.tree[in;I.(TopicName Parent IsNode)]</code>
<code class="emphasize">→[5]       2.1=⎕NC⊂(⍕parent),'.',name:(⍕parent),'.',name      ⍝ Does this one exist?</code>
<code class="emphasize">→[6]       0=nodeFlag:''                                      ⍝ If it's not a node we are done</code>
<code class="emphasize">→[7]       ref2←⍎(⍕parent),'.',name</code>
<code class="emphasize">→[8]       name←'∆DefaultPage'</code>
<code class="emphasize">→[9]       2.1≠ref2.⎕NC⊂name:''                               ⍝ Is there a ∆DefaultPage?</code>
<code class="emphasize">→[10]      (⍕ref2),'.',name</code>
<code> [11] ⍝ Takes a row number and tries to find a (help) variable or, if that</code>
<code> [12] ⍝ does not exist, a function called ∆DefaultPage.</code>
<code> [13] ⍝ Returns just the name or ''.</code>
<code> [14]  }</code>
</div>
<code class="header" id="listing_62">#.Laguntza.Laguntza.GetIndicesFromVarsContent &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetIndicesFromVarsContent←{</code>
<code> [1] ⍝ ⍵ is a row from ∆Ref.d.tree. Checks whether it's a variable.</code>
<code class="emphasize">→[2]      ∆Ref←⍺</code>
<code class="emphasize">→[3]      (name parent)←⍵</code>
<code class="emphasize">→[4]      ref←{326≢⎕DR parent:⍎⍵ ⋄ ⍵}parent</code>
<code class="emphasize">→[5]      markdown←∆Ref GetMarkdownVarsContent_ ref name</code>
<code class="emphasize">→[6]      0=≢markdown:markdown'' '' ''</code>
<code class="emphasize">→[7]      GetIndicesFromMarkdown markdown</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_63">#.Laguntza.Laguntza.GetItemStates &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetItemStates←{</code>
<code> [1] ⍝ ⍵ is single item number</code>
<code class="emphasize">→[2]      ∆Ref←⍺</code>
<code class="emphasize">→[3]      ⌽(32⍴2)⊤2 ⎕NQ ∆Ref.n.tree'GetItemState'⍵   ⍝ Don't call the method: bug 10925</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_64">#.Laguntza.Laguntza.GetLastError &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetLastError</code>
<code class="emphasize">→[1]  '∆GetLastError'⎕NA'I4 kernel32.C32|GetLastError'</code>
<code class="emphasize">→[2]  r←∆GetLastError</code>
</div>
<code class="header" id="listing_65">#.Laguntza.Laguntza.GetPageName &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> page←GetPageName dummy</code>
<code> [1] ⍝ Checks the command line for page and returns its settings or an empty vector otherwise</code>
<code class="emphasize">→[2]  cla←2 ⎕NQ'#' 'GetCommandLineArgs'</code>
<code class="emphasize">→[3]  cla←cla~¨'-'</code>
<code class="emphasize">→[4]  searchFor←'page='</code>
<code class="emphasize">→[5]  page←↑1↑{⍵/⍨0&lt;≢¨⍵}searchFor∘{0=⍺≡(≢⍺)↑⎕C ⍵:'' ⋄ (≢⍺)↓⍵}¨cla</code>
<code> [6] ⍝Done</code>
</div>
<code class="header" id="listing_66">#.Laguntza.Laguntza.GetParentAndTopicNameAsRef &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetParentAndTopicNameAsRef←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       1≠≢in←⍵:'Invalid right argument: not a single item number'⎕SIGNAL 11</code>
<code class="emphasize">→[3]       tree←∆Ref.d.tree[↑in;]</code>
<code class="emphasize">→[4]       parent←I.Parent⊃tree           ⍝ Get a ref to the parent</code>
<code class="emphasize">→[5]       f←0≠≢I.TopicName⊃tree          ⍝ Not a node?</code>
<code class="emphasize">→[6]       f:parent(I.TopicName⊃tree)     ⍝ Return pointer to the help page</code>
<code class="emphasize">→[7]       parent((3.2=parent.⎕NC'∆DefaultPage')⊃'' '∆DefaultPage')</code>
<code> [8]  ⍝ ⍵ is an item number</code>
<code> [9]  ⍝ Returns one of:</code>
<code> [10] ⍝ Ref to parent and name of help function.</code>
<code> [11] ⍝ Name of the help function is ∆DefaultPage if and only if there is</code>
<code> [12] ⍝ such a page. If there is not help page (node without ∆DefaultPage)</code>
<code> [13] ⍝ Then the second element is empty.</code>
<code> [14]  }</code>
</div>
<code class="header" id="listing_67">#.Laguntza.Laguntza.GetSaltPath &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  path←GetSaltPath parent</code>
<code class="emphasize">→[1]   name←A.Last⍕∆Ref.∆parms.source</code>
<code class="emphasize">→[2]   path←name,'/',(1+≢⍕∆Ref.∆parms.source)↓⍕parent</code>
<code class="emphasize">→[3]   :If 0≠≢∆Ref.∆parms.saltFolder</code>
<code class="emphasize">→[4]       path←((-≢name)↓∆Ref.∆parms.saltFolder),path</code>
<code> [5]   :EndIf</code>
<code class="emphasize">→[6]   (('.'=path)/path)←'/'</code>
<code class="emphasize">→[7]   :If ~':'∊path</code>
<code class="emphasize">→[8]       home←(-1+≢name)↓{⍵[0;]↑⍨+/∧\∧⌿⍵=[1]⍵[0;]}⊃(∨/¨('.',name,'.')∘⍷¨#.SALT_Var_Data.VD[;0])⌿#.SALT_Var_Data.VD[;1]</code>
<code class="emphasize">→[9]       path←home,path</code>
<code> [10]  :EndIf</code>
<code class="emphasize">→[11]  path←'expand'FilesAndDirs.NormalizePath path</code>
<code> [12] ⍝Done</code>
</div>
<code class="header" id="listing_68">#.Laguntza.Laguntza.GetStates &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetStates←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      states←{2 ⎕NQ ∆Ref.n.tree'GetItemState'⍵}¨∆Ref.d.tree[;I.Row]  ⍝ Get all states</code>
<code class="emphasize">→[3]      ⍵×⌽⍉(32⍴2)⊤states                                              ⍝ convert to Booleans</code>
<code> [4] ⍝ Returns the ItemState for the TreeView as a bit matrix</code>
<code> [5] ⍝ If ⍵ is 0, the shape is correct but all bits are off (useful for the first call).</code>
<code> [6] ⍝ Specify ⍵=1 for all other cases.</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_69">#.Laguntza.Laguntza.GoBack &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GoBack←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       (n d)←∆Ref.(n d)</code>
<code class="emphasize">→[3]       d.history←1⌽d.history          ⍝ First gets last</code>
<code class="emphasize">→[4]       ci←0⊃d.history                 ⍝ Current item is...</code>
<code class="emphasize">→[5]       _←∆Ref SetItem(ci≠¯1)/ci       ⍝ Make this one the first one</code>
<code class="emphasize">→[6]       _←SelectTreeView ∆Ref          ⍝ Force the TreeView to be THE tab</code>
<code class="emphasize">→[7]       _←⎕NQ n.tree 9999              ⍝ Enforce update</code>
<code class="emphasize">→[8]       0                              ⍝ Suppress the default handling for "Backspace"</code>
<code> [9]  ⍝ Uses (and manipulates) the _Data.lastItem for jumping back one page per call</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_70">#.Laguntza.Laguntza.GoForward &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GoForward←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       (n d)←∆Ref.(n d)</code>
<code class="emphasize">→[3]       d.history←¯1⌽d.history         ⍝ Last gets first</code>
<code class="emphasize">→[4]       ci←0⊃d.history                 ⍝ Current item is...</code>
<code class="emphasize">→[5]       _←∆Ref SetItem ci              ⍝ Make this one the first one</code>
<code class="emphasize">→[6]       _←SelectTreeView ∆Ref          ⍝ Force the TreeView to be THE tab</code>
<code class="emphasize">→[7]       _←⎕NQ n.tree 9999              ⍝ Enforce update</code>
<code class="emphasize">→[8]       0                              ⍝ Suppress the default handling for "Backspace"</code>
<code> [9]  ⍝ Uses (and manipulates) the _Data.lastItem for jumping back one page per call</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_71">#.Laguntza.Laguntza.GoToNextBoldTopic &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GoToNextBoldTopic←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       in←GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[3]       tv←∆Ref.n.tree                             ⍝ Ref to TreeView</code>
<code class="emphasize">→[4]       st←∆Ref GetStates 1                        ⍝ Get status for all topics</code>
<code class="emphasize">→[5]       boldFlags←(1+in)↓st[;4]</code>
<code class="emphasize">→[6]       0=+/boldFlags:⍬⊣Show'No more emphasized topics after the current one'</code>
<code class="emphasize">→[7]       next←1+in+boldFlags⍳1                      ⍝ Next bold one</code>
<code class="emphasize">→[8]       Display ∆Ref next</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_72">#.Laguntza.Laguntza.GoToRow &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←GoToRow ∆Ref</code>
<code class="emphasize">→[1]   r←⍬</code>
<code class="emphasize">→[2]   n←⎕NS''</code>
<code class="emphasize">→[3]   ∆←⊂'Form'</code>
<code class="emphasize">→[4]   ∆,←⊂'Posn'(50+∆Ref.Posn)</code>
<code class="emphasize">→[5]   ∆,←⊂'Size'(160 300)</code>
<code class="emphasize">→[6]   ∆,←⊂'Caption' 'Laguntza - go to row number'</code>
<code class="emphasize">→[7]   ∆,←⊂'Coord' 'Pixel'</code>
<code class="emphasize">→[8]   ∆,←('MaxButton' 0)('MinButton' 0)('SysMenu' 0)('Sizeable' 0)</code>
<code class="emphasize">→[9]   n.Form←⍎'Form'⎕WC ∆</code>
<code class="emphasize">→[10]  n.Form.on9999←1</code>
<code> [11] </code>
<code class="emphasize">→[12]  ∆←⊂'Label'</code>
<code class="emphasize">→[13]  ∆,←⊂'Posn'(15 5)</code>
<code class="emphasize">→[14]  ∆,←⊂'Caption'('Enter row number (',(⍕⌊/∆Ref.d.tree[;I.Row]),'-',(⍕⌈/∆Ref.d.tree[;I.Row]),'):')</code>
<code class="emphasize">→[15]  n.Label←⍎'Label'n.Form.⎕WC ∆</code>
<code> [16] </code>
<code class="emphasize">→[17]  ∆←⊂'Edit'</code>
<code class="emphasize">→[18]  ∆,←⊂'Posn'((5+0⊃+⌿⊃n.Label.(Posn Size)),5)</code>
<code class="emphasize">→[19]  ∆,←⊂'FieldType' 'Numeric'</code>
<code class="emphasize">→[20]  ∆,←⊂'Text' '99999'</code>
<code class="emphasize">→[21]  n.Value←⍎'Value'n.Form.⎕WC ∆</code>
<code class="emphasize">→[22]  n.Value.Text←''</code>
<code> [23] </code>
<code class="emphasize">→[24]  ∆←⊂'Button'</code>
<code class="emphasize">→[25]  ∆,←⊂'Caption' 'OK'</code>
<code class="emphasize">→[26]  ∆,←⊂'Default' 1</code>
<code class="emphasize">→[27]  ∆,←⊂'Posn'((30+0⊃+⌿⊃n.Value.(Posn Size)),5)</code>
<code class="emphasize">→[28]  ∆,←⊂'Size'(⍬ 110)</code>
<code class="emphasize">→[29]  n.OK←⍎'OK'n.Form.⎕WC ∆</code>
<code> [30] </code>
<code class="emphasize">→[31]  ∆←⊂'Button'</code>
<code class="emphasize">→[32]  ∆,←⊂'Caption' 'Cancel'</code>
<code class="emphasize">→[33]  ∆,←⊂'Cancel' 1</code>
<code class="emphasize">→[34]  ∆,←⊂'Posn'(n.OK.Posn[0],120)</code>
<code class="emphasize">→[35]  ∆,←⊂'Size'(⍬ 110)</code>
<code class="emphasize">→[36]  n.Cancel←⍎'Cancel'n.Form.⎕WC ∆</code>
<code class="emphasize">→[37]  n.Cancel.onSelect←1</code>
<code> [38] </code>
<code class="emphasize">→[39]  n.SB←⍎'SB'n.Form.⎕WC'Statusbar'</code>
<code class="emphasize">→[40]  n.Info←⍎'Info'n.SB.⎕WC'StatusField'('Size'(⍬(n.Form.Size[1]-10)))</code>
<code class="emphasize">→[41]  n.∆Ref←∆Ref</code>
<code class="emphasize">→[42]  n.OK.onSelect←'OnOkInGotoRow'n</code>
<code class="emphasize">→[43]  ⎕NQ n.Value'GotFocus' ⋄ res←⎕DQ n.Form</code>
<code class="emphasize">→[44]  :If 0≠≢res</code>
<code class="emphasize">→[45]  :AndIf n.Cancel≢0⊃res</code>
<code class="emphasize">→[46]      Display ∆Ref n.Value.Value</code>
<code> [47]  :EndIf</code>
<code class="emphasize">→[48]  {0:: ⋄ ⍵.Close}n.Form</code>
<code> [49] ⍝Done</code>
</div>
<code class="header" id="listing_73">#.Laguntza.Laguntza.GoToSearchTab &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GoToSearchTab←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      _←⎕NQ ∆Ref.n.search'Select'</code>
<code class="emphasize">→[3]      ⍬</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_74">#.Laguntza.Laguntza.HandleError &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  HandleError</code>
<code class="emphasize">→[1]   ⎕TRAP←0 'S'</code>
<code class="emphasize">→[2]   folder←(2 ⎕NQ #'GetEnvironment' 'LocalAppData'),'\Laguntza\'</code>
<code class="emphasize">→[3]   'Create!'FilesAndDirs.CheckPath folder</code>
<code class="emphasize">→[4]   ⎕WSID←folder,'Error-WS-',(APLTreeUtils2.FormatDateTime ⎕TS)~' :-'</code>
<code class="emphasize">→[5]   ⎕LX←'⍝',⎕LX</code>
<code class="emphasize">→[6]   currentDir←FilesAndDirs.PWD</code>
<code class="emphasize">→[7]   commandline←2 ⎕NQ #'GetCommandLine'</code>
<code class="emphasize">→[8]   1 ⎕SAVE ⎕WSID</code>
<code class="emphasize">→[9]   Show'An error has occurred. The Help Viewer cannot continue' ''('(A dump was created in ',folder,')')</code>
<code class="emphasize">→[10]  ⎕OFF</code>
</div>
<code class="header" id="listing_75">#.Laguntza.Laguntza.HelpOnHelp &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←HelpOnHelp ∆Ref</code>
<code> [1]   ⍝ Fires up Laguntza's own help</code>
<code class="emphasize">→[2]   r←0</code>
<code class="emphasize">→[3]   ps←CreateParms ⍬</code>
<code class="emphasize">→[4]   ps.helpCaption←'Laguntza''s Help'</code>
<code class="emphasize">→[5]   ps.folderName←GetHome''</code>
<code class="emphasize">→[6]   ps.userMode←1</code>
<code class="emphasize">→[7]   ps.expand←'None'</code>
<code class="emphasize">→[8]   :If 0&lt;##.⎕NC'CiderConfig'</code>
<code class="emphasize">→[9]       ps.source←HelpHelp</code>
<code> [10]  :EndIf</code>
<code class="emphasize">→[11]  buff←New ps</code>
<code class="emphasize">→[12]  r←{⍵.Wait}buff</code>
<code> [13] ⍝Done</code>
</div>
<code class="header" id="listing_76">#.Laguntza.Laguntza.InjectIndices &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  InjectIndices←{</code>
<code> [1]  ⍝ ⍵ are the indices of a single page. These are injected into the already existing indices</code>
<code> [2]  ⍝ while old ones are removed.</code>
<code> [3]  ⍝ This function is typically called after a page update.</code>
<code class="emphasize">→[4]       ∆Ref←⍺</code>
<code class="emphasize">→[5]       (indices in mat)←⍵</code>
<code class="emphasize">→[6]       (entries rows fullMat)←⎕FREAD ∆Ref.f.(tieNo ∆index)</code>
<code class="emphasize">→[7]       mat≡(rows=↑in)⌿fullMat:⍬                           ⍝ No change, so nothing needs to be done</code>
<code class="emphasize">→[8]       b←rows≠↑in</code>
<code class="emphasize">→[9]       (entries rows fullMat)←b∘⌿¨entries rows fullMat    ⍝ Remove the old ones, if any</code>
<code class="emphasize">→[10]      entries,←indices</code>
<code class="emphasize">→[11]      rows,←in</code>
<code class="emphasize">→[12]      fullMat⍪←mat</code>
<code class="emphasize">→[13]      fullMat[;0]←FillRowsInIndicesMatrix fullMat[;0]</code>
<code class="emphasize">→[14]      ind←⍋⊃fullMat[;0]</code>
<code class="emphasize">→[15]      entries←entries[ind]</code>
<code class="emphasize">→[16]      rows←rows[ind]</code>
<code class="emphasize">→[17]      fullMat←fullMat[ind;]</code>
<code class="emphasize">→[18]      fullMat←{m←⍵ ⋄ 0=≢ind←⍸{(⍵⍳⍵)≠⍳≢⍵}m[;0]:m ⋄ m[ind;0]←' ' ⋄ m}fullMat</code>
<code class="emphasize">→[19]      ⍬⊣(entries rows fullMat)⎕FREPLACE ∆Ref.f.(tieNo ∆index)</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_77">#.Laguntza.Laguntza.IsBookmarkable &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> IsBookmarkable←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      ~⍵∊∆Ref.d.bookmark    ⍝ must not be already bookmarked</code>
<code> [3] ⍝ Returns a 1 if in (item number) is already bookmarked</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_78">#.Laguntza.Laguntza.IsNode &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> IsNode←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      row←∆Ref.d.tree[;I.Parent]⍳⊂⍕⍵</code>
<code class="emphasize">→[3]      ∆Ref.d.tree[row;I.IsNode]</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_79">#.Laguntza.Laguntza.LF &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←LF</code>
<code class="emphasize">→[1]  r←⎕UCS 10</code>
</div>
<code class="header" id="listing_80">#.Laguntza.Laguntza.ListCategoriesAsRefs &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ListCategoriesAsRefs←{</code>
<code> [1]  ⍝ Returns all help categories found in ⍵.</code>
<code> [2]  ⍝ By default only ⍵ is scanned.</code>
<code> [3]  ⍝ By specifying "recursive" as left argument you can change this.</code>
<code class="emphasize">→[4]       ⍺←''</code>
<code class="emphasize">→[5]       recursiveFlag←{(0=1↑0⍴⍵):⍵ ⋄ 'RECURSIVE'≡1 ⎕C ⍵}⍺</code>
<code class="emphasize">→[6]       (0=≢r←{⍵/⍨~∨/¨(↑¨⍵)∊¨⊂'_∆'}⍵.⎕NL-9):⍬</code>
<code class="emphasize">→[7]       r←⍵.⍎¨r</code>
<code class="emphasize">→[8]       parms←ExecHelpParms(0⊃r).##</code>
<code class="emphasize">→[9]       r←r[⍋parms[;0]⍳A.Last¨⍕¨r]</code>
<code class="emphasize">→[10]      (~recursiveFlag):r</code>
<code class="emphasize">→[11]      ∊r,¨recursiveFlag ∇¨r</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_81">#.Laguntza.Laguntza.LoadHelpWithSalt &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  parms←LoadHelpWithSalt parms</code>
<code> [1]  ⍝ `folder` is the folder that hosts a help system.\\</code>
<code> [2]  ⍝ The last part of `folder` defines the help system.</code>
<code> [3]  ⍝ For example: `D:\This\That\MyHelp` results in a help system `#.MyHelp`.\\</code>
<code> [4]  ⍝ However, if `parms.source` is, say, `#.Container.MyHelp` then that</code>
<code> [5]  ⍝ defines the namespace the help system is loaded into.</code>
<code class="emphasize">→[6]   'parms.source MUST be specified'⎕SIGNAL 11/⍨0=≢parms.source</code>
<code class="emphasize">→[7]   'parms.saltFolder MUST be specified'⎕SIGNAL 11/⍨0=≢parms.saltFolder</code>
<code class="emphasize">→[8]   parent←⍎APLTreeUtils2.Last{⍵↓⍨¯1+-≢⍺⍺ ⍵}⍕parms.source</code>
<code class="emphasize">→[9]   {}LoadHelpWithSalt_ parms.saltFolder(⍕parms.source)</code>
<code> [10] ⍝Done</code>
</div>
<code class="header" id="listing_82">#.Laguntza.Laguntza.LoadHelpWithSalt_ &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←LoadHelpWithSalt_(folder node)</code>
<code class="emphasize">→[1]   r←⍬</code>
<code class="emphasize">→[2]   node ⎕NS''</code>
<code class="emphasize">→[3]   :For file :In list←FilesAndDirs.ListFiles folder,'\*.dyalog'</code>
<code class="emphasize">→[4]       cmd←file,' -target=',node</code>
<code class="emphasize">→[5]       {}⎕SE.SALT.Load cmd</code>
<code> [6]   :EndFor</code>
<code class="emphasize">→[7]   :For dir :In list←FilesAndDirs.ListDirs folder</code>
<code class="emphasize">→[8]       name←1⊃1 ⎕NPARTS dir</code>
<code class="emphasize">→[9]       {}LoadHelpWithSalt_ dir(node,'.',name)</code>
<code> [10]  :EndFor</code>
<code> [11] ⍝Done</code>
</div>
<code class="header" id="listing_83">#.Laguntza.Laguntza.MakeRelativePathAbsoluteForIMG &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  MakeRelativePathAbsoluteForIMG←{</code>
<code> [1]  ⍝ If the Markdown (⍵) contains the definition of an image and the SRC starts with `./` (or `.\`)</code>
<code> [2]  ⍝ then this is considered a relative path, and it is converted into an absolute path</code>
<code> [3]  ⍝ by adding `homePath` to it.</code>
<code class="emphasize">→[4]       homePath←⍺</code>
<code class="emphasize">→[5]       md←⍵</code>
<code class="emphasize">→[6]       0=+/'!['⍷∊md:md                                ⍝ Yes, that makes it faster!</code>
<code class="emphasize">→[7]       replaceBy←homePath</code>
<code class="emphasize">→[8]       ((replaceBy='\')/replaceBy)←'/'</code>
<code class="emphasize">→[9]       replaceBy←(-'/'=¯1↑replaceBy)↓replaceBy</code>
<code class="emphasize">→[10]      replaceBy←'\1\2',replaceBy,'/\3'</code>
<code> [11] ⍝     replaceBy←'\1',replaceBy,'/\2'</code>
<code class="emphasize">→[12]      cb←'^\s{0,3}([~|`]){3,}(.*?)\1{3,}\s{0,}$'    ⍝ Code block</code>
<code class="emphasize">→[13]      iac←'`.*?`'                                    ⍝ Inline APL code</code>
<code class="emphasize">→[14]      path←'(!\[.*?]\()(file:\/\/)?\.[\\|//](.*?\))'</code>
<code> [15] ⍝     path←'(!\[.*?]\()\.[\\|/](.*?\))'</code>
<code class="emphasize">→[16]      options←('Mode' 'M')('DotAll' 1)</code>
<code class="emphasize">→[17]      r←iac cb path ⎕R'&amp;' '&amp;'replaceBy⍠options⊣md</code>
<code class="emphasize">→[18]      r</code>
<code> [19]  }</code>
</div>
<code class="header" id="listing_84">#.Laguntza.Laguntza.ManageTopicProperties &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ManageTopicProperties←{</code>
<code> [1]  ⍝ `testFlag` is 1 only when it's running under a test case.</code>
<code class="emphasize">→[2]       testFlag←⍺</code>
<code class="emphasize">→[3]       (∆Ref in rf)←⍵</code>
<code class="emphasize">→[4]       testFlag:⍬</code>
<code class="emphasize">→[5]       parentName←GetParentAndTopicNameAsText ∆Ref.d.tree[in;]</code>
<code class="emphasize">→[6]       type←∆Ref EditOrDeleteTopicPropertiesPage parentName</code>
<code class="emphasize">→[7]       0=type:⍬</code>
<code class="emphasize">→[8]       2=type:∆Ref DeleteTopicProperty rf</code>
<code class="emphasize">→[9]       _←EditTopicProperties ∆Ref in rf</code>
<code class="emphasize">→[10]      ⍬</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_85">#.Laguntza.Laguntza.MethodList &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←MethodList</code>
<code class="emphasize">→[1]   r←''</code>
<code class="emphasize">→[2]   r,←⊂'AllowedTags'</code>
<code class="emphasize">→[3]   r,←⊂'CloseHelp'</code>
<code class="emphasize">→[4]   r,←⊂'CompileHelpFile'</code>
<code class="emphasize">→[5]   r,←⊂'CompileHelpFileInto'</code>
<code class="emphasize">→[6]   r,←⊂'CreateParms'</code>
<code class="emphasize">→[7]   r,←⊂'FindTopic'</code>
<code class="emphasize">→[8]   r,←⊂'GetNoClose'</code>
<code class="emphasize">→[9]   r,←⊂'GetVisible'</code>
<code class="emphasize">→[10]  r,←⊂'Inject∆TopicProperties'</code>
<code class="emphasize">→[11]  r,←⊂'ListHelpForms'</code>
<code class="emphasize">→[12]  r,←⊂'New'</code>
<code class="emphasize">→[13]  r,←⊂'Reset'</code>
<code class="emphasize">→[14]  r,←⊂'RemoveLinksFromText'</code>
<code class="emphasize">→[15]  r,←⊂'SetNoClose'</code>
<code class="emphasize">→[16]  r,←⊂'SetVisible'</code>
<code class="emphasize">→[17]  r,←⊂'ShowTopic'</code>
<code class="emphasize">→[18]  r,←⊂'Version'</code>
<code class="emphasize">→[19]  r←⊃r</code>
</div>
<code class="header" id="listing_86">#.Laguntza.Laguntza.OnContextMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnContextMenu←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       n←CreateTreeViewContextMenu ∆Ref</code>
<code class="emphasize">→[3]       res←⎕DQ n.menu                         ⍝ Hand over to user</code>
<code class="emphasize">→[4]       (0=≢res):0                             ⍝ cancelled?!</code>
<code class="emphasize">→[5]       sel←0⊃res</code>
<code class="emphasize">→[6]       in←GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[7]       (n.collaps≡sel):∆Ref CollapseFrom in   ⍝ Collapse this branch</code>
<code class="emphasize">→[8]       (n.expand≡sel):∆Ref ExpandFrom in      ⍝ Expand this branch</code>
<code class="emphasize">→[9]       (n.bookmark≡sel):∆Ref Bookmark in      ⍝ Bookmark current item</code>
<code class="emphasize">→[10]      (n.increaseFontSize≡sel):∆Ref ChangeTreeViewFontSize 1</code>
<code class="emphasize">→[11]      (n.decreaseFontSize≡sel):∆Ref ChangeTreeViewFontSize ¯1</code>
<code class="emphasize">→[12]      (n.resetFontSize≡sel):∆Ref ChangeTreeViewFontSize 0</code>
<code class="emphasize">→[13]      ∆Ref.p.userMode:0</code>
<code> [14]  ⍝⍝⍝ All what follows is for developers only</code>
<code class="emphasize">→[15]      (n.editHelp≡sel):∆Ref EditFromTv in</code>
<code class="emphasize">→[16]      (n.copyShortName≡sel):1 CopyLinkToClipboard ∆Ref</code>
<code class="emphasize">→[17]      (n.copyFullName≡sel):1 CopyFullLinkToClipboard ∆Ref</code>
<code class="emphasize">→[18]      (n.printFullName≡sel):PrintFullNameToQSE ∆Ref</code>
<code class="emphasize">→[19]      (n.editTopicProperties≡sel):HandleTopicProperties ∆Ref</code>
<code class="emphasize">→[20]      (n.injectPage≡sel):InjectNewPageStub ∆Ref in 0</code>
<code class="emphasize">→[21]      (n.injectNode≡sel):InjectNewNode ∆Ref</code>
<code class="emphasize">→[22]      (n.brokenLinks≡sel):∆Ref CheckSinglePageForBrokenLink in</code>
<code class="emphasize">→[23]      (n.ambiguousLinks≡sel):∆Ref CheckSinglePageForAmbiguousLink in</code>
<code class="emphasize">→[24]      (n.renameHelp≡sel):RenameHelpTopic ∆Ref in</code>
<code class="emphasize">→[25]      (n.deleteHelp≡sel):DeleteTopicOrNode ∆Ref</code>
<code class="emphasize">→[26]      (n.copyFullPath≡sel):∆Ref CopyFullPath2Clipboard in</code>
<code class="emphasize">→[27]      0</code>
<code> [28] ⍝ Offers a context menu on the TreeView</code>
<code> [29]  }</code>
</div>
<code class="header" id="listing_87">#.Laguntza.Laguntza.OnFind &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnFind←{</code>
<code class="emphasize">→[1]      ⎕NQ f.reg.search'Select'</code>
<code> [2] ⍝ Activate the "Search" tab in response to "Ctrl+F"</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_88">#.Laguntza.Laguntza.OnItemUpInTreeView &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnItemUpInTreeView←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      _←ResetStatusbar ∆Ref</code>
<code class="emphasize">→[3]      1 ⎕NQ ∆Ref.n.tree 9999   ⍝ Force update - before a potential context menu is displayed</code>
<code> [4] ⍝ Triggers an immediate update</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_89">#.Laguntza.Laguntza.OnKeyPressInTreeView &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnKeyPressInTreeView←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       ⍵[2]∊'UC' 'DC':1⊣⎕NQ ∆Ref.n.tree 9998(1⍳⍨(0⊃⍵).SelItems) ⍝ Special: ↑ and ↓</code>
<code class="emphasize">→[3]       key←2⊃⍵                                        ⍝ Which key was pressed?</code>
<code class="emphasize">→[4]       (0=≢in←GetCurrentItem ∆Ref.n):⍬                ⍝ Which item (in) is selected? (get out if none)</code>
<code class="emphasize">→[5]       (80 2≡⍵[4 5]):PrintCurrentPage ∆Ref</code>
<code class="emphasize">→[6]       ('+'≡key):∆Ref Expand in                       ⍝ Expand current node</code>
<code class="emphasize">→[7]       ('-'≡key):∆Ref Collapse in                     ⍝ Collapse current node</code>
<code class="emphasize">→[8]       ('DB'≡key):GoBack ∆Ref                         ⍝ Backspace is "Go back"</code>
<code class="emphasize">→[9]       (70 2≡⍵[4 5]):GoToSearchTab ∆Ref               ⍝ Ctrl+F pressed? Go to "Search" tab</code>
<code class="emphasize">→[10]      ((⊂⍵[4 5])∊(96 2)(45 2)):∆Ref ChangeTreeViewFontSize 0  ⍝ Restore default font size (Ctrl+0)</code>
<code class="emphasize">→[11]      flag←⍵[4 5]≡68 2                               ⍝ Was Ctrl+D pressed?</code>
<code class="emphasize">→[12]      bm←∆Ref IsBookmarkable in                      ⍝ Is current topic "bookmarkable"?</code>
<code class="emphasize">→[13]      _←∆Ref Bookmark(flag∧bm)/in                    ⍝ Then bookmark this item</code>
<code class="emphasize">→[14]      _←∆Ref{⍵:ProcessF12 ⍺ ⋄ ⍬}⍵[4 5]≡123 0         ⍝ Was F12 pressed? (Edit ∆LinkID)</code>
<code class="emphasize">→[15]      _←⎕NQ ∆Ref.n.tree 9998(GetCurrentItem ∆Ref.n)  ⍝ Must remain last line: forces an update</code>
<code class="emphasize">→[16]      ~flag</code>
<code> [17] ⍝ Handles various keys in the TreeView</code>
<code> [18]  }</code>
</div>
<code class="header" id="listing_90">#.Laguntza.Laguntza.OnOkInGotoRow &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnOkInGotoRow←{</code>
<code class="emphasize">→[1]      n←⍺</code>
<code class="emphasize">→[2]      (n.Value.Value∊n.∆Ref.d.tree[;I.Row]):1⊣⎕NQ n.Form 9999</code>
<code class="emphasize">→[3]      n.Info.Text←'Invalid row number'</code>
<code class="emphasize">→[4]      0</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_91">#.Laguntza.Laguntza.OnReport &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnReport←{</code>
<code> [1]  ⍝ Investigates which "Report" command the user has actually issued</code>
<code> [2]  ⍝ and calls the appropriate function.</code>
<code class="emphasize">→[3]       ref←⍎0⊃⍵                               ⍝ Ref to the menu command</code>
<code class="emphasize">→[4]       cmd←{⍵↑⍨-'.'⍳⍨⌽⍵}0⊃⍵                   ⍝ The selected "Print" command</code>
<code class="emphasize">→[5]       all←'CurrentItem' 'UserGuide' 'ObjectModelRef' 'Object' 'FunctionRef' 'Full'</code>
<code class="emphasize">→[6]       b←cmd∘≡¨all                            ⍝ Which one is it?</code>
<code class="emphasize">→[7]       _←ShowEggTimer ∆Ref</code>
<code class="emphasize">→[8]       ref.Active←0</code>
<code class="emphasize">→[9]       _←⍎'Report',((b⍳1)⊃all),' ⍬'           ⍝ Execute the work horse</code>
<code class="emphasize">→[10]      _←RemoveEggTimer ∆Ref</code>
<code class="emphasize">→[11]      ref.Active←1</code>
<code class="emphasize">→[12]      0</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_92">#.Laguntza.Laguntza.OnReportEventMsg &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnReportEventMsg←{</code>
<code> [1]  ⍝ Helper for the sole purpose of debugging event-related issues.</code>
<code class="emphasize">→[2]      ⎕←⍵</code>
<code class="emphasize">→[3]      1</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_93">#.Laguntza.Laguntza.OnReportLostFocus &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnReportLostFocus←{</code>
<code> [1]  ⍝ Helper for the sole purpose of debugging Focus issues.</code>
<code class="emphasize">→[2]      ⎕←⍵</code>
<code class="emphasize">→[3]      1</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_94">#.Laguntza.Laguntza.OnRetractingInTreeView &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnRetractingInTreeView←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      _←1 ⎕NQ ∆Ref.n.tree 9999</code>
<code class="emphasize">→[3]      1</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_95">#.Laguntza.Laguntza.OnSelectOkInAskForName &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnSelectOkInAskForName←{</code>
<code class="emphasize">→[1]      rf←↑⍵</code>
<code class="emphasize">→[2]      n←{9=⍵.⎕NC'n':⍵.n ⋄ ∇ ⍵.##}rf</code>
<code class="emphasize">→[3]      name←n.Name.Text</code>
<code class="emphasize">→[4]      ((name=' ')/name)←'_'</code>
<code class="emphasize">→[5]      ¯1≠⎕NC name:1⊢⎕NQ n.∆form 9999,0/n.∆result←n.Name.Text</code>
<code class="emphasize">→[6]      _←ShowError'This is not a valid APL name'</code>
<code class="emphasize">→[7]      0</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_96">#.Laguntza.Laguntza.OnToolbarBtn &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnToolbarBtn←{</code>
<code class="emphasize">→[1]       cmd←⍎0⊃⍵</code>
<code class="emphasize">→[2]       ∆Ref←Get∆Ref cmd</code>
<code class="emphasize">→[3]       n←∆Ref.n</code>
<code class="emphasize">→[4]       (n.backBtn≡cmd):GoBack ∆Ref</code>
<code class="emphasize">→[5]       (n.forwardBtn≡cmd):GoForward ∆Ref</code>
<code class="emphasize">→[6]       (n.bookmarkBtn≡cmd):∆Ref Bookmark GetCurrentItem n</code>
<code class="emphasize">→[7]       (n.showNavigation≡cmd):ToggleNavigationBar ∆Ref</code>
<code class="emphasize">→[8]       . ⍝ ???</code>
<code> [9]  ⍝ Processes the buttons in the toolbar when selected (pressed).</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_97">#.Laguntza.Laguntza.Or &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Or←{</code>
<code> [1]  ⍝ Function selection (or :Case):</code>
<code> [2]  ⍝ (f3 array) ←→ 0 0 1 0 f1 Or f2 Or f3 Or f4 array</code>
<code class="emphasize">→[3]      ~∨/⍺:⍵</code>
<code class="emphasize">→[4]      &lt;/⍺:⍵⍵ ⍵</code>
<code class="emphasize">→[5]      2=≢⍺:⍺⍺ ⍵</code>
<code class="emphasize">→[6]      (¯1↓⍺)⍺⍺ ⍵</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_98">#.Laguntza.Laguntza.PrintCurrentPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PrintCurrentPage←{</code>
<code> [1] ⍝ Print current page of the WebBrowser ActiveX control</code>
<code> [2] ⍝ https://msdn.microsoft.com/en-us/library/aa752044(v=vs.85).aspx#sec_wb_print</code>
<code class="emphasize">→[3]      ∆Ref←⍵</code>
<code class="emphasize">→[4]      OLECMDID_PRINT←6               ⍝ https://msdn.microsoft.com/en-us/library/windows/desktop/ms691264(v=vs.85).aspx</code>
<code class="emphasize">→[5]      OLECMDEXECOPT_PROMPTUSER←1     ⍝ https://msdn.microsoft.com/en-us/library/windows/desktop/ms683930(v=vs.85).aspx</code>
<code class="emphasize">→[6]      11::⍬                          ⍝ Sometimes the next line results in a DOMAIN ERROR for no apparent reason</code>
<code class="emphasize">→[7]      ∆Ref.n.browser.ExecWB OLECMDID_PRINT OLECMDEXECOPT_PROMPTUSER ⍬ ⍬</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_99">#.Laguntza.Laguntza.PrintFullNameToQSE &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PrintFullNameToQSE←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      row←GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[3]      ~row&lt;↑≢∆Ref.d.tree:⍬           ⍝ Sometimes something strange happens</code>
<code class="emphasize">→[4]      link←↑{⍺,'.',⍵}/∆Ref.d.tree[row;4 1]</code>
<code class="emphasize">→[5]      ⎕←'⍝ ',link</code>
<code class="emphasize">→[6]      ⍬</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_100">#.Laguntza.Laguntza.ProgressbarSet &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ProgressbarSet←{</code>
<code class="emphasize">→[1]      (counter total)←⍵</code>
<code class="emphasize">→[2]      ∆Ref.n.PB.Thumb←1⌈99⌊⌊100×counter÷total</code>
<code class="emphasize">→[3]      ⍬</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_101">#.Laguntza.Laguntza.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←'New' 'CreateStub' 'Selfie' 'CloseHelp' 'CompileHelpFile' 'CreateParms' 'FindTopic' 'GetNoClose'</code>
<code class="emphasize">→[2]  r,←'Inject∆TopicProperties' 'LoadHelpWithSalt' 'ListHelpForms' 'Reset' 'SaveHelpSystemWithSalt'</code>
<code class="emphasize">→[3]  r,←'SetNoClose' 'GetVisible' 'SetVisible' 'ShowTopic' 'Version' 'History'</code>
</div>
<code class="header" id="listing_102">#.Laguntza.Laguntza.RenameHelpTopic &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{testflag}RenameHelpTopic(∆Ref in)</code>
<code> [1]  ⍝ Let user (developers only) edit item number ⍵.</code>
<code> [2]  ⍝ The user is expected to have changed the name.</code>
<code> [3]  ⍝ If that is the case then the original one is deleted and Link is told.</code>
<code> [4]  ⍝ This MUST NOT be called on any ∆DefaultPage.</code>
<code class="emphasize">→[5]   r←0</code>
<code class="emphasize">→[6]   testflag←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'testflag'</code>
<code class="emphasize">→[7]   {}ResetStatusbar ∆Ref</code>
<code class="emphasize">→[8]   fullPageName←∆Ref GetHelpVarsName in</code>
<code class="emphasize">→[9]   pageName←1⊃'.'A.SplitPath fullPageName</code>
<code class="emphasize">→[10]  parent←⍎¯1↓↑'.'A.SplitPath fullPageName</code>
<code class="emphasize">→[11]  :If '.∆DefaultPage'{⍺≡(-≢⍺)↑⍵}pageName</code>
<code class="emphasize">→[12]      {}Show'You MUST NOT change the name of a ∆DefaultPage!'</code>
<code> [13]  :Else</code>
<code class="emphasize">→[14]      old←parent.⍎pageName</code>
<code class="emphasize">→[15]      :If testflag</code>
<code class="emphasize">→[16]          newName←'A_Test'</code>
<code> [17]      :Else</code>
<code class="emphasize">→[18]          newName←∆Ref AskForRename parent pageName</code>
<code> [19]      :EndIf</code>
<code class="emphasize">→[20]      :If 0=≢newName</code>
<code class="emphasize">→[21]      :OrIf newName≡pageName</code>
<code class="emphasize">→[22]          {}Show'No rename performed, therefore no action taken.'</code>
<code class="emphasize">→[23]          :Return</code>
<code> [24]      :EndIf</code>
<code class="emphasize">→[25]      {}testflag RenameInTopicProperties ∆Ref pageName newName parent</code>
<code class="emphasize">→[26]      ⍎(⍕parent),'.',newName,'←',fullPageName    ⍝ Copy old to new</code>
<code class="emphasize">→[27]      :If ∆Ref.p.notifyLink</code>
<code class="emphasize">→[28]          {}⎕SE.Link.Add(⍕parent),'.',newName</code>
<code class="emphasize">→[29]          {}⎕SE.Link.Expunge fullPageName</code>
<code> [30]      :Else</code>
<code class="emphasize">→[31]          ⎕EX(⍕parent),'.',pageName              ⍝ Remove old one</code>
<code> [32]      :EndIf</code>
<code class="emphasize">→[33]      oldTitle←HTML.GetTitle old</code>
<code class="emphasize">→[34]      :If 0=testflag</code>
<code class="emphasize">→[35]          {}parent EditByQED newName</code>
<code class="emphasize">→[36]          :If 0≠≢oldTitle</code>
<code class="emphasize">→[37]          :AndIf oldTitle≡HTML.GetTitle parent⍎newName</code>
<code class="emphasize">→[38]          :AndIf oldTitle≢newName</code>
<code class="emphasize">→[39]              msg←⊂'You have renamed the help page but not changed the "Title" tag.'</code>
<code class="emphasize">→[40]              msg,←'' 'If this was a mistake then don''t forget to fix it.'</code>
<code class="emphasize">→[41]              'Help: rename problem?!'Show msg</code>
<code> [42]          :EndIf</code>
<code> [43]      :EndIf</code>
<code class="emphasize">→[44]      {}Compile ∆Ref</code>
<code class="emphasize">→[45]      ∆Ref ShowTopic(⍕parent),'.',newName</code>
<code> [46]  :EndIf</code>
</div>
<code class="header" id="listing_103">#.Laguntza.Laguntza.RenameInTopicProperties &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←testflag RenameInTopicProperties(∆Ref oldname newName parent)</code>
<code> [1]  ⍝ Rename an entry in ∆TopicProiperties.</code>
<code class="emphasize">→[2]   :If r←3=parent.⎕NC'∆TopicProperties'</code>
<code class="emphasize">→[3]       result←parent.⍎'∆TopicProperties ⍬'</code>
<code class="emphasize">→[4]       ind←result[;0]⍳⊂oldname</code>
<code class="emphasize">→[5]       result[ind;0]←⊂newName</code>
<code class="emphasize">→[6]       body←⍪GetTopicPropertyTemplate ⍬</code>
<code class="emphasize">→[7]       body⍪←⍪ReformatTopicPropertyResult result</code>
<code class="emphasize">→[8]       parent.⎕FX,body</code>
<code class="emphasize">→[9]       :If 0=testflag</code>
<code class="emphasize">→[10]      :AndIf 0=1↑0⍴rc←parent EditFnsByQED'∆TopicProperties'</code>
<code class="emphasize">→[11]          . ⍝ Something went wrong - please investigate</code>
<code> [12]      :EndIf</code>
<code class="emphasize">→[13]      ∆Ref TellLinkAboutChange(⍕parent),'.∆TopicProperties'</code>
<code> [14]  :EndIf</code>
</div>
<code class="header" id="listing_104">#.Laguntza.Laguntza.Replace &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Replace←{</code>
<code class="emphasize">→[1]       (w h)←⍵        ⍝ Where (hits) and HTML</code>
<code class="emphasize">→[2]       (ss st et)←⍺   ⍝ Search string; start tag; end tag</code>
<code class="emphasize">→[3]       h←(↑w)⌽h       ⍝ Bring to front</code>
<code class="emphasize">→[4]       was←(≢ss)↑h    ⍝ Because case might be an issue we save the original</code>
<code class="emphasize">→[5]       h←(≢ss)↓h      ⍝ Drop it</code>
<code class="emphasize">→[6]       h,←st,was,et   ⍝ Add to the end</code>
<code class="emphasize">→[7]       0=≢w←1↓w:h     ⍝ This one is done, and there might be nonbe left</code>
<code class="emphasize">→[8]       (↑w)-←(≢ss)    ⍝ Because we have dropped the search string from h</code>
<code class="emphasize">→[9]       ⍺ ∇ w h        ⍝ Next one</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_105">#.Laguntza.Laguntza.ReplaceSearchStringByEmphasizeSpan &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReplaceSearchStringByEmphasizeSpan←{</code>
<code class="emphasize">→[1]       (w h)←⍵        ⍝ Where (are the hits) and HTML to be changed</code>
<code class="emphasize">→[2]       (ss st et)←⍺   ⍝ Search string; start tag; end tag</code>
<code class="emphasize">→[3]       h←(↑w)⌽h       ⍝ Bring hit to the front</code>
<code class="emphasize">→[4]       was←(≢ss)↑h    ⍝ Because case might be an issue we save the original</code>
<code class="emphasize">→[5]       h←(≢ss)↓h      ⍝ Drop search string it</code>
<code class="emphasize">→[6]       h,←st,was,et   ⍝ Add it emphasized to the end</code>
<code class="emphasize">→[7]       0=≢w←1↓w:h     ⍝ This one is done, and there might be none left</code>
<code class="emphasize">→[8]       (↑w)-←(≢ss)    ⍝ Because we have dropped the search string from h</code>
<code class="emphasize">→[9]       ⍺ ∇ w h        ⍝ Next one</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_106">#.Laguntza.Laguntza.RunAsStandalone &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←RunAsStandalone</code>
<code> [1]  ⍝ This function runs under ViewHelp.exe.</code>
<code class="emphasize">→[2]   ⎕ML←3 ⋄ ⎕IO←0</code>
<code class="emphasize">→[3]   r←⍬</code>
<code class="emphasize">→[4]   AllowContinueWS ⍬</code>
<code class="emphasize">→[5]   :If 0</code>
<code class="emphasize">→[6]       ⎕TRAP←0 'S'</code>
<code class="emphasize">→[7]       AllowRide 4613</code>
<code> [8]   :Else</code>
<code class="emphasize">→[9]       ⎕TRAP←(0 'E' '#.Laguntza.HandleError')</code>
<code> [10]  :EndIf</code>
<code class="emphasize">→[11]  :If 0=isDev←A.IsDevelopment</code>
<code class="emphasize">→[12]      folderName←GetHelpFolder ⍬</code>
<code class="emphasize">→[13]      expand←'None'</code>
<code class="emphasize">→[14]      filename←folderName,File.GetHelpFileName</code>
<code class="emphasize">→[15]      :If ~File.DoesFileExist filename</code>
<code class="emphasize">→[16]          msg←'Could not find:'filename</code>
<code class="emphasize">→[17]          msg,←'' 'The programm cannot continue.'</code>
<code> [18]          ⍝ --- Debug information</code>
<code class="emphasize">→[19]          :If debug←0</code>
<code class="emphasize">→[20]              msg,←⊂'folder name: ',folderName</code>
<code class="emphasize">→[21]              msg,←⊂'Command line: ',⎕C 2 ⎕NQ'#' 'GetCommandLine'</code>
<code class="emphasize">→[22]              msg,←⊂'Current directory: ',#.FilesAndDirs.PWD</code>
<code> [23]          :EndIf</code>
<code class="emphasize">→[24]          'Laguntza'Show msg</code>
<code class="emphasize">→[25]          :If isDev</code>
<code class="emphasize">→[26]              ∘∘∘ ⍝ Deliberate error</code>
<code> [27]          :Else</code>
<code class="emphasize">→[28]              ⎕OFF</code>
<code> [29]          :EndIf</code>
<code> [30]      :EndIf</code>
<code class="emphasize">→[31]      tieNo←filename ⎕FSTIE 0</code>
<code class="emphasize">→[32]      parms←⎕FREAD tieNo 6</code>
<code class="emphasize">→[33]      ⎕FUNTIE tieNo</code>
<code class="emphasize">→[34]      ps←⎕NS''</code>
<code class="emphasize">→[35]      parms[parms[;0]⍳⊂'userMode';1]←1 ⍝ This function always runs in user mode</code>
<code class="emphasize">→[36]      :If 0≠≢parms</code>
<code class="emphasize">→[37]          ps.{⍎(0⊃⍵),'←1⊃⍵'}¨↓parms</code>
<code> [38]      :EndIf</code>
<code class="emphasize">→[39]      ps.folderName←folderName</code>
<code class="emphasize">→[40]      :If File.DoesFileExist'help.ico'</code>
<code class="emphasize">→[41]          ps.helpIcon←'file:///',(↑1 ⎕NPARTS''),'\help.ico'</code>
<code> [42]      :EndIf</code>
<code class="emphasize">→[43]      ps.visible←1</code>
<code class="emphasize">→[44]      ps.page←GetPageName ⍬</code>
<code class="emphasize">→[45]      ref←New ps</code>
<code class="emphasize">→[46]      ⎕DQ ref</code>
<code class="emphasize">→[47]      :If isDev</code>
<code class="emphasize">→[48]          ∘∘∘ ⍝ Deliberate error</code>
<code> [49]      :Else</code>
<code class="emphasize">→[50]          ⎕OFF</code>
<code> [51]      :EndIf</code>
<code> [52]  :Else</code>
<code class="emphasize">→[53]      ⎕←'*** Runs under Runtime ViewHelp.exe only!'</code>
<code> [54]  :EndIf</code>
</div>
<code class="header" id="listing_107">#.Laguntza.Laguntza.SaveHelpSystemWithSalt &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←SaveHelpSystemWithSalt(parms help)</code>
<code> [1] ⍝ Designed to save a help system with SALT in parms.saltFolder.</code>
<code class="emphasize">→[2]  'Specify pointer rather than name for the help system'⎕SIGNAL 11/⍨80=⎕DR help</code>
<code class="emphasize">→[3]  r←SaveNodeWithSalt help parms.saltFolder</code>
<code> [4] ⍝Done</code>
</div>
<code class="header" id="listing_108">#.Laguntza.Laguntza.SaveNodeWithSalt &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{firstFlag}SaveNodeWithSalt(node folder)</code>
<code> [1]  ⍝ `node` is supposed to be the node of a help system.</code>
<code> [2]  ⍝ `folder` is the folder the node is saved in.</code>
<code> [3]  ⍝ Saves all variables and a function `∆TopicProperties` if there is one.</code>
<code> [4]  ⍝ It then checks whether there are sub namespaces. If so it calls itself</code>
<code> [5]  ⍝ on those namespaces.</code>
<code> [6]  ⍝ Don't specify a left argument: it's used to recognize recursive calls.</code>
<code class="emphasize">→[7]   r←⍬</code>
<code class="emphasize">→[8]   firstFlag←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 1}'firstFlag'</code>
<code class="emphasize">→[9]   :If firstFlag</code>
<code class="emphasize">→[10]      path←folder,'\'</code>
<code> [11]  :Else</code>
<code class="emphasize">→[12]      path←↑,/1 ⎕NPARTS folder,'\',({⍵↑⍨-'.'⍳⍨⌽⍵}⍕node),'\'</code>
<code> [13]  :EndIf</code>
<code class="emphasize">→[14]  :For vars :In varsList←' '~¨⍨↓node.⎕NL 2</code>
<code class="emphasize">→[15]      cmd←(⍕node),'.',vars,' ',path,vars,'.dyalog -makedir -noprompt'</code>
<code class="emphasize">→[16]      {}⎕SE.SALT.Save cmd</code>
<code> [17]  :EndFor</code>
<code class="emphasize">→[18]  :If 3=node.⎕NC'∆TopicProperties'</code>
<code class="emphasize">→[19]      cmd←(⍕node),'.∆TopicProperties ',path,'∆TopicProperties.dyalog -noprompt'</code>
<code class="emphasize">→[20]      {}⎕SE.SALT.Save cmd</code>
<code> [21]  :EndIf</code>
<code class="emphasize">→[22]  :For subnode :In subnodeList←' '~¨⍨↓node.⎕NL 9</code>
<code class="emphasize">→[23]      0 SaveNodeWithSalt(node⍎subnode)path</code>
<code> [24]  :EndFor</code>
</div>
<code class="header" id="listing_109">#.Laguntza.Laguntza.SearchThis &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  SearchThis←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       0=1↑0⍴⍵:⍵      ⍝ Numeric?! That is already an item nunber then</code>
<code class="emphasize">→[3]       '#.'≡2↑⍵:⍵     ⍝ Already fully qualified</code>
<code class="emphasize">→[4]       sa←1           ⍝ 1: Ignore container in search</code>
<code class="emphasize">→[5]       sa,←⊂⍵         ⍝ 2: Search string</code>
<code class="emphasize">→[6]       sa,←0          ⍝ 3: full text search</code>
<code class="emphasize">→[7]       sa,←1          ⍝ 4: 1=search Reference</code>
<code class="emphasize">→[8]       sa,←1          ⍝ 5: 1=search User's Guide</code>
<code class="emphasize">→[9]       sa,←0          ⍝ 6: 1=search Misc</code>
<code class="emphasize">→[10]      sa,←1          ⍝ 7: unique flag ("drop doubles")</code>
<code class="emphasize">→[11]      sa,←0          ⍝ 8: fuzzy search flag (find anywhere)</code>
<code class="emphasize">→[12]      sa,←0          ⍝ 9: lower case flag</code>
<code class="emphasize">→[13]      (line name type)←∆Ref Search.Search sa     ⍝ Perform the search</code>
<code class="emphasize">→[14]      line</code>
<code> [15] ⍝ Search for ⍵ and return the line number (hit) or ⍬ for "no hit"</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_110">#.Laguntza.Laguntza.SelectTreeView &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SelectTreeView←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      ⎕NQ ∆Ref.n.contents'Select'</code>
<code> [3] ⍝ Force TreeView to be THE tab</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_111">#.Laguntza.Laguntza.SetItem &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetItem←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      rf←∆Ref.n.tree                 ⍝ Ref to TreeView</code>
<code class="emphasize">→[3]      rf.SelItems←(≢rf.Items)⍴0      ⍝ Deselect all</code>
<code class="emphasize">→[4]      rf.SelItems[⍵]←1               ⍝ Select the desired one</code>
<code class="emphasize">→[5]      0</code>
<code> [6] ⍝ Selects ⍵ and only ⍵ in the TreeView</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_112">#.Laguntza.Laguntza.SetItemState &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetItemState←{</code>
<code class="emphasize">→[1]      itemNo←⍵</code>
<code class="emphasize">→[2]      (∆Ref states)←⍺</code>
<code class="emphasize">→[3]      state←{2⊥⍉⌽⍵}states                         ⍝ Convert to Int</code>
<code class="emphasize">→[4]      ⍬⊣⎕NQ ∆Ref.n.tree'SetItemState'itemNo ⍺     ⍝ Set the state</code>
<code> [5] ⍝ ⍺[0] is ∆Ref</code>
<code> [6] ⍝ ⍺[1] is vector of booleans representing the states of a particular item</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_113">#.Laguntza.Laguntza.SetStates &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetStates←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      states←{2⊥⍉⌽⍵}⍵                                                 ⍝ Convert to Int</code>
<code class="emphasize">→[3]      states{2 ⎕NQ ∆Ref.n.tree'SetItemState'⍵ ⍺}¨∆Ref.d.tree[;I.Row]  ⍝ Reset all states</code>
<code> [4]  ⍝ ⍵ is a matrix of Booleans with TreeView item states</code>
<code> [5]  ⍝ All items are set according to ⍵ then</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_114">#.Laguntza.Laguntza.Show &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Show←{</code>
<code class="emphasize">→[1]      ⍺←'Attention!'</code>
<code class="emphasize">→[2]      _←'f_msg'⎕WC'MsgBox'⍺ ⍵'Info'</code>
<code class="emphasize">→[3]      _←⎕DQ'f_msg'</code>
<code class="emphasize">→[4]      1:r←⍬</code>
<code> [5] ⍝ Display ⍵ with caption ⍺ in a message box of type "Info"</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_115">#.Laguntza.Laguntza.ShowEmptyPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowEmptyPage←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      html←'&lt;html&gt;&lt;/html&gt;'</code>
<code class="emphasize">→[3]      _←{0::⍬ ⋄ ⍬⊣⍵.n.browser.Document.close}∆Ref</code>
<code class="emphasize">→[4]      _←∆Ref{0::⍬ ⋄ ⍬⊣⍺.n.browser.Document.write⊂∊⍵}html</code>
<code class="emphasize">→[5]      ⍬</code>
<code> [6] ⍝ Display a "Page not found" page in the right pane</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_116">#.Laguntza.Laguntza.ShowError &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowError←{</code>
<code class="emphasize">→[1]      ⍺←'Attention!'</code>
<code class="emphasize">→[2]      _←'f_msg'⎕WC'MsgBox'⍺ ⍵'Error'('Btns'(,⊂'OK'))</code>
<code class="emphasize">→[3]      _←⎕DQ'f_msg'</code>
<code class="emphasize">→[4]      ⍬</code>
<code> [5] ⍝ Display ⍵ with caption ⍺ in a message box of type "Error"</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_117">#.Laguntza.Laguntza.ShowHtmlOfCurrentTopic &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowHtmlOfCurrentTopic←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      A←∆Ref.d.A</code>
<code class="emphasize">→[3]      html←∆Ref.n.browser.Document.documentElement.outerHTML</code>
<code class="emphasize">→[4]      _←{{⍵}(#.⎕NS'').(⎕ED⍠('ReadOnly' 1)&amp;{'ed'}ed←⍵)}html</code>
<code class="emphasize">→[5]      ⍬</code>
<code> [6] ⍝ Shows the HTML of the WebBrowser ActiveX control</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_118">#.Laguntza.Laguntza.TellAboutMissingDefaultPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  TellAboutMissingDefaultPage←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       (in name)←⍵</code>
<code class="emphasize">→[3]       p←↑GetParentAndTopicNameAsText ∆Ref.d.tree[,in;]</code>
<code class="emphasize">→[4]       2=⎕NC p,'.∆DefaultPage':0</code>
<code class="emphasize">→[5]       msg←⊂'There is no default page defined for '</code>
<code class="emphasize">→[6]       msg,←⊂'   ',p</code>
<code class="emphasize">→[7]       msg,←''('Would you like to create one?')</code>
<code class="emphasize">→[8]       0=∆Ref.p.helpCaption YesOrNo msg:1</code>
<code class="emphasize">→[9]       _←∆Ref EditDefaultPage p</code>
<code class="emphasize">→[10]      1</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_119">#.Laguntza.Laguntza.TellNotEmpty &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> TellNotEmpty←{</code>
<code class="emphasize">→[1]      ⍺←''</code>
<code class="emphasize">→[2]      caption←⍺</code>
<code class="emphasize">→[3]      msg←⍵</code>
<code class="emphasize">→[4]      msg←⍎'MB'⎕WC'MsgBox'('Style' 'Info')('Btns' 'OK')('Text'msg)('Caption'caption)</code>
<code class="emphasize">→[5]      ⍬⊣msg.Wait</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_120">#.Laguntza.Laguntza.ToggleNavigationBar &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←ToggleNavigationBar ∆Ref</code>
<code class="emphasize">→[1]  r←⍬</code>
<code class="emphasize">→[2]  :If ∆Ref.n.showNavigation.State</code>
<code class="emphasize">→[3]      ∆Ref.n.splitter.Posn←∆Ref.n.∆SplitterPosn</code>
<code> [4]  :Else</code>
<code class="emphasize">→[5]      ∆Ref.n.∆SplitterPosn←∆Ref.n.splitter.Posn</code>
<code class="emphasize">→[6]      ∆Ref.n.splitter.Posn←0 0</code>
<code> [7]  :EndIf</code>
</div>
<code class="header" id="listing_121">#.Laguntza.Laguntza.UnboldAll &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  UnboldAll←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       st←∆Ref GetStates 1                    ⍝ Get status for all topics</code>
<code class="emphasize">→[3]       st[;4]←0                               ⍝ Reset the "Bold" flag for all items</code>
<code class="emphasize">→[4]       ∆Ref.n.tree.Visible←0</code>
<code class="emphasize">→[5]       _←∆Ref SetStates st                    ⍝ Write status back</code>
<code class="emphasize">→[6]       ∆Ref.n.tree.Visible←1</code>
<code class="emphasize">→[7]       ⍬</code>
<code> [8]  ⍝ All bold topics get normal again</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_122">#.Laguntza.Laguntza.UpdateFileData &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref UpdateFileData in</code>
<code> [1]  ⍝ See also CollectData</code>
<code> [2]  ⍝ "ref" points to a Help namespace</code>
<code> [3]  ⍝ "name" is the name of a help function. May even be ∆DefaultPage.</code>
<code> [4]  ⍝ Does NOT update the ∆parms component because the user cannot change any</code>
<code> [5]  ⍝ parameter by simply editing a help page.</code>
<code class="emphasize">→[6]   r←⍬</code>
<code class="emphasize">→[7]   (ref name)←∆Ref GetParentAndTopicNameAsRef in</code>
<code class="emphasize">→[8]   markdown←∆Ref GetMarkdownVarsContent name ref</code>
<code class="emphasize">→[9]   (Words words)←GetWordsFromMarkdown markdown</code>
<code class="emphasize">→[10]  X←HTML.CreateParameterSpace ∆Ref</code>
<code class="emphasize">→[11]  markdown←X in ProcessLinks_ markdown</code>
<code class="emphasize">→[12]  html←∆Ref in Markdown2HTML_ markdown</code>
<code class="emphasize">→[13]  {}html ⎕FREPLACE ∆Ref.f.tieNo,in+1+10</code>
<code class="emphasize">→[14]  allWords←⎕FREAD ∆Ref.f.(tieNo ∆words)</code>
<code class="emphasize">→[15]  (in⊃allWords)←words</code>
<code class="emphasize">→[16]  {}allWords ⎕FREPLACE ∆Ref.f.(tieNo ∆words)</code>
<code class="emphasize">→[17]  allWords←⎕FREAD ∆Ref.f.(tieNo ∆Words)</code>
<code class="emphasize">→[18]  (in⊃allWords)←Words</code>
<code class="emphasize">→[19]  {}allWords ⎕FREPLACE ∆Ref.f.(tieNo ∆Words)</code>
<code class="emphasize">→[20]  indices←∆Ref GetIndicesFromVarsContent ∆Ref.d.tree[in;I.(TopicName Parent)]</code>
<code class="emphasize">→[21]  indices←Index.GetIndices(⊂indices)∆Ref(∆Ref.d.tree[,in;])</code>
<code class="emphasize">→[22]  {}∆Ref InjectIndices indices</code>
<code> [23] ⍝Done</code>
</div>
<code class="header" id="listing_123">#.Laguntza.Laguntza.ViewLaguntzasHelp &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {ref}←ViewLaguntzasHelp dummy</code>
<code> [1]  ⍝ Puts Laguntza's own help on display</code>
<code class="emphasize">→[2]   ⎕ML←3 ⋄ ⎕IO←0</code>
<code class="emphasize">→[3]   :If 0=⎕NC'TatinVars.HOME'</code>
<code class="emphasize">→[4]   :AndIf 0=##.⎕NC'CiderConfig.HOME'</code>
<code class="emphasize">→[5]       ##.FilesAndDirs.PolishCurrentDir</code>
<code> [6]   :EndIf</code>
<code class="emphasize">→[7]   filename←GetHome'\',File.GetHelpFileName</code>
<code class="emphasize">→[8]   expand←'None'</code>
<code class="emphasize">→[9]   :If ~File.DoesFileExist filename</code>
<code class="emphasize">→[10]      msg←'Could not find:'filename</code>
<code class="emphasize">→[11]      msg,←'' 'The programm cannot continue.'</code>
<code> [12]          ⍝ --- Debug information</code>
<code class="emphasize">→[13]      :If debug←0</code>
<code class="emphasize">→[14]          msg,←⊂'folder name: ',folderName</code>
<code class="emphasize">→[15]          msg,←⊂'Command line: ',⎕C 2 ⎕NQ'#' 'GetCommandLine'</code>
<code class="emphasize">→[16]          msg,←⊂'Current directory: ',#.FilesAndDirs.PWD</code>
<code> [17]      :EndIf</code>
<code class="emphasize">→[18]      'Laguntza'Show msg</code>
<code> [19]  :Else</code>
<code class="emphasize">→[20]      tieNo←filename ⎕FSTIE 0</code>
<code class="emphasize">→[21]      parms←⎕FREAD tieNo 6</code>
<code class="emphasize">→[22]      ⎕FUNTIE tieNo</code>
<code class="emphasize">→[23]      ps←⎕NS''</code>
<code class="emphasize">→[24]      parms[parms[;0]⍳⊂'userMode';1]←1 ⍝ This function always runs in user mode</code>
<code class="emphasize">→[25]      :If 0≠≢parms</code>
<code class="emphasize">→[26]          ps.{⍎(0⊃⍵),'←1⊃⍵'}¨↓parms</code>
<code> [27]      :EndIf</code>
<code class="emphasize">→[28]      ps.folderName←GetHome''</code>
<code class="emphasize">→[29]      :If File.DoesFileExist'help.ico'</code>
<code class="emphasize">→[30]          ps.helpIcon←'file:///',(↑⎕CMD'cd'),'\help.ico'</code>
<code> [31]      :EndIf</code>
<code class="emphasize">→[32]      ps.visible←1</code>
<code class="emphasize">→[33]      ps.page←GetPageName ⍬</code>
<code class="emphasize">→[34]      ref←New ps</code>
<code> [35]  :EndIf</code>
</div>
<code class="header" id="listing_124">#.Laguntza.Laguntza.YesOrNo &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  YesOrNo←{</code>
<code class="emphasize">→[1]       caption←⍺</code>
<code class="emphasize">→[2]       ∆←⊂'MsgBox'</code>
<code class="emphasize">→[3]       ∆,←⊂'Caption'caption</code>
<code class="emphasize">→[4]       ∆,←⊂'Text'⍵</code>
<code class="emphasize">→[5]       ∆,←⊂'Style' 'Query'</code>
<code class="emphasize">→[6]       ∆,←⊂'Btns'('YES' 'NO')</code>
<code class="emphasize">→[7]       ∆,←⊂'Event'('MsgBtn1' 'MsgBtn2')1</code>
<code class="emphasize">→[8]       _←'ask'⎕WC ∆</code>
<code class="emphasize">→[9]       res←⎕DQ'ask'</code>
<code class="emphasize">→[10]      _←⎕EX'ask'</code>
<code class="emphasize">→[11]      'MsgBtn1'≡1⊃res</code>
<code> [12]  ⍝ Ask question ⍵ and offer Yes/No and returns 1 or 0</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_125">#.Laguntza.Laguntza.YesOrNoInSession &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  bool←YesOrNoInSession msg</code>
<code class="emphasize">→[1]   flag←0</code>
<code class="emphasize">→[2]   :Repeat</code>
<code class="emphasize">→[3]       :If 1&lt;≡msg</code>
<code class="emphasize">→[4]           ⎕←⍪msg</code>
<code> [5]       :Else</code>
<code class="emphasize">→[6]           ⎕←msg</code>
<code> [7]       :EndIf</code>
<code class="emphasize">→[8]       ⎕←'(Enter "y" or "n")'</code>
<code class="emphasize">→[9]       answer←¯1↑⍞</code>
<code class="emphasize">→[10]      flag←answer∊'YyNn!'</code>
<code class="emphasize">→[11]  :Until flag</code>
<code class="emphasize">→[12]  ⍎('!'=answer)/'.'</code>
<code class="emphasize">→[13]  bool←answer∊'Yy'</code>
</div>
<code class="header" id="listing_126">#.Laguntza.Laguntza.QuadVariables.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_127">#.Laguntza.Laguntza.API.ListHelpForms &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ListHelpForms</code>
<code class="emphasize">→[1]  r←##.ListHelpForms</code>
</div>
<code class="header" id="listing_128">#.Laguntza.Laguntza.API.Reset &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←Reset</code>
<code class="emphasize">→[1]  r←##.Reset</code>
</div>
<code class="header" id="listing_129">#.Laguntza.Laguntza.API.Version &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Version</code>
<code class="emphasize">→[1]  r←##.Version</code>
</div>
<code class="header" id="listing_130">#.Laguntza.Laguntza.AskString.OnCheckNameOfNewNode &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnCheckNameOfNewNode←{</code>
<code class="emphasize">→[1]      n←(↑⍵).##.n</code>
<code class="emphasize">→[2]      name←n.input.Text</code>
<code class="emphasize">→[3]      ((name=' ')/name)←'_'</code>
<code class="emphasize">→[4]      0≠(⎕NS'').⎕NC name:0⊣##.Show'Sorry, but this is not a valid APL name.'</code>
<code class="emphasize">→[5]      _←2 ⎕NQ n.form'Close'</code>
<code class="emphasize">→[6]      n.∆result←name</code>
<code class="emphasize">→[7]      0</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_131">#.Laguntza.Laguntza.AskString.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_132">#.Laguntza.Laguntza.AskString.Run &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  (key string)←{caption}Run(∆Ref question default)</code>
<code class="emphasize">→[1]   caption←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'caption'</code>
<code class="emphasize">→[2]   n←⎕NS''</code>
<code class="emphasize">→[3]   size←150 600</code>
<code> [4]  </code>
<code class="emphasize">→[5]   ∆←''</code>
<code class="emphasize">→[6]   ∆,←⊂'Caption'caption</code>
<code class="emphasize">→[7]   ∆,←⊂'Posn'(∆Ref.n.form.Posn+20 20)</code>
<code class="emphasize">→[8]   ∆,←⊂'Size'size</code>
<code class="emphasize">→[9]   ∆,←⊂'Coord' 'Pixel'</code>
<code class="emphasize">→[10]  ∆,←⊂'MaxButton' 0</code>
<code class="emphasize">→[11]  ∆,←⊂'IconObj'∆Ref.n.form.IconObj</code>
<code class="emphasize">→[12]  ∆,←⊂'FontObj'∆Ref.n.form.FontObj</code>
<code> [13] </code>
<code class="emphasize">→[14]  n.form←⎕NEW'Form'∆</code>
<code class="emphasize">→[15]  n.form.onConfigure←'OnConfigure'size</code>
<code class="emphasize">→[16]  n.aplFont←n.form.⎕NEW'Font'(('PName' 'APL385 Unicode')('Size' 18)('Fixed' 1))</code>
<code> [17] </code>
<code class="emphasize">→[18]  ∆←''</code>
<code class="emphasize">→[19]  ∆,←⊂'Posn'(10 10)</code>
<code class="emphasize">→[20]  ∆,←⊂'Caption'question</code>
<code class="emphasize">→[21]  ∆,←⊂'Attach'('Top' 'Left' 'Top' 'Left')</code>
<code class="emphasize">→[22]  n.question←n.form.⎕NEW'Label'∆</code>
<code> [23] </code>
<code class="emphasize">→[24]  ∆←''</code>
<code class="emphasize">→[25]  ∆,←⊂'Text'default</code>
<code class="emphasize">→[26]  ∆,←⊂'Size'(⍬(n.form.Size[1]-20))</code>
<code class="emphasize">→[27]  ∆,←⊂'Posn'((10+0⊃+⌿⊃n.question.(Posn Size)),10)</code>
<code class="emphasize">→[28]  ∆,←⊂'Attach'('Top' 'Left' 'Top' 'Right')</code>
<code class="emphasize">→[29]  ∆,←⊂'FontObj'n.aplFont</code>
<code class="emphasize">→[30]  n.input←n.form.⎕NEW'Edit'∆</code>
<code class="emphasize">→[31]  n.input.Size[0]-←5</code>
<code> [32] </code>
<code class="emphasize">→[33]  ∆←''</code>
<code class="emphasize">→[34]  ∆,←⊂'Size'(⍬ 100)</code>
<code class="emphasize">→[35]  ∆,←⊂'Default' 1</code>
<code class="emphasize">→[36]  ∆,←⊂'Caption' 'OK'</code>
<code class="emphasize">→[37]  ∆,←⊂'Attach'('Bottom' 'Left' 'Bottom' 'Left')</code>
<code class="emphasize">→[38]  n.ok←n.form.⎕NEW'Button'∆</code>
<code class="emphasize">→[39]  n.ok.Posn←(n.form.Size[0]-n.ok.Size[0]+10),10</code>
<code> [40] </code>
<code class="emphasize">→[41]  ∆←''</code>
<code class="emphasize">→[42]  ∆,←⊂'Size'(⍬ 100)</code>
<code class="emphasize">→[43]  ∆,←⊂'Cancel' 1</code>
<code class="emphasize">→[44]  ∆,←⊂'Caption' 'Cancel'</code>
<code class="emphasize">→[45]  ∆,←⊂'Attach'('Bottom' 'Left' 'Bottom' 'Left')</code>
<code class="emphasize">→[46]  n.cancel←n.form.⎕NEW'Button'∆</code>
<code class="emphasize">→[47]  n.cancel.Posn←(n.ok.Posn[0]),10+1⊃+⌿⊃n.ok.(Posn Size)</code>
<code> [48] </code>
<code class="emphasize">→[49]  n.cancel.onSelect←1</code>
<code class="emphasize">→[50]  n.ok.onSelect←'OnCheckNameOfNewNode'</code>
<code class="emphasize">→[51]  n.input.SelText←1,1+≢default</code>
<code class="emphasize">→[52]  n.form.n←n</code>
<code class="emphasize">→[53]  ⎕NQ n.input'GotFocus' ⋄ res←⎕DQ n.form</code>
<code> [54] </code>
<code class="emphasize">→[55]  key←(n.cancel≡↑res)⊃'OK' 'Cancel'</code>
<code class="emphasize">→[56]  :If key≡'OK'</code>
<code class="emphasize">→[57]      string←n.∆result</code>
<code> [58]  :Else</code>
<code class="emphasize">→[59]      string←''</code>
<code class="emphasize">→[60]      {}2 ⎕NQ n.form'Close'</code>
<code> [61]  :EndIf</code>
<code> [62] ⍝Done</code>
</div>
<code class="header" id="listing_133">#.Laguntza.Laguntza.Events.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_134">#.Laguntza.Laguntza.Events.ReportBrokenLink &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ReportBrokenLink</code>
<code> [1] ⍝ This event is catched by the test cases in order to report</code>
<code> [2] ⍝ broken links in a help page.</code>
<code class="emphasize">→[3]  r←996</code>
</div>
<code class="header" id="listing_135">#.Laguntza.Laguntza.Export2HTML_.CreateDefaultIndexPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateDefaultIndexPage←{</code>
<code class="emphasize">→[1]       (f row folder path level)←⍵</code>
<code class="emphasize">→[2]       ∆Ref←⍺</code>
<code class="emphasize">→[3]       bool←(1+f.tree[row;0])=row↓f.tree[;0]</code>
<code class="emphasize">→[4]       noOf←1+((1+row)↓f.tree[;0])⍳f.tree[row;0]</code>
<code class="emphasize">→[5]       (noOf↓bool)←0</code>
<code class="emphasize">→[6]       type←f.tree[bool/row↓⍳≢f.tree;6]</code>
<code class="emphasize">→[7]       urls←f.tree[bool/row↓⍳≢f.tree;1]</code>
<code class="emphasize">→[8]       (type/urls),←⊂'/index.html'</code>
<code class="emphasize">→[9]       type←~type</code>
<code class="emphasize">→[10]      (type/urls)←(type/urls),¨⊂'.html'</code>
<code class="emphasize">→[11]      (type/urls)←'_',¨type/urls</code>
<code class="emphasize">→[12]      anchors←(bool/row↓f.tree[;2]){'&lt;a class="link" href="',⍵,'"&gt;',⍺,'&lt;/a&gt;'}¨urls</code>
<code class="emphasize">→[13]      title←2⊃f.tree[row;]</code>
<code class="emphasize">→[14]      head←∆Ref GetHead title folder(level+1)</code>
<code class="emphasize">→[15]      breadcrumb←f GetBreadcrumb row</code>
<code class="emphasize">→[16]      body←∆Ref MarkUpIndexPage title anchors folder breadcrumb level</code>
<code class="emphasize">→[17]      html←head,body</code>
<code class="emphasize">→[18]      filename←folder,'HTML/',path,'/index.html'</code>
<code class="emphasize">→[19]      r←(⊂html)⎕NPUT filename 1</code>
<code class="emphasize">→[20]      1:r←0</code>
<code> [21]  }</code>
</div>
<code class="header" id="listing_136">#.Laguntza.Laguntza.Export2HTML_.CreateHomePage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateHomePage←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       (f path)←⍵</code>
<code class="emphasize">→[3]       level←0</code>
<code class="emphasize">→[4]       mainTocPage←1</code>
<code class="emphasize">→[5]       mainIndexPage←0</code>
<code class="emphasize">→[6]       tag←##.HTML.Tag</code>
<code class="emphasize">→[7]       toc←GetTOC f</code>
<code class="emphasize">→[8]       body←''</code>
<code class="emphasize">→[9]       body,←⊂'&lt;body&gt;'</code>
<code class="emphasize">→[10]      body,←InjectMainMenu level mainTocPage mainIndexPage</code>
<code class="emphasize">→[11]      body,←⊂'&lt;h1 id="h1toc"&gt;',f.caption,'&lt;br /&gt;Table Of Contents&lt;/h1&gt;'</code>
<code class="emphasize">→[12]      body,←⊂'&lt;div id="toc"&gt;'</code>
<code class="emphasize">→[13]      body,←toc</code>
<code class="emphasize">→[14]      body,←⊂'&lt;/div&gt;'</code>
<code class="emphasize">→[15]      body,←⊂'&lt;/body&gt;'</code>
<code class="emphasize">→[16]      head←∆Ref GetHead f.caption path level</code>
<code class="emphasize">→[17]      html←head,body,⊂'&lt;/html&gt;'</code>
<code class="emphasize">→[18]      filename←path,'/index.html'</code>
<code class="emphasize">→[19]      r←(⊂html)⎕NPUT filename 1</code>
<code class="emphasize">→[20]      1:r←0</code>
<code> [21]  }</code>
</div>
<code class="header" id="listing_137">#.Laguntza.Laguntza.Export2HTML_.CreateIndexPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateIndexPage←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       (f path)←⍵</code>
<code class="emphasize">→[3]       level←0</code>
<code class="emphasize">→[4]       mainTocPage←0</code>
<code class="emphasize">→[5]       mainIndexPage←1</code>
<code class="emphasize">→[6]       tag←##.HTML.Tag</code>
<code class="emphasize">→[7]       body←''</code>
<code class="emphasize">→[8]       body,←⊂'&lt;body&gt;'</code>
<code class="emphasize">→[9]       body,←InjectMainMenu level mainTocPage mainIndexPage</code>
<code class="emphasize">→[10]      body,←⊂'&lt;h1 id="h1index"&gt;',f.caption,'&lt;br /&gt;Index&lt;/h1&gt;'</code>
<code class="emphasize">→[11]      body,←⊂'&lt;div id="index"&gt;'</code>
<code class="emphasize">→[12]      body,←GetIndex f</code>
<code class="emphasize">→[13]      body,←⊂'&lt;/div&gt;'</code>
<code class="emphasize">→[14]      body,←⊂'&lt;/body&gt;'</code>
<code class="emphasize">→[15]      head←∆Ref GetHead f.caption path level</code>
<code class="emphasize">→[16]      html←head,body,⊂'&lt;/html&gt;'</code>
<code class="emphasize">→[17]      filename←path,'/TheIndex.html'</code>
<code class="emphasize">→[18]      r←(⊂html)⎕NPUT filename 1</code>
<code class="emphasize">→[19]      1:r←0</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_138">#.Laguntza.Laguntza.Export2HTML_.GetBreadcrumb &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetBreadcrumb←{</code>
<code class="emphasize">→[1]       f←⍺</code>
<code class="emphasize">→[2]       row←⍵</code>
<code class="emphasize">→[3]       rows←{¯1+(≢⍵)-⍵⍳⍳↑⍵}⌽(1+row)↑f.tree[;0]</code>
<code class="emphasize">→[4]       parents←{↑{⍺,'/',⍵}/⍵}⍣(0≠≢rows)⊣f.tree[rows;2]</code>
<code class="emphasize">→[5]       breadcrumb←parents,((0≠≢parents)/'/'),,row⊃f.tree[;2]</code>
<code class="emphasize">→[6]       ~'/'∊breadcrumb:''</code>
<code class="emphasize">→[7]       urls←{(⊂⍵)↑¨⍨1+⍳≢⍵}f.tree[rows;1]</code>
<code class="emphasize">→[8]       buff←urls{((↑{⍺,'/',⍵}/⍺),'/index.html')⍵}¨f.tree[rows;1]</code>
<code class="emphasize">→[9]       (0⊃¨buff)←(,/((row⊃f.tree[;6])+≢buff)⍴⊂'../'),¨0⊃¨buff</code>
<code class="emphasize">→[10]      ↑{⍺,' / ',⍵}/{'&lt;a href="',(0⊃⍵),'"&gt;',(1⊃⍵),'&lt;/a&gt;'}¨buff</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_139">#.Laguntza.Laguntza.Export2HTML_.GetHead &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetHead←{</code>
<code> [1]   ⍝ Creates top part of the HTML code needed for the "head" part of the HTML page:</code>
<code> [2]   ⍝ Doc declaration, html, title and meta tags.</code>
<code class="emphasize">→[3]       (title path level)←⍵</code>
<code class="emphasize">→[4]       ∆Ref←⍺</code>
<code class="emphasize">→[5]       head←''</code>
<code class="emphasize">→[6]       head,←⊂'&lt;!DOCTYPE html&gt;'</code>
<code class="emphasize">→[7]       head,←⊂'&lt;html lang="',∆Ref.p.language,'"&gt;'</code>
<code class="emphasize">→[8]       head,←⊂'&lt;head&gt;'</code>
<code> [9]     ⍝ ↓↓↓ https://blogs.msdn.microsoft.com/askie/2009/03/23/understanding-compatibility-modes-in-internet-explorer-8/</code>
<code class="emphasize">→[10]      head,←⊂'&lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;' ⍝ This must be the FIRST entry after &lt;head&gt; according to some sources!</code>
<code class="emphasize">→[11]      head,←⊂'&lt;title&gt;',title,'&lt;/title&gt;'</code>
<code class="emphasize">→[12]      href←##.HTML.EnforceSlash ∆Ref.p.folderName</code>
<code class="emphasize">→[13]      href,←'/'/⍨'/'≠¯1↑href</code>
<code class="emphasize">→[14]      head,←⊂'&lt;meta charset="UTF-8"&gt;'</code>
<code class="emphasize">→[15]      fn←(↑,/(level)⍴⊂'../'),'Assets/screen.css'</code>
<code class="emphasize">→[16]      head,←⊂'&lt;link rel="stylesheet" type="text/css" href="',fn,'" media="screen"&gt;'</code>
<code class="emphasize">→[17]      fn←(↑,/(level)⍴⊂'../'),'Assets/print.css'</code>
<code class="emphasize">→[18]      head,←⊂'&lt;link rel="stylesheet" type="text/css" href="',fn,'" media="print"&gt;'</code>
<code class="emphasize">→[19]      head,⊂'&lt;/head&gt;'</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_140">#.Laguntza.Laguntza.Export2HTML_.GetIndex &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetIndex←{</code>
<code class="emphasize">→[1]       f←⍵</code>
<code class="emphasize">→[2]       index←2⊃f.index</code>
<code class="emphasize">→[3]       ∆chapterName←1+∆pageName←1+∆keywords←0</code>
<code class="emphasize">→[4]       rows←1⊃f.index</code>
<code class="emphasize">→[5]       pageUrls←f GetRelativePageNameForRow¨rows</code>
<code class="emphasize">→[6]       pageUrls←(⊂'HTML/'),¨pageUrls</code>
<code class="emphasize">→[7]       pageAnchors←index[;∆keywords]{'&lt;a href="',⍵,'"&gt;',⍺,'&lt;/a&gt;'}¨pageUrls</code>
<code class="emphasize">→[8]       tag←##.HTML.Tag</code>
<code class="emphasize">→[9]       bool←0&lt;≢¨index[;∆chapterName]</code>
<code class="emphasize">→[10]      chapterUrls←(↑¨¯2↓¨⎕NPARTS¨bool/pageUrls),¨⊂'index.html'</code>
<code class="emphasize">→[11]      chapterAnchors←bool\chapterUrls{'&lt;a href="',⍺,'"&gt;',⍵,'&lt;/a&gt;'}¨bool/index[;∆pageName]</code>
<code class="emphasize">→[12]      col1←'td'∘tag¨index[;∆pageName]</code>
<code class="emphasize">→[13]      col2←'td'∘tag¨pageAnchors</code>
<code class="emphasize">→[14]      col3←'td'∘tag¨chapterAnchors</code>
<code class="emphasize">→[15]      table←'&lt;table id="table_index"&gt;' '&lt;thead&gt;' '&lt;tr&gt;' '&lt;th&gt;Key word&lt;/th&gt;' '&lt;th&gt;Page name&lt;/th&gt;' '&lt;th&gt;Chapter&lt;/th&gt;' '&lt;/tr&gt;'</code>
<code class="emphasize">→[16]      table,←'&lt;/thead&gt;' '&lt;tbody&gt;'</code>
<code class="emphasize">→[17]      table,←{↑,/⍵}¨'tr'∘tag¨(⊂¨col1),¨(⊂¨col2),¨⊂¨col3</code>
<code class="emphasize">→[18]      table,←'&lt;/tbody&gt;' '&lt;/table&gt;'</code>
<code class="emphasize">→[19]      table</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_141">#.Laguntza.Laguntza.Export2HTML_.GetRelativePageNameForRow &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetRelativePageNameForRow←{</code>
<code class="emphasize">→[1]      f←⍺</code>
<code class="emphasize">→[2]      row←⍵</code>
<code class="emphasize">→[3]      url←f GetRelativeUrlForRow row</code>
<code class="emphasize">→[4]      f.tree[row;6]:url,'/index.html'</code>
<code class="emphasize">→[5]      url,'.html'</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_142">#.Laguntza.Laguntza.Export2HTML_.GetRelativeUrlForRow &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetRelativeUrlForRow←{</code>
<code class="emphasize">→[1]      f←⍺</code>
<code class="emphasize">→[2]      row←⍵</code>
<code class="emphasize">→[3]      rows←{¯1+(≢⍵)-⍵⍳⍳↑⍵}⌽(1+row)↑f.tree[;0]</code>
<code class="emphasize">→[4]      parents←{↑{⍺,'/',⍵}/⍵}⍣(0≠≢rows)⊣f.tree[rows;1]</code>
<code class="emphasize">→[5]      parents,((0≠≢parents)/'/'),((~row⊃f.tree[;6])/'_'),row⊃f.tree[;1]</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_143">#.Laguntza.Laguntza.Export2HTML_.GetTOC &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  toc←{attr}GetTOC f</code>
<code class="emphasize">→[1]   toc←⊂'&lt;div id="toc"&gt;'</code>
<code class="emphasize">→[2]   lastLevel←¯1</code>
<code class="emphasize">→[3]   :For row :In ⍳≢f.tree</code>
<code class="emphasize">→[4]       (level name caption isContainer)←f.tree[row;0 1 2 6]</code>
<code class="emphasize">→[5]       :If lastLevel&lt;level</code>
<code class="emphasize">→[6]           toc,←⊂'&lt;ul&gt;'</code>
<code class="emphasize">→[7]       :ElseIf lastLevel&gt;level</code>
<code class="emphasize">→[8]           toc,←(lastLevel-level)⍴⊂'&lt;/ul&gt;'</code>
<code> [9]       :EndIf</code>
<code class="emphasize">→[10]      :If isContainer</code>
<code class="emphasize">→[11]          url←'HTML/',f GetRelativeUrlForRow row</code>
<code class="emphasize">→[12]          toc,←⊂'&lt;li&gt;&lt;a href="',url,'/index.html"&gt;',caption,'&lt;/a&gt;'</code>
<code> [13]      :Else</code>
<code class="emphasize">→[14]          url←'HTML/',f GetRelativeUrlForRow row</code>
<code class="emphasize">→[15]          toc,←⊂'&lt;li&gt;&lt;a href="',url,'.html"&gt;',caption,'&lt;/a&gt;'</code>
<code> [16]      :EndIf</code>
<code class="emphasize">→[17]      lastLevel←level</code>
<code> [18]  :EndFor</code>
<code class="emphasize">→[19]  toc,←⊂'&lt;/div&gt;'</code>
</div>
<code class="header" id="listing_144">#.Laguntza.Laguntza.Export2HTML_.GetTocCSS &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetTocCSS</code>
<code class="emphasize">→[1]   r←⊂'&lt;style type="text/css" media="all"&gt;'</code>
<code class="emphasize">→[2]   r,←⊂'div#toc {'</code>
<code class="emphasize">→[3]   r,←⊂' font-family:"Georgia";'</code>
<code class="emphasize">→[4]   r,←⊂' font-size:small;'</code>
<code class="emphasize">→[5]   r,←⊂'}'</code>
<code class="emphasize">→[6]   r,←⊂'div#toc ul {'</code>
<code class="emphasize">→[7]   r,←⊂'display: block;'</code>
<code class="emphasize">→[8]   r,←⊂' list-style-type: circle;'</code>
<code class="emphasize">→[9]   r,←⊂' padding-left: 10px;'</code>
<code class="emphasize">→[10]  r,←⊂' margin: 2px 0 0 0!important;;'</code>
<code class="emphasize">→[11]  r,←⊂'}'</code>
<code class="emphasize">→[12]  r,←⊂'div#toc ul li {'</code>
<code class="emphasize">→[13]  r,←⊂' margin: 2px 0 0 6px;'</code>
<code class="emphasize">→[14]  r,←⊂'}'</code>
<code class="emphasize">→[15]  r,←⊂'div#toc a {'</code>
<code class="emphasize">→[16]  r,←⊂' text-decoration:none;'</code>
<code class="emphasize">→[17]  r,←⊂' color:black;'</code>
<code class="emphasize">→[18]  r,←⊂'}'</code>
<code class="emphasize">→[19]  r,←⊂'&lt;/style&gt;'</code>
</div>
<code class="header" id="listing_145">#.Laguntza.Laguntza.Export2HTML_.HandleImageFolder &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> HandleImageFolder←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      folder←⍵</code>
<code class="emphasize">→[3]      _←1 ⎕MKDIR folder,'/Images'</code>
<code class="emphasize">→[4]      _←(∆Ref.p.folderName,'/Images')HandleImageFolder_ folder,'/Images'</code>
<code class="emphasize">→[5]      1:r←⍬</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_146">#.Laguntza.Laguntza.Export2HTML_.HandleImageFolder_ &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←sourcePath HandleImageFolder_ targetPath</code>
<code class="emphasize">→[1]   r←⍬</code>
<code class="emphasize">→[2]   :If ⎕NEXISTS sourcePath</code>
<code class="emphasize">→[3]   :AndIf 0≠≢list←0 1 ⎕NINFO⍠('Wildcard' 1)⊣sourcePath,'/*'</code>
<code class="emphasize">→[4]       :For file :In (2=1⊃list)/0⊃list   ⍝ Copy all files</code>
<code class="emphasize">→[5]           tno1←file ⎕NTIE 0 64</code>
<code class="emphasize">→[6]           tno2←(targetPath,'/',↑{⍺,⍵}/¯2↑⎕NPARTS file)⎕NCREATE 0</code>
<code class="emphasize">→[7]           (⎕NREAD tno1 11 ¯1 0)⎕NAPPEND tno2</code>
<code class="emphasize">→[8]           ⎕NUNTIE tno1 tno2</code>
<code> [9]       :EndFor</code>
<code class="emphasize">→[10]      :For file :In (1=1⊃list)/0⊃list   ⍝ Handle sub directories</code>
<code class="emphasize">→[11]          subFolder←1⊃⎕NPARTS file</code>
<code class="emphasize">→[12]          1 ⎕MKDIR targetPath,'/',subFolder</code>
<code class="emphasize">→[13]          (sourcePath,'/',subFolder)HandleImageFolder_ targetPath,'/',subFolder</code>
<code> [14]      :EndFor</code>
<code> [15]  :EndIf</code>
</div>
<code class="header" id="listing_147">#.Laguntza.Laguntza.Export2HTML_.HandleJavaScriptAndCSS &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  HandleJavaScriptAndCSS←{</code>
<code class="emphasize">→[1]       folder←⍵</code>
<code class="emphasize">→[2]       _←1 ⎕MKDIR folder,'/Assets'</code>
<code class="emphasize">→[3]       fn←(≢'file:///')↓##.HTML.GetCssFileName ∆Ref'screen'</code>
<code class="emphasize">→[4]       _←(⎕NGET fn)⎕NPUT(folder,'/Assets/screen.css')1</code>
<code class="emphasize">→[5]       fn←(≢'file:///')↓##.HTML.GetCssFileName ∆Ref'print'</code>
<code class="emphasize">→[6]       _←(⎕NGET fn)⎕NPUT(folder,'/Assets/print.css')1</code>
<code> [7]       ⍝ Later we add JavaScript files here, if any.</code>
<code class="emphasize">→[8]       1:r←0</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_148">#.Laguntza.Laguntza.Export2HTML_.InjectMainMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  InjectMainMenu←{</code>
<code class="emphasize">→[1]       ⍺←''</code>
<code class="emphasize">→[2]       breadcrumb←⍺</code>
<code class="emphasize">→[3]       (level mainTocPage mainIndexPage)←⍵</code>
<code class="emphasize">→[4]       buff←↑,/level⍴⊂'../'</code>
<code class="emphasize">→[5]       a1←'&lt;li&gt;&lt;a ',(mainTocPage/'id="a_mainmenu_toc" '),'href="',buff,'index.html"&gt;TOC&lt;/a&gt;&lt;/li&gt;'</code>
<code class="emphasize">→[6]       a2←'&lt;li&gt;&lt;a ',(mainIndexPage/'id="a_mainmenu_index" '),'href="',buff,'TheIndex.html"&gt;Index&lt;/a&gt;&lt;/li&gt;'</code>
<code class="emphasize">→[7]       html←(0≠≢breadcrumb)/'&lt;p id="p_breadcrumb"&gt;'breadcrumb'&lt;/p&gt;'</code>
<code class="emphasize">→[8]       html,←'&lt;ul id="mainmenu"&gt;'a1 a2'&lt;/ul&gt;'</code>
<code class="emphasize">→[9]       html</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_149">#.Laguntza.Laguntza.Export2HTML_.MakeFrames &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  MakeFrames←{</code>
<code class="emphasize">→[1]       body←⍵</code>
<code class="emphasize">→[2]       toc←⍺</code>
<code class="emphasize">→[3]       frames←'&lt;frames id="frame"&gt;' '&lt;tr&gt;' '&lt;td id="left_frame"&gt;' '&lt;div id="left_frame_content"&gt;'</code>
<code class="emphasize">→[4]       frames,←toc</code>
<code class="emphasize">→[5]       frames,←'&lt;/div&gt;' '&lt;/td&gt;' '&lt;td id="right_frame"&gt;' '&lt;div id="right_frame_content&gt;'</code>
<code class="emphasize">→[6]       frames,←body</code>
<code class="emphasize">→[7]       frames,←'&lt;/div&gt;' '&lt;/td&gt;' '&lt;/tr&gt;' '&lt;/frames&gt;'</code>
<code class="emphasize">→[8]       frames</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_150">#.Laguntza.Laguntza.Export2HTML_.MakeFullPageFrom &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> MakeFullPageFrom←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      (body path level)←⍵</code>
<code class="emphasize">→[3]      title←##.HTML.GetTitleFromBody body</code>
<code class="emphasize">→[4]      (∆Ref GetHead title path(level+1)),(⊂'&lt;body&gt;'),body,'&lt;/body&gt;' '&lt;/html&gt;'</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_151">#.Laguntza.Laguntza.Export2HTML_.MarkUpIndexPage &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  MarkUpIndexPage←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       (title anchors folder breadcrumb level)←⍵</code>
<code class="emphasize">→[3]       tag←##.HTML.Tag</code>
<code class="emphasize">→[4]       body←''</code>
<code class="emphasize">→[5]       body,←⊂'&lt;body&gt;'</code>
<code class="emphasize">→[6]       body,←breadcrumb InjectMainMenu(level+1)0 0</code>
<code class="emphasize">→[7]       body,←⊂'h1'tag title</code>
<code class="emphasize">→[8]       body,←⊂'&lt;ul class="defaultpagelist"&gt;'</code>
<code class="emphasize">→[9]       body,←'li'∘tag¨anchors</code>
<code class="emphasize">→[10]      body,←⊂'&lt;/ul&gt;'</code>
<code class="emphasize">→[11]      body,←⊂'&lt;/body&gt;'</code>
<code class="emphasize">→[12]      (⊂'&lt;html&gt;'),body,⊂'&lt;/html&gt;'</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_152">#.Laguntza.Laguntza.Export2HTML_.PolishAnchors &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  html←x PolishAnchors html</code>
<code> [1]  ⍝ The html (⍵) is from Laguntza, meaning that all internal links look</code>
<code> [2]  ⍝ like `&lt;a href="#001"` - they need to point to real HTML pages now, so we</code>
<code> [3]  ⍝ have to change them all.\\</code>
<code> [4]  ⍝ Also, all images need to be polished as well</code>
<code class="emphasize">→[5]   (f level)←x</code>
<code class="emphasize">→[6]   :If 0&lt;noOf←+/bool←'&lt;a href="#'⍷html</code>
<code class="emphasize">→[7]       top←(bool⍳1)↑html</code>
<code class="emphasize">→[8]       anchors←1↓(~bool)⊂html</code>
<code class="emphasize">→[9]       rows←{⍎⍵↑⍨⍵⍳'"'}¨(≢'a href="#')↓¨anchors</code>
<code class="emphasize">→[10]      anchors←{⍵/⍨2≤+\'"'=⍵}¨anchors</code>
<code class="emphasize">→[11]      urls←f∘GetRelativeUrlForRow¨rows</code>
<code class="emphasize">→[12]      urls←(,/(level)⍴⊂'../'),¨urls</code>
<code class="emphasize">→[13]      type←f.tree[rows;6]</code>
<code class="emphasize">→[14]      (type/urls)←(type/urls),¨⊂'/index.html'</code>
<code class="emphasize">→[15]      type←~type</code>
<code class="emphasize">→[16]      (type/urls)←(type/urls),¨⊂'.html'</code>
<code class="emphasize">→[17]      html←top,↑,/(⊂'&lt;a href="'),¨urls,¨anchors</code>
<code> [18]  :EndIf</code>
<code class="emphasize">→[19]  :If 0&lt;noOf←+/bool←'&lt;img src="'⍷html</code>
<code class="emphasize">→[20]      top←(bool⍳1)↑html</code>
<code class="emphasize">→[21]      buff←1↓(~bool)⊂html</code>
<code class="emphasize">→[22]      buff←'&lt;',¨(1+level)PolishAnchors_¨buff</code>
<code class="emphasize">→[23]      html←top,↑,/buff</code>
<code> [24]  :EndIf</code>
</div>
<code class="header" id="listing_153">#.Laguntza.Laguntza.Export2HTML_.PolishAnchors_ &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  PolishAnchors_←{</code>
<code> [1]  ⍝ Checks whether the src=" part of an image definition is an absolute path name.</code>
<code> [2]  ⍝ If yes: leave it alone.</code>
<code> [3]  ⍝ If no: add as many "../" as defined by `level`.</code>
<code class="emphasize">→[4]       level←⍺</code>
<code class="emphasize">→[5]       html←⍵</code>
<code class="emphasize">→[6]       src←{⍵↑⍨⍵⍳'"'}'src="'{(≢⍺)↓⍵↓⍨(⍺⍷⍵)⍳1}html</code>
<code class="emphasize">→[7]       f1←'/'=1⍴src</code>
<code class="emphasize">→[8]       f2←'\\'≡2⍴src</code>
<code class="emphasize">→[9]       f3←':'∊src</code>
<code class="emphasize">→[10]      f1∨f2∨f3:html</code>
<code class="emphasize">→[11]      'src="'⎕R('&amp;',↑,/level⍴⊂'../')⊣html</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_154">#.Laguntza.Laguntza.Export2HTML_.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_155">#.Laguntza.Laguntza.Export2HTML_.Run &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←Run(∆Ref folder)</code>
<code class="emphasize">→[1]   f←⎕NS''                                ⍝ Holds all file data</code>
<code class="emphasize">→[2]   f.(tree Words words index caption)←⎕FREAD ∆Ref.f.tieNo(1 2 3 4 5)</code>
<code class="emphasize">→[3]   folder←##.HTML.EnforceSlash folder</code>
<code class="emphasize">→[4]   HandleJavaScriptAndCSS folder</code>
<code class="emphasize">→[5]   ∆Ref HandleImageFolder folder</code>
<code class="emphasize">→[6]   ⎕MKDIR folder,'/HTML'</code>
<code class="emphasize">→[7]   ∆Ref CreateHomePage f folder</code>
<code class="emphasize">→[8]   ∆Ref CreateIndexPage f folder</code>
<code class="emphasize">→[9]   :For row :In ⍳¯10+-/⌽2↑⎕FSIZE ∆Ref.f.tieNo</code>
<code class="emphasize">→[10]      path←f GetRelativeUrlForRow row</code>
<code class="emphasize">→[11]      body←⎕FREAD ∆Ref.f.tieNo,11+row</code>
<code class="emphasize">→[12]      {}1 ⎕MKDIR⍣(f.tree[row;6])⊣folder,'/HTML/',path</code>
<code class="emphasize">→[13]      level←+/f.tree[row;0 6]</code>
<code class="emphasize">→[14]      :If 0=≢body</code>
<code class="emphasize">→[15]          ∆Ref CreateDefaultIndexPage f row folder path level</code>
<code> [16]      :Else</code>
<code class="emphasize">→[17]          filename←folder,'HTML/',f GetRelativePageNameForRow row</code>
<code class="emphasize">→[18]          body←(⊂f level)PolishAnchors¨body</code>
<code class="emphasize">→[19]          breadcrumb←f GetBreadcrumb row</code>
<code class="emphasize">→[20]          body←(breadcrumb InjectMainMenu(level+1)0 0),body</code>
<code class="emphasize">→[21]          html←∆Ref MakeFullPageFrom body path level</code>
<code class="emphasize">→[22]          (⊂html)⎕NPUT filename</code>
<code> [23]      :EndIf</code>
<code> [24]  :EndFor</code>
<code class="emphasize">→[25]  'Export as HTML'##.Show'Help system exported to:'folder</code>
</div>
<code class="header" id="listing_156">#.Laguntza.Laguntza.File.DeleteFolder &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> DeleteFolder←{</code>
<code> [1] ⍝ Removes folder ⍵ with all its contents.</code>
<code class="emphasize">→[2]      dir←⍵</code>
<code class="emphasize">→[3]      rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code class="emphasize">→[4]      {11::1 ⋄ 6::0 ⋄ 0⊣⍵.DeleteFolder(dir~'"')1}rf</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_157">#.Laguntza.Laguntza.File.DoesFileExist &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> DoesFileExist←{</code>
<code> [1] ⍝ Checks whether file ⍵ do exist or not</code>
<code> [2] ⍝ ⍵ can be either a simple text vector (=a filename) or a vector of</code>
<code> [3] ⍝ text vectors each being a filename.</code>
<code class="emphasize">→[4]      (~0 1∊⍨≡⍵):∇¨⍵</code>
<code class="emphasize">→[5]      rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code class="emphasize">→[6]      rf.FileExists⊂⍵</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_158">#.Laguntza.Laguntza.File.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_159">#.Laguntza.Laguntza.GUI.GetItemStates &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetItemStates←{</code>
<code> [1] ⍝ ⍺ is ref to the ListView. ⍵ is single item number</code>
<code class="emphasize">→[2]      rf←⍺</code>
<code class="emphasize">→[3]      ⌽(32⍴2)⊤2 ⎕NQ rf'GetItemState'⍵   ⍝ Don't call the method: bug 10925</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_160">#.Laguntza.Laguntza.GUI.GetProperSize &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetProperSize←{</code>
<code class="emphasize">→[1]       (¯1≡⍵):⍺           ⍝ Argument of "Run" is defaulting? Take Windows Registry (defaults to (⍬ ⍬) anyway)</code>
<code class="emphasize">→[2]       (0=1↑0⍴∊⍵):⍵       ⍝ Argument is numeric? Take it!</code>
<code class="emphasize">→[3]       (~'%'∊∊⍵):⍎⍵       ⍝ No percent sign? Make it numeric</code>
<code class="emphasize">→[4]       v←{0 1∊⍨≡⍵:2⍴⍎⍵~'%' ⋄ ⍎¨⍵~¨'%'}⍵   ⍝ Handle %</code>
<code class="emphasize">→[5]       (y x)←GetScreenSize ⍬              ⍝ Get screen size</code>
<code class="emphasize">→[6]       ⌊x y×v÷100                         ⍝ Calc pixels</code>
<code> [7]  ⍝ Take the right "Size", either from "outside" (=arg of "Run") or</code>
<code> [8]  ⍝ from Windows registry or defaults. If argument it can be text with "%",</code>
<code> [9]  ⍝ for example:  "36%"</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_161">#.Laguntza.Laguntza.GUI.GetScreenSize &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetScreenSize←{</code>
<code class="emphasize">→[1]      r←GetSystemMetrics¨16 17   ⍝ width and height of screen(s)</code>
<code class="emphasize">→[2]      10×⌊r÷10                   ⍝ Sometimes screen size differs by some pixels</code>
<code> [3] ⍝ Get screen size</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_162">#.Laguntza.Laguntza.GUI.On9994 &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> On9994←{</code>
<code class="emphasize">→[1]      ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code class="emphasize">→[2]      ∆Ref.n.browser_sf.Active←1</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_163">#.Laguntza.Laguntza.GUI.On9999InIndexKeyword &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  On9999InIndexKeyword←{</code>
<code> [1]   ⍝ This is triggered by a timer in order to react with a small delay to user input.</code>
<code class="emphasize">→[2]       rf←0⊃⍵</code>
<code class="emphasize">→[3]       ∆Ref←⍺</code>
<code class="emphasize">→[4]       A←∆Ref.d.A</code>
<code class="emphasize">→[5]       ri←∆Ref.n.indexList                        ⍝ Ref to indexKeyword</code>
<code class="emphasize">→[6]       _←ri.⎕EX'IndexUpdateTimer'</code>
<code class="emphasize">→[7]       (0=≢tx←⎕C ∆Ref.n.indexKeyword.Text):0</code>
<code class="emphasize">→[8]       items←0⊃⎕FREAD ∆Ref.f.(tieNo ∆index)</code>
<code class="emphasize">→[9]       ri.SelItems←(no←≢ri.Items)⍴0</code>
<code class="emphasize">→[10]      bool←(⊃(≢tx)↑¨items)∧.=tx</code>
<code class="emphasize">→[11]      (0=noOf←+/bool):(∆Ref.n.browser.Size←0 0){1}##.ResetStatusbar ∆Ref</code>
<code class="emphasize">→[12]      in←(bool⍳1)⊃1⊃⎕FREAD ∆Ref.f.(tieNo ∆index)</code>
<code class="emphasize">→[13]      ri.SelItems[bool⍳1]←1</code>
<code class="emphasize">→[14]      _←∆Ref ##.SelectItemInTreeView in</code>
<code class="emphasize">→[15]      _←##.ResetStatusbar ∆Ref</code>
<code class="emphasize">→[16]      _←∆Ref ##.SetInfoText(⍕noOf),' index ',((1=noOf)⊃'entries' 'entry'),' match the keyword'</code>
<code class="emphasize">→[17]      ∆←⊂'Timer'</code>
<code class="emphasize">→[18]      ∆,←⊂'Interval' 250</code>
<code class="emphasize">→[19]      ∆,←⊂'Event' 'Timer'(FullPathToHandler'OnIndexTimer')ri</code>
<code class="emphasize">→[20]      1⊣'IndexUpdateTimer'ri.⎕WC ∆</code>
<code> [21]  }</code>
</div>
<code class="header" id="listing_164">#.Laguntza.Laguntza.GUI.OnDecreaseDefaultFontSizeForTV &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnDecreaseDefaultFontSizeForTV←{</code>
<code class="emphasize">→[1]      ∆Ref←##.Get∆Ref↑⍵</code>
<code class="emphasize">→[2]      _←∆Ref ##.ChangeTreeViewFontSize ¯1</code>
<code class="emphasize">→[3]      ⍬</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_165">#.Laguntza.Laguntza.GUI.OnDelayedUpdate &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnDelayedUpdate←{</code>
<code class="emphasize">→[1]       rf←⍎'DelayedUpdate'⍺.⎕WC'Timer'('Interval' 200)</code>
<code class="emphasize">→[2]       rf.onTimer←'OnTimer'</code>
<code class="emphasize">→[3]       ⍬</code>
<code> [4]  ⍝ Creates a timer which after its getting fired sends an "Update"</code>
<code> [5]  ⍝ event round. When the user scrolls through the tree with the</code>
<code> [6]  ⍝ cursor keys, this is supposed to be so fast that the timer</code>
<code> [7]  ⍝ is re-created before the event is actually triggered, preventing</code>
<code> [8]  ⍝ the update to take place before the user releases the key.</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_166">#.Laguntza.Laguntza.GUI.OnEditFromMainMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnEditFromMainMenu←{</code>
<code class="emphasize">→[1]      ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code class="emphasize">→[2]      ##.EditFromMainMenu ∆Ref</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_167">#.Laguntza.Laguntza.GUI.OnIncreaseDefaultFontSizeForTV &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnIncreaseDefaultFontSizeForTV←{</code>
<code class="emphasize">→[1]      ∆Ref←##.Get∆Ref↑⍵</code>
<code class="emphasize">→[2]      _←∆Ref ##.ChangeTreeViewFontSize 1</code>
<code class="emphasize">→[3]      ⍬</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_168">#.Laguntza.Laguntza.GUI.OnIndexTimer &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnIndexTimer←{</code>
<code class="emphasize">→[1]       _←{0::⍬ ⋄ {0::⍬ ⋄ ⍵.Close}⍎⍵}0⊃⍵</code>
<code class="emphasize">→[2]       ∆Ref←##.Get∆Ref ⍺</code>
<code class="emphasize">→[3]       (0=+/∆Ref.n.indexList.SelItems):0</code>
<code class="emphasize">→[4]       row←∆Ref.n.indexList.SelItems⍳1</code>
<code class="emphasize">→[5]       _←ShowListViewItem ∆Ref.n.indexList row</code>
<code class="emphasize">→[6]       in←∆Ref ##.Index.GetIndexNumber row</code>
<code class="emphasize">→[7]       _←##.Display ∆Ref in</code>
<code class="emphasize">→[8]       _←⎕DL 0.1</code>
<code class="emphasize">→[9]       ⍬</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_169">#.Laguntza.Laguntza.GUI.OnKeyPressInForm &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnKeyPressInForm←{</code>
<code class="emphasize">→[1]      80 2≢⍵[4 5]:1      ⍝ Ctrl+P ?!</code>
<code class="emphasize">→[2]      ∆Ref←##.Get∆Ref↑⍵</code>
<code class="emphasize">→[3]      0⊣##.PrintCurrentPage ∆Ref</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_170">#.Laguntza.Laguntza.GUI.OnKeyPressInIndexKeyword &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnKeyPressInIndexKeyword←{</code>
<code class="emphasize">→[1]      rf←0⊃⍵</code>
<code class="emphasize">→[2]      ∆Ref←##.Get∆Ref rf</code>
<code class="emphasize">→[3]      70 2≡⍵[4 5]:##.GoToSearchTab ∆Ref</code>
<code class="emphasize">→[4]      _←⎕NQ rf 9999</code>
<code class="emphasize">→[5]      (127 8 2≡⍵[3 4 5]):1⊣rf.Text←''        ⍝ Ctrl+Backspace?</code>
<code class="emphasize">→[6]      1</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_171">#.Laguntza.Laguntza.GUI.OnMouseWheelInTreeView &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnMouseWheelInTreeView←{</code>
<code class="emphasize">→[1]      2≠5⊃⍵:1                                        ⍝ No Ctrl key pressed: we are not interested.</code>
<code class="emphasize">→[2]      ∆Ref←##.Get∆Ref↑⍵</code>
<code class="emphasize">→[3]      direction←×6⊃⍵                                 ⍝ negative: bigger</code>
<code class="emphasize">→[4]      ∆Ref ##.ChangeTreeViewFontSize direction</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_172">#.Laguntza.Laguntza.GUI.OnRestoreDefaultFontSizeForTV &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnRestoreDefaultFontSizeForTV←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      ∆Ref.n.treeFont.Size←∆Ref.n.font.Size</code>
<code class="emphasize">→[3]      ⍬</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_173">#.Laguntza.Laguntza.GUI.OnSearchAsIs &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnSearchAsIs←{</code>
<code class="emphasize">→[1]      ∆Ref←##.Get∆Ref↑⍵</code>
<code class="emphasize">→[2]      1=∆Ref.n.matchWholeWord.Active←~∆Ref.n.searchAsIs.State:1</code>
<code class="emphasize">→[3]      ∆Ref.n.matchWholeWord.State←0</code>
<code class="emphasize">→[4]      1</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_174">#.Laguntza.Laguntza.GUI.OnStatusbarContextMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnStatusbarContextMenu←{</code>
<code class="emphasize">→[1]      ∆Ref←##.Get∆Ref↑⍵</code>
<code class="emphasize">→[2]      ∆Ref.p.userMode:⍬</code>
<code class="emphasize">→[3]      ##.CopyLinkToClipboard ∆Ref</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_175">#.Laguntza.Laguntza.GUI.OnTimer &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnTimer←{</code>
<code class="emphasize">→[1]      rf←0⊃⍵</code>
<code class="emphasize">→[2]      _←rf.Close</code>
<code class="emphasize">→[3]      6::</code>
<code class="emphasize">→[4]      _←⎕NQ rf.## 9999</code>
<code> [5] ⍝</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_176">#.Laguntza.Laguntza.GUI.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_177">#.Laguntza.Laguntza.GUI.ShowListViewItem &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowListViewItem←{</code>
<code> [1] ⍝ ref points to a ListView</code>
<code> [2] ⍝ in is item number to ensure is visible</code>
<code class="emphasize">→[3]      (ref in)←⍵</code>
<code class="emphasize">→[4]      _←'sendmsg'⎕NA'I4 USER32|SendMessage* P U4 P P'</code>
<code class="emphasize">→[5]      hndl←ref ⎕WG'Handle'</code>
<code class="emphasize">→[6]      LVM_ENSUREVISIBLE←4115</code>
<code class="emphasize">→[7]      ⍬⊣sendmsg hndl LVM_ENSUREVISIBLE in 1</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_178">#.Laguntza.Laguntza.GUI.∆List &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ∆List←{</code>
<code> [1]      ⍝ List all controls with their ⍵ and caption (if any)</code>
<code> [2]      ⍝ ⍵ is "type"</code>
<code> [3]      ⍝ If "type" is empty, all controls are listed.</code>
<code> [4]      ⍝ if "type" is not empty then only controls are listed of that "type".</code>
<code> [5]      ⍝ "type" can be either a simple string or a vector of strings.</code>
<code class="emphasize">→[6]       vars←⎕NL-2</code>
<code class="emphasize">→[7]       refs←⎕NL-9</code>
<code class="emphasize">→[8]       r←⊃{6 2::'-' '' ⋄ rf←⍎⍵ ⋄ (⊂⍵),(⊂rf.Type),(⊂{0::'' ⋄ ⍵.Caption}rf)}¨refs</code>
<code class="emphasize">→[9]       r{(0=≢⍵):⍺ ⋄ ⍺,[0](⍪⍵),((≢⍵),2)⍴'Vars' ''}←vars</code>
<code class="emphasize">→[10]      (0=≢⍵):r</code>
<code class="emphasize">→[11]      types←{0 1∊⍨≡⍵:,⊂,⍵ ⋄ ⍵}⍵</code>
<code class="emphasize">→[12]      bool←(r[;1]≢¨⊂'Vars')\({0::'' ⋄ ⍵.Type}∘⍎¨refs)∊types</code>
<code class="emphasize">→[13]      r←bool⌿r</code>
<code class="emphasize">→[14]      r</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_179">#.Laguntza.Laguntza.HTML.ComplexLink &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←ComplexLink(∆Ref tx st row)</code>
<code> [1]  ⍝ Processes complex links like:</code>
<code> [2]  ⍝ "→[*Name]"</code>
<code> [3]  ⍝ "→[*.Name]"</code>
<code> [4]  ⍝ "→[↑*.Name]"</code>
<code> [5]  ⍝ "→[Name]"</code>
<code> [6]  ⍝ "→[PathLevel3.Name]"</code>
<code> [7]  ⍝ "→[##.##.PathLevel3.Name]"</code>
<code> [8]  ⍝ "→[#.Full.Path.Name]"</code>
<code> [9]  ⍝ "→[Object.ThisMethod | alternative link text]"</code>
<code> [10] ⍝ tx: What's going to become the Help</code>
<code> [11] ⍝ st: For performance reasons tx might have been rotated. (-st)⌽ brings it back into shape.</code>
<code class="emphasize">→[12]  l←⌊/tx⍳']|'                                                ⍝ Length of "magic" word</code>
<code class="emphasize">→[13]  lt←{⍵↑⍨⍵⍳']'}tx                                            ⍝ Cut this link into lt</code>
<code class="emphasize">→[14]  :If '→[http://'⎕C{⍺≡⍺⍺(≢⍺)↑⍵}tx</code>
<code class="emphasize">→[15]  :OrIf '→[https://'⎕C{⍺≡⍺⍺(≢⍺)↑⍵}tx</code>
<code class="emphasize">→[16]      url←{⍵↑⍨⍵⍳'|'}2↓lt</code>
<code class="emphasize">→[17]      lt←##.A.DMB{'|'∊⍵:⍵↓⍨1+⍵⍳'|' ⋄ ⍵}2↓lt</code>
<code class="emphasize">→[18]      lk←'&lt;a class="externallink" href="',url,'"&gt;',lt,'&lt;/a&gt;' ⍝ wrap in HTML</code>
<code> [19]  :Else</code>
<code class="emphasize">→[20]      :If 0=≢in←(row ##.FindTopic ∆Ref({⍵↑⍨⌊/⍵⍳'|] '}2↓lt))[;0]</code>
<code class="emphasize">→[21]          lk←∆Ref ReportBrokenLink l↑tx</code>
<code class="emphasize">→[22]      :ElseIf 1&lt;≢in</code>
<code class="emphasize">→[23]          lk←∆Ref ReportAmbiguousLink l↑tx</code>
<code> [24]      :Else</code>
<code class="emphasize">→[25]          lt←PolishLinkText lt</code>
<code class="emphasize">→[26]          lt,←(0=≢lt)/##.I.Title⊃∆Ref.d.tree[↑in;]           ⍝ No link title? Fetch topic title!</code>
<code class="emphasize">→[27]          lk←'&lt;a class="link" href="#',(⍕in),'"&gt;',lt,'&lt;/a&gt;'  ⍝ wrap in HTML</code>
<code> [28]      :EndIf</code>
<code> [29]  :EndIf</code>
<code class="emphasize">→[30]  r←(-st)⌽lk,(1+tx⍳']')↓tx                                   ⍝ Insert link, rotate back</code>
</div>
<code class="header" id="listing_180">#.Laguntza.Laguntza.HTML.FindIn &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  FindIn←{</code>
<code> [1]  ⍝ Returns indices for everything in tx that is marked up by "markup"</code>
<code> [2]  ⍝ "markup" is typically "*" or "_"</code>
<code> [3]  ⍝ Example:</code>
<code> [4]  ⍝ '*' FindIn  'This is *bold*'</code>
<code> [5]  ⍝ '*' FindIn  'This is * not bold *'</code>
<code class="emphasize">→[6]       markup←⍺</code>
<code class="emphasize">→[7]       tx←⍵</code>
<code class="emphasize">→[8]       tx2←' ',(MaskAplCharsAndLinks tx),' '</code>
<code class="emphasize">→[9]       (((markup,markup)⍷tx2)/tx2)←' '</code>
<code class="emphasize">→[10]      tx2[,({⍵/⍳≢⍵}('\',markup)⍷tx2)∘.+⍳2]←' '</code>
<code class="emphasize">→[11]      tx2[1+{⍵/⍳≢⍵}(' ',markup,' ')⍷tx2]←' '</code>
<code class="emphasize">→[12]      ~markup∊tx2:⍬</code>
<code class="emphasize">→[13]      i←¯1+{⍵/⍳≢⍵}tx2=markup</code>
<code class="emphasize">→[14]      (2×⌊0.5×≢i)↑i                  ⍝ Make sure we have open/close pairs</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_181">#.Laguntza.Laguntza.HTML.GetBasePath &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetBasePath←{</code>
<code> [1]   ⍝ ⍵ is &lt;head&gt;</code>
<code> [2]   ⍝ Looks for a meta key with the name "basepath".</code>
<code> [3]   ⍝ NOTE: format must match EXACTLY!</code>
<code> [4]   ⍝ Returns just content or empty vector.</code>
<code> [5]   ⍝ Usually we need the path for finding images etc. after the</code>
<code> [6]   ⍝ help system was copied elsewhere.</code>
<code class="emphasize">→[7]       head←⍵</code>
<code class="emphasize">→[8]       searchFor←'&lt;meta name="basepath" content="'</code>
<code class="emphasize">→[9]       b←searchFor∘{⍺≡(≢⍺)↑⍵}¨head</code>
<code class="emphasize">→[10]      0=+/b:''</code>
<code class="emphasize">→[11]      {⍵↑⍨⍵⍳'"'}(≢searchFor)↓(b⍳1)⊃head</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_182">#.Laguntza.Laguntza.HTML.GetSep &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetSep←{</code>
<code class="emphasize">→[1]      ('⋄'∊⍵)⌷',⋄'</code>
<code> [2] ⍝ Determines proper separator: "⋄" when found, otherwise ","</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_183">#.Laguntza.Laguntza.HTML.MarkUpAsInvalidLink &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> MarkUpAsInvalidLink←{</code>
<code class="emphasize">→[1]      '&lt;span class="invalidlink"&gt;(INVALID LINK: ',⍵,')&lt;/span&gt;'</code>
<code> [2]  }</code>
</div>
<code class="header" id="listing_184">#.Laguntza.Laguntza.HTML.MaskAplChars &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> MaskAplChars←{</code>
<code> [1] ⍝ Masks everything between backticks.</code>
<code> [2] ⍝ 'This                 code →[Link]' ← MaskAplCharsAndLinks 'This `is Inline APL` code →[Link]'</code>
<code class="emphasize">→[3]      tx←⍵</code>
<code class="emphasize">→[4]      0=+/b←'`'=tx:tx                    ⍝</code>
<code class="emphasize">→[5]      tx[{⍵/⍳≢⍵}{⍵∨≠\⍵}b]←' '           ⍝ Mask the APL</code>
<code class="emphasize">→[6]      tx</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_185">#.Laguntza.Laguntza.HTML.MaskAplCharsAndLinks &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> MaskAplCharsAndLinks←{</code>
<code> [1] ⍝ 'This                 code        ' ← MaskAplCharsAndLinks 'This `is Inline APL` code →[Link]'</code>
<code class="emphasize">→[2]      tx←⍵</code>
<code class="emphasize">→[3]      tx←MaskAplChars tx</code>
<code class="emphasize">→[4]      tx←MaskLinks tx</code>
<code class="emphasize">→[5]      tx</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_186">#.Laguntza.Laguntza.HTML.PolishLinkText &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PolishLinkText←{</code>
<code class="emphasize">→[1]      '|'∊⍵:⍵↓⍨1+⍵⍳'|'   ⍝ Link text is defined: done.</code>
<code class="emphasize">→[2]      ##.A.Last ⍵        ⍝ The part on the right of the last dot becomes the link text.</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_187">#.Laguntza.Laguntza.HTML.ProcessLinks &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ProcessLinks←{</code>
<code class="emphasize">→[1]       X←⍺</code>
<code class="emphasize">→[2]       ∆Ref←X.∆Ref</code>
<code class="emphasize">→[3]       row←X.row</code>
<code class="emphasize">→[4]       tx←⍵</code>
<code class="emphasize">→[5]       b←'→['⍷tx                     ⍝ Where are the links (if any)</code>
<code class="emphasize">→[6]       (0=+/b):tx                    ⍝ No links? Ready!</code>
<code class="emphasize">→[7]       st←b⍳1                        ⍝ Starting point</code>
<code class="emphasize">→[8]       tx←st⌽tx,' '                  ⍝ Bring to front</code>
<code class="emphasize">→[9]       tx←ComplexLink ∆Ref tx st row ⍝ Process complex links</code>
<code class="emphasize">→[10]      tx</code>
<code> [11] ⍝ Process any links in tx. By default ⍵ is wrapped into a &lt;p&gt; of the "body" class.</code>
<code> [12] ⍝ You can change this. For example, for table cells:</code>
<code> [13] ⍝    ∆Ref '' ''∘ProcessLinks¨allTableCells</code>
<code> [14] ⍝ This makes sure that there is no additional markup within cells.</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_188">#.Laguntza.Laguntza.HTML.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_189">#.Laguntza.Laguntza.HTML.ReportAmbiguousLink &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReportAmbiguousLink←{</code>
<code> [1]  ⍝ ⍵ is the link</code>
<code class="emphasize">→[2]       ∆Ref←⍺</code>
<code class="emphasize">→[3]       link←⍵               ⍝ Link text and item numbers</code>
<code class="emphasize">→[4]       r←'&lt;span class="invalidlink"&gt;(AMBIGUOUS LINK: ',({⍵,('['∊⍵)/']'}⍕1↓link),')&lt;/span&gt;'</code>
<code class="emphasize">→[5]       ∆Ref.p.userMode:r</code>
<code class="emphasize">→[6]       _←∆Ref ReportAmbiguousLink_ link</code>
<code class="emphasize">→[7]       ⎕THIS.X.linkReport,←⊂'ambiguous'</code>
<code class="emphasize">→[8]       r</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_190">#.Laguntza.Laguntza.HTML.ReportAmbiguousLink_ &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ReportAmbiguousLink_←{</code>
<code> [1] ⍝ ⍵ is the link</code>
<code class="emphasize">→[2]      ∆Ref←⍺</code>
<code class="emphasize">→[3]      {0=⎕NC ⍵:0 ⋄ ~⍎⍵}'∆Ref.∆ReportToSession':⍬  ⍝ Check whether reporting is switched off (test cases etc)</code>
<code class="emphasize">→[4]      link←⍵               ⍝ Link text and item numbers</code>
<code class="emphasize">→[5]      ⎕←'*** Could not resolve this ambiguous link: ',link</code>
<code class="emphasize">→[6]      ⍬</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_191">#.Laguntza.Laguntza.HTML.Split &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Split←{</code>
<code class="emphasize">→[1]      ⍺←GetSep ⍵</code>
<code class="emphasize">→[2]      s←⍺</code>
<code class="emphasize">→[3]      ⎕ML←0</code>
<code class="emphasize">→[4]      1↓¨(s,⍵)⊂⍨s=s,⍵</code>
<code> [5] ⍝ Default: splits ⍵ at "⋄" when found, otherwise on ","</code>
<code> [6] ⍝ You can overwrite this via ⍺.</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_192">#.Laguntza.Laguntza.HTML.Tag &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Tag←{</code>
<code class="emphasize">→[1]      ⍺←'p'</code>
<code class="emphasize">→[2]      '&lt;',⍺,'&gt;',⍵,'&lt;/',⍺,'&gt;'</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_193">#.Laguntza.Laguntza.HelpHelp.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_194">#.Laguntza.Laguntza.I.Dvlp &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Dvlp</code>
<code class="emphasize">→[1]  r←3</code>
</div>
<code class="header" id="listing_195">#.Laguntza.Laguntza.I.∆List &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←∆List</code>
<code class="emphasize">→[1]  l←(⎕NL-3)~'∆'⎕NL-3</code>
<code class="emphasize">→[2]  r←l{(⍺,[0.5]⍵)[⍋⍵;]}⍎¨l</code>
</div>
<code class="header" id="listing_196">#.Laguntza.Laguntza.Icons.PolishIconFilename &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PolishIconFilename←{</code>
<code class="emphasize">→[1]      r←'file://'{(≢⍺)↓⍵}⍵</code>
<code class="emphasize">→[2]      r↓⍨'/'=↑r</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_197">#.Laguntza.Laguntza.Icons.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_198">#.Laguntza.Laguntza.Index.DropDoublesFromKeywordsAndTree &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> DropDoublesFromKeywordsAndTree←{</code>
<code class="emphasize">→[1]      (keywords tree)←⍵</code>
<code class="emphasize">→[2]      0=≢∊keywords:''tree</code>
<code class="emphasize">→[3]      keywords←##.A.DMB¨keywords     ⍝ Delete multiple blanks</code>
<code class="emphasize">→[4]      b←0&lt;≢¨keywords                 ⍝ Which ones are not empty?</code>
<code class="emphasize">→[5]      keywords←b/keywords            ⍝ Remove empty ones</code>
<code class="emphasize">→[6]      tree←b⌿tree                    ⍝ ... empty...</code>
<code class="emphasize">→[7]      keywords tree</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_199">#.Laguntza.Laguntza.Index.GetIndexNumber &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetIndexNumber←{</code>
<code class="emphasize">→[1]      ∆Ref←⍺</code>
<code class="emphasize">→[2]      row←⍵</code>
<code class="emphasize">→[3]      row⊃1⊃⎕FREAD ∆Ref.f.(tieNo ∆index)</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_200">#.Laguntza.Laguntza.Index.OnContextMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←OnContextMenu msg</code>
<code> [1]  ⍝ Offers a context menu on the "Search" hit list</code>
<code class="emphasize">→[2]   r←0</code>
<code class="emphasize">→[3]   ∆Ref←##.Get∆Ref rf←0⊃msg</code>
<code class="emphasize">→[4]   tab←⎕UCS 9</code>
<code class="emphasize">→[5]   in←(rf.SelItems⍳1)⊃1⊃⎕FREAD ∆Ref.f.(tieNo ∆index)</code>
<code class="emphasize">→[6]   →(¯1≡in)/0                             ⍝ Is a "container" - nothing to do</code>
<code class="emphasize">→[7]   hc←0&lt;in ##.NoOfChildren ∆Ref.d.tree[;##.I.Depth]  ⍝ Has it children?</code>
<code class="emphasize">→[8]   'cm'⎕WC'Menu'</code>
<code class="emphasize">→[9]   bm←∆Ref ##.IsBookmarkable in           ⍝ Gets 1 if item may be bookmarked</code>
<code class="emphasize">→[10]  tx←'Bookmark this item',tab,'Ctrl+D'</code>
<code class="emphasize">→[11]  'cm.bookmark'⎕WC'MenuItem'tx('Active'bm)</code>
<code class="emphasize">→[12]  cm.{⍵ ⎕WS'Event' 'Select' 1}¨'MenuItem'cm.⎕WN''</code>
<code class="emphasize">→[13]  um←∆Ref.p.userMode</code>
<code class="emphasize">→[14]  {}{⍵:⍬ ⋄ 'cm.s2'⎕WC'Separator'}um</code>
<code class="emphasize">→[15]  arg←'MenuItem' 'Edit "Help" function'('Event' 'Select' 1)</code>
<code class="emphasize">→[16]  {}arg{⍵:⍬ ⋄ 'cm.edit'⎕WC ⍺}um</code>
<code class="emphasize">→[17]  res←⎕DQ'cm'                            ⍝ Hand over to user</code>
<code class="emphasize">→[18]  {}{0::⍬ ⋄ ⍬⊣⍵.Close}cm</code>
<code class="emphasize">→[19]  :If 0≠≢res                             ⍝ Not cancelled?!</code>
<code class="emphasize">→[20]      sel←{⍵↓⍨1+⍵⍳'.'}0⊃res              ⍝ Which menu item got selected?</code>
<code class="emphasize">→[21]      :Select sel</code>
<code class="emphasize">→[22]      :Case 'edit'                       ⍝ Let user edit a help function</code>
<code class="emphasize">→[23]          {}∆Ref ##.EditFromIndex in</code>
<code class="emphasize">→[24]      :Case 'bookmark'</code>
<code class="emphasize">→[25]          {}∆Ref ##.Bookmark in</code>
<code> [26]      :Else</code>
<code class="emphasize">→[27]          .                              ⍝ Huuh?!</code>
<code> [28]      :EndSelect</code>
<code> [29]  :EndIf</code>
</div>
<code class="header" id="listing_201">#.Laguntza.Laguntza.Index.OnHitSelectedIndex &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnHitSelectedIndex←{</code>
<code class="emphasize">→[1]       ref←0⊃⍵                            ⍝ Create reference</code>
<code class="emphasize">→[2]       ∆Ref←##.Get∆Ref ref</code>
<code class="emphasize">→[3]       ∆Ref.n.indexKeyword.Text←''        ⍝ Reset the search field</code>
<code class="emphasize">→[4]       ln←ref.SelItems⍳1                  ⍝ Which line number?</code>
<code class="emphasize">→[5]       (ln=≢ref.SelItems):0               ⍝ Nothing selected?</code>
<code class="emphasize">→[6]       in←∆Ref GetIndexNumber ln          ⍝ Translate ln into item no</code>
<code class="emphasize">→[7]       _←∆Ref ##.SelectItemInTreeView in</code>
<code class="emphasize">→[8]       (¯1≢in):0 ##.Display ∆Ref in       ⍝ Not a branch: display it!</code>
<code class="emphasize">→[9]       ∆Ref.n.browser.Size←0 0            ⍝ Nothing to display</code>
<code class="emphasize">→[10]      ∆Ref.n.tree.SelItems←(≢∆Ref.n.tree.Items)⍴0</code>
<code> [11] ⍝ Display the appropriate help page</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_202">#.Laguntza.Laguntza.Index.OnKeyPressInIndex &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnKeyPressInIndex←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       ref←0⊃⍵</code>
<code class="emphasize">→[3]       f←∆Ref.p.userMode∨{16::1 ⋄ 13 2≢2↑4↓⍵}⍵   ⍝ Either user mode or not Ctrl+Enter</code>
<code class="emphasize">→[4]       f:{_←⎕NQ ⍵ 9998 ⋄ 1}ref        ⍝ Create timer for update</code>
<code class="emphasize">→[5]       rn←##.GetCurrentItem ∆Ref.n    ⍝ Which row?</code>
<code class="emphasize">→[6]       in←rn⌷1⊃##._Data.index         ⍝ Item number</code>
<code class="emphasize">→[7]       (¯1≡in):1                      ⍝ Is a container - get out</code>
<code class="emphasize">→[8]       _←##.EditFromIndex in          ⍝ Let this fns edit</code>
<code class="emphasize">→[9]       0                              ⍝ Suppress keystroke</code>
<code> [10] ⍝ Creates a timer which in turn cares about an update</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_203">#.Laguntza.Laguntza.Index.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_204">#.Laguntza.Laguntza.Index.QualifyParent &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> QualifyParent←{</code>
<code class="emphasize">→[1]      (tree containerName)←⍵</code>
<code class="emphasize">→[2]      locs←⍕¨tree[;##.I.Parent]          ⍝ Get the location of each</code>
<code class="emphasize">→[3]      locs←(1+≢⍕containerName)↓¨locs     ⍝ Remove container name</code>
<code class="emphasize">→[4]      locs←{'#',('.'/⍨0&lt;≢⍵),⍵}¨locs      ⍝ Add "#." (or "#" as "root"</code>
<code class="emphasize">→[5]      tree[;##.I.Parent]←locs</code>
<code class="emphasize">→[6]      tree</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_205">#.Laguntza.Laguntza.Lint_.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_206">#.Laguntza.Laguntza.Lint_.ReportAmbiguousLinks &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReportAmbiguousLinks←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       A←∆Ref.d.A</code>
<code class="emphasize">→[3]       ⍺←¯1</code>
<code class="emphasize">→[4]       buf←⍺ CheckAmbiguousLinks ∆Ref</code>
<code class="emphasize">→[5]       _←##.UnboldAll ∆Ref</code>
<code class="emphasize">→[6]       (0=≢buf):⍬⊣⎕←'No ambiguous links found'</code>
<code class="emphasize">→[7]       ⎕←(⎕PW-1)⍴'-'</code>
<code class="emphasize">→[8]       ⎕←buf</code>
<code class="emphasize">→[9]       0=∆Ref ##.YesOrNo'Would you like to emphasize all pages with ambiguous links?':⍬</code>
<code class="emphasize">→[10]      buf←1↓,buf</code>
<code class="emphasize">→[11]      rows←⍎¨buf{⍵↑⍨⍵⍳' '}¨A.DLB buf                     ⍝ Isolate row numbers</code>
<code class="emphasize">→[12]      _←∆Ref ##.BoldenTheseTopics rows</code>
<code class="emphasize">→[13]      ⍬</code>
<code> [14]  }</code>
</div>
<code class="header" id="listing_207">#.Laguntza.Laguntza.Lint_.ReportBrokenLinks &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReportBrokenLinks←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       A←∆Ref.d.A</code>
<code class="emphasize">→[3]       ⍺←¯1</code>
<code class="emphasize">→[4]       buf←⍺ CheckBrokenLinks ∆Ref</code>
<code class="emphasize">→[5]       _←##.UnboldAll ∆Ref</code>
<code class="emphasize">→[6]       (0=≢buf):⍬⊣⎕←'No broken links found'</code>
<code class="emphasize">→[7]       ⎕←(⎕PW-1)⍴'-'</code>
<code class="emphasize">→[8]       ⎕←buf</code>
<code class="emphasize">→[9]       0=∆Ref.p.helpCaption ##.YesOrNo'Would you like to emphasize all pages with broken links?':⍬</code>
<code class="emphasize">→[10]      buf←1↓,buf</code>
<code class="emphasize">→[11]      rows←⍎¨buf{⍵↑⍨⍵⍳' '}¨A.DLB buf                 ⍝ Isolate line numbers (tree)</code>
<code class="emphasize">→[12]      _←∆Ref ##.BoldenTheseTopics rows</code>
<code class="emphasize">→[13]      ⍬</code>
<code> [14]  }</code>
</div>
<code class="header" id="listing_208">#.Laguntza.Laguntza.Lint_.Run &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {report}←Run(∆Ref source)</code>
<code> [1] ⍝ The workhorse; called by Laguntza.Lint</code>
<code class="emphasize">→[2]  report←0 1⍴''</code>
<code class="emphasize">→[3]  report⍪←∆Ref CheckAllLinks source</code>
<code> [4] ⍝Done</code>
</div>
<code class="header" id="listing_209">#.Laguntza.Laguntza.Reports.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_210">#.Laguntza.Laguntza.Reports.Run &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Run←{</code>
<code class="emphasize">→[1]      ⍺←¯1</code>
<code class="emphasize">→[2]      (∆Ref reportName)←⍵</code>
<code class="emphasize">→[3]      'MissinTopicProps'≡reportName:⍬⊣##.Lint_.ReportMissing∆TopicProperties ∆Ref</code>
<code class="emphasize">→[4]      'AllLinkIDs'≡reportName:⍬⊣##.Lint_.ReportAllLinkIDs ∆Ref</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_211">#.Laguntza.Laguntza.Search.CreateContextMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateContextMenu←{</code>
<code class="emphasize">→[1]       tab←⎕UCS 9</code>
<code class="emphasize">→[2]       ∆Ref←⍵</code>
<code> [3]  </code>
<code class="emphasize">→[4]       in←{⍵.lines⌷⍨⍵.SelItems⍳1}∆Ref.n.reportList    ⍝ Item number</code>
<code class="emphasize">→[5]       hc←0&lt;in ##.NoOfChildren ∆Ref.d.tree[;##.I.Depth]  ⍝ Has it children?</code>
<code> [6]  </code>
<code class="emphasize">→[7]       n←⎕NS''</code>
<code class="emphasize">→[8]       n.menu←⎕NEW⊂'Menu'</code>
<code class="emphasize">→[9]       bm←∆Ref ##.IsBookmarkable in                   ⍝ Gets 1 if item may be bookmarked</code>
<code class="emphasize">→[10]      tx←'Bookmark this item',tab,'Ctrl+D'</code>
<code class="emphasize">→[11]      n.bookmark←n.menu.⎕NEW'MenuItem'(('Caption'tx)('Active'bm))</code>
<code> [12] </code>
<code class="emphasize">→[13]      ('MenuItem'⎕WN n.menu).onSelect←1</code>
<code class="emphasize">→[14]      ∆Ref.p.userMode:n in</code>
<code> [15] </code>
<code class="emphasize">→[16]      n.sep2←n.menu.⎕NEW⊂'Separator'</code>
<code> [17] </code>
<code class="emphasize">→[18]      tx←'Edit help page',tab,'Ctrl+Enter'</code>
<code class="emphasize">→[19]      n.edit←n.menu.⎕NEW'MenuItem'(⊂'Caption'tx)</code>
<code> [20] </code>
<code class="emphasize">→[21]      tx←'Manage ∆TopicProperties'</code>
<code class="emphasize">→[22]      n.manageTopicProp←n.menu.⎕NEW'MenuItem'(,⊂('Caption'tx))</code>
<code> [23] </code>
<code class="emphasize">→[24]      flag←∆Ref.d.tree[in;##.I.IsNode]</code>
<code class="emphasize">→[25]      title←##.I.Title⊃∆Ref.d.tree[in;]</code>
<code> [26] </code>
<code class="emphasize">→[27]      tx←'Copy full path of "',title,'"'</code>
<code class="emphasize">→[28]      n.copyFullPath←n.menu.⎕NEW'MenuItem'(⊂('Caption'tx))</code>
<code> [29] </code>
<code class="emphasize">→[30]      ('MenuItem'⎕WN n.menu).onSelect←1</code>
<code class="emphasize">→[31]      n in</code>
<code> [32]  }</code>
</div>
<code class="header" id="listing_212">#.Laguntza.Laguntza.Search.DisplayCurrentSearchLine &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  DisplayCurrentSearchLine←{</code>
<code class="emphasize">→[1]       ∆Ref←⍵</code>
<code class="emphasize">→[2]       ref←∆Ref.n.reportList              ⍝ Create reference</code>
<code class="emphasize">→[3]       lineNo←ref.SelItems⍳1              ⍝ Which line?</code>
<code class="emphasize">→[4]       ((≢ref.SelItems)=lineNo):0         ⍝ Nothing selected?</code>
<code class="emphasize">→[5]       0=ref.⎕NC'lines':⍬                 ⍝ That's true in case no (successful) search was performed yet.</code>
<code class="emphasize">→[6]       itemNo←lineNo⌷ref.lines            ⍝ Translate line no into item no (saved in "Data")</code>
<code class="emphasize">→[7]       in←##.Display ∆Ref itemNo          ⍝ Display it</code>
<code class="emphasize">→[8]       _←∆Ref ##.SelectItemInTreeView in</code>
<code class="emphasize">→[9]       in</code>
<code> [10] ⍝ 1. Displays the help page of the currently selected item in the "Search" list.</code>
<code> [11] ⍝ 2. Make sure that the search term is highlighted,</code>
<code> [12] ⍝ 3. Select the item in the trees of both, "Search" and "Content" for the sake of sync.</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_213">#.Laguntza.Laguntza.Search.Find &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Find←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       A←∆Ref.d.A</code>
<code class="emphasize">→[3]       (n ss mhw)←⍵                ⍝ n:names to be searched in; ss=search string; mhw:match whole words only</code>
<code class="emphasize">→[4]       ~mhw:∨/ss⍷n                 ⍝ Fuzzy search: find somewhere</code>
<code class="emphasize">→[5]       ss2←(⊂'')~⍨' 'A.Split ss    ⍝ Break into words</code>
<code class="emphasize">→[6]       ∧/¨ss2∘∊¨n                  ⍝ Special handling if n is a vector</code>
<code> [7]  ⍝ Tries to actually find something</code>
<code> [8]  ⍝ fs (fuzzy search) = 1 : Use ⍷</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_214">#.Laguntza.Laguntza.Search.On9999 &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  On9999←{</code>
<code class="emphasize">→[1]       ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code class="emphasize">→[2]       n←∆Ref.n</code>
<code class="emphasize">→[3]       ef←0&lt;≢n.searchString.Text  ⍝ ef = empty flag. True when nothing to search for</code>
<code class="emphasize">→[4]       n.searchBtn.Active←ef      ⍝ Make "Go" (search) btn active if appropriate</code>
<code class="emphasize">→[5]       ##.ResetStatusbar ∆Ref     ⍝</code>
<code> [6]  ⍝ Checks the length of the string entered in the "Combo".</code>
<code> [7]  ⍝ If it's empty, make the "Search" button inactive</code>
<code> [8]  ⍝ If not, make button active</code>
<code> [9]  ⍝ Reset status bar in any case</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_215">#.Laguntza.Laguntza.Search.OnColClick &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnColClick←{</code>
<code class="emphasize">→[1]       ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code class="emphasize">→[2]       ref←∆Ref.n.reportList              ⍝ Create reference</code>
<code class="emphasize">→[3]       col←2⊃⍵                            ⍝ The col we are dealing with</code>
<code class="emphasize">→[4]       d←⊃,/ref.(Items ReportInfo)        ⍝ all data</code>
<code class="emphasize">→[5]       0=≢d:⍬</code>
<code class="emphasize">→[6]       s←⊃d[;col] ⍝ The col to be sorted</code>
<code class="emphasize">→[7]       si←##.Alpha{si←⍺⍋⍵ ⋄ ⍵≢⍵[si;]:si ⋄ ⍺⍒⍵}s ⍝ Build sort index</code>
<code class="emphasize">→[8]       ref.Items←ref.Items[si]            ⍝ Sort items</code>
<code class="emphasize">→[9]       ref.ReportInfo←ref.ReportInfo[si;] ⍝ Sort other data</code>
<code class="emphasize">→[10]      ref.lines←ref.lines[si]            ⍝ Sort the history</code>
<code class="emphasize">→[11]      ref.SelItems[]←0                   ⍝ Deselect everything</code>
<code class="emphasize">→[12]      ref.SelItems[0]←1                  ⍝ Select first line</code>
<code class="emphasize">→[13]      _←⎕NQ ref'GotFocus'                ⍝ Force focus to the list</code>
<code class="emphasize">→[14]      _←⎕NQ ref'ItemDown' 0 1 0          ⍝ Jump on the very first item</code>
<code class="emphasize">→[15]      ⎕NQ ref'KeyPress' 'DC'             ⍝ "Press" Cursor down</code>
<code> [16] ⍝ Sort the rows according to the column the user did click at</code>
<code> [17] ⍝ Second click: sort the other way round</code>
<code> [18] ⍝ Handle focus and current line as well</code>
<code> [19]  }</code>
</div>
<code class="header" id="listing_216">#.Laguntza.Laguntza.Search.OnContextMenu &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnContextMenu←{</code>
<code class="emphasize">→[1]       ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code class="emphasize">→[2]       (n in)←CreateContextMenu ∆Ref</code>
<code class="emphasize">→[3]       res←⎕DQ n.menu                         ⍝ Hand over to user</code>
<code class="emphasize">→[4]       (0=≢res):0                             ⍝ cancelled?!</code>
<code class="emphasize">→[5]       sel←0⊃res                              ⍝ Which menu item got selected?</code>
<code class="emphasize">→[6]       (n.bookmark≡sel):∆Ref ##.Bookmark in   ⍝ Bookmark current item</code>
<code> [7]  </code>
<code class="emphasize">→[8]       (n.edit≡sel):∆Ref ##.EditFromSearch in ⍝ Let user edit a help function</code>
<code class="emphasize">→[9]       (n.manageTopicProp≡sel):##.HandleTopicProperties ∆Ref in</code>
<code class="emphasize">→[10]      (n.copyFullPath≡sel):∆Ref ##.CopyFullPath2Clipboard in</code>
<code class="emphasize">→[11]      . ⍝ Huuh?!</code>
<code> [12] ⍝ Offers a context menu on the "Search" hit list</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_217">#.Laguntza.Laguntza.Search.OnContextMenuCombo &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnContextMenuCombo←{</code>
<code class="emphasize">→[1]       _←'mm'⎕WC'Menu'</code>
<code class="emphasize">→[2]       tx←'Display help page',(⎕UCS 9),'Doubleclick'</code>
<code class="emphasize">→[3]       _←'mm.display'⎕WC'MenuItem'tx</code>
<code class="emphasize">→[4]       _←mm.{⍵ ⎕WS'Event' 'Select' 1}¨'MenuItem'mm.⎕WN''</code>
<code class="emphasize">→[5]       (0=≢res←⎕DQ'mm'):⍬</code>
<code class="emphasize">→[6]       cmd←0⊃res</code>
<code class="emphasize">→[7]       (cmd≡'mm.display'):DisplayCurrentSearchLine ⍬</code>
<code class="emphasize">→[8]       ⍬</code>
<code> [9]  ⍝ Offer a context menu on current item in find results</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_218">#.Laguntza.Laguntza.Search.OnHitSelected &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnHitSelected←{</code>
<code class="emphasize">→[1]      f←(,¯1)≡1↑2↓⍵      ⍝ f ←→ 1: don't reset the status bar</code>
<code class="emphasize">→[2]      ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code class="emphasize">→[3]      _←DisplayCurrentSearchLine ∆Ref</code>
<code class="emphasize">→[4]      f:⍬</code>
<code class="emphasize">→[5]      ⍬⊣##.ResetStatusbar ∆Ref</code>
<code> [6] ⍝ Calc the selected item in the list (if any) and display it</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_219">#.Laguntza.Laguntza.Search.OnKeyPress &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnKeyPress←{</code>
<code class="emphasize">→[1]       ref←⍎0⊃⍵                       ⍝ Reference to the list</code>
<code class="emphasize">→[2]       ∆Ref←⍺</code>
<code class="emphasize">→[3]       0=≢ref.SelItems:0              ⍝ Yes, this HAS hapanned</code>
<code class="emphasize">→[4]       0=+/ref.SelItems:0             ⍝ Yes, this HAS hapanned</code>
<code class="emphasize">→[5]       flag←2↑3↓⍵≡68 2                ⍝ Was Ctrl+D pressed?</code>
<code class="emphasize">→[6]       in←{⍵.lines⌷⍨⍵.SelItems⍳1}ref  ⍝ Item number</code>
<code class="emphasize">→[7]       bm←∆Ref ##.IsBookmarkable in   ⍝ Is current "bookmarkable"?</code>
<code class="emphasize">→[8]       _←##.Bookmark(flag∧bm)/in      ⍝ Then bookmark this item</code>
<code class="emphasize">→[9]       f←∆Ref.p.userMode∨13 2≢2↑4↓⍵   ⍝ Either user mode or not Ctrl+Enter</code>
<code class="emphasize">→[10]      f:{_←⎕NQ ⍵ 9998 ⋄ 1}0⊃⍵        ⍝ Create timer for update</code>
<code class="emphasize">→[11]      in←{⍵.lines⌷⍨⍵.SelItems⍳1}ref  ⍝ Item number</code>
<code class="emphasize">→[12]      _←##.EditFromSearch in         ⍝ Let this fns edit</code>
<code class="emphasize">→[13]      _←⎕NQ ref'GotFocus'            ⍝ Force focus back to the list (because of ⎕ED)</code>
<code class="emphasize">→[14]      0                              ⍝ Suppress keystroke</code>
<code> [15] ⍝ Processes Ctrl+D, Ctrl+Enter and others</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_220">#.Laguntza.Laguntza.Search.Public &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Public</code>
<code class="emphasize">→[1]  r←''</code>
</div>
<code class="header" id="listing_221">#.Laguntza.Laguntza.Search.ShowNotFound &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowNotFound←{</code>
<code class="emphasize">→[1]      ∆Ref←⍵</code>
<code class="emphasize">→[2]      rf←∆Ref.n.searchString                     ⍝ Reference</code>
<code class="emphasize">→[3]      _←∆Ref ##.SetInfoText'Not found: "',rf.Text,'"'     ⍝ Display message in status bar</code>
<code class="emphasize">→[4]      _←∆Ref ##.SetInfoBCol ∆Ref.p.statusbarAlarmColor    ⍝ Make statusbar more prominent</code>
<code class="emphasize">→[5]      _←⎕NQ ∆Ref.n.searchString'GotFocus'        ⍝ Force focus back in case the buttoin was clicked</code>
<code class="emphasize">→[6]      ⍬</code>
<code> [7] ⍝ Display appropriate message in statusbar</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_222">#.Laguntza.Laguntza.Search.TellInvalidCharInSearchCombo &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  TellInvalidCharInSearchCombo←{</code>
<code> [1]  ⍝ ⍵ is the character the user has entered into the "Search" combo box.</code>
<code> [2]  ⍝ At this stage we already know that the input is invalid for a "word"</code>
<code> [3]  ⍝ search, so we just tell the user.</code>
<code class="emphasize">→[4]       ∆Ref←⍺</code>
<code class="emphasize">→[5]       ∆Ref.∆parms.testMode:⍬</code>
<code class="emphasize">→[6]       msg←⊂'You have entered a "',⍵,'"'</code>
<code class="emphasize">→[7]       msg,←'' 'This is an invalid character since you''ve opted for a word-only search.'</code>
<code class="emphasize">→[8]       msg,←'' 'Enter a single word or separate multiple words with a blank OR'</code>
<code class="emphasize">→[9]       msg,←⊂'tick "Search as entered".'</code>
<code class="emphasize">→[10]      caption←∆Ref.p.helpCaption,' : invalid input'</code>
<code class="emphasize">→[11]      _←caption ##.Show msg</code>
<code class="emphasize">→[12]      ⍬</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_223">#.Laguntza.Laguntza.Search.TitleSearch &mdash; 0%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  TitleSearch←{</code>
<code class="emphasize">→[1]       ∆Ref←⍺</code>
<code class="emphasize">→[2]       A←∆Ref.d.A</code>
<code class="emphasize">→[3]       (ss lf mhw sai)←⍵                      ⍝ Search string, ignore case, match whole words only, search as is</code>
<code class="emphasize">→[4]       lc←lf∘{⍺:⎕C ⍵ ⋄ ⍵}                     ⍝ Make fns that translates to lowercase according to "lowercase flag"</code>
<code class="emphasize">→[5]       n←lc⊃∆Ref.d.tree[;##.I.Title]          ⍝ All names to search in</code>
<code class="emphasize">→[6]       (((⎕UCS 160)=,n)/,n)←' '               ⍝ Replace unbreakable blanks by normal ones</code>
<code class="emphasize">→[7]       n{~⍵:⍺ ⋄ {(⊂'')~⍨' 'A.Split A.DMB ⍵}¨↓⍺}←mhw ⍝ Convert titles into vector of words if mhw</code>
<code class="emphasize">→[8]       bool←∆Ref Find(n(lc ss)mhw)            ⍝ Search with "Lowercase"</code>
<code class="emphasize">→[9]       ls←∪⍸bool                              ⍝ Calc lines</code>
<code class="emphasize">→[10]      (0=≢ls):⍬ ⍬                            ⍝ Nothing found?</code>
<code class="emphasize">→[11]      pqn←∆Ref GetFullyQualifiedNamesForDisplay ls</code>
<code class="emphasize">→[12]      ls pqn                                 ⍝ Build result</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_224">#.Laguntza.Laguntza.AskForNodeType &mdash; 4%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  type←testFlag AskForNodeType ∆Ref</code>
<code> [1]   :If testFlag</code>
<code> [2]       type←⊂'sibling'</code>
<code> [3]   :Else</code>
<code class="emphasize">→[4]       type←⊂''</code>
<code class="emphasize">→[5]       n←⎕NS''</code>
<code class="emphasize">→[6]       ∆←''</code>
<code class="emphasize">→[7]       ∆,←⊂'Caption' 'Node type'</code>
<code class="emphasize">→[8]       ∆,←⊂'Posn'(45+∆Ref.n.form.Posn)</code>
<code class="emphasize">→[9]       ∆,←⊂'Icon'∆Ref.n.form.IconObj</code>
<code class="emphasize">→[10]      ∆,←⊂'Coord' 'Pixel'</code>
<code class="emphasize">→[11]      ∆,←⊂'Size'(250 300)</code>
<code class="emphasize">→[12]      ∆,←⊂'MaxButton' 0</code>
<code class="emphasize">→[13]      ∆,←⊂'MinButton' 0</code>
<code class="emphasize">→[14]      ∆,←⊂'Sizeable' 0</code>
<code class="emphasize">→[15]      n.∆form←⎕NEW'Form'∆</code>
<code class="emphasize">→[16]      n.∆form.n←n</code>
<code> [17] </code>
<code class="emphasize">→[18]      ∆←''</code>
<code class="emphasize">→[19]      ∆,←⊂'Posn'(15 15)</code>
<code class="emphasize">→[20]      ∆,←⊂'Caption' 'What shall the new node be?'</code>
<code class="emphasize">→[21]      n.question←n.∆form.⎕NEW'Label'∆</code>
<code> [22] </code>
<code class="emphasize">→[23]      ∆←''</code>
<code class="emphasize">→[24]      ∆,←⊂'Posn'((15+↑+⌿⊃n.question.(Posn Size)),15)</code>
<code class="emphasize">→[25]      ∆,←⊂'Caption' ' Options '</code>
<code class="emphasize">→[26]      ∆,←⊂'Size'(100 140)</code>
<code class="emphasize">→[27]      n.Group←n.∆form.⎕NEW'Group'∆</code>
<code> [28] </code>
<code class="emphasize">→[29]      ∆←''</code>
<code class="emphasize">→[30]      ∆,←⊂'Caption' '&amp;Sibling'</code>
<code class="emphasize">→[31]      ∆,←⊂'Posn'(25 15)</code>
<code class="emphasize">→[32]      ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[33]      ∆,←⊂'State' 1</code>
<code class="emphasize">→[34]      n.Sibling←n.Group.⎕NEW'Button'∆</code>
<code> [35] </code>
<code class="emphasize">→[36]      ∆←''</code>
<code class="emphasize">→[37]      ∆,←⊂'Caption' '&amp;Child'</code>
<code class="emphasize">→[38]      ∆,←⊂'Posn'((10+↑+⌿⊃n.Sibling.(Posn Size))15)</code>
<code class="emphasize">→[39]      ∆,←⊂'Style' 'Radio'</code>
<code class="emphasize">→[40]      ∆,←⊂'State' 0</code>
<code class="emphasize">→[41]      n.Child←n.Group.⎕NEW'Button'∆</code>
<code class="emphasize">→[42]      n.∆Types←n.(Sibling Child)</code>
<code> [43] </code>
<code class="emphasize">→[44]      ∆←''</code>
<code class="emphasize">→[45]      ∆,←⊂'Caption' 'OK'</code>
<code class="emphasize">→[46]      ∆,←⊂'Size'(⍬ 110)</code>
<code class="emphasize">→[47]      ∆,←⊂'Default' 1</code>
<code class="emphasize">→[48]      ∆,←⊂'Event'('Select' 1)</code>
<code class="emphasize">→[49]      n.OK←n.∆form.⎕NEW'Button'∆</code>
<code class="emphasize">→[50]      n.OK.Posn←(n.∆form.Size[0]-n.OK.Size[0]+15),15</code>
<code> [51] </code>
<code class="emphasize">→[52]      ∆←''</code>
<code class="emphasize">→[53]      ∆,←⊂'Caption' 'Cancel'</code>
<code class="emphasize">→[54]      ∆,←⊂'Size'(⍬ 110)</code>
<code class="emphasize">→[55]      ∆,←⊂'Cancel' 1</code>
<code class="emphasize">→[56]      ∆,←⊂'Event'('Select' 1)</code>
<code class="emphasize">→[57]      n.Cancel←n.∆form.⎕NEW'Button'∆</code>
<code class="emphasize">→[58]      n.Cancel.Posn←(n.OK.Posn[0]),n.OK.Size[1]+2×15</code>
<code class="emphasize">→[59]      n.∆Buttons←n.(OK Cancel)</code>
<code class="emphasize">→[60]      n.∆Buttons.onSelect←1</code>
<code> [61] </code>
<code class="emphasize">→[62]      ⎕NQ n.Sibling'GotFocus' ⋄ res←n.∆form.Wait</code>
<code class="emphasize">→[63]      n.∆form.⎕EX'n'</code>
<code class="emphasize">→[64]      :If n.OK≡↑res</code>
<code class="emphasize">→[65]          type←n.∆Types.State/'sibling' 'child'</code>
<code> [66]      :EndIf</code>
<code> [67]  :EndIf</code>
</div>
<code class="header" id="listing_225">#.Laguntza.Laguntza.EditTopicProperties &mdash; 12%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{testFlag}EditTopicProperties(∆Ref row rf)</code>
<code> [1]   ⍝ `testFlag` is 1 only when it's running under a test case.</code>
<code> [2]   r←0</code>
<code> [3]   testFlag←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'testFlag'</code>
<code> [4]   :If ~testFlag</code>
<code class="emphasize">→[5]       oldResult←rf.⍎'∆TopicProperties ⍬'</code>
<code class="emphasize">→[6]       success←0</code>
<code class="emphasize">→[7]       :Repeat</code>
<code class="emphasize">→[8]           :If 0=1↑0↑rc←EditByQED(⍕rf),'.∆TopicProperties'</code>
<code class="emphasize">→[9]               . ⍝ Something went wrong - please investigate</code>
<code> [10]          :EndIf</code>
<code class="emphasize">→[11]          :Trap 0</code>
<code class="emphasize">→[12]              newResult←rf.⍎'∆TopicProperties ⍬'</code>
<code> [13]          :Else</code>
<code class="emphasize">→[14]              msg←'∆TopicProperties did not execute - please correct it'</code>
<code class="emphasize">→[15]              'Topic properties'ShowError msg</code>
<code class="emphasize">→[16]              :Continue</code>
<code> [17]          :EndTrap</code>
<code class="emphasize">→[18]          :If oldResult≡newResult</code>
<code class="emphasize">→[19]              :Return</code>
<code> [20]          :EndIf</code>
<code class="emphasize">→[21]          bool←0&lt;rf.⎕NC newResult[;0]</code>
<code class="emphasize">→[22]          :If 0=success←∧/bool</code>
<code class="emphasize">→[23]              msg←'Note that '</code>
<code class="emphasize">→[24]              :If 1=+/~bool</code>
<code class="emphasize">→[25]                  msg,←'this object does not exist when it must:'</code>
<code> [26]              :Else</code>
<code class="emphasize">→[27]                  msg,←'these objects do not exist when they must:'</code>
<code> [28]              :EndIf</code>
<code class="emphasize">→[29]              msg←(⊂msg),{2≠≡⍵:⊂⍵ ⋄ ⍵}↑{⍺,',',⍵}/(~bool)/newResult[;0]</code>
<code class="emphasize">→[30]              'Topic properties'ShowError msg</code>
<code> [31]          :EndIf</code>
<code class="emphasize">→[32]      :Until success</code>
<code class="emphasize">→[33]      {}Compile ∆Ref</code>
<code class="emphasize">→[34]      r←1</code>
<code> [35]  :EndIf</code>
</div>
<code class="header" id="listing_226">#.Laguntza.Laguntza.GetNameForNewNode &mdash; 19%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←testFlag GetNameForNewNode parent</code>
<code> [1]   flag←0</code>
<code> [2]   :If testFlag</code>
<code> [3]       :If 0=≢list←'N'parent.⎕NL 9</code>
<code> [4]           r←'Node_01'</code>
<code> [5]       :Else</code>
<code class="emphasize">→[6]           r←'Node_',¯2↑'0',⍕1+↑↑{(//)⎕VFI ⍵↓⍨1+⍵⍳'_'},¯1↑'Test_'{⍵⌿⍨((≢⍺)↑[1]⍵)∧.=⍺}list</code>
<code> [7]       :EndIf</code>
<code> [8]   :Else</code>
<code class="emphasize">→[9]       default←''</code>
<code class="emphasize">→[10]      :Repeat</code>
<code class="emphasize">→[11]          caption←'Insert node &gt; ',⍕parent</code>
<code class="emphasize">→[12]          (key r)←caption AskString.Run ∆Ref'Specify a node name (must be a valid APL name; blanks become "_"):'default</code>
<code class="emphasize">→[13]          :If 'Cancel'≡key</code>
<code class="emphasize">→[14]              r←''</code>
<code class="emphasize">→[15]              :Return</code>
<code> [16]          :EndIf</code>
<code class="emphasize">→[17]          :Select ↑parent.⎕NC r</code>
<code class="emphasize">→[18]          :Case ¯1</code>
<code class="emphasize">→[19]              Show'Sorry:'('   &lt;',r,'&gt;')'is not a valid APL name.' '' 'Please try again.'</code>
<code class="emphasize">→[20]              default←r</code>
<code class="emphasize">→[21]          :Case 0</code>
<code class="emphasize">→[22]              flag←1</code>
<code> [23]          :Else</code>
<code class="emphasize">→[24]              Show'Sorry:'('   &lt;',r,'&gt;')'is already taken.' '' 'Please try again.'</code>
<code class="emphasize">→[25]              default←r</code>
<code> [26]          :EndSelect</code>
<code class="emphasize">→[27]      :Until flag</code>
<code> [28]  :EndIf</code>
</div>
<code class="header" id="listing_227">#.Laguntza.Laguntza.OnMenuCmd &mdash; 23%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnMenuCmd←{</code>
<code> [1]       ∆Ref←Get∆Ref 0⊃⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]       _←ResetStatusbar ∆Ref</code>
<code> [4]       name←{⍵↑⍨-'.'⍳⍨⌽⍵}⍕0⊃⍵         ⍝ Select the pure name</code>
<code> [5]     ⍝ Handle all the different menu commands:</code>
<code> [6]       ('showHtmlFile'≡name):DisplayCurrentTopicInBrowser ∆Ref</code>
<code> [7]       ('showHtml'≡name):ShowHtmlOfCurrentTopic ∆Ref</code>
<code> [8]       ('quit'≡name):CloseGui ∆Ref</code>
<code class="emphasize">→[9]       ('about'≡name):About ∆Ref</code>
<code class="emphasize">→[10]      ('add'≡name):∆Ref Bookmark GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[11]      ('del'≡name):∆Ref DelBookmark GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[12]      ('delAll'≡name):DelAllBookmarks ∆Ref</code>
<code class="emphasize">→[13]      ('collapse'≡name):∆Ref CollapseAll 1</code>
<code class="emphasize">→[14]      ('expand'≡name):∆Ref ExpandAll 1</code>
<code class="emphasize">→[15]      ('devHelp'≡name):ShowDevelopersHelp ⍬</code>
<code class="emphasize">→[16]      ('crash'≡name):f.mb.dev.crash.Checked←~f.mb.dev.crash.Checked</code>
<code class="emphasize">→[17]      ('proofRead'≡name):GUI.OnBuildDocFromAllPages ∆Ref</code>
<code class="emphasize">→[18]      ('compile'≡name):Compile ∆Ref</code>
<code class="emphasize">→[19]      ('reportBrokenLinks'≡name):⍬⊣Lint_.ReportBrokenLinks ∆Ref</code>
<code class="emphasize">→[20]      ('reportAmbiguousLinks'≡name):⍬⊣Lint_.ReportAmbiguousLinks ∆Ref</code>
<code class="emphasize">→[21]      ('reportTopicProperties'≡name):⍬⊣Lint_.ReportTopicProperties ∆Ref</code>
<code class="emphasize">→[22]      ('unbold'≡name):UnboldAll ∆Ref</code>
<code class="emphasize">→[23]      ('browseTree'≡name):BrowseTree ∆Ref</code>
<code class="emphasize">→[24]      ('nextBold'≡name):GoToNextBoldTopic ∆Ref</code>
<code class="emphasize">→[25]      ('helpHelp'≡name):HelpOnHelp&amp;∆Ref</code>
<code class="emphasize">→[26]      ('gotoRow'≡name):GoToRow ∆Ref</code>
<code class="emphasize">→[27]      ('reportMissingIndexes'≡name):ReportMissingIndexEntries ∆Ref</code>
<code class="emphasize">→[28]      ('handleTopicProperties'≡name):HandleTopicProperties ∆Ref</code>
<code class="emphasize">→[29]      ('export'≡name):Export2HTML ∆Ref</code>
<code class="emphasize">→[30]      (('i'=1⍴name)∧∧/(1↓name)∊⎕D):∆Ref GetBookmark name</code>
<code> [31]    ⍝ What passed through is probably something very new?!</code>
<code class="emphasize">→[32]      . ⍝ Huuh?!</code>
<code> [33] ⍝ General callback for all "Select" events on any menu items in the main form</code>
<code> [34]  }</code>
</div>
<code class="header" id="listing_228">#.Laguntza.Laguntza.PageNotFound &mdash; 33%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PageNotFound←{</code>
<code> [1]      (0=≢⍵):'&lt;h1&gt;Page not found&lt;/h1&gt;' '&lt;p&gt;Sorry, the requested page could not be found.&lt;/p&gt;'</code>
<code class="emphasize">→[2]      t←'&lt;p&gt;Sorry, the requested page:',(⊂(↑0 1∊⍨≡|⍵)⍵),'could not be found.&lt;/p&gt;'</code>
<code class="emphasize">→[3]      '&lt;h1&gt;Page not found&lt;/h1&gt;'t</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_229">#.Laguntza.Laguntza.TellHowToArrangeNodes &mdash; 33%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  TellHowToArrangeNodes←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       ⍺←0</code>
<code> [3]       testflag←⍺</code>
<code> [4]       testflag:r←1</code>
<code class="emphasize">→[5]       msg←''</code>
<code class="emphasize">→[6]       msg,←⊂'Note that by default new nodes/help pages are inserted'</code>
<code class="emphasize">→[7]       msg,←⊂'in alphabetical order.'</code>
<code class="emphasize">→[8]       msg,←⊂''</code>
<code class="emphasize">→[9]       msg,←⊂'You can change the order to your liking by selecting:'</code>
<code class="emphasize">→[10]      msg,←⊂'"Manage ∆TopicProperties"'</code>
<code class="emphasize">→[11]      msg,←⊂'from the context menu of the tree view.'</code>
<code class="emphasize">→[12]      1:r←1⊣∆Ref.p.helpCaption Show msg</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_230">#.Laguntza.Laguntza.ReadBookMarksFromRegistry &mdash; 40%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReadBookMarksFromRegistry←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       A←∆Ref.d.A</code>
<code> [3]       0=≢rp←GetFullRegPath ∆Ref:⍬</code>
<code> [4]       (0=≢savedBookmarks←''RegRead rp,'bookmarks'):⍬</code>
<code class="emphasize">→[5]       (0=≢savedBookmarks←∪';'A.Split savedBookmarks):⍬</code>
<code class="emphasize">→[6]       savedBookmarks←{⍵[Alpha⍋⊃A.Last¨⍵]}savedBookmarks</code>
<code class="emphasize">→[7]       rows←(GetParentAndTopicNameAsText ∆Ref.d.tree)⍳savedBookmarks</code>
<code class="emphasize">→[8]       rows←(rows&lt;≢∆Ref.d.tree)/rows     ⍝ In development a bookmarked page might have been deleted</code>
<code class="emphasize">→[9]       _←∆Ref AddSavedBookmarksToMenu rows</code>
<code class="emphasize">→[10]      ⍬</code>
<code> [11]  ⍝ Attempts to read any bookmarks from the Windows Registry</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_231">#.Laguntza.Laguntza.GUI.OnBeforeNavigate &mdash; 40%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←OnBeforeNavigate msg</code>
<code> [1]  ⍝ Handler for "BeforeNavigate" events in the WebBrowser ActiveX control.</code>
<code> [2]   r←1</code>
<code> [3]   (self url)←msg[0 3]</code>
<code> [4]   self←⍎self</code>
<code> [5]   ∆Ref←##.Get∆Ref self</code>
<code> [6]   :If ∨/{≢'\bhttp[s]*://'⎕S 0⊣⍵}url</code>
<code class="emphasize">→[7]       self.Stop      ⍝ Returning just a 0 as result is not enough!</code>
<code class="emphasize">→[8]       r←0</code>
<code class="emphasize">→[9]       {}##.A.GoToWebPage url</code>
<code> [10]  :ElseIf 'file://'{⍺≡(≢⍺)↑⍵}url</code>
<code class="emphasize">→[11]      topic←{⍵↓⍨⍵⍳'#'}{⍵↑⍨-'.'⍳⍨⌽⍵}url</code>
<code class="emphasize">→[12]      :If ∧/(1↓topic)∊⎕D</code>
<code class="emphasize">→[13]          in←↑(//)⎕VFI 1↓topic</code>
<code> [14]      :Else</code>
<code class="emphasize">→[15]          no←(⎕C ∆Ref.d.tree[;##.I.TopicName])⍳⊂1↓topic</code>
<code class="emphasize">→[16]          in←∆Ref.d.tree[no;##.I.Row]</code>
<code> [17]      :EndIf</code>
<code class="emphasize">→[18]      {}##.Display ∆Ref in              ⍝ Display a certain topic</code>
<code> [19]  :EndIf</code>
</div>
<code class="header" id="listing_232">#.Laguntza.Laguntza.HTML.GetCssFileName &mdash; 40%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetCssFileName←{</code>
<code> [1]      (∆Ref type)←⍵</code>
<code> [2]      {('\\'≡2⍴⍵)∨':'∊⍵}∆Ref.p.folderName:EnforceSlash'file:///',∆Ref.p.folderName,'/Assets/CSS/',type,'.css'</code>
<code class="emphasize">→[3]      rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code class="emphasize">→[4]      r←'file:///',rf.GetAbsolutePathName⊂∆Ref.p.folderName,'/Assets/CSS/',type,'.css'</code>
<code class="emphasize">→[5]      EnforceSlash r</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_233">#.Laguntza.Laguntza.Search.HandleNotFound &mdash; 40%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> HandleNotFound←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      ##.IsNotOnSearchTab ∆Ref:⍬</code>
<code class="emphasize">→[3]      _←##.ShowEmptyPage ∆Ref</code>
<code class="emphasize">→[4]      _←ShowNotFound ∆Ref</code>
<code class="emphasize">→[5]      ⍬</code>
<code> [6]  ⍝ Make sure that any emphasized stuff is removed from the search screen</code>
<code> [7]  ⍝ and then display a message to the user that nothing was found.</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_234">#.Laguntza.Laguntza.HTML.PolishImageLinks &mdash; 50%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PolishImageLinks←{</code>
<code> [1]  ⍝ Since all images are defined relative to the current dir we must now</code>
<code> [2]  ⍝ change this by inserting the basePath. We CANNOT use the HTML "base"</code>
<code> [3]  ⍝ thingy because that would destroy all #-links!</code>
<code> [4]      (head body)←⍵</code>
<code> [5]      0=+/'&lt;img'⍷∊body:body</code>
<code class="emphasize">→[6]      basePath←GetBasePath head</code>
<code class="emphasize">→[7]      '&lt;img src="'⎕R('&amp;',basePath)⍠('Mode' 'D')⊣body</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_235">#.Laguntza.Laguntza.ReportAmbiguousLink_ &mdash; 60%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ReportAmbiguousLink_←{</code>
<code> [1] ⍝ ⍵ is the link</code>
<code> [2]      ∆Ref←⍺</code>
<code> [3]      (link row)←⍵</code>
<code> [4]      0=∆Ref.p.reportToSession:r←⍬</code>
<code class="emphasize">→[5]      ⎕←'*** This link is ambiguous: ',link,' in ',↑{(⍕⍺),'.',⍵}/X.∆Ref.d.tree[row;I.(Parent TopicName)]</code>
<code class="emphasize">→[6]      1:r←⍬</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_236">#.Laguntza.Laguntza.ReportBrokenLink_ &mdash; 60%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ReportBrokenLink_←{</code>
<code> [1] ⍝ ⍵ is the link</code>
<code> [2]      ∆Ref←⍺</code>
<code> [3]      (link row)←⍵</code>
<code> [4]      0=∆Ref.p.reportToSession:r←⍬</code>
<code class="emphasize">→[5]      ⎕←'*** Could not resolve this unknown link: ',link,' in ',↑{(⍕⍺),'.',⍵}/X.∆Ref.d.tree[row;I.(Parent TopicName)]</code>
<code class="emphasize">→[6]      1:r←⍬</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_237">#.Laguntza.Laguntza.InjectNewPageStub &mdash; 62%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{sibling}InjectNewPageStub(∆Ref in testFlag)</code>
<code> [1]  ⍝ `in` is not neccessarily identical with n.tree.SelItems⍳1: in case it is new it's +1.</code>
<code> [2]  ⍝ Returns 1 in case the help was re-compiled, otherwise 0.</code>
<code> [3]   r←0</code>
<code> [4]   row←∆Ref.d.tree[↑in;]</code>
<code> [5]   :If row[I.IsNode]</code>
<code> [6]       :If 0=⎕NC'sibling'</code>
<code class="emphasize">→[7]           :If 0=≢sibling←∆Ref AskWhetherSiblingOrChild GetParentAndTopicNameAsText row</code>
<code class="emphasize">→[8]               :Return                ⍝ Cancelled!</code>
<code> [9]           :Else</code>
<code class="emphasize">→[10]              :If sibling≡'into'</code>
<code class="emphasize">→[11]                  parent←⍎↑{(⍕⍺),'.',⍵}/row[I.(Parent TopicName)]</code>
<code> [12]              :Else</code>
<code class="emphasize">→[13]                  parent←I.Parent⊃row</code>
<code> [14]              :EndIf</code>
<code> [15]          :EndIf</code>
<code> [16]      :Else</code>
<code> [17]          parent←⍎↑{(⍕⍺),'.',⍵}/row[I.(Parent TopicName)]</code>
<code> [18]      :EndIf</code>
<code> [19]  :Else</code>
<code> [20]      parent←∆Ref GetParentOf in</code>
<code> [21]  :EndIf</code>
<code> [22]  r←testFlag InjectNewPageStub_ ∆Ref in parent</code>
<code> [23]  testFlag TellHowToArrangeNodes ∆Ref</code>
<code> [24] ⍝Done</code>
</div>
<code class="header" id="listing_238">#.Laguntza.Laguntza.Lint_.ReportTopicProperties &mdash; 62%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  rep←ReportTopicProperties ∆Ref</code>
<code> [1]   rep←⍬</code>
<code> [2]  ⍝ an = all nodes. They may have a ∆TopicProperties function</code>
<code> [3]   :If 0≠≢an←##.ListNamespaceTree ∆Ref.p.source</code>
<code> [4]       at←(3=↑¨an.⎕NC⊂'∆TopicProperties')/an</code>
<code> [5]       :If ∆Ref.p.reportToSession</code>
<code class="emphasize">→[6]           ⎕←(⎕PW-1)⍴'--- TopicProperties report ',⎕PW⍴'-'</code>
<code> [7]       :EndIf</code>
<code> [8]       :If 0=≢at</code>
<code> [9]           :If ∆Ref.p.reportToSession</code>
<code class="emphasize">→[10]              ⎕←'No ∆TopicProperties found'</code>
<code> [11]          :EndIf</code>
<code> [12]      :Else</code>
<code> [13]          rep←↑,/∆Ref CheckTopicProperty¨at</code>
<code> [14]          :If ∆Ref.p.reportToSession</code>
<code class="emphasize">→[15]              :If 0=≢rep</code>
<code class="emphasize">→[16]                  ⎕←'All ∆TopicProperties functions are fine'</code>
<code> [17]              :Else</code>
<code class="emphasize">→[18]                  ⎕←⍪rep</code>
<code> [19]              :EndIf</code>
<code> [20]          :EndIf</code>
<code> [21]      :EndIf</code>
<code> [22]  :EndIf</code>
</div>
<code class="header" id="listing_239">#.Laguntza.Laguntza.ReportProblem &mdash; 63%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReportProblem←{</code>
<code> [1]       ∆Ref←⍺</code>
<code> [2]       (ps tree)←⍵</code>
<code> [3]       ps.userMode:⍬</code>
<code> [4]       (~0∊nc←{↑(4⊃⍵).⎕NC 1⊃⍵}¨↓tree):⍬</code>
<code> [5]       0=∆Ref.p.reportToSession:⍬</code>
<code class="emphasize">→[6]       ⎕←(⎕PW-1)⍴'--- Problems (∆TopicProperties?!) - these do not exist: ',⎕PW⍴'-'</code>
<code class="emphasize">→[7]       ⎕←⍪{(⍕4⊃⍵),'.',1⊃⍵}¨↓(nc=0)⌿tree</code>
<code class="emphasize">→[8]       ⍬</code>
<code> [9]  ⍝ Reports any problems with items (probably ∆TopicProperties!</code>
<code> [10] ⍝ to the session but only in user mode.</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_240">#.Laguntza.Laguntza.TellLinkRegardingNew∆TopicProperty &mdash; 63%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←TellLinkRegardingNew∆TopicProperty where</code>
<code> [1]  ⍝ Tell Link</code>
<code> [2]   r←0</code>
<code> [3]   :If 0=⎕SE.⎕NC'Link'            ⍝ If the Link API is not in ⎕SE...</code>
<code class="emphasize">→[4]       {}⎕SE.UCMD'Link.Status'    ⍝ ... force it to be loaded</code>
<code> [5]   :EndIf</code>
<code> [6]   res←⎕SE.Link.Add(⍕where),'.∆TopicProperties'</code>
<code> [7]   :If ∨/'Not in a linked namespace:'⍷res</code>
<code> [8]   :AndIf ∆Ref.p.reportToSession</code>
<code class="emphasize">→[9]       ⎕←'*** Link was told about ∆TopicProperties in ',(⍕where),' but it wasn''t interested'</code>
<code class="emphasize">→[10]      r←1</code>
<code> [11]  :EndIf</code>
<code> [12] ⍝Done</code>
</div>
<code class="header" id="listing_241">#.Laguntza.Laguntza.Search.OnKeyPressInCombo &mdash; 63%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnKeyPressInCombo←{</code>
<code> [1]       (obj input)←⍵[0 2]</code>
<code> [2]       0 2∊⍨≢input:1⊣EnforceCheckOfSearchStringLength obj</code>
<code> [3]       ∆Ref←##.Get∆Ref obj</code>
<code> [4]       f←∆Ref.n.searchAsIs.State∨(~∆Ref.n.matchWholeWord.State)∨input∊' ',##.AllowedChars ⍬</code>
<code> [5]       f:1⊣EnforceCheckOfSearchStringLength obj ⍝ Okay?</code>
<code class="emphasize">→[6]       ∆Ref.n.searchAsIs.State:1                  ⍝ "Search as is"? Then we allow any input!</code>
<code class="emphasize">→[7]       _←∆Ref TellInvalidCharInSearchCombo input  ⍝ Tell user</code>
<code class="emphasize">→[8]       0                                          ⍝ Suppress invalid input</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_242">#.Laguntza.Laguntza.OnUpdate &mdash; 66%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref OnUpdate msg</code>
<code> [1]  ⍝ Basically create appropriate format and display it</code>
<code> [2]   r←1</code>
<code> [3]   rf←∆Ref.n.form</code>
<code> [4]   ⎕TRAP←∆Ref.p.userMode⊃(994 'C' '→∆Error')(994 'C' '→0')</code>
<code> [5]   :If 0&lt;∆Ref.f.⎕NC'tieNo'</code>
<code> [6]   :AndIf ~∆Ref.f.tieNo∊⎕FNUMS</code>
<code class="emphasize">→[7]       :Return        ⍝ Timing issue: does not exist anymore.</code>
<code> [8]   :EndIf</code>
<code> [9]   :If {11::1 ⋄ 'Namespace'≡rf.Type}⍬            ⍝ The user might just have closed the GUI (Alt+F4...)</code>
<code class="emphasize">→[10]      Cleanup ⍬</code>
<code> [11]  :Else</code>
<code> [12]      (obj ev)←2↑msg,(≢msg)↓'' ''</code>
<code> [13]      :If 0=≢in←GetCurrentItem ∆Ref.n</code>
<code class="emphasize">→[14]          r←0</code>
<code> [15]      :Else</code>
<code> [16]          {}∆Ref AddToHistory in                ⍝ Add the first item to the history</code>
<code> [17]          {}∆Ref CheckBookmarkButton in         ⍝ Make the "Bookmark" button active/inactive</code>
<code> [18]          {}∆Ref ParentInStatusbar in           ⍝ Display parent path if appropriate</code>
<code> [19]          {}DisplayParentelInfo ∆Ref in         ⍝ Display number of children (if any)</code>
<code> [20]          ∆Ref.n.tree.SelItems[in]←1            ⍝ Select the current item</code>
<code> [21]          html←∆Ref File.GetHtmlFromFile in</code>
<code> [22]          html←HTML.WrapInHtml ∆Ref 2 html in</code>
<code> [23]          tf←0                                  ⍝ Test flag - this is not a test</code>
<code> [24]          fs←2                                  ⍝ Font size; may be one of 1,2,3</code>
<code> [25]          arg←fs html in tf                     ⍝ Compile argument</code>
<code> [26]          ∆Ref ViewHTML arg                   ⍝ Display output in proper format</code>
<code> [27]      :EndIf</code>
<code> [28]  :EndIf</code>
<code> [29]  ⎕DL 0.0005 ⋄ 1 ⎕NQ ∆Ref.n.tree'GotFocus'      ⍝ This solves the focus problem!!</code>
<code> [30]  :Return</code>
<code> [31] ⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝</code>
<code class="emphasize">→[32] ∆Error:</code>
<code class="emphasize">→[33]  :If 0=∆Ref.p.userMode</code>
<code class="emphasize">→[34]      ⎕←(⎕PW-1)⍴'-'</code>
<code class="emphasize">→[35]      ⎕←'Error in "',(↑{⍺,'.',⍵}/∆Ref.d.tree[in;I.(Parent TopicName)]),'" (row=',(⍕I.Row⊃∆Ref.d.tree[in;]),'); ',⎕DMX.EM</code>
<code class="emphasize">→[36]      ⎕←'Deliberate stop; continue with →⎕LC; do NOT try →1 !'</code>
<code class="emphasize">→[37]      ⎕←'If you want to edit the faulty help page execute this: (updates the help files as well!)'</code>
<code class="emphasize">→[38]      ⎕←'∆Ref Edit ',(⍕in),' ''',(∆Ref GetHelpVarsName in),''''</code>
<code class="emphasize">→[39]      . ⍝ Deliberate stop; read above and then continue with →0 (do NOT try →1).</code>
<code> [40]  :EndIf</code>
</div>
<code class="header" id="listing_243">#.Laguntza.Laguntza.CheckForAlreadyOpen &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CheckForAlreadyOpen←{</code>
<code> [1]      (ps l)←⍵</code>
<code> [2]      ~(⊂fn←⎕C ps.folderName)∊l2←⎕C l.p.folderName:⍬</code>
<code class="emphasize">→[3]      (l2⍳⊂fn)⊃l</code>
<code> [4] ⍝ Checks whether the help form requested by ps already exists. If not ⍬ is returned,</code>
<code> [5] ⍝ otherwise a ref to that form is returned. We don't want to open the the help pages</code>
<code> [6] ⍝ more than once!</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_244">#.Laguntza.Laguntza.GetHome &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetHome add</code>
<code> [1]  ⍝ Tries first ##.TatinVars and then ##.CiderConfig.HOME.\\</code>
<code> [2]  ⍝ If both fail it settles for the current directory.\\</code>
<code> [3]   F←FilesAndDirs</code>
<code> [4]   :If 0&lt;⎕NC'TatinVars.HOME'</code>
<code class="emphasize">→[5]       r←TatinVars.HOME,add</code>
<code> [6]   :ElseIf 0&lt;##.⎕NC'CiderConfig.HOME'</code>
<code> [7]       r←##.CiderConfig.HOME,add</code>
<code> [8]   :Else</code>
<code class="emphasize">→[9]       r←'.\',(F.AddTrailingSep postfix),add</code>
<code> [10]  :EndIf</code>
<code> [11] ⍝Done</code>
</div>
<code class="header" id="listing_245">#.Laguntza.Laguntza.GetTopicIndexFromCaption &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetTopicIndexFromCaption←{</code>
<code> [1]      (currentItem result)←⍵</code>
<code> [2]      currentItem2←currentItem</code>
<code> [3]      ((currentItem2=' ')/currentItem2)←'_'</code>
<code> [4]      (⊂currentItem2)∊,result[;0]:result[;0]⍳⊂currentItem2</code>
<code class="emphasize">→[5]      (⊂currentItem)∊,result[;1]:result[;1]⍳⊂currentItem</code>
<code class="emphasize">→[6]      ¯1+≢result</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_246">#.Laguntza.Laguntza.ListNamespaceTree &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{x}ListNamespaceTree ref</code>
<code> [1]  ⍝ Returns a list of all namespaces in ⍵, including ⍵ itself.</code>
<code> [2]  ⍝ Does NOT return unnamed namespaces or GUI instances.</code>
<code> [3]  ⍝ Does not fall for circle references.</code>
<code> [4]  ⍝ Uses global ∆Ref.∆NamespaceTree if available.</code>
<code> [5]   :If 0=≢ref</code>
<code> [6]       ref←⍎{⍵↑⍨⍵⍳'.'}(⎕IO)⊃{⍵/⍨0&lt;⍬∘⍴¨⍴¨⍵}1↓⎕XSI</code>
<code> [7]   :EndIf</code>
<code> [8]   x←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ¯1}'x'</code>
<code> [9]   :If 9=⎕NC'∆Ref'</code>
<code> [10]  :AndIf 0&lt;∆Ref.⎕NC'∆NamespaceTree'</code>
<code class="emphasize">→[11]      :If ref∊# ⎕SE</code>
<code class="emphasize">→[12]          r←∆Ref.∆NamespaceTree</code>
<code> [13]      :Else</code>
<code class="emphasize">→[14]          r←∆Ref.∆NamespaceTree{⍺/⍨((1+≢⍵)↑[1]⊃(⍕¨⍺),¨'.')∧.=⍵,'.'}⍕ref</code>
<code> [15]      :EndIf</code>
<code> [16]  :Else</code>
<code> [17]      r←x ListNamespaceTree_ ref</code>
<code> [18]  :EndIf</code>
</div>
<code class="header" id="listing_247">#.Laguntza.Laguntza.GUI.On9991 &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  On9991 msg</code>
<code> [1]   ∆Ref←##.Get∆Ref rf←0⊃msg</code>
<code> [2]   ⎕DL 0.0005</code>
<code> [3]   ⍝⎕←hasFocus←∆Ref.GetFocus</code>
<code> [4]   :Select ∆Ref.d.currentTabIs</code>
<code> [5]   :Case ∆Ref.n.tree</code>
<code class="emphasize">→[6]       1 ⎕NQ ∆Ref.n.tree'GotFocus'</code>
<code> [7]   :Case ∆Ref.n.search</code>
<code class="emphasize">→[8]       1 ⎕NQ ∆Ref.n.searchString'GotFocus'</code>
<code> [9]   :Case ∆Ref.n.index</code>
<code class="emphasize">→[10]      1 ⎕NQ ∆Ref.n.indexKeyword'GotFocus'</code>
<code> [11]  :EndSelect</code>
<code> [12] ⍝ On the "Search" as well as the "Index" tab the focus is always given</code>
<code> [13] ⍝ to the edit field - it will be quite hard to change that!</code>
<code> [14] ⍝ As long as nobody complains...</code>
</div>
<code class="header" id="listing_248">#.Laguntza.Laguntza.Icons.HandleIcon &mdash; 67%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←HandleIcon ∆Ref</code>
<code> [1]  A←∆Ref.d.A</code>
<code> [2]  :If 0=≢∆Ref.p.helpIcon</code>
<code> [3]      r←CreateIcon ∆Ref.n.form</code>
<code> [4]  :ElseIf 'file://'{⍺≡⎕C(≢⍺)↑⍵}⍕∆Ref.p.helpIcon</code>
<code class="emphasize">→[5]      r←⍎'theIcon'⎕WC'Icon'('File'(PolishIconFilename ∆Ref.p.helpIcon))('Style' 'small')</code>
<code> [6]  :Else</code>
<code class="emphasize">→[7]      r←∆Ref.p.helpIcon</code>
<code> [8]  :EndIf</code>
</div>
<code class="header" id="listing_249">#.Laguntza.Laguntza.ReportMissingIndexEntries &mdash; 69%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←ReportMissingIndexEntries ∆Ref</code>
<code> [1]   r←''</code>
<code> [2]   list←GetParentAndTopicNameAsText ∆Ref.d.tree</code>
<code> [3]   :If ∆Ref.p.reportToSession</code>
<code class="emphasize">→[4]       ⎕←(⎕PW-1)↑'--- Help topics without any index entries',(⎕PW-1)⍴'-'</code>
<code> [5]   :EndIf</code>
<code> [6]   counter←0</code>
<code> [7]   :For this :In list</code>
<code> [8]       :If 2=⎕NC this</code>
<code> [9]           body←⍎this</code>
<code> [10]          :If 0=∨/∨/¨'[DATA]:index'∘⍷¨body</code>
<code class="emphasize">→[11]              ⎕←'⍝ ',this</code>
<code class="emphasize">→[12]              r,←⊂this</code>
<code class="emphasize">→[13]              counter+←1</code>
<code> [14]          :EndIf</code>
<code> [15]      :EndIf</code>
<code> [16]  :EndFor</code>
<code> [17]  :If 0=counter</code>
<code> [18]      r←'All help pages carry index entries'</code>
<code> [19]  :EndIf</code>
<code> [20]  :If ∆Ref.p.reportToSession</code>
<code class="emphasize">→[21]      ⎕←{2=≡⍵:⍪r ⋄ r}r</code>
<code> [22]  :EndIf</code>
<code> [23] ⍝Done</code>
</div>
<code class="header" id="listing_250">#.Laguntza.Laguntza.CompileHelpFile &mdash; 73%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {∆Ref}←CompileHelpFile y</code>
<code> [1]  ⍝ Compiles the help file needed for actually showing the Help pages.</code>
<code> [2]  ⍝ This can be called without an instance of the Help in question. In that</code>
<code> [3]  ⍝ case y will be a command space providing all information needed. Otherwise</code>
<code> [4]  ⍝ y is a ref pointing to an instance of Laguntza.\\</code>
<code> [5]  ⍝ The explicit result should be used by test cases only.</code>
<code> [6]  ⍝ Note that this function shadows the global `∆Ref` deliberately. This is a</code>
<code> [7]  ⍝ necesary measure to ensure a full recompile</code>
<code> [8]   A←APLTreeUtils2</code>
<code> [9]   :If 'Namespace'≡y ⎕WG'Type'      ⍝ Is it a parameter space?</code>
<code class="emphasize">→[10]      ∆Ref←CreateHelpForm ps←CheckParms y</code>
<code class="emphasize">→[11]      ∆Ref.p←ps</code>
<code class="emphasize">→[12]      CreateData ∆Ref</code>
<code> [13]  :Else</code>
<code> [14]      ∆Ref←y</code>
<code> [15]  :EndIf</code>
<code> [16]  File.DealWithFiles ∆Ref</code>
<code> [17]  CollectData ∆Ref               ⍝ Gather all the data needed for the tree</code>
<code> [18]  File.CloseFile ∆Ref</code>
<code> [19]  CopyImages ∆Ref</code>
<code> [20]  CopyAndMassageCSSfiles ∆Ref</code>
<code> [21] ⍝Done</code>
</div>
<code class="header" id="listing_251">#.Laguntza.Laguntza.GetMarkdownVarsContent_ &mdash; 73%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←∆Ref GetMarkdownVarsContent_(ref name)</code>
<code> [1]  ⍝ Returns the contents of a vars (Markdown).</code>
<code> [2]  ⍝ If that fails then there is no help page and '' is returned.</code>
<code> [3]   r←''</code>
<code> [4]   :If 2.1=ref.⎕NC⊂name</code>
<code> [5]       varsName←(⍕ref),'.',name</code>
<code> [6]   :ElseIf 2=ref.⎕NC name,'.∆DefaultPage'</code>
<code> [7]       varsName←(⍕ref),'.',name,'.∆DefaultPage'</code>
<code> [8]   :Else</code>
<code> [9]       :Return</code>
<code> [10]  :EndIf</code>
<code> [11]  result←⍎varsName</code>
<code> [12]  result←ExecEmbeddedFns result varsName</code>
<code> [13] ⍝ ⍎(∨/'FlipDB'⍷∊result)/'.'</code>
<code> [14]  ticks←0≠2|+/¨'`'=RemoveCodeBlock result</code>
<code> [15]  :If 1∊ticks</code>
<code class="emphasize">→[16]      :If ∆Ref.p.userMode</code>
<code> [17]         ⍝ Returning two empty vectors is the best we can do in user mode.</code>
<code> [18]      :Else</code>
<code class="emphasize">→[19]          :If AskForEdit2 varsName result ticks</code>
<code class="emphasize">→[20]              →1</code>
<code> [21]          :Else</code>
<code class="emphasize">→[22]              :Return</code>
<code> [23]          :EndIf</code>
<code> [24]      :EndIf</code>
<code> [25]  :Else</code>
<code> [26]      r←result</code>
<code> [27]  :EndIf</code>
</div>
<code class="header" id="listing_252">#.Laguntza.Laguntza.Markdown2HTML_ &mdash; 74%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Markdown2HTML_←{</code>
<code> [1]       (∆Ref row)←⍺</code>
<code> [2]       md←⍵</code>
<code> [3]       0=≢md:md</code>
<code> [4]       M←MarkAPL</code>
<code> [5]       parms←M.CreateParms</code>
<code> [6]       parms.checkLinks←0</code>
<code> [7]       parms.verbose←0</code>
<code> [8]       parms.bookmarkLink←0</code>
<code> [9]       parms.markdownStrict←1</code>
<code> [10]      parms.syntaxSugar←0</code>
<code> [11]      parms.projectPathFolder←∆Ref.p.folderName,'\'</code>
<code> [12]      ns←M.Init parms md</code>
<code> [13]      ns←M.Process ns</code>
<code> [14]      0=≢ns.report:ns.html</code>
<code class="emphasize">→[15]      flag←{0=⎕NC ⍵:0 ⋄ ~⍎⍵}'∆Ref.∆ReportToSession':Is reporting to ⎕SE is switched off(test cases etc)?</code>
<code class="emphasize">→[16]      flag:ns.html</code>
<code class="emphasize">→[17]      ⎕←'*** Problem',((1&lt;≢ns.report)/'s'),' in ',GetParentAndTopicNameAsText ∆Ref.d.tree[row;]</code>
<code class="emphasize">→[18]      ⎕←⍪ns.report</code>
<code class="emphasize">→[19]      ns.html</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_253">#.Laguntza.Laguntza.CreateStubTopic &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←testFlag CreateStubTopic(parent name)</code>
<code> [1]   :If testFlag</code>
<code> [2]       :If 0=≢list←'T'(⍎parent).⎕NL 2</code>
<code> [3]           name←'Test_01'</code>
<code> [4]       :Else</code>
<code> [5]           name←'Test_',¯2↑'0',⍕1+↑↑{(//)⎕VFI ⍵↓⍨1+⍵⍳'_'},¯1↑'Test_'{⍵⌿⍨((≢⍺)↑[1]⍵)∧.=⍺}list</code>
<code> [6]       :EndIf</code>
<code> [7]       header←'# ',name</code>
<code> [8]   :Else</code>
<code class="emphasize">→[9]       ((name='_')/name)←' '</code>
<code class="emphasize">→[10]      header←'# ',name</code>
<code> [11]  :EndIf</code>
<code> [12]  r←'[DATA]:index=''''' ''header'' 'Your new help page...'</code>
</div>
<code class="header" id="listing_254">#.Laguntza.Laguntza.Inject∆TopicProperties_ &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Inject∆TopicProperties_←{</code>
<code> [1]       r←''</code>
<code> [2]       (ref recursiveFlag)←⍵</code>
<code> [3]       f←0≠≢' '~¨⍨↓ref.⎕NL 2                     ⍝ Are there any variables?</code>
<code> [4]       l←{0=≢l←⍵.⎕NL-9:l ⋄ (~(↑¨l)∊'_∆')/l}ref    ⍝ Collect sub-namespaces</code>
<code> [5]       f∨←0≠≢l</code>
<code> [6]       f∧←0=ref.⎕NC'∆TopicProperties'</code>
<code> [7]       r←ref{⍵:⍺⊣⍺.⎕FX Create∆TopicProperties ⍺ ⋄ ''}f</code>
<code> [8]       _←ref{⍵:TellLinkRegardingNew∆TopicProperty ⍺ ⋄ ⍬}0≠≢r</code>
<code> [9]       0=recursiveFlag:r</code>
<code class="emphasize">→[10]      0=≢l:r</code>
<code class="emphasize">→[11]      l←ref.⍎¨l</code>
<code class="emphasize">→[12]      r,∊∇¨l,¨recursiveFlag</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_255">#.Laguntza.Laguntza.GUI.GetSystemMetrics &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetSystemMetrics val</code>
<code> [1] ⍝ Get any Windows system metrics</code>
<code> [2]  '∆GetSystemMetrics'⎕NA'I4 USER32.C32|GetSystemMetrics I4'</code>
<code> [3]  :If 1=≢val</code>
<code> [4]      r←∆GetSystemMetrics val        ⍝ Single value?</code>
<code> [5]  :Else</code>
<code class="emphasize">→[6]      r←∆GetSystemMetrics¨val        ⍝ Multiple values</code>
<code> [7]  :EndIf</code>
</div>
<code class="header" id="listing_256">#.Laguntza.Laguntza.Icons.CreateIcon &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←CreateIcon parent</code>
<code> [1]  ⍝ Tries to find the Icon in ./Images/; if that does not work out it uses TatinVars.HOME, assuming it is running</code>
<code> [2]  ⍝ as a Tatin package because then TatinVars.HOME tells us where to find assets.</code>
<code> [3]   :If ⎕NEXISTS'./Assets/Images/ViewHelp.ico'</code>
<code class="emphasize">→[4]       filename←'./Assets/Images/ViewHelp.ico'</code>
<code> [5]   :Else</code>
<code> [6]       filename←##.GetHome'/Assets/Images/ViewHelp.ico'</code>
<code> [7]   :EndIf</code>
<code> [8]   r←⍎'LaguntzaIcon'parent.⎕WC'Icon'('File'filename)('Style' 'Small')</code>
<code> [9]   ⍝Done</code>
</div>
<code class="header" id="listing_257">#.Laguntza.Laguntza.Search.Search &mdash; 75%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Search←{</code>
<code> [1]       ∆Ref←⍺</code>
<code> [2]       (ic ss full lf mhw sai)←⍵</code>
<code> [3]      ⍝ 1: ic   = ignore container</code>
<code> [4]      ⍝ 2: ss   = Search string</code>
<code> [5]      ⍝ 3: full = "full text search" flag</code>
<code> [6]      ⍝ 4: lf   = lower case flag</code>
<code> [7]      ⍝ 5: mhw  = match whole words only</code>
<code> [8]      ⍝ 6: sai  = search as is</code>
<code> [9]       full:∆Ref FullSearch ss lf mhw sai     ⍝ Perform a full text search</code>
<code class="emphasize">→[10]      ∆Ref TitleSearch ss lf mhw sai</code>
<code> [11]  ⍝ Performs a "Search" in "direction" on the global search</code>
<code> [12]  ⍝ string  which is "_Data.searchString"</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_258">#.Laguntza.Laguntza.GUI.CreateBookmarkMenu &mdash; 79%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateBookmarkMenu←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       tab←⎕UCS 9</code>
<code> [3]       eh←FullPathToHandler'##.OnMenuCmd'</code>
<code> [4]       ∆Ref.n.bookmarkMenu←⍎'bookmark'∆Ref.n.menubar.⎕WC'Menu' '&amp;Bookmarks'</code>
<code> [5]       cp←'Add bookmark',tab,'Ctrl+D'</code>
<code> [6]       ∆Ref.n.addBookmark←⍎'add'∆Ref.n.bookmarkMenu.⎕WC'MenuItem'cp('Active' 0)('Event' 'Select'eh)</code>
<code> [7]       cp←'Delete bookmark'</code>
<code> [8]       ∆Ref.n.delBookmark←⍎'del'∆Ref.n.bookmarkMenu.⎕WC'MenuItem'cp('Active' 0)('Event' 'Select'eh)</code>
<code> [9]       cp←'Delete all bookmarks'</code>
<code> [10]      ∆Ref.n.delAllBookmarks←⍎'delAll'∆Ref.n.bookmarkMenu.⎕WC'MenuItem'cp('Active' 0)('Event' 'Select'eh)</code>
<code> [11]      0=≢bm←∆Ref.d.bookmark:⍬            ⍝ No bookmarks?</code>
<code class="emphasize">→[12]      ∆Ref.d.bookmark←⍬                  ⍝ Because they are re-saved on this by the next line!</code>
<code class="emphasize">→[13]      _←∆Ref ##.Bookmark¨bm              ⍝ Bookmark them</code>
<code class="emphasize">→[14]      ⍬</code>
<code> [15] ⍝ Create the "Bookmarks" menu</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_259">#.Laguntza.Laguntza.TidyUp &mdash; 80%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> TidyUp←{</code>
<code> [1] ⍝ Checks whether anything inside Help</code>
<code> [2]      (0=⎕NC'HelpForms'):⍬                 ⍝ Nothing there to worry</code>
<code> [3]      (0=≢l←HelpForms.⎕NL-9):⍬             ⍝ It's empty - done</code>
<code> [4]      l←HelpForms.⍎¨l                      ⍝ It's empty - done</code>
<code> [5]      (0=+/b←~{0::0 ⋄ 'Form'≡⍵.Type}¨l):⍬  ⍝ All of them are forms - done</code>
<code class="emphasize">→[6]      ⍬⊣⎕EX¨⍕¨b/l</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_260">#.Laguntza.Laguntza.DeleteAPL_Object &mdash; 83%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref DeleteAPL_Object name</code>
<code> [1]   r←⍬</code>
<code> [2]   :If ∆Ref.p.notifyLink</code>
<code> [3]       result←⎕SE.Link.Expunge name</code>
<code> [4]       :If ∆Ref.p.reportToSession∧0=≢result</code>
<code> [5]       :OrIf 0≡result</code>
<code class="emphasize">→[6]           ⎕←'*** Link was told that "',(A.Last name),'" was deleted but wasn''t interested'</code>
<code> [7]       :EndIf</code>
<code> [8]   :EndIf</code>
<code> [9]  ⍝Done</code>
</div>
<code class="header" id="listing_261">#.Laguntza.Laguntza.ComplexLink &mdash; 86%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←ComplexLink(X tx st row)</code>
<code> [1]  ⍝ Processes complex links like:</code>
<code> [2]  ⍝ "→[*Name]"</code>
<code> [3]  ⍝ "→[*.Name]"</code>
<code> [4]  ⍝ "→[↑*.Name]"</code>
<code> [5]  ⍝ "→[Name]"</code>
<code> [6]  ⍝ "→[PathLevel3.Name]"</code>
<code> [7]  ⍝ "→[##.##.PathLevel3.Name]"</code>
<code> [8]  ⍝ "→[#.Full.Path.Name]"</code>
<code> [9]  ⍝ "→[Object.ThisMethod | alternative link text]"</code>
<code> [10] ⍝ tx: What's going to become the Help</code>
<code> [11] ⍝ st: For performance reasons tx might have been rotated. (-st)⌽ brings it back into shape.</code>
<code> [12]  l←⌊/tx⍳']|'                                                ⍝ Length of "magic" word</code>
<code> [13]  lt←{⍵↑⍨⍵⍳']'}tx                                            ⍝ Cut this link into lt</code>
<code> [14]  add←0</code>
<code> [15]  :If '→[http://'⎕C{⍺≡⍺⍺(≢⍺)↑⍵}tx</code>
<code> [16]  :OrIf '→[https://'⎕C{⍺≡⍺⍺(≢⍺)↑⍵}tx</code>
<code class="emphasize">→[17]      url←{⍵↑⍨⍵⍳'|'}2↓lt</code>
<code class="emphasize">→[18]      lt←A.DMB{'|'∊⍵:⍵↓⍨1+⍵⍳'|' ⋄ ⍵}2↓lt</code>
<code class="emphasize">→[19]      lk←'[',lt,'](',url,')'                                 ⍝ wrap in HTML</code>
<code> [20]  :Else</code>
<code> [21]      :If 0=≢in←(row FindTopic X.∆Ref({⍵↑⍨⌊/⍵⍳'|] '}2↓lt))[;0]</code>
<code> [22]          lk←X row ReportBrokenLink l↑tx</code>
<code> [23]      :ElseIf 1&lt;≢in</code>
<code> [24]          lk←row ReportAmbiguousLink l↑tx</code>
<code> [25]      :Else</code>
<code> [26]          lt←PolishLinkText lt</code>
<code> [27]          lt,←(0=≢lt)/I.Title⊃X.∆Ref.d.tree[↑in;]            ⍝ No link title? Fetch topic title!</code>
<code> [28]          :If '``'≡((1+tx⍳']')⊃tx),¯1↑tx                     ⍝ Is it marked up as code?</code>
<code> [29]              st-←1</code>
<code> [30]              tx←¯1↓tx</code>
<code> [31]              lk←'[`',lt,'`](#',(⍕in),')'                    ⍝ Convert to a Markdown bookmark link that is marked up as code</code>
<code> [32]              add←1</code>
<code> [33]          :Else</code>
<code> [34]              lk←'[',lt,'](#',(⍕in),')'                      ⍝ Convert to a Markdown bookmark link</code>
<code> [35]          :EndIf</code>
<code> [36]      :EndIf</code>
<code> [37]  :EndIf</code>
<code> [38]  r←(-st)⌽lk,((1+add)+tx⍳']')↓tx                             ⍝ Insert link, rotate back</code>
<code> [39] ⍝Done</code>
</div>
<code class="header" id="listing_262">#.Laguntza.Laguntza.InjectNewPageStub_ &mdash; 86%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←testFlag InjectNewPageStub_(∆Ref in parent)</code>
<code> [1]  ⍝ Returns 1 in case the help was re-compiled, otherwise 0.</code>
<code> [2]   r←0</code>
<code> [3]   ⎕SE.⎕SHADOW'TEMP'</code>
<code> [4]   'TEMP'⎕SE.⎕NS''</code>
<code> [5]   okFlag←0</code>
<code> [6]   :If testFlag</code>
<code> [7]       name←'Test_'</code>
<code> [8]       testlist←' '~¨⍨↓'T'parent.⎕NL 2</code>
<code> [9]       testlist←'Test_'{⍵/⍨⍺∘≡¨(≢⍺)↑¨⍵}testlist</code>
<code> [10]      :If 0=≢testlist</code>
<code> [11]          name,←'01'</code>
<code> [12]      :Else</code>
<code> [13]          name,←¯2↑'00',⍕1+⍎¯2↑↑¯1↑testlist</code>
<code> [14]      :EndIf</code>
<code> [15]  :Else</code>
<code class="emphasize">→[16]      name←AskForName ∆Ref</code>
<code> [17]  :EndIf</code>
<code> [18]  →(0=≢name)/0</code>
<code> [19]  name←' '⎕R'_'⊣name</code>
<code> [20]  ⍎'⎕SE.TEMP.',(⍕name),'←testFlag CreateStubTopic (⍕parent) name'</code>
<code> [21]  :Repeat</code>
<code> [22]      :If 0=testFlag</code>
<code class="emphasize">→[23]      :AndIf 0=⎕SE.TEMP EditByQED name</code>
<code class="emphasize">→[24]          :Return        ⍝ User has not entered anything</code>
<code> [25]      :EndIf</code>
<code> [26]      :If 0=≢∊⍎'⎕SE.TEMP.',name</code>
<code class="emphasize">→[27]          :Return</code>
<code> [28]      :Else</code>
<code> [29]          okFlag←1</code>
<code> [30]      :EndIf</code>
<code> [31]      ⍎(⍕parent),'.',name,'←⎕SE.TEMP.',name</code>
<code> [32]  :Until okFlag</code>
<code> [33]  ∆Ref TellLinkAboutChange(⍕parent),'.',name</code>
<code> [34]  ∆Ref AddToTopicProperties name parent</code>
<code> [35]  {}Compile ∆Ref</code>
<code> [36]  r←1</code>
<code> [37]  ∆Ref ShowTopic(⍕parent),'.',name</code>
<code> [38] ⍝Done</code>
</div>
<code class="header" id="listing_263">#.Laguntza.Laguntza.CreateStub &mdash; 87%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{parms}CreateStub name</code>
<code> [1]  ⍝ Creates a new help system as a starting point. It comes with two pages ("Overview" and "Copyright")</code>
<code> [2]  ⍝ and a sub folder "Sub" that has another two pages, "Foo" and "Goo".\\</code>
<code> [3]  ⍝ `name` must be the name of the new help system. If it is a relative path (like `Foo`) the help</code>
<code> [4]  ⍝ system is created in `#`. If it is a full path (like `#.Here.Foo`) a help system `Foo`</code>
<code> [5]  ⍝ will be created in `#.Here` which must already exist.\\</code>
<code> [6]  ⍝ You can specify a parameter space, typically created by calling `Laguntza.CreateParms ''`, as</code>
<code> [7]  ⍝ optional left argument.</code>
<code> [8]  ⍝ `r` is a pointer to the newly created help system.</code>
<code> [9]  ⍝ In case something is wrong with the argument(s) `CreateStub` throws an error.</code>
<code> [10]  parms←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ⍬}'parms'</code>
<code> [11]  :If 0≠≢parms</code>
<code> [12]      'Invalid container namespace'⎕SIGNAL 11/⍨326≠⎕DR parms</code>
<code> [13]  :EndIf</code>
<code> [14]  parms←CreateParms parms</code>
<code> [15]  :If '.'∊name</code>
<code class="emphasize">→[16]      (parent name)←{⍵{(⍺↓⍨-1+≢⍵)(⍺↑⍨-≢⍵)}'.'A.Last ⍵}name</code>
<code> [17]  :ElseIf 0=≢parms.source</code>
<code> [18]      parent←((⍕⎕THIS),'.')∘{↑⍵↓⍨+/∧\⍺∘≡¨(≢⍺)↑¨⍵}⎕NSI</code>
<code> [19]  :Else</code>
<code> [20]      parent←⍕parms.source</code>
<code> [21]  :EndIf</code>
<code> [22]  {}{⍵ #.⎕NS''}⍣(↑0=⎕NC parent)⊣parent</code>
<code> [23]  'Invalid container namespace'⎕SIGNAL 11/⍨(9≠⎕NC parent)∧(,'#')≢,parent</code>
<code> [24]  parent←⍎parent</code>
<code> [25]  :Trap 0</code>
<code> [26]      ⎕SIGNAL/{0=⍵:''⍬ ⋄ ¯1=⍵:'Invalid name' 11 ⋄ 'Name is already taken' 11}parent.⎕NC name</code>
<code> [27]  :Else</code>
<code> [28]      'Invalid name'⎕SIGNAL 11</code>
<code> [29]  :EndTrap</code>
<code> [30]  ref←⍎name parent.⎕NS''</code>
<code> [31]  parms.helpCaption←name</code>
<code> [32]  parms.source←parent⍎name</code>
<code> [33]  parms.expand←'All'</code>
<code> [34]  ref2←⍎'Sub'ref.⎕NS''</code>
<code> [35]  ref.Overview←'[DATA]:index=''How to start ⋄ Get going ⋄ First steps''' '' '# Overview' '' 'This is the "Overview" page'</code>
<code> [36]  ref.Copyright←'[DATA]:index=''Copyright''' '' '# Copyright' '' '(c) Copyright 2021 xyz'</code>
<code> [37]  ref2.Foo←'[DATA]:index=''This is about Foo''' '# Foo' '' 'This is the "Foo" page' '' 'Go to →[Overview]'</code>
<code> [38]  ref2.Goo←'[DATA]:index=''This is about Goo''' '# Goo' '' 'This is the "Goo" page' '' 'Go to →[Overview]'</code>
<code> [39]  r←1 New parms</code>
<code> [40]  :If 0≠≢parms.saltFolder</code>
<code class="emphasize">→[41]  :AndIf CheckOnEditFixForSaltHandler ⍬</code>
<code class="emphasize">→[42]      cmd←'"',(parms.saltFolder~'"'),'" -patterns=',name,' -loadfn -makedir -noprompt -clear'</code>
<code class="emphasize">→[43]      SaveHelpSystemWithSalt parms ref</code>
<code> [44]  :EndIf</code>
<code> [45]  r.n.∆Ref TellLinkAboutChange ref</code>
<code> [46] ⍝Done</code>
</div>
<code class="header" id="listing_264">#.Laguntza.Laguntza.CloseHelp &mdash; 88%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←CloseHelp ∆Ref</code>
<code> [1]  ⍝ Normally this needs a ref pointing to a Help instance but if this is an</code>
<code> [2]  ⍝ empty vector instead then ALL instances of Laguntza will be closed.\\</code>
<code> [3]  ⍝ Returns 0 for succecss and `⎕en` otherwise.</code>
<code> [4]   r←0</code>
<code> [5]   ⎕DL 0.2</code>
<code> [6]   ⎕TRAP←(0 'E' '→0,≢r←⎕EN')</code>
<code> [7]   :If ⍬≢A←{0::⍬ ⋄ ⍵.d.A}∆Ref</code>
<code> [8]       File.CloseFile ∆Ref</code>
<code> [9]       FilesAndDirs.DeleteFile ∆Ref.∆tempFilename</code>
<code> [10]  :AndIf {0::0 ⋄ 'Form'≡⍵.Type}∆Ref</code>
<code> [11]      :If (0=≢rp←GetFullRegPath ∆Ref)                ⍝ There is no RegKey specified: close the form, done.</code>
<code class="emphasize">→[12]          FilesAndDirs.DeleteFile ∆Ref.∆tempFilename</code>
<code class="emphasize">→[13]          ∆Ref.n.form.Close</code>
<code> [14]      :Else</code>
<code> [15]          ids←↑¨{⍺,'.',⍵}/¨∆Ref.d.bookmark           ⍝ Names of the bookmarks</code>
<code> [16]          ids←1↓∊';',¨ids                            ⍝ Prepare them</code>
<code> [17]          {}ids RegWrite rp,'Bookmarks'              ⍝ Save them in the Registry</code>
<code> [18]          :If (WindowStateNormal≠∆Ref.State)         ⍝ Maximzed or minimized: we are done</code>
<code class="emphasize">→[19]              {}∆Ref.n.form.Close</code>
<code> [20]          :Else</code>
<code> [21]              SM_CYMENU←15                           ⍝ Menu bar height</code>
<code> [22]              mbh←GUI.GetSystemMetrics SM_CYMENU</code>
<code> [23]              posn←∆Ref.n.form.Posn                  ⍝ Save Posn of the help window</code>
<code> [24]              posn[0]-←mbh</code>
<code> [25]              {}(⍕posn)RegWrite rp,'Posn'</code>
<code> [26]              size←∆Ref.n.form.Size                  ⍝ Save Size of the help</code>
<code> [27]              {}(⍕size)RegWrite rp,'Size'</code>
<code> [28]              {}(⍕∆Ref.n.splitter.Posn)RegWrite rp,'SplitterPosn' ⍝ Save posn of the splitter</code>
<code> [29]              FilesAndDirs.DeleteFile ∆Ref.∆tempFilename</code>
<code> [30]              {}∆Ref.n.form.Close</code>
<code> [31]              ⎕EX⍕∆Ref</code>
<code> [32]          :EndIf</code>
<code> [33]      :EndIf</code>
<code> [34]  :EndIf</code>
</div>
<code class="header" id="listing_265">#.Laguntza.Laguntza.ViewHTML &mdash; 88%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {html}←∆Ref ViewHTML(s html in tf)</code>
<code> [1]  ⍝ Right argument: size, code, item no, test flag</code>
<code> [2]   :If 0=IsNotOnSearchTab ∆Ref         ⍝ We emphasize hits only when focus is on the search TAB</code>
<code class="emphasize">→[3]       html(EmphasizeHitsInHTML)←∆Ref</code>
<code> [4]   :EndIf</code>
<code> [5]  ∆CarryOn:</code>
<code> [6]   :If ~tf</code>
<code> [7]       ⎕TRAP←((∆Ref.p.trapErrors)/⊂(995 'C' '→0,≢r←''''')),⊂(0 'S')</code>
<code> [8]   :EndIf</code>
<code> [9]   :If (,1)≢,tf                        ⍝ Test flag on? Get out!</code>
<code> [10] </code>
<code> [11]      ⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝</code>
<code> [12]      ⍝ We don't do the (memory based) approach anymore because ⍝</code>
<code> [13]      ⍝ a) Ctrl+F (Find) on a page does not work then           ⍝</code>
<code> [14]      ⍝ b) The engine is IE11 or worse, NOT Edge!               ⍝</code>
<code> [15]      ⍝      ∆Ref.n.browser.Document.close                      ⍝</code>
<code> [16]      ⍝      ∆Ref.n.browser.Document.write⊂1↓↑,/(⎕UCS 13),¨html ⍝</code>
<code> [17]      ⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝⍝</code>
<code> [18] </code>
<code> [19]      (⊂html)FilesAndDirs.NPUT ∆Ref.∆tempFilename 1</code>
<code> [20]      ∆Ref.n.browser.Navigate⊂'file://',∆Ref.∆tempFilename</code>
<code> [21] </code>
<code> [22]  :EndIf</code>
<code> [23] ⍝ Prepare HTML, write to file and make IE display that file.</code>
<code> [24] ⍝ 1=test flag (tf) : do only create the HTML; 0=operate normally.</code>
</div>
<code class="header" id="listing_266">#.Laguntza.Laguntza.TellLinkAboutChange &mdash; 89%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref TellLinkAboutChange y</code>
<code> [1]  ⍝ `y` is either a name of a single funtion/operator/variable or a ref pointing to a namespace.</code>
<code> [2]  ⍝ If it is a namespace Link's `Add` method is called in order to make sure that Link</code>
<code> [3]  ⍝ is told about all functions/operators/variables in `y` and any sub-namespaces.</code>
<code> [4]  ⍝ Returns 0 in case Link was not interested (or not supposed to be told anyway) and 1 otherwise.</code>
<code> [5]   r←0</code>
<code> [6]   :If ∆Ref.p.notifyLink</code>
<code> [7]       'Link is not present in ⎕SE'⎕SIGNAL 11/⍨9≠⎕SE.⎕NC'Link'</code>
<code> [8]       name←⍕y</code>
<code> [9]       res←⎕SE.Link.Add name</code>
<code> [10]      r←0&lt;≢res</code>
<code> [11]      :If ∆Ref.p.reportToSession</code>
<code> [12]      :AndIf 0=≢res</code>
<code class="emphasize">→[13]          ⎕←'*** Link was told that ',name,((9=⎕NC name)/'.*'),' got changed but wasn''t interested.'</code>
<code> [14]      :EndIf</code>
<code> [15]  :EndIf</code>
<code> [16] ⍝Done</code>
</div>
<code class="header" id="listing_267">#.Laguntza.Laguntza.New &mdash; 90%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {∆Ref}←{enforceCompile}New ps</code>
<code> [1]  ⍝ Creates a new instance of a help system.</code>
<code> [2]  ⍝ Parameter space "ps" is needed. Function `CreateParms` creates one with defaults.\\</code>
<code> [3]  ⍝ Example:\\</code>
<code> [4]  ⍝ ~~~</code>
<code> [5]  ⍝ ps←Laguntza.CreateParms ⍬</code>
<code> [6]  ⍝ ps.folderName←'C:\MyHelp'</code>
<code> [7]  ⍝ ps.source←#.MyHelp</code>
<code> [8]  ⍝ Markdown2.New ps</code>
<code> [9]  ⍝ ~~~</code>
<code> [10]  ⎕ML←3 ⋄ ⎕IO←0</code>
<code> [11]  A←APLTreeUtils2</code>
<code> [12]  'Right argument must be a parameter space'⎕SIGNAL 11/⍨9.1≢⎕NC⊂'ps'</code>
<code> [13]  ps←CreateParms ps</code>
<code> [14]  ps←CheckParms ps</code>
<code> [15]  enforceCompile←HandleEnforceCompile ps{0&lt;⎕NC ⍵:⍎⍵ ⋄ CheckCompileFiles ⍺}'enforceCompile'</code>
<code> [16]  ps.folderName←(-(¯1↑ps.folderName)∊'\/')↓ps.folderName</code>
<code> [17]  'Invalid parameter: "foldername"'⎕SIGNAL 11/⍨(,ps.folderName)≡,¯1</code>
<code> [18]  {}TidyUp ⍬</code>
<code> [19]  ∆Ref←CreateHelpForm ps</code>
<code> [20]  ∆Ref.A←A   ⍝ Establish a reference to APLTreeUtils2 for performance</code>
<code> [21]  ∆Ref.∆NamespaceTree←ListNamespaceTree⍎{⍵↑⍨⍵⍳'.'}(⎕IO)⊃{⍵/⍨0&lt;⍬∘⍴¨⍴¨⍵}⎕XSI</code>
<code> [22]  ∆Ref.∆parms←ps</code>
<code> [23]  ∆Ref.∆tempFilename←GetTempFilename'html'</code>
<code> [24]  {}CreateData ∆Ref</code>
<code> [25]  ∆Ref.p←ps</code>
<code> [26]  {}ps ReadGuiParmsFromRegistry ∆Ref</code>
<code> [27]  {}GUI.CreateGui ∆Ref</code>
<code> [28]  :If enforceCompile</code>
<code> [29]      {}CompileHelpFile ∆Ref</code>
<code> [30]  :Else</code>
<code class="emphasize">→[31]      'f'∆Ref.⎕NS''</code>
<code class="emphasize">→[32]      ∆Ref←File.EstablishFileIndexVars ∆Ref</code>
<code class="emphasize">→[33]      ∆Ref.f.filename←File.GetHelpFileName</code>
<code> [34]  :EndIf</code>
<code> [35]  {}GUI.PopulateToolbar ∆Ref</code>
<code> [36]  ∆Ref.d.tree←File.OpenFilesAndGetTree ∆Ref</code>
<code> [37]  {}ps ReadBookMarksFromRegistry ∆Ref</code>
<code> [38]  {}PopulateGUI ∆Ref</code>
<code> [39]  {}¯1 Display ∆Ref ∆Ref.p.page</code>
<code> [40]  ∆Ref.n.browser_sf.Active←1</code>
<code> [41]  :If ∆Ref.p.visible</code>
<code> [42]      2 ⎕NQ ∆Ref.n.tree'GotFocus'</code>
<code> [43]  :EndIf</code>
</div>
<code class="header" id="listing_268">#.Laguntza.Laguntza.Create∆TopicProperties &mdash; 91%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  b←Create∆TopicProperties target</code>
<code> [1]  ⍝ Returns a body for the standard ∆TopicProperties function expected to exist in every</code>
<code> [2]  ⍝ tree node of a help system. Pre-populates the body with whatever is already found</code>
<code> [3]  ⍝ in "target" with defaults active←1, caption←'' and developmentOnly←0.</code>
<code> [4]  ⍝ Note that the absence of this function in a node does not harm the help system:</code>
<code> [5]  ⍝ it will carry on with default values.</code>
<code> [6]  ⍝ You can (re-)create a function ∆TopicProperties in any node from its context menu.</code>
<code> [7]   l←' '~¨⍨↓target.⎕NL 9 2                ⍝ All namespaces and variables</code>
<code> [8]   l←('∆'≠↑¨l)/l                          ⍝ Drop all starting with "∆" (∆DefaultPage!)</code>
<code> [9]   b←GetTopicPropertyTemplate ⍬</code>
<code> [10]  quote←{'''',⍵,''''}</code>
<code> [11]  titles←(≢l)⍴⊂quote''</code>
<code> [12]  :If ∨/isVars←2.1=target.⎕NC¨⊂¨l</code>
<code class="emphasize">→[13]      (isVars/titles)←{t←HTML.GetTitle target.⍎⍵ ⋄ 0=≢t:⍵ ⋄ quote t}¨isVars/l</code>
<code> [14]  :EndIf</code>
<code> [15]  ((titles≡¨quote¨l)/titles)←⊂''''''                     ⍝ Titles becomes empty when identical with name</code>
<code> [16]  b,←⍕¨'r⍪←'∘,¨↓⍉⊃(quote¨l)(titles)(⍕¨1⍴⍨≢l)(⍕¨0⍴⍨≢l)</code>
<code> [17]  b,←⊂,'r'</code>
<code> [18]  b,←⊂,'}'</code>
<code> [19] ⍝Done</code>
</div>
<code class="header" id="listing_269">#.Laguntza.Laguntza.InjectNewNode_ &mdash; 91%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←testFlag InjectNewNode_(∆Ref name parent type row)</code>
<code> [1]   'Invalid: "type"'⎕SIGNAL 11/⍨~type∊'sibling' 'child'</code>
<code> [2]   :If 'child'≡↑type</code>
<code class="emphasize">→[3]       parent←parent.⍎↑∆Ref.d.tree[row;I.TopicName]</code>
<code> [4]   :EndIf</code>
<code> [5]   name parent.⎕NS''              ⍝ This injects the node. Lexical order applies</code>
<code> [6]   {}∆Ref AddToTopicProperties name parent</code>
<code> [7]   {}Compile ∆Ref</code>
<code> [8]   row2←∆Ref GetItemNumberFromPattern(⍕parent),'.',name</code>
<code> [9]   :If 0≠≢row2</code>
<code> [10]      {}∆Ref SelectItemInTreeView row2</code>
<code> [11]      {}ProcessEvents ∆Ref.n.form</code>
<code> [12]  :EndIf</code>
<code> [13]  {}'into'InjectNewPageStub ∆Ref row2 testFlag</code>
<code> [14] ⍝Done</code>
</div>
<code class="header" id="listing_270">#.Laguntza.Laguntza.IntitialExpand &mdash; 92%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←IntitialExpand ∆Ref</code>
<code> [1]  ⍝ Expand the appropriate branches; honors ∆Ref.p.expand</code>
<code> [2]   r←⍬</code>
<code> [3]   A←∆Ref.d.A</code>
<code> [4]   :Select ⎕C ∆Ref.p.expand</code>
<code> [5]   :Case 'none'</code>
<code> [6]       :Return</code>
<code> [7]   :Case 'level1'</code>
<code> [8]       these←⍸∆Ref.d.tree[;I.Depth]=0</code>
<code> [9]   :Case 'all'</code>
<code> [10]      these←⍸2{⍺&lt;⍵}/∆Ref.d.tree[;I.Depth]</code>
<code> [11]  :Else</code>
<code class="emphasize">→[12]      .                                      ⍝ Huuh?!</code>
<code> [13]  :EndSelect</code>
<code> [14]  _←{1 ⎕NQ ∆Ref.n.tree'Expanding'⍵}¨these    ⍝ Expand them</code>
<code> [15]  {}∆Ref SelectItemInTreeView 0              ⍝ Force focus back to first one</code>
<code> [16] ⍝Done</code>
</div>
<code class="header" id="listing_271">#.Laguntza.Laguntza.HTML.MaskLinks &mdash; 94%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{sep}MaskLinks tx</code>
<code> [1]   sep←{0=⎕NC ⍵:']' ⋄ ⍎⍵}'sep'                ⍝ By default the full link is masked. Can be '|' instead when the link text should survive</code>
<code> [2]   :If 1≠≢sep</code>
<code> [3]   :OrIf ~sep∊'|]'</code>
<code class="emphasize">→[4]       'Invalid left argument'⎕SIGNAL 11</code>
<code> [5]   :Else</code>
<code> [6]       b1←'→['⍷r←tx                           ⍝ The links</code>
<code> [7]       :If 0&lt;+/b1                             ⍝ No links? Done!</code>
<code> [8]           tx2←b1{⎕ML←1 ⋄ ⍺⊂⍵}r               ⍝ Split up where the link(s) start</code>
<code> [9]           b2←∊&lt;\¨tx2=sep                     ⍝ Split and look for the fist `sep` - that's the end of the link</code>
<code> [10]          :If sep='|'</code>
<code> [11]              b3←∊&lt;\¨tx2=']'                 ⍝ When the link text is supposed to surive the closing `]` must be wiped out</code>
<code> [12]          :EndIf</code>
<code> [13]          count←(≢b2)++/∧\~b1                ⍝ How many chars until the first link?</code>
<code> [14]          b2←(-count)↑b2                     ⍝ Fill up</code>
<code> [15]          r[{⍵/⍳≢⍵}{⍵∨≠\⍵}b1∨b2]←' '         ⍝ Mask the links</code>
<code> [16]          :If sep='|'</code>
<code> [17]              b3←(-count)↑b3                 ⍝ Fill up</code>
<code> [18]              (b3/r)←' '                     ⍝ The closing `]` of any links becomes a blank</code>
<code> [19]          :EndIf</code>
<code> [20]      :EndIf</code>
<code> [21]  :EndIf</code>
</div>
<code class="header" id="listing_272">#.Laguntza.Laguntza.CreateParms &mdash; 95%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateParms←{</code>
<code> [1]   ⍝ If `⍵` is empty: create a namespace and populate it with default parameters</code>
<code> [2]   ⍝ Otherwise `⍵` must be a parameter space. Missing parameters are added before `⍵` is returned as result.</code>
<code> [3]       ⍺←{'CLEAR WS'≡⍵:FilesAndDirs.PWD ⋄ 0⊃⎕NPARTS ⍵}⎕WSID</code>
<code> [4]       p←⎕NS''</code>
<code> [5]       p.homeFolder←⍺</code>
<code> [6]       p.cssPrintFilename←''          ⍝ Name of the CSS file to be used for printing</code>
<code> [7]       p.cssScreenFilename←''         ⍝ Name of the CSS file to be used for the screen</code>
<code> [8]       p.folderName←¯1                ⍝ MUST be specified.</code>
<code> [9]       p.helpAbout←'Laguntza' 'Written by Kai Jaeger'</code>
<code> [10]      p.helpCaption←'Laguntza'       ⍝ General caption used in all GUI controls.</code>
<code> [11]      p.helpIcon←''                  ⍝ Filename of an ICO file or ref pointing to an ICO object. Empty results in default icon.</code>
<code> [12]      p.helpVersion←1⊃Version</code>
<code> [13]      p.helpVersionDate←2⊃Version</code>
<code> [14]      p.expand←'Level1'              ⍝ May be one of: "All", "Level1" or "None.</code>
<code> [15]      p.isRuntime←IsRunTime ⍬</code>
<code> [16]      p.language←'en'                ⍝ Used to set the language in `&lt;html lang="`.</code>
<code> [17]      p.maxWidth←'900px'             ⍝ If you don't want to restrict the width set this to ⍬.</code>
<code> [18]      p.noClose←0                    ⍝ 1=Don't close the Help, leave files tied etc, just set Visible←0. You must call "CloseHelp" eventually.</code>
<code> [19]      p.notifyLink←1                 ⍝ Shall Link be notified? Normally only test cases will set this to 0.</code>
<code> [20]      p.page←0                       ⍝ The page to be shown at start time; Can be a row number, minimal or full link.</code>
<code> [21]      p.posn←⍬ ⍬                     ⍝ Default position (might be overwritten from outside).</code>
<code> [22]      p.printFontSize←'9pt'          ⍝ Defines the basic font size for printing. Everything else refers to this by either "em" or in percentage.</code>
<code> [23]      p.regPath←''                   ⍝ Path to Windows Registry. Becomes "Software\APLTree\Laguntza\",helpCaption if empty. 0 disables mechanism.</code>
<code> [24]      p.reportToSession←¯1           ⍝ 1=report problems (like broken links etc) to the session. Defaults to `isRuntime`.</code>
<code> [25]      p.saltFolder←''                ⍝ If not empty then all vars &amp; ∆TopicProperties are saved in files within that folder.</code>
<code> [26]      p.screenFontSize←'16px'        ⍝ Defines the basic font size for the screen. Everything else refers to this by either "em" or in percentage.</code>
<code> [27]      p.size←⍬ ⍬                     ⍝ Default size (might be overwritten from outside).</code>
<code> [28]      p.source←''                    ⍝ Ref to the NS that contains the Help system. Needed for compilation &amp; development only.</code>
<code> [29]      p.splitterPosn←⍬ ⍬             ⍝ May be overwritten by user and/or Windows Registry.</code>
<code> [30]      p.statusbarAlarmColor←255 160 160 ⍝ Used to make the message in the status bar more prominent.</code>
<code> [31]      p.testMode←0                   ⍝ Suppress dialogs telling the user about problems etc.</code>
<code> [32]      p.trapErrors←¯1                ⍝ Becomes userMode if not set.</code>
<code> [33]      p.userMode←p.isRuntime         ⍝ Default depends on APL's exe type.</code>
<code> [34]      p.visible←1                    ⍝ By default the GUI is visible.</code>
<code> [35]      ' '≠1↑0⍴p.⎕FX⊃'r←∆List' 'r←⍉{⍵,[-0.5]⍎¨⍵}(⎕NL-2 9)':.</code>
<code> [36]      0=≢⍵:p</code>
<code> [37]      326≠⎕DR ⍵:p</code>
<code> [38]      p2←⍵</code>
<code> [39]      ' '≠1↑0⍴p2.⎕FX⊃'r←∆List' 'r←⍉{⍵,[-0.5]⍎¨⍵}(⎕NL-2 9)':.</code>
<code> [40]      0=≢list←(' '~¨⍨↓p.⎕NL 2 9)~p2.⎕NL-2 9:p2</code>
<code class="emphasize">→[41]      _←p p2.{⍎⍵,'←⍺⍎⍵'}¨list</code>
<code class="emphasize">→[42]      p2</code>
<code> [43]  }</code>
</div>
<code class="header" id="listing_273">#.Laguntza.Laguntza.ExecEmbeddedFns &mdash; 97%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←ExecEmbeddedFns(md name)</code>
<code> [1]  ⍝ Mask code and then search for function calls.</code>
<code> [2]  ⍝ `md` is Markdown.</code>
<code> [3]  ⍝ `name` is the fully qualified name of the variable representing the help page.</code>
<code> [4]  ⍝ These are between `⍎⍎` and `⍎⍎`</code>
<code> [5]   r←1↓↑,/(⎕UCS 13),¨md</code>
<code> [6]   mask←GetMaskForCode r</code>
<code> [7]   ind←'[^⍎]⍎⍎⍎[^⍎]'⎕S 0⍠('EOL' 'CR')('Mode' 'M')⊣' ',(mask\mask/r),' '</code>
<code> [8]   :If 0=≢ind</code>
<code> [9]       r←md</code>
<code> [10]  :Else</code>
<code> [11]      ind←⊖0 3+[1]((⌊(≢ind)÷2),2)⍴ind</code>
<code> [12]      ind[;1]-←ind[;0]</code>
<code> [13]      :For start length :In ↓ind</code>
<code> [14]          r←start⌽r</code>
<code> [15]          fnsCall←3↓¯3↓length↑r</code>
<code> [16]          calledFrom←¯1↓↑'.'A.SplitPath name</code>
<code> [17]          noOf←+/∧\fnsCall∊'#.'</code>
<code> [18]          calledFrom←⍎calledFrom,((0&lt;noOf)/'.'),¯1↓noOf↑fnsCall</code>
<code> [19]          fnsCall←noOf↓fnsCall</code>
<code> [20]          :If '.'∊fnsCall</code>
<code> [21]              (p1 p2)←'.'A.SplitPath fnsCall</code>
<code> [22]              calledFrom←⍎(⍕calledFrom),'.',¯1↓{⍵↓⍨3×'⍎⍎⍎'≡3↑⍵}p1~⎕UCS 13</code>
<code> [23]              fnsCall←p2</code>
<code> [24]          :EndIf</code>
<code> [25]          :If 0≠≢arg←{⍵↓⍨⌊/⍵⍳' ''[({'}fnsCall</code>
<code> [26]              fnsCall←(-≢arg)↓fnsCall</code>
<code> [27]          :EndIf</code>
<code> [28]          :If 3=calledFrom.⎕NC fnsCall</code>
<code> [29]              fns←calledFrom⍎fnsCall</code>
<code> [30]              :If 0=≢arg</code>
<code> [31]                  result←fns name</code>
<code> [32]              :Else</code>
<code> [33]                  result←arg fns name</code>
<code> [34]              :EndIf</code>
<code> [35]              :If 2=≡result</code>
<code class="emphasize">→[36]                  result←1↓↑,/(⎕UCS 13),¨result</code>
<code> [37]              :EndIf</code>
<code> [38]          :Else</code>
<code> [39]              result←'INVALID FUNCTION CALL: ',fnsCall</code>
<code> [40]          :EndIf</code>
<code> [41]          r←(-start)⌽result,length↓r</code>
<code> [42]      :EndFor</code>
<code> [43]      r←(⎕UCS 13)A.Split r</code>
<code> [44]  :EndIf</code>
</div>
<code class="header" id="listing_274">#.Laguntza.Laguntza.GUI.CreateIndex &mdash; 97%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateIndex←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]  </code>
<code> [4]       ∆←⊂'Label'</code>
<code> [5]       ∆,←⊂'Caption' '&amp;Type in the keyword to find:     ' ⍝ Don't delete the blanks! Field gets too small otherwise for unknown reasons</code>
<code> [6]       ∆,←⊂'Posn'(5 6)</code>
<code> [7]       ∆,←⊂'Attach'('Top' 'Left' 'Top' 'Right')</code>
<code> [8]       n.indexKeyword_label←⍎'L_IndexKeyword'n.index_sf.⎕WC ∆</code>
<code> [9]  </code>
<code> [10]      ∆←⊂'Edit'</code>
<code> [11]      ∆,←⊂'Posn'((1+0⊃AddPosnAndSizeFor n.indexKeyword_label),3)</code>
<code> [12]      ∆,←⊂'Size'(⍬(n.index_sf.Size[1]-6))</code>
<code> [13]      ∆,←⊂'Attach'('Top' 'Left' 'Top' 'Right')</code>
<code> [14]      n.indexKeyword←⍎'IndexKeyword'n.index_sf.⎕WC ∆</code>
<code> [15]      n.indexKeyword.onKeyPress←'OnKeyPressInIndexKeyword'∆Ref</code>
<code> [16]      n.indexKeyword.on9999←'On9999InIndexKeyword'∆Ref</code>
<code> [17] </code>
<code> [18]      ∆←⊂'ListView'</code>
<code> [19]      ∆,←⊂'Posn'((16+0⊃AddPosnAndSizeFor n.indexKeyword),3)</code>
<code> [20]      ∆,←⊂'Size'(n.index_sf.Size-(21+0⊃AddPosnAndSizeFor n.indexKeyword),6)</code>
<code> [21]      ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [22]      ∆,←⊂'FullRowSelect' 1</code>
<code> [23]      ∆,←⊂'View' 'Report'</code>
<code> [24]      ∆,←⊂'ColTitles'('Keyword' 'Page title' 'Location')</code>
<code> [25]      ∆,←⊂'Font'∆Ref.n.indexFont</code>
<code> [26]      n.indexList←⍎'list'n.index_sf.⎕WC ∆</code>
<code> [27]      n.indexList.onItemUp←FullPathToHandler'##.Index.OnHitSelectedIndex'</code>
<code> [28]      n.indexList.on9999←FullPathToHandler'##.Index.OnHitSelectedIndex'</code>
<code> [29]      n.indexList.onKeyPress←FullPathToHandler'##.Index.OnKeyPressInIndex'∆Ref</code>
<code> [30]      n.indexList.onContextMenu←FullPathToHandler'##.Index.OnContextMenu'</code>
<code> [31]      n.indexList.on9998←(FullPathToHandler'OnDelayedUpdate')n.indexList</code>
<code> [32]      0=∆Ref.p.userMode:⍬</code>
<code class="emphasize">→[33]      ⍬</code>
<code> [34]  }</code>
</div>
<code class="header" id="listing_275">#.Laguntza.Laguntza.GUI.CreateTabs &mdash; 97%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateTabs←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]  </code>
<code> [4]       ∆←⊂'TabControl'</code>
<code> [5]       ∆,←⊂'Size'((⍵.Size[0]-70),300)</code>
<code> [6]       ∆,←⊂'Posn'(0 0)</code>
<code> [7]       ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Left')</code>
<code> [8]       n.tabControl←⍎'reg'n.form.⎕WC ∆</code>
<code> [9]  </code>
<code> [10]      ∆←⊂'TabButton'</code>
<code> [11]      ∆,←⊂'Caption' 'Contents'</code>
<code> [12]      n.tabBtns←n.contents←⍎'tv'n.tabControl.⎕WC ∆</code>
<code> [13] </code>
<code> [14]      ∆←⊂'Subform'</code>
<code> [15]      ∆,←⊂'TabObj'n.contents</code>
<code> [16]      ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [17]      ∆,←⊂'EdgeStyle' 'Dialog'</code>
<code> [18]      n.tabs←n.contents_sf←⍎'sf_tv'n.tabControl.⎕WC ∆</code>
<code> [19] </code>
<code> [20]      ∆←⊂'TabButton'</code>
<code> [21]      ∆,←⊂'Caption' 'Search'</code>
<code> [22]      n.tabBtns,←n.search←⍎'search'n.tabControl.⎕WC ∆</code>
<code> [23] </code>
<code> [24]      ∆←⊂'Subform'</code>
<code> [25]      ∆,←⊂'TabObj'n.search</code>
<code> [26]      ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [27]      ∆,←⊂'EdgeStyle' 'Dialog'</code>
<code> [28]      n.tabs,←n.search_sf←⍎'sf_search'n.tabControl.⎕WC ∆</code>
<code> [29] </code>
<code> [30]      ∆←⊂'TabButton'</code>
<code> [31]      ∆,←⊂'Caption' 'Index'</code>
<code> [32]      n.tabBtns,←n.index←⍎'index'n.tabControl.⎕WC ∆</code>
<code> [33] </code>
<code> [34]      ∆←⊂'Subform'</code>
<code> [35]      ∆,←⊂'TabObj'n.index</code>
<code> [36]      ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [37]      ∆,←⊂'EdgeStyle' 'Dialog'</code>
<code> [38]      n.tabs,←n.index_sf←⍎'sf_index'n.tabControl.⎕WC ∆</code>
<code> [39] </code>
<code> [40]      n.OrigSize←n.tabControl.Size ⍝ Remember size (Visibility can be toggled!)</code>
<code> [41]      ⎕NQ n.contents'Select'</code>
<code class="emphasize">→[42]      ⍬</code>
<code> [43] ⍝ Creates the tabs for the tree, search and index</code>
<code> [44]  }</code>
</div>
<code class="header" id="listing_276">#.Laguntza.Laguntza.GUI.CreateSearch &mdash; 99%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>   CreateSearch←{</code>
<code> [1]        ∆Ref←⍵</code>
<code> [2]        um←∆Ref.p.userMode         ⍝ is 1 if running in user mode</code>
<code> [3]        n←∆Ref.n</code>
<code> [4]        ref←n.search_sf</code>
<code> [5]   </code>
<code> [6]        ∆←⊂'Label'</code>
<code> [7]        ∆,←⊂'Caption' 'Search for:'</code>
<code> [8]        ∆,←⊂'Posn'(5 10)</code>
<code> [9]        ∆,←⊂'Attach'(4⍴'Top' 'Left')</code>
<code> [10]       rf2←⍎'l'ref.⎕WC ∆</code>
<code> [11]  </code>
<code> [12]       ∆←⊂'Combo'</code>
<code> [13]       ∆,←⊂'Items'∆Ref.d.searchString</code>
<code> [14]       ∆,←⊂'Style' 'DropEdit'</code>
<code> [15]       ∆,←⊂'Posn'((0⊃AddPosnAndSizeFor rf2),5)</code>
<code> [16]       ∆,←⊂'Size'(⍬(ref.Size[1]-60))</code>
<code> [17]       ∆,←⊂'SelItems'({0∊⍵:⍬ ⋄ ⍵↑1}≢∆Ref.d.searchString)</code>
<code> [18]       ∆,←⊂'Event' 'KeyPress'(FullPathToHandler'##.Search.OnKeyPressInCombo')</code>
<code> [19]       ∆,←⊂'Event' 9999(FullPathToHandler'##.Search.On9999')</code>
<code> [20]       ∆,←⊂'Attach'('Top' 'Left' 'Top' 'Right')</code>
<code> [21]       n.searchString←⍎'e'ref.⎕WC ∆</code>
<code> [22]  </code>
<code> [23]       ∆←⊂'Button'</code>
<code> [24]       ∆,←⊂'Caption' ' &amp;Go '</code>
<code> [25]       ∆,←⊂'Posn'((n.searchString.Posn[0]),ref.Size[1]-45)</code>
<code> [26]       ∆,←⊂'Size'(22 40)</code>
<code> [27]       ∆,←⊂'Active'(0≠≢,∆Ref.d.searchString)</code>
<code> [28]       ∆,←⊂'Event' 'Select'(FullPathToHandler'##.Search.OnSearch')</code>
<code> [29]       ∆,←⊂'Attach'(4⍴'Top' 'Right')</code>
<code> [30]       n.searchBtn←⍎'search'ref.⎕WC ∆</code>
<code> [31]  </code>
<code> [32]       ∆←⊂'Button'</code>
<code> [33]       ∆,←⊂'Caption' 'Ignore case'</code>
<code> [34]       ∆,←⊂'Style' 'Check'</code>
<code> [35]       ∆,←⊂'State' 1</code>
<code> [36]       ∆,←⊂'Posn'((10+0⊃AddPosnAndSizeFor n.searchBtn),5)</code>
<code> [37]       ∆,←⊂'Attach'(4⍴'Top' 'Left')</code>
<code> [38]       ∆,←⊂'Tip' 'If this is ticked, "A" and "a" are considered the same'</code>
<code> [39]       ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [40]       n.ignoreCaseFlag←⍎'c'ref.⎕WC ∆</code>
<code> [41]  </code>
<code> [42]       ∆←⊂'Button'</code>
<code> [43]       ∆,←⊂'Caption' 'Whole word(s) only'</code>
<code> [44]       ∆,←⊂'Style' 'Check'</code>
<code> [45]       ∆,←⊂'Posn'((0⊃AddPosnAndSizeFor n.ignoreCaseFlag),5)</code>
<code> [46]       ∆,←⊂'Attach'(4⍴'Top' 'Left')</code>
<code> [47]       ∆,←⊂'Tip'('Interprets "Search for" as a word - or a list of words - and tries to find them')</code>
<code> [48]       ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [49]       ∆,←⊂'State' 1</code>
<code> [50]       n.matchWholeWord←⍎'mhw'ref.⎕WC ∆</code>
<code> [51]  </code>
<code> [52]       ∆←⊂'Button'</code>
<code> [53]       ∆,←⊂'Caption' 'Search as entered'</code>
<code> [54]       ∆,←⊂'Style' 'Check'</code>
<code> [55]       ∆,←⊂'Posn'((0⊃AddPosnAndSizeFor n.matchWholeWord),5)</code>
<code> [56]       ∆,←⊂'Attach'(4⍴'Top' 'Left')</code>
<code> [57]       ∆,←⊂'Tip'('Tries to find the contents of "Search for" as it was entered.' 'This can take some time in case the number of help pages is large!')</code>
<code> [58]       ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [59]       ∆,←⊂'State' 0</code>
<code> [60]       n.searchAsIs←⍎'mhw'ref.⎕WC ∆</code>
<code> [61]       n.searchAsIs.onSelect←'OnSearchAsIs'</code>
<code> [62]  </code>
<code> [63]       ∆←⊂'Group'</code>
<code> [64]       ∆,←⊂'Caption' 'Search'</code>
<code> [65]       ∆,←⊂'Posn'((5+0⊃AddPosnAndSizeFor n.searchBtn),165)</code>
<code> [66]       ∆,←⊂'Size'(70 120)</code>
<code> [67]       ∆,←⊂'Attach'(4⍴'Top' 'Left')</code>
<code> [68]       n.searchParms←⍎'R1'ref.⎕WC ∆</code>
<code> [69]  </code>
<code> [70]       ∆←⊂'Button'</code>
<code> [71]       ∆,←⊂'Caption' '&amp;Full-text'</code>
<code> [72]       ∆,←⊂'Style' 'Radio'</code>
<code> [73]       ∆,←⊂'Posn'(20 5)</code>
<code> [74]       ∆,←⊂'Attach'(4⍴'Top' 'Left')</code>
<code> [75]       ∆,←⊂'Tip'('"Whole words": all paragraphs are scanned but code is ignored' '"Search as entered": everything is searched')</code>
<code> [76]       ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [77]       ∆,←⊂'State' 0</code>
<code> [78]       n.fullTextSearchFlag←⍎'R1'n.searchParms.⎕WC ∆</code>
<code> [79]  </code>
<code> [80]       ∆←⊂'Button'</code>
<code> [81]       ∆,←⊂'Caption' 'Tree titles &amp;only'</code>
<code> [82]       ∆,←⊂'Style' 'Radio'</code>
<code> [83]       ∆,←⊂'Posn'(45 5)</code>
<code> [84]       ∆,←⊂'Attach'(4⍴'Top' 'Left')</code>
<code> [85]       ∆,←⊂'Tip' 'Scans just the topic titles as shown in the tree'</code>
<code> [86]       ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [87]       ∆,←⊂'State' 1</code>
<code> [88]       n.titleOnlySearchFlag←⍎'R2'n.searchParms.⎕WC ∆</code>
<code> [89]  </code>
<code> [90]       ∆←⊂'ListView'</code>
<code> [91]       ∆,←⊂'Posn'((10+0⊃AddPosnAndSizeFor n.searchParms)5)</code>
<code> [92]       ∆,←⊂'Size'(10⌈ref.Size-(15+↑AddPosnAndSizeFor n.searchParms)10)</code>
<code> [93]       ∆,←⊂'View' 'Report'</code>
<code> [94]       ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [95]       ∆,←⊂'ColTitles'('Topic' 'Location')</code>
<code> [96]       ∆,←⊂'FullRowSelect' 1</code>
<code> [97]       ∆,←⊂'Event' 'ItemUp'(FullPathToHandler'##.Search.OnHitSelected')</code>
<code> [98]       ∆,←⊂'Event' 9999(FullPathToHandler'##.Search.OnHitSelected')</code>
<code> [99]       ∆,←⊂'Event' 'KeyPress'(FullPathToHandler'##.Search.OnKeyPress')∆Ref</code>
<code> [100]      ∆,←⊂'Event' 'ColumnClick'(FullPathToHandler'##.Search.OnColClick')</code>
<code> [101]      ∆,←⊂'Event' 'ContextMenu'(FullPathToHandler'##.Search.OnContextMenu')</code>
<code> [102]      ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [103]      n.reportList←⍎'list'ref.⎕WC ∆</code>
<code> [104]      _←n.reportList ⎕WS'Event' 9998(FullPathToHandler'##.GUI.OnDelayedUpdate')n.reportList</code>
<code> [105]      0=∆Ref.p.userMode:⍬</code>
<code class="emphasize">→[106]      ⍬</code>
<code> [107] ⍝ Creates the tab for the "Find" dialog</code>
<code> [108]  }</code>
</div>
<code class="header" id="listing_277">#.Laguntza.Laguntza.A &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←A</code>
<code> [1]  ⍝ Returns a ref pointing to APLTreeUtils.</code>
<code> [2]  ⍝ Used only in case a function in ⎕THIS is called</code>
<code> [3]  ⍝ that is NOT one of the Run* functions: they all establish</code>
<code> [4]  ⍝ a reference "A" which is localized in that Run*-function.</code>
<code> [5]  ⍝ When ∆Ref is visible from this function then it uses</code>
<code> [6]  ⍝ ∆Ref.A; that will be much faster than searching for</code>
<code> [7]  ⍝ APLTreeUtils whenever `A` is referred to.</code>
<code> [8]   :If 9=⎕NC'∆Ref'</code>
<code> [9]       r←∆Ref.A</code>
<code> [10]  :Else</code>
<code> [11]      r←APLTreeUtils2</code>
<code> [12]  :EndIf</code>
</div>
<code class="header" id="listing_278">#.Laguntza.Laguntza.AddToHistory &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  AddToHistory←{</code>
<code> [1]       ∆Ref←⍺</code>
<code> [2]       (n d)←∆Ref.(n d)</code>
<code> [3]       in←↑⍵                                  ⍝ Fist item number</code>
<code> [4]       d.history,⍨←(in≠0⊃d.history)/in        ⍝ Append item no in front if not already there (back!)</code>
<code> [5]       n.backBtn.Active←1&lt;d.history⍳¯1        ⍝ Make "Back" active/inactive</code>
<code> [6]       n.forwardBtn.Active←¯1≠¯1↑d.history    ⍝ Make "Forward" active/inactive</code>
<code> [7]       ⍬</code>
<code> [8]  ⍝ The "history" vars contains the number of all pages</code>
<code> [9]  ⍝ It's very first entry is ¯1 which is used to determine the</code>
<code> [10] ⍝ "end" of the queue. Important for working out when "Back" or</code>
<code> [11] ⍝ "Forward" can't work anymore.</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_279">#.Laguntza.Laguntza.AddToTopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref AddToTopicProperties(name parent)</code>
<code> [1]  ⍝ Adds "name" to ∆TopicProperties if that exists in `parent` at all.</code>
<code> [2]   r←⍬</code>
<code> [3]   :If r←3=⎕NC(⍕parent),'.∆TopicProperties'</code>
<code> [4]       result←⍎(⍕parent),'.∆TopicProperties ⍬'</code>
<code> [5]       ci←GetCurrentItem ∆Ref.n       ⍝ current item (new page "name" goes AFTER that)</code>
<code> [6]       cin←ci⊃∆Ref.n.tree.Items       ⍝ current item name</code>
<code> [7]       ind←1+GetTopicIndexFromCaption cin result</code>
<code> [8]       title←HTML.GetTitle⍎(⍕parent),'.',name</code>
<code> [9]       title←(name≡{0=+/b←' '=w←⍵:w ⋄ (b/w)←'_' ⋄ w}title)⊃title''</code>
<code> [10]      title~←'`'</code>
<code> [11]      result←(ind↑result)⍪(name title 1 0)⍪ind↓result</code>
<code> [12]      body←⍪GetTopicPropertyTemplate ⍬</code>
<code> [13]      body⍪←⍪ReformatTopicPropertyResult result</code>
<code> [14]      parent.⎕FX,body</code>
<code> [15]      ∆Ref TellLinkAboutChange parent</code>
<code> [16]  :EndIf</code>
</div>
<code class="header" id="listing_280">#.Laguntza.Laguntza.AllowContinueWS &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> AllowContinueWS←{1:shy←2704⌶1}</code>
</div>
<code class="header" id="listing_281">#.Laguntza.Laguntza.AllowedChars &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> AllowedChars←{</code>
<code> [1]      '_∆',⎕D,⎕A,⎕C ⎕A</code>
<code> [2]  }</code>
</div>
<code class="header" id="listing_282">#.Laguntza.Laguntza.Alpha &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Alpha</code>
<code> [1]  r←' #ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789',[-0.2]' #abcdefghijklmnopqrstuvwxyz0123456789'</code>
</div>
<code class="header" id="listing_283">#.Laguntza.Laguntza.AreThereNoBookmarksYet &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> AreThereNoBookmarksYet←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      A←∆Ref.d.A</code>
<code> [3]      'i'∊↑¨A.Last∘⍕¨⎕WN ∆Ref.n.bookmarkMenu     ⍝ Bookmark items start their names with an "i"</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_284">#.Laguntza.Laguntza.BuildDocFromAllPages &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  BuildDocFromAllPages←{</code>
<code> [1]       ⍺←0</code>
<code> [2]       ∆Ref←⍵</code>
<code> [3]       ∆Ref.∆ReportToSession←⍺                    ⍝ 1 = don't report problems with links to the session</code>
<code> [4]       A←∆Ref.d.A</code>
<code> [5]       _←ShowEggTimer ∆Ref</code>
<code> [6]       ∆Ref.n.PB←ProgressbarCreate ∆Ref</code>
<code> [7]       _←⎕DL 0.5                                  ⍝ Otherwise the status bar never becomes visible</code>
<code> [8]       fs←2                                       ⍝ Font size</code>
<code> [9]       l←∆Ref GetVarsName ∆Ref.d.tree[;I.Row]     ⍝ List of help pages</code>
<code> [10]      doc←GetAllHtmlFromFile ∆Ref</code>
<code> [11]      doc←l{(1↑⍵),(⊂'&lt;p class="fns_name"&gt;',⍺,'&lt;/p&gt;'),1↓⍵}¨doc</code>
<code> [12]      doc,¨←⊂⊂'&lt;hr/&gt;'</code>
<code> [13]      doc←⊃,/doc</code>
<code> [14]      cssFlag←1</code>
<code> [15]      doc←(HTML.MakeCssForDoc HTML.HtmlTopCode fs'Help Pages'cssFlag),doc</code>
<code> [16]      tf←GetTempFilename'html'</code>
<code> [17]      _←(⊂doc)FilesAndDirs.NPUT tf 1</code>
<code> [18]      _←∆Ref SetInfoText''</code>
<code> [19]      _←∆Ref.n.PB.Close</code>
<code> [20]      _←RemoveEggTimer ∆Ref</code>
<code> [21]      tf</code>
<code> [22] ⍝ Creates HTML code representing a complete document by default.</code>
<code> [23] ⍝ Returns the name of the (temp) file with the HTML.</code>
<code> [24]  }</code>
</div>
<code class="header" id="listing_285">#.Laguntza.Laguntza.BuildHelpTree &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  BuildHelpTree←{</code>
<code> [1]  ⍝ Returns the (properly sorted) tree for all active help nodes.</code>
<code> [2]       ⍺←0                                        ⍝ Level</code>
<code> [3]       0=≢r←↓⍺ CollectChildren ⍵:r</code>
<code> [4]       (0=≢l←(5⊃¨r){⍵/⍨⍺{9=↑⍺.⎕NC ⍵}¨⍵}1⊃¨r):r</code>
<code> [5]       b←9=↑∘⍵.⎕NC¨1⊃¨r</code>
<code> [6]       rl←⍵.⍎¨l                                   ⍝ References</code>
<code> [7]       buf←(⍺+1)∇¨rl                              ⍝ Recursive call</code>
<code> [8]       (b/r)←(⊂¨b/r),¨buf                         ⍝ Preserve proper sort order</code>
<code> [9]       ⊃,/r{(⊂⍣⍵)⍺}¨~b</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_286">#.Laguntza.Laguntza.CR &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←CR</code>
<code> [1]  r←⎕UCS 13</code>
</div>
<code class="header" id="listing_287">#.Laguntza.Laguntza.CheckBookmarkButton &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckBookmarkButton←{</code>
<code> [1]       ∆Ref←⍺</code>
<code> [2]       in←⍵</code>
<code> [3]       n←∆Ref.n</code>
<code> [4]       flag←~(⊂∆Ref.d.tree[in;I.(Parent TopicName)])∊∆Ref.d.bookmark ⍝ Not already bookmarked?</code>
<code> [5]       n.bookmarkBtn.Active←flag      ⍝ The Bookmark button</code>
<code> [6]       n.addBookmark.Active←flag      ⍝ Handle the "Add bookmark" menu item</code>
<code> [7]       flag←~flag                     ⍝ Already bookmarked?</code>
<code> [8]       n.delBookmark.Active←flag      ⍝ Handle the "Del bookmark" menu item</code>
<code> [9]       flag←AreThereNoBookmarksYet ∆Ref  ⍝ Is there are any bookmark at all?</code>
<code> [10]      n.delAllBookmarks.Active←flag  ⍝ Handle the "Del all bookmarks" menu item</code>
<code> [11]      ⍬</code>
<code> [12] ⍝ Makes the "Bookmark" toolbutton as well as the "Bookmark" menu item(s)</code>
<code> [13] ⍝ active/inactive depending on the circumstances</code>
<code> [14]  }</code>
</div>
<code class="header" id="listing_288">#.Laguntza.Laguntza.CheckCompileFiles &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CheckCompileFiles←{</code>
<code> [1]  ⍝ Check the file. Returns 0 if it is okay and 1 otherwise.</code>
<code> [2]      ps←⍵</code>
<code> [3]      0≠{22::1 ⋄ 0⊣⎕FUNTIE ⍵ ⎕FSTIE 0}ps.folderName,'\',File.GetHelpFileName</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_289">#.Laguntza.Laguntza.CheckItemTitle &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckItemTitle←{</code>
<code> [1]       rf←⍺</code>
<code> [2]       table←⍵</code>
<code> [3]       b←0=≢¨table[;2]</code>
<code> [4]       (0=+/b):table</code>
<code> [5]       table[⍸b;2]←PolishName¨b⌿table[;1]</code>
<code> [6]       table</code>
<code> [7]  ⍝ Take a table (typically delivered by ∆TopicProperties) and checks whether "title" is set.</code>
<code> [8]  ⍝ If it's not then the (polished) name is used as title.</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_290">#.Laguntza.Laguntza.CheckParms &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckParms←{</code>
<code> [1]       ps←⍵</code>
<code> [2]       0=≢ps.helpCaption:'"helpCaption" not found'⎕SIGNAL 6</code>
<code> [3]       ps.trapErrors←(ps.trapErrors≡¯1)⊃ps.(trapErrors userMode)</code>
<code> [4]       ps.expand{(0=≢⍺):'Level1' ⋄ ⍺}←⍬</code>
<code> [5]       ps.reportToSession{⍺≡¯1:⍵ ⋄ ⍺}←~ps.isRuntime</code>
<code> [6]       (,¯1)≢,ps.folderName:ps</code>
<code> [7]       rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code> [8]       ps.folderName←(2 ⎕NQ'#' 'GetEnvironment' 'Temp'),'\',{⍵↑⍨⍵⍳'.'}rf.GetTempName</code>
<code> [9]       ps</code>
<code> [10] ⍝ Checks and possibly modifies a number of items in the parameter space</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_291">#.Laguntza.Laguntza.CloseGui &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CloseGui←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      ∆Ref.p.noClose:⍬⊣∆Ref.p.visible←∆Ref.Visible←0</code>
<code> [3]      6::⍬</code>
<code> [4]      ⍬⊣⎕NQ ∆Ref.n.form'Close'</code>
<code> [5] ⍝ Calls the "Close" method of the GUI, if any: might have disappeared at this stage already.</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_292">#.Laguntza.Laguntza.CollectChildren &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{depth}CollectChildren NS</code>
<code> [1]  ⍝ Takes a ref pointing to a namespace as right argument.</code>
<code> [2]  ⍝ Tries to find ∆TopicProperties and executes it if it exists.</code>
<code> [3]  ⍝ If it cannot find ∆TopicProperties it compiles a table with default values.</code>
<code> [4]  ⍝ It also checks whether there is a function ∆DefaultPage. If that's the</code>
<code> [5]  ⍝ case then this function will represent the NS as such instead of the</code>
<code> [6]  ⍝ page otherwise one is created on the fly carrying just links.</code>
<code> [7]  ⍝ ⍺ is, when specified, the level in the tree view. It defaults to 0.</code>
<code> [8]   depth←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'depth'</code>
<code> [9]   r←''</code>
<code> [10]  :If 0&lt;NS.⎕NC'∆TopicProperties'</code>
<code> [11]      r←(NS CheckItemTitle DropUnwanted depth{(0=≢⍺):⍵ ⋄ ⍺,⍵}NS.⍎'∆TopicProperties ⍬'),NS</code>
<code> [12]  :Else</code>
<code> [13]      list1←' '~¨⍨↓NS.⎕NL 2</code>
<code> [14]      list1←list1[Alpha⍋⊃list1]</code>
<code> [15]      :If 0&lt;≢list2←' '~¨⍨↓NS.⎕NL 9.1</code>
<code> [16]      :AndIf 0&lt;≢list2←(NS{((⍕⍺),'.',⍵)≡ShowDisplayFormat ⍺.⍎⍵}¨list2)/list2  ⍝ Remove all refs)</code>
<code> [17]          list2←list2[Alpha⍋⊃list2]</code>
<code> [18]      :EndIf</code>
<code> [19]      list←list1,list2</code>
<code> [20]      list←(~(↑¨list)∊¨⊂'∆_')⌿list</code>
<code> [21]      r←(depth{(0=≢⍺):⍵ ⋄ ⍺,⍵}⊃{(⊂⍵),(⊂PolishName ⍵),1 0}¨list),NS   ⍝ name, caption, active, dev only, ref</code>
<code> [22]  :EndIf</code>
</div>
<code class="header" id="listing_293">#.Laguntza.Laguntza.CollectData &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←CollectData ∆Ref</code>
<code> [1]  ⍝ See also UpdateFileData</code>
<code> [2]   r←⍬</code>
<code> [3]   p←∆Ref.p</code>
<code> [4]   tree←CreateTree p</code>
<code> [5]   ∆Ref.d.tree←tree</code>
<code> [6]   {}∆Ref ReportProblem p tree</code>
<code> [7]   markdown←∆Ref GetMarkdownVarsContent¨↓tree[;I.(TopicName Parent)]</code>
<code> [8]   (Words words)←{0=≢⍵:'' '' ⋄ ↓⍉⍵}⊃GetWordsFromMarkdown¨markdown</code>
<code> [9]   X←HTML.CreateParameterSpace ∆Ref</code>
<code> [10]  markdown←X ProcessLinks(⍳≢markdown)markdown</code>
<code> [11]  html←∆Ref Markdown2HTML markdown</code>
<code> [12]  {}∆Ref SaveAllHtml html</code>
<code> [13]  indices←GetIndicesFromMarkdown¨markdown</code>
<code> [14]  indices←Index.GetIndices indices ∆Ref ∆Ref.d.tree</code>
<code> [15]  tree[;I.Parent]←⍕¨tree[;I.Parent] ⍝ MUST be text when written to a component file: see Dyalog bug &lt;01157&gt;</code>
<code> [16]  {}tree ⎕FREPLACE ∆Ref.f.(tieNo ∆tree)</code>
<code> [17]  {}words ⎕FREPLACE ∆Ref.f.(tieNo ∆words)</code>
<code> [18]  {}Words ⎕FREPLACE ∆Ref.f.(tieNo ∆Words)</code>
<code> [19]  {}indices ⎕FREPLACE ∆Ref.f.(tieNo ∆index)</code>
<code> [20]  {}∆Ref.p.helpCaption ⎕FREPLACE ∆Ref.f.(tieNo ∆caption)</code>
<code> [21]  SaveHelpParms ∆Ref</code>
<code> [22] ⍝Done</code>
</div>
<code class="header" id="listing_294">#.Laguntza.Laguntza.CollectHelpPages &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> (list allPages)←CollectHelpPages ∆Ref</code>
<code> [1]  list←↑¨{(⍕⍺),'.',⍵}/¨↓∆Ref.d.tree[;4 1]</code>
<code> [2]  noOf←¯10+-/⌽2↑⎕FSIZE ∆Ref.f.tieNo</code>
<code> [3]  allPages←⎕FREAD ∆Ref.f.tieNo(1+10+⍳noOf)</code>
<code> [4]  allPages←{'&lt;[^&gt;]*.?&gt;'⎕R''⊣⍵}¨allPages</code>
<code> [5] ⍝Done</code>
</div>
<code class="header" id="listing_295">#.Laguntza.Laguntza.Compile &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  Compile←{</code>
<code> [1]  ⍝ Recompile Help file, for example after an edit or insert or delete operation, or when</code>
<code> [2]  ⍝ the developer called "Compile..." from the "Developer" menu.</code>
<code> [3]       ∆Ref←⍵</code>
<code> [4]       _←∆Ref.⎕EX'∆NamespaceTree'</code>
<code> [5]       ∆Ref.∆NamespaceTree←ListNamespaceTree ⍬</code>
<code> [6]       in←GetCurrentItem ∆Ref.n</code>
<code> [7]       _←∆Ref SetInfoText'Compiling the help, please wait...'</code>
<code> [8]       _←∆Ref SetInfoBCol ∆Ref.p.statusbarAlarmColor</code>
<code> [9]       _←{0=∆Ref.⎕NC'n':⍬ ⋄ ∆Ref.n.infoSB.BCol←⍵}∆Ref.p.statusbarAlarmColor</code>
<code> [10]      _←ShowEggTimer ∆Ref</code>
<code> [11]      _←∆Ref SetVisibleForTreeAndIndexTab 0</code>
<code> [12]      _←CompileHelpFile ∆Ref</code>
<code> [13]      ∆Ref.d.tree←File.OpenFilesAndGetTree ∆Ref</code>
<code> [14]      _←PopulateGUI ∆Ref</code>
<code> [15]      _←¯1 Display ∆Ref in</code>
<code> [16]      _←∆Ref SetVisibleForTreeAndIndexTab 1</code>
<code> [17]      ⍬⊣∆Ref SetInfoText''</code>
<code> [18]  }</code>
</div>
<code class="header" id="listing_296">#.Laguntza.Laguntza.CopyAndMassageCSSfiles &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←CopyAndMassageCSSfiles ∆Ref</code>
<code> [1]   r←⍬</code>
<code> [2]   home←FilesAndDirs.ExpandPath GetHome'\Assets\CSS'</code>
<code> [3]   target←FilesAndDirs.ExpandPath ∆Ref.p.folderName,'\Assets\CSS'</code>
<code> [4]  </code>
<code> [5]   filename←'screen.css'</code>
<code> [6]   css←0⊃FilesAndDirs.NGET home,'/',filename</code>
<code> [7]   css←'&lt;&lt;max-width&gt;&gt;'⎕R ∆Ref.p.maxWidth⍠('Greedy' 0)⊣css</code>
<code> [8]   css←'&lt;&lt;font-size&gt;&gt;'⎕R ∆Ref.p.screenFontSize⍠('Greedy' 0)⊣css</code>
<code> [9]   'CREATE!'FilesAndDirs.CheckPath target</code>
<code> [10]  css FilesAndDirs.NPUT(target,'/',filename)1</code>
<code> [11] </code>
<code> [12]  filename←'print.css'</code>
<code> [13]  css←0⊃FilesAndDirs.NGET home,'/',filename</code>
<code> [14]  css←'&lt;&lt;font-size&gt;&gt;'⎕R ∆Ref.p.printFontSize⍠('Greedy' 0)⊣css</code>
<code> [15]  css FilesAndDirs.NPUT(target,'/',filename)1</code>
<code> [16] ⍝Done</code>
</div>
<code class="header" id="listing_297">#.Laguntza.Laguntza.CopyImages &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←CopyImages ∆Ref</code>
<code> [1]  r←⍬</code>
<code> [2]  target←∆Ref.p.folderName</code>
<code> [3]  path←GetHome'\Assets/Images'</code>
<code> [4]  (target,'\Assets\')⎕NCOPY⍠('IfExists' 'Replace')⊣path</code>
<code> [5] ⍝Done</code>
</div>
<code class="header" id="listing_298">#.Laguntza.Laguntza.CreateData &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateData←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       ∆Ref.d←∆Ref.⎕NS''</code>
<code> [3]       ∆Ref.d.searchString←''           ⍝ Remembers any search strings during this session</code>
<code> [4]       ∆Ref.d.bookmark←⍬                ⍝ Vector of up to 9 items bookmarked by the user</code>
<code> [5]       ∆Ref.d.history←,¯1               ⍝ Used to remember all pages visited, and which one is current</code>
<code> [6]       ∆Ref.d.lastGoToTopic←''</code>
<code> [7]       ∆Ref.d.A←APLTreeUtils2</code>
<code> [8]       ∆Ref.s←∆Ref.⎕NS''                ⍝ Search parameters. Is coverwritten by GUI settings later on</code>
<code> [9]       ∆Ref.s.searchString←''</code>
<code> [10]      ∆Ref.s.ignoreCase←⍬</code>
<code> [11]      ∆Ref.s.matchWholeWord←⍬</code>
<code> [12]      ∆Ref.s.fullTextSearchFlag←⍬</code>
<code> [13]      ∆Ref.s.searchAsIs←⍬</code>
<code> [14]      1:shy←⍬</code>
<code> [15] ⍝ Create and populate the ∆Ref.d namespace</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_299">#.Laguntza.Laguntza.CreateHelpForm &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateHelpForm←{</code>
<code> [1]  ⍝ Creates a new namespace which later will become a help form</code>
<code> [2]       ps←⍵</code>
<code> [3]       _←{9=⎕NC ⍵:⍬ ⋄ 'HelpForms'⎕THIS.⎕NS''}'HelpForms'</code>
<code> [4]       0=≢l←HelpForms.⎕NL-9:⍎'FORM_00'HelpForms.⎕NS''</code>
<code> [5]       lr←HelpForms.⍎¨ln←HelpForms.⎕NL-9                  ⍝ List of names and refs</code>
<code> [6]       ⍬≢ref←CheckForAlreadyOpen ps lr:ref                ⍝ Check weather this one is already open</code>
<code> [7]       nextNo←↑(⍳99)~⍎¨¯2↑¨ln                             ⍝ Next available free number is...</code>
<code> [8]       ⍎('FORM_',¯2↑'00',⍕nextNo)HelpForms.⎕NS''</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_300">#.Laguntza.Laguntza.CreateTree &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateTree←{</code>
<code> [1]   ⍝ Builds up the tree, saves it in its designated file and returns the tree as result.</code>
<code> [2]       p←⍵</code>
<code> [3]       tree←⊃BuildHelpTree p.source</code>
<code> [4]       tree,←⍳≢tree                       ⍝ The row numbers</code>
<code> [5]       tree←tree[;0 1 2 3 5 6]            ⍝ Drop active flag: at this stage all rows are active</code>
<code> [6]       0=≢tree:'The source namespace is empty!'⎕SIGNAL 11</code>
<code> [7]       fullNames←↑¨{(⍕⍺),'.',⍵}/¨↓tree[;I.(Parent TopicName)] ⍝ Here I.Parent is still a ref!</code>
<code> [8]       fullNames←{3=↑⎕NC ⍵:⍵ ⋄ ⍵,⍵{⍵/⍨3=⎕NC ⍺,⍵}'.∆DefaultPage'}¨fullNames  ⍝ Add ∆DefaultPage if appropriate</code>
<code> [9]       tree,←9=∊⎕NC¨(⍕¨tree[;I.Parent]),¨'.',¨tree[;I.TopicName]  ⍝ Is is a node?</code>
<code> [10]      tree</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_301">#.Laguntza.Laguntza.DeleteTopicOrNode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{testFlag}DeleteTopicOrNode ∆Ref</code>
<code> [1]  ⍝ Deletes either a node (= a namespace and all its contents) or a help topic.</code>
<code> [2]  ⍝ User must re-compile afterwards.</code>
<code> [3]   testFlag←{0=⎕NC ⍵:0 ⋄ ⍎⍵}'testFlag'</code>
<code> [4]   in←GetCurrentItem ∆Ref.n</code>
<code> [5]   (isNode parent name)←∆Ref.d.tree[in;I.(IsNode Parent TopicName)]</code>
<code> [6]   parentName←⍕parent</code>
<code> [7]   :If hasTopicProperties←3=parent.⎕NC'∆TopicProperties'</code>
<code> [8]       title←GetTitleFromTopicProperty parent name</code>
<code> [9]   :Else</code>
<code> [10]      title←name</code>
<code> [11]  :EndIf</code>
<code> [12]  question←('Sure that you want to delete ',(isNode⊃'help topic ' 'node '))('"',title,'"')'?'</code>
<code> [13]  askFns←question∘{∆Ref.p.helpCaption YesOrNo ⍺}</code>
<code> [14]  flag←askFns⍣(↑0=testFlag)⊣1</code>
<code> [15]  :If flag</code>
<code> [16]      fullName←GetParentAndTopicNameAsText ∆Ref.d.tree[in;]</code>
<code> [17]      ∆Ref DeleteAPL_Object fullName</code>
<code> [18]      :If hasTopicProperties</code>
<code> [19]          result←parent.⍎'∆TopicProperties ⍬'</code>
<code> [20]          result⌿⍨←~result[;0]∊⊂name</code>
<code> [21]          body←⍪GetTopicPropertyTemplate ⍬</code>
<code> [22]          body⍪←⍪ReformatTopicPropertyResult result</code>
<code> [23]          ⍎(' '≠1↑0⍴parent.⎕FX,body)/'. ⍝ Deliberate stop: something went wrong'</code>
<code> [24]          ∆Ref TellLinkAboutChange parentName,'.∆TopicProperties'</code>
<code> [25]      :EndIf</code>
<code> [26]      {}Compile ∆Ref</code>
<code> [27]      ∆Ref ShowTopic parentName</code>
<code> [28]  :EndIf</code>
</div>
<code class="header" id="listing_302">#.Laguntza.Laguntza.Display &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {in}←{ev}Display(∆Ref pattern)</code>
<code> [1]  ⍝ Designed to be called when the Help Viewer is already established.</code>
<code> [2]  ⍝ ∆Ref.p.visible defines the visibility of the form.</code>
<code> [3]  ⍝ However, with a 1 as left argument the caller of "Display" can</code>
<code> [4]  ⍝ force the GUI to become visible anyway.</code>
<code> [5]  ⍝ Returns the item number.</code>
<code> [6]   ev←{0=⎕NC ⍵:0 ⋄ ⍎⍵}'ev'              ⍝ 1:enforce visibility, even if p.visibile is 0; ¯1: very first call</code>
<code> [7]   (n p)←∆Ref.(n p)</code>
<code> [8]   pattern←PolishPagePattern pattern</code>
<code> [9]   in←∆Ref GetItemNumberFromPattern pattern</code>
<code> [10]  n.infoSB.BCol←0                      ⍝ Reset status bar color</code>
<code> [11]  :If ((,¯1)≢,in)∧0≠≢in</code>
<code> [12]      in{⍵=⍺:0 ⋄ ⍺}←≢∆Ref.d.tree</code>
<code> [13]      {}∆Ref SelectItemInTreeView in</code>
<code> [14]      _←⎕NQ n.tree 9999                ⍝ Enforce screen update</code>
<code> [15]      ⎕NQ n.tree'Flush'                ⍝ DO NOT call this with a 1 as left argument: won't work!</code>
<code> [16]  :EndIf</code>
<code> [17]  {}∆Ref SetVisible ev{⍺≡1:⍺ ⋄ ⍵}p.visible</code>
<code> [18]  {}RemoveEggTimer ∆Ref</code>
</div>
<code class="header" id="listing_303">#.Laguntza.Laguntza.DisplayParentelInfo &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  DisplayParentelInfo←{</code>
<code> [1]       (∆Ref in)←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]       d←in⌽∆Ref.d.tree[;I.Depth]     ⍝ Depth information</code>
<code> [4]       nsa←+/∧\d[0]≤⌽(-in)↑d          ⍝ No of siblings "above"</code>
<code> [5]       d←(-nsa)⌽d                     ⍝ Embrace siblings "above"</code>
<code> [6]       d←(1++/∧\(1↓d)≥d[0])↑d         ⍝ Cut back to this "family"</code>
<code> [7]       ns←¯1+d[0]+.=d                 ⍝ No of siblings "undernath" (-1 because of itself)</code>
<code> [8]       d←nsa⌽d                        ⍝ Make d[0] current line</code>
<code> [9]       d←(1+(1↓d)⍳d[0])↑d             ⍝ Cut back to this branch</code>
<code> [10]      nc←(d[0]+1)+.=(1+(1↓d)⍳d[0])↑d ⍝ No of children</code>
<code> [11]      tx←(⍕nc),((0=nc)∨1&lt;nc)⊃' child, ' ' children, '</code>
<code> [12]      tx,←(⍕ns),' sibling',(1&lt;ns)/'s'</code>
<code> [13]      ≢n.relSB.Text←tx</code>
<code> [14] ⍝ Display information about siblings &amp; children, but only if tree is visible</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_304">#.Laguntza.Laguntza.DropUnwanted &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> DropUnwanted←{</code>
<code> [1]      tree←⍵</code>
<code> [2]      ⍝ !!!! Don't use I.* here - the "Active" flag has not been removed as of yet!</code>
<code> [3]      tree⌿⍨←tree[;3]                        ⍝ Drop inactive ones</code>
<code> [4]      tree⌿⍨←(0=tree[;4])∨~IsRunTime ⍬       ⍝ Drop any that should appear in Dvlp only</code>
<code> [5]      tree</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_305">#.Laguntza.Laguntza.FindForm &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  FindForm←{</code>
<code> [1]  ⍝ ⍵ is a ref to a child of a Form</code>
<code> [2]  ⍝ Finds the Form and returns its ref</code>
<code> [3]  ⍝ Occasionally this crashes with a DOMAIN ERROR because it's too fast.</code>
<code> [4]  ⍝ In such cases it calls itself recursively with a delay but controls</code>
<code> [5]  ⍝ the number of attempts via the left argument.</code>
<code> [6]       ⍺←¯1</code>
<code> [7]       11::(⍺+1)∇{_←⎕DL 0.2 ⋄ ⍵}⍵</code>
<code> [8]       ⍺=2:. ⍝ Avoid endless loop. Has never ocurred in real life</code>
<code> [9]       (⍵.Type≡'Form'):⍵</code>
<code> [10]      ∇ ⍵.##</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_306">#.Laguntza.Laguntza.FindTopic &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{row}FindTopic(∆Ref pattern)</code>
<code> [1]  ⍝ Accepts a string in different flavours.</code>
<code> [2]  ⍝ The left argument is only needed for a relative link: it then</code>
<code> [3]  ⍝ is the row number from which the link was initiated.</code>
<code> [4]  ⍝ - `text`</code>
<code> [5]  ⍝   Returns the rows of all topics where name ≡ pattern.</code>
<code> [6]  ⍝   If the name cannot be found it looks for the Title.</code>
<code> [7]  ⍝ - `*text`</code>
<code> [8]  ⍝   Text may or may not contain a dot.</code>
<code> [9]  ⍝   "pattern" is compared with all {parent}.{name} from the right.</code>
<code> [10] ⍝ - `↑*text`</code>
<code> [11] ⍝   Same as `*text` but returns just the first hit.</code>
<code> [12] ⍝ - `#.l1.l2.l3.text`</code>
<code> [13] ⍝   Full path</code>
<code> [14] ⍝ - `f3.text` and `##.f2.text` and `##.##.f2.text` and ...</code>
<code> [15] ⍝   Relative links. "row" is needed here.</code>
<code> [16]  A←∆Ref.d.A</code>
<code> [17]  pattern←(-'.∆DefaultPage'{(≢⍺)×⍺≡(-≢⍺)↑⍵}pattern)↓pattern</code>
<code> [18]  tree←∆Ref.d.tree</code>
<code> [19]  :If '*'=↑pattern~'↑'</code>
<code> [20]      buf←GetParentAndTopicNameAsText tree</code>
<code> [21]      in←pattern{(0=≢⍵):⍵ ⋄ (↑⍣(↑'↑'∊⍺))⍵}⍸(⊃(-¯1+≢pattern~'↑')↑¨buf)∧.=1↓pattern~'↑'</code>
<code> [22]  :ElseIf '#.'≡2↑pattern</code>
<code> [23]      buf←GetParentAndTopicNameAsText tree</code>
<code> [24]      in←⍸buf≡¨⊂pattern</code>
<code> [25]  :ElseIf '#'∊pattern</code>
<code> [26]      'Missing left argument'⎕SIGNAL 11/⍨0=⎕NC'row'</code>
<code> [27]      'Invalid left argument'⎕SIGNAL 11/⍨~row∊tree[;I.Row]</code>
<code> [28]      (path1 path2)←'.'A.SplitPath pattern   ⍝ "path2" might point to a function or a namespace</code>
<code> [29]      id←⍕I.Parent⊃tree[row;]</code>
<code> [30]      id,←(∆Ref.d.tree[row;I.IsNode])/'.',I.TopicName⊃tree[row;]</code>
<code> [31]      id,←¯1⌽path1</code>
<code> [32]      :If ⍬≡parent←{6::⍬ ⋄ ⍎⍵}id</code>
<code> [33]          in←⍬</code>
<code> [34]      :Else</code>
<code> [35]          :If 2=parent.⎕NC path2</code>
<code> [36]              in←tree[⍸(GetParentAndTopicNameAsText tree)≡¨⊂(⍕parent),'.',path2;I.Row]</code>
<code> [37]          :Else</code>
<code> [38]              :If 0=+/bool←(tree[;I.Parent])≡¨⊂parent</code>
<code> [39]              :OrIf 0=+/bool2←path2∘≡¨bool⌿tree[;I.TopicName]</code>
<code> [40]                  in←⍬</code>
<code> [41]              :Else</code>
<code> [42]                  in←bool2/bool/tree[;I.Row]</code>
<code> [43]              :EndIf</code>
<code> [44]          :EndIf</code>
<code> [45]      :EndIf</code>
<code> [46]  :Else                       ⍝ Search just the same level</code>
<code> [47]      'Left argument is missing'⎕SIGNAL 6/⍨0=⎕NC'row'</code>
<code> [48]      :If I.IsNode⊃tree[row;]</code>
<code> [49]          bool←((1+row)⍴0),∧\{⍵[0]&lt;1↓⍵}row↓{⍵[;I.Depth]}tree</code>
<code> [50]          t2←bool⌿tree</code>
<code> [51]      :Else</code>
<code> [52]          cl←row⊃tree[;I.Depth]</code>
<code> [53]          bool←(⌽∧\cl≤⌽row↑tree[;I.Depth]),∧\cl≤row↓tree[;I.Depth]</code>
<code> [54]          t2←bool⌿tree</code>
<code> [55]          bool←t2[;I.Depth]=cl+'.'+.=pattern</code>
<code> [56]          t2←bool⌿t2</code>
<code> [57]      :EndIf</code>
<code> [58]      :If '.'∊pattern</code>
<code> [59]          id←⍕I.Parent⊃tree[row;]</code>
<code> [60]          id,←(I.IsNode⊃tree[row;])/'.',I.TopicName⊃tree[row;]</code>
<code> [61]          id,←'.',pattern</code>
<code> [62]          :If 0=+/bool←(GetParentAndTopicNameAsText t2)≡¨⊂id</code>
<code> [63]              in←⍬</code>
<code> [64]          :Else</code>
<code> [65]              in←bool⌿t2[;I.Row]</code>
<code> [66]          :EndIf</code>
<code> [67]      :Else</code>
<code> [68]          :If 0&lt;+/bool←t2[;I.TopicName]≡¨⊂pattern</code>
<code> [69]              in←bool/t2[;I.Row]</code>
<code> [70]          :ElseIf 0&lt;+/bool←(0=tree[;I.Depth])∧tree[;I.TopicName]≡¨⊂pattern</code>
<code> [71]              in←bool/tree[;I.Row]</code>
<code> [72]          :Else</code>
<code> [73]              in←⍬</code>
<code> [74]          :EndIf</code>
<code> [75]      :EndIf</code>
<code> [76]  :EndIf</code>
<code> [77]  :If 0≠≢r←∆Ref.d.tree[,in;I.(Row Parent TopicName)]</code>
<code> [78]      r[;1]←⍕¨r[;1]</code>
<code> [79]  :EndIf</code>
</div>
<code class="header" id="listing_307">#.Laguntza.Laguntza.GetAllHtmlFromFile &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> html←GetAllHtmlFromFile ∆Ref</code>
<code> [1]  noOf←¯10+-/⌽2↑⎕FSIZE ∆Ref.f.tieNo</code>
<code> [2]  html←⎕FREAD ∆Ref.f.tieNo(1+10+⍳noOf)</code>
<code> [3] ⍝Done</code>
</div>
<code class="header" id="listing_308">#.Laguntza.Laguntza.GetCurrentItem &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetCurrentItem←{</code>
<code> [1]      n←⍵</code>
<code> [2]      {⍵&lt;≢n.tree.SelItems:⍵ ⋄ ⎕IO}⍬⍴n.tree.SelItems⍳1</code>
<code> [3] ⍝ Returns the number of the current item as a scalar</code>
<code> [4] ⍝ or ⎕IO if there is no item selected currently.</code>
<code> [5] ⍝ Yes, that DID happen in the past.</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_309">#.Laguntza.Laguntza.GetFullRegPath &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetFullRegPath←{</code>
<code> [1]  ⍝ Returns path to the Windows Registry or empty vector</code>
<code> [2]       ∆Ref←⍵</code>
<code> [3]       0≡∆Ref.p.regPath:''                                   ⍝ Disabled?</code>
<code> [4]       ('\'=¯1↑∆Ref.p.regPath):'Invalid: regPath'⎕SIGNAL 11  ⍝ Check</code>
<code> [5]       f1←0≠≢∆Ref.p.regPath                                  ⍝ Not empty?</code>
<code> [6]       f1:{⍵,('\'≠¯1↑⍵)/'\'}∆Ref.p.regPath                   ⍝ Then we are fine</code>
<code> [7]       f2←0≠≢∆Ref.p.helpCaption                              ⍝ Not empty?</code>
<code> [8]       f2:'Software\APLTree\Laguntza\',∆Ref.p.helpCaption,'\'    ⍝ Establish a sensible default</code>
<code> [9]       ''                                                    ⍝ Okay, there is nothing we can do then</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_310">#.Laguntza.Laguntza.GetIndicesFromMarkdown &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetIndicesFromMarkdown←{</code>
<code> [1]       md←A.DLB ⍵</code>
<code> [2]       0=+/b←'['=↑¨md:''</code>
<code> [3]       b←b\'[data]:index='''∘{⍺≡(≢⍺)↑⍵}¨⎕C b/md</code>
<code> [4]       0=+/b:''</code>
<code> [5]       indices←¯1↓¨A.DTB¨(≢'[data]:index=''')↓¨b/md</code>
<code> [6]       indices←(0&lt;≢¨indices)/indices</code>
<code> [7]       0=≢indices:''</code>
<code> [8]       ∪Index.NormalizeKeywords indices</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_311">#.Laguntza.Laguntza.GetItemNumberFromPattern &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetItemNumberFromPattern←{</code>
<code> [1]  ⍝ If ⍵ (the pattern) does not identify a particular page ⍬ is returned.</code>
<code> [2]  ⍝ If it identifies more than 1 page a ¯1 is returned.</code>
<code> [3]  ⍝ Otherwise the item number is returned.</code>
<code> [4]  ⍝ Result is always a scalar.</code>
<code> [5]       ∆Ref←⍺</code>
<code> [6]       0=≢⍵:⍬</code>
<code> [7]       0=1↑0⍴⍵:⍵</code>
<code> [8]       {1=≢⍵:↑⍵ ⋄ ¯1}FindTopic ∆Ref ⍵</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_312">#.Laguntza.Laguntza.GetMarkdownVarsContent &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetMarkdownVarsContent←{</code>
<code> [1] ⍝ ⍵ is a row from ∆Ref.d.tree. Checks whether it's a variable.</code>
<code> [2] ⍝ It returns either the contents of that variable or ''</code>
<code> [3]      ∆Ref←⍺</code>
<code> [4]      (name parent)←⍵</code>
<code> [5]      ref←{326≢⎕DR parent:⍎⍵ ⋄ ⍵}parent</code>
<code> [6]      ∆Ref GetMarkdownVarsContent_ ref name</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_313">#.Laguntza.Laguntza.GetMaskForCode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  mask←GetMaskForCode md</code>
<code> [1]  ⍝ Returns a mask that hides codes (everything between "~~~" or back-ticks.</code>
<code> [2]   mask←(≢md)⍴0</code>
<code> [3]   :If 0≠≢ind←'^\s{0,3}[~`]{3,}\s{0,}$'⎕S 0 1⍠('Mode' 'M')('DotAll' 1)('EOL' 'CR')⊣md</code>
<code> [4]       'Odd number of code fences'⎕SIGNAL 11/⍨0≠2|≢ind</code>
<code> [5]       mask[↑¨ind]←1</code>
<code> [6]       mask←{⍵∨≠\⍵}mask</code>
<code> [7]       mask[∊{(↑⍵)+⍳1⊃⍵}¨ind]←1</code>
<code> [8]   :EndIf</code>
<code> [9]   :If 0≠≢ind←'`.*?`'⎕S 0 1⍠('Mode' 'M')('DotAll' 1)('EOL' 'CR')⊣md</code>
<code> [10]      mask[∊{(↑⍵)+⍳1⊃⍵}¨ind]←1</code>
<code> [11]  :EndIf</code>
<code> [12]  mask←~mask</code>
</div>
<code class="header" id="listing_314">#.Laguntza.Laguntza.GetNoClose &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetNoClose←{</code>
<code> [1] ⍝ Use this to Get the "noClose" property (`∆Ref.p.noClose`)</code>
<code> [2]      ∆Ref←⍵</code>
<code> [3]      ∆Ref.p.noClose</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_315">#.Laguntza.Laguntza.GetParentAndTopicNameAsText &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetParentAndTopicNameAsText←{</code>
<code> [1]      tree←⍵</code>
<code> [2]      2&gt;⍴⍴tree:(⍕I.Parent⊃tree),'.',I.TopicName⊃tree</code>
<code> [3]      (⍕¨tree[;I.Parent]),¨'.',¨tree[;I.TopicName]</code>
<code> [4] ⍝ ⍵ is either a single row (vector) stemming from ∆Ref.d.tree or a matrix of rows.</code>
<code> [5] ⍝ Returns  I.Parent and I.TopicName as a single string.</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_316">#.Laguntza.Laguntza.GetParentOf &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←∆Ref GetParentOf row</code>
<code> [1] ⍝ Returns (Parent,TopicName) as text for a node and just (Parent) otherwise.</code>
<code> [2]  r←↑∆Ref.d.tree[row;I.Parent]</code>
</div>
<code class="header" id="listing_317">#.Laguntza.Laguntza.GetTempFilename &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  filename←GetTempFilename extension</code>
<code> [1]  ⍝ Returns a temp filename in the temp directory.</code>
<code> [2]  ⍝ If ⍵ is not empty, it's taken as extension.</code>
<code> [3]   path←(2 ⎕NQ'#' 'GetEnvironment' 'temp'),'\'</code>
<code> [4]   start←no←⍎{(,'ZI2,ZI2,ZI2'⎕FMT 3↑⍵),⍕3↓⍵}3↓⎕TS  ⍝ Expensive but successful very soon</code>
<code> [5]   :Repeat</code>
<code> [6]       filename←path,(⎕AN,'_',⍕no),{0=≢⍵:'.tmp' ⋄ ((~'.'∊⍵)/'.'),⍵}extension</code>
<code> [7]       fno←0</code>
<code> [8]       :Trap 22</code>
<code> [9]           ⎕NUNTIE fno←filename ⎕NCREATE 0</code>
<code> [10]          flag←1</code>
<code> [11]      :EndTrap</code>
<code> [12]      no+←10</code>
<code> [13]  :Until (fno≠0)∨no&gt;start+1000×10  ⍝ max 1000 tries - this will always suuceed.</code>
</div>
<code class="header" id="listing_318">#.Laguntza.Laguntza.GetTitleFromTopicProperty &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetTitleFromTopicProperty←{</code>
<code> [1]  ⍝ Returns "title" if it is not empty but "name" otherwise.</code>
<code> [2]       (parent name)←⍵</code>
<code> [3]       result←parent.⍎'∆TopicProperties ⍬'</code>
<code> [4]       ((name=' ')/name)←'_'</code>
<code> [5]       ~(⊂name)∊result[;0]:. ⍝ Something  went terribly wrong</code>
<code> [6]       ind←result[;0]⍳⊂name</code>
<code> [7]       0=≢title←1⊃result[ind;]:0⊃result[ind;]</code>
<code> [8]       title</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_319">#.Laguntza.Laguntza.GetTopicPropertyTemplate &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetTopicPropertyTemplate←{</code>
<code> [1]  ⍝ Returns the header and the leading comments for any `∆TopicProperties` function.</code>
<code> [2]       r←''</code>
<code> [3]       r,←⊂'∆TopicProperties←{'</code>
<code> [4]       r,←⊂'⍝ This function is needed by the Laguntza system.'</code>
<code> [5]       r,←⊂'⍝ You can edit this function from the Laguntza GUI via the context menu.'</code>
<code> [6]       r,←⊂'⍝ *** NOTE:'</code>
<code> [7]       r,←⊂'⍝     Make only changes to this function that affect the explicit result.'</code>
<code> [8]       r,←⊂'⍝     Any other changes will eventually disappear because these functions are rebuild'</code>
<code> [9]       r,←⊂'⍝     under program control from their explicit result under certain circumstances.'</code>
<code> [10]      r,←⊂'⍝        This is also the reason why you should use the `active` flag to hide a topic'</code>
<code> [11]      r,←⊂'⍝     temporarily because although just putting a `⍝` symbol in front of its line'</code>
<code> [12]      r,←⊂'⍝     seems to have the same effect, in the long run that''s not true because the'</code>
<code> [13]      r,←⊂'⍝     commented line will disappear in the event of a rebuild.'</code>
<code> [14]      r,←⊂'⍝ ----------------------------------'</code>
<code> [15]      r,←⊂'⍝ r gets a table with these columns:'</code>
<code> [16]      r,←⊂'⍝ [;0] namespace or function name.'</code>
<code> [17]      r,←⊂'⍝ [;1] caption in the tree view. If empty the namespace/fns name is taken.'</code>
<code> [18]      r,←⊂'⍝ [;2] active flag.'</code>
<code> [19]      r,←⊂'⍝ [;3] developmentOnly flag; 1=the corresponding node does not show in user mode.'</code>
<code> [20]      r,←⊂'r←0 4⍴'''''</code>
<code> [21]      r</code>
<code> [22]  }</code>
</div>
<code class="header" id="listing_320">#.Laguntza.Laguntza.GetVarsName &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetVarsName←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      in←⍵</code>
<code> [3]      ∆Ref GetParentAndTopicNameAsText ∆Ref.d.tree[,in;]</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_321">#.Laguntza.Laguntza.GetVisible &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetVisible←{</code>
<code> [1] ⍝ Use this to get the "visible" property (`∆Ref.p.visible`)</code>
<code> [2]      ∆Ref←⍵</code>
<code> [3]      ∆Ref.p.visible≠∆Ref.Visible:'∆Ref.p.visible and the main form''s "Visible" property are inconsistent'⎕SIGNAL 11</code>
<code> [4]      ∆Ref.p.visible</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_322">#.Laguntza.Laguntza.GetWordsFromMarkdown &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetWordsFromMarkdown←{</code>
<code> [1]  ⍝ ⍵ is Markdown.</code>
<code> [2]  ⍝ Returns a two-item vector</code>
<code> [3]  ⍝ [1] All words unchanged</code>
<code> [4]  ⍝ [2] All words lowercased</code>
<code> [5]       markdown←⍵</code>
<code> [6]       0=≢markdown:'' ''</code>
<code> [7]       Words←RemoveFunctinCalls RemoveCode RemoveData markdown</code>
<code> [8]       Words←'|'HTML.MaskLinks¨Words</code>
<code> [9]       Words←SeparateWords∊' ',Words</code>
<code> [10]      Words⌿⍨←~∧/¨Words∊¨⊂⎕D,'.,'</code>
<code> [11]      Words←∪' 'A.Split A.DMB Words</code>
<code> [12]      Words/⍨←1&lt;≢¨Words             ⍝ We don't want one-letter words</code>
<code> [13]      0=≢Words:'' ''</code>
<code> [14]      words←∪⎕C Words</code>
<code> [15]      Words←CR,CR,⍨∊↑{⍺,CR,⍵}/Words</code>
<code> [16]      words←CR,CR,⍨∊↑{⍺,CR,⍵}/words</code>
<code> [17]      Words words</code>
<code> [18]  }</code>
</div>
<code class="header" id="listing_323">#.Laguntza.Laguntza.Get∆Ref &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Get∆Ref←{</code>
<code> [1]      ref←FindForm{⍬≡⍴⍵:⍵ ⋄ ⍎⍵}⍵</code>
<code> [2]      ref.n.∆Ref</code>
<code> [3] ⍝ Takes a ref pointing to the GUI or one of its children</code>
<code> [4] ⍝ (typically coming from 0⊃⍵ of a callback)</code>
<code> [5] ⍝ and returns ∆Ref</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_324">#.Laguntza.Laguntza.HandleEnforceCompile &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> HandleEnforceCompile←{</code>
<code> [1]      enforceCompile←⍵</code>
<code> [2]      ~enforceCompile∊0 1:'Invalid: "enforceCompile"'⎕SIGNAL 11</code>
<code> [3]      enforceCompile=0:0</code>
<code> [4]      0=≢ps.source:'Files need to be compiled but "source" is not specified'⎕SIGNAL 11</code>
<code> [5]      1</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_325">#.Laguntza.Laguntza.HandleTopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  HandleTopicProperties←{</code>
<code> [1]  ⍝ `testFlag` is 1 only when it's running under a test case.</code>
<code> [2]       ⍺←0</code>
<code> [3]       testFlag←⍺</code>
<code> [4]       (∆Ref in)←2↑⍵,⊂⍬</code>
<code> [5]       in←{GetCurrentItem ∆Ref.n}⍣(⍬≡in)⊣in</code>
<code> [6]       ⍬≡in:⍬  ⍝ Windows bug: sometimes it pretends that no item is selected where there is</code>
<code> [7]       rf←I.Parent⊃∆Ref.d.tree[in;]</code>
<code> [8]       3=rf.⎕NC'∆TopicProperties':testFlag ManageTopicProperties ∆Ref in rf</code>
<code> [9]       msg←⊂'There is no function ∆TopicProperties in ',(⍕rf),' yet.'</code>
<code> [10]      msg,←⊂'Would you like to introduce it?'</code>
<code> [11]      f←ask←msg∘{∆Ref.p.helpCaption YesOrNo ⍺}⍣(↑0=testFlag)⊣1</code>
<code> [12]      0=f:⍬</code>
<code> [13]      res←I</code>
<code> [14]      _←Inject∆TopicProperties rf</code>
<code> [15]      0=≢res:⍬</code>
<code> [16]      testFlag EditTopicProperties ∆Ref in rf</code>
<code> [17]  }</code>
</div>
<code class="header" id="listing_326">#.Laguntza.Laguntza.InjectNewNode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{testFlag}InjectNewNode ∆Ref</code>
<code> [1]   r←⍬</code>
<code> [2]   testFlag←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 0}'testFlag'</code>
<code> [3]   row←GetCurrentItem ∆Ref.n</code>
<code> [4]   parentName←⍕parent←∆Ref GetParentOf row</code>
<code> [5]   :If 0≠≢name←testFlag GetNameForNewNode parent</code>
<code> [6]       :If ∆Ref.d.tree[row;I.IsNode]</code>
<code> [7]           type←testFlag AskForNodeType ∆Ref</code>
<code> [8]       :Else</code>
<code> [9]           type←⊂'sibling'</code>
<code> [10]      :EndIf</code>
<code> [11]  :AndIf type∊'sibling' 'child'</code>
<code> [12]      testFlag InjectNewNode_ ∆Ref name parent type row</code>
<code> [13]  :EndIf</code>
</div>
<code class="header" id="listing_327">#.Laguntza.Laguntza.Inject∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←{recursive}Inject∆TopicProperties ref</code>
<code> [1]  ⍝ Creates ∆TopicProperties functions in a particular or all (sub-)namespaces in ref.\\</code>
<code> [2]  ⍝ "ref" points to a namespace that is (going to become) Laguntza compliant.\\</code>
<code> [3]  ⍝ "recursive" must be either '' or 'all'.</code>
<code> [4]  ⍝ The default for "recursive" is ''. If it is not 'recursive' than a</code>
<code> [5]  ⍝ `∆TopicProperties` function is injected into "ref" only (if at all).\\</code>
<code> [6]  ⍝ Returns a list of refs of namespaces which got a `∆TopicProperties` function injected.</code>
<code> [7]   recursive←{0&lt;⎕NC ⍵:⍎⍵ ⋄ ''}'recursive'</code>
<code> [8]   'Invalid left argument'⎕SIGNAL 11/⍨' '≠1↑0⍴recursive</code>
<code> [9]   recursive←⎕C recursive</code>
<code> [10]  'Invalid left argument'⎕SIGNAL 11/⍨~(⊂recursive)∊'' 'recursive'</code>
<code> [11]  recursiveFlag←'recursive'≡recursive</code>
<code> [12]  'Invalid parameter "ref"'⎕SIGNAL 11/⍨9≠⎕NC⍕ref</code>
<code> [13]  r←Inject∆TopicProperties_ ref recursiveFlag</code>
<code> [14] ⍝Done</code>
</div>
<code class="header" id="listing_328">#.Laguntza.Laguntza.IsNotOnSearchTab &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> IsNotOnSearchTab←{</code>
<code> [1]  ⍝ Are we on the search tab?</code>
<code> [2]      ∆Ref←⍵</code>
<code> [3]      6::0   ⍝ Next line may cause a VALUE ERROR when the test cases are run, but then we ARE on the search tab</code>
<code> [4]      obj←∆Ref.GetFocus</code>
<code> [5]      0=(⊂'sf_search')∊'.'{⍵⊂⍨'.'≠⍵}obj</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_329">#.Laguntza.Laguntza.IsRunTime &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> IsRunTime←{</code>
<code> [1]      'Dev'≢3↑3⊃'.'⎕WG'APLVersion'</code>
<code> [2]  }</code>
</div>
<code class="header" id="listing_330">#.Laguntza.Laguntza.ListHelpForms &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←ListHelpForms</code>
<code> [1] ⍝ Returns a list of references pointing to the current APLTreHelp instanciates.</code>
<code> [2]  r←''</code>
<code> [3]  :If 9=⎕NC'HelpForms'</code>
<code> [4]  :AndIf 0≠≢l←HelpForms.⎕NL-9</code>
<code> [5]  :AndIf 0≠≢l←HelpForms.⎕WN''</code>
<code> [6]      r←HelpForms.⍎¨l</code>
<code> [7]  :EndIf</code>
</div>
<code class="header" id="listing_331">#.Laguntza.Laguntza.ListNamespaceTree_ &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ListNamespaceTree_←{</code>
<code> [1]  ⍝ Returns a list of all namespaces in ⍵, including ⍵ itself.</code>
<code> [2]  ⍝ Does NOT return unnamed namespaces or GUI instances.</code>
<code> [3]  ⍝ Does not fall for circle references.</code>
<code> [4]       ⍺←¯1</code>
<code> [5]       ref←⍵</code>
<code> [6]       container←{(¯1≡⍵):{⍵.buf←'' ⋄ ⍵}⎕NS'' ⋄ ⍵}⍺</code>
<code> [7]       list←ref{⍺.(⍎⍕'⍺',⌽⎕NL-9.1)}⍬      ⍝ Ordinary &amp; unnamed namespaces (NS)</code>
<code> [8]       list/⍨←{'['∊⍵:0 ⋄ 0::0 ⋄ (⊂⍵ ⎕WG'Type')∊'Root' 'Namespace' 'Session'}∘⍕¨list</code>
<code> [9]       list~←container.buf</code>
<code> [10]      container.buf,←list</code>
<code> [11]      (0=≢list):container.buf</code>
<code> [12]      _←container ∇¨list</code>
<code> [13]      container.buf</code>
<code> [14]  }</code>
</div>
<code class="header" id="listing_332">#.Laguntza.Laguntza.Markdown2HTML &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  AllHtmls←∆Ref Markdown2HTML vectorOfMarkdowns</code>
<code> [1]  ⍝ Convert the Markdown into HTML.</code>
<code> [2]  ⍝ **Don't** make this an ¨ call: the for loop makes investigating</code>
<code> [3]  ⍝ any problems in the data much easier.</code>
<code> [4]   AllHtmls←''</code>
<code> [5]   vectorOfMarkdowns←,vectorOfMarkdowns</code>
<code> [6]   :For i :In ⍳≢vectorOfMarkdowns</code>
<code> [7]       html←(∆Ref i)Markdown2HTML_ i⊃vectorOfMarkdowns</code>
<code> [8]       AllHtmls,←⊂html</code>
<code> [9]   :EndFor</code>
</div>
<code class="header" id="listing_333">#.Laguntza.Laguntza.NoOfChildren &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  NoOfChildren←{</code>
<code> [1]       ⍺←0</code>
<code> [2]       in←⍺                           ⍝ Item number</code>
<code> [3]       int←⍵                          ⍝ Depth</code>
<code> [4]       0=≢int:0</code>
<code> [5]       ≢in WhereAreTheChildren int</code>
<code> [6]  ⍝ Returns the number of children (but no grand-chirdren etc) found.</code>
<code> [7]  ⍝ ⍵ is an integer vector ("Depth" of a TreeView typically)</code>
<code> [8]  ⍝ ⍺ is the item number we are interested in. Defaults to 0.</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_334">#.Laguntza.Laguntza.OnClose &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnClose←{</code>
<code> [1]      ⍬≡∆Ref←{0=⎕NC⍕⍵:⍬ ⋄ Get∆Ref ⍵}0⊃⍵:1    ⍝ GUI might have ceased to exist</code>
<code> [2]      ∆Ref.p.noClose:0⊣∆Ref SetVisible 0     ⍝ Just make it invisible</code>
<code> [3]      1⊣CloseHelp ∆Ref</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_335">#.Laguntza.Laguntza.OnExpandingInTreeView &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnExpandingInTreeView←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      ∆Ref.n.tree.SelItems←(≢∆Ref.n.tree.Items)⍴0</code>
<code> [3]      ∆Ref.n.tree.SelItems[2⊃⍵]←1</code>
<code> [4]      1</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_336">#.Laguntza.Laguntza.OnTabSelect &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnTabSelect←{</code>
<code> [1]       this←⍎0⊃⍵</code>
<code> [2]       ∆Ref←Get∆Ref this</code>
<code> [3]       n←∆Ref.n</code>
<code> [4]       _←ResetStatusbar ∆Ref</code>
<code> [5]       t←(n.tabBtns⍳this)⊃n.tabs</code>
<code> [6]       _←⎕NQ t'GotFocus'                              ⍝ Force focus to that child</code>
<code> [7]       n.searchBtn.Default←n.search≡this              ⍝ Circumvention of bug &lt;00718&gt;</code>
<code> [8]       ∆Ref.d.currentTabIs←this</code>
<code> [9]       t≡n.search_sf:1⊣⎕NQ n.searchString'GotFocus'   ⍝ Special handling for "Search"</code>
<code> [10] ⍝ When the tab is changed, the status bar is reset</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_337">#.Laguntza.Laguntza.ParentInStatusbar &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ParentInStatusbar←{</code>
<code> [1]       ∆Ref←⍺                                         ⍝ Can be the item number</code>
<code> [2]       in←⍵</code>
<code> [3]       n←∆Ref.n</code>
<code> [4]       1=∆Ref.p.userMode:⍬⊣n.pathSB.Text←''           ⍝ Set the text</code>
<code> [5]       tx←⍕∆Ref GetParentOf in                        ⍝ Get parent(s) of item</code>
<code> [6]       tx←(1+≢⍕↑∆Ref.d.tree[0;I.Parent])↓tx</code>
<code> [7]       tx,←((0≠≢tx)/'.'),I.TopicName⊃∆Ref.d.tree[in;] ⍝ Topic name</code>
<code> [8]       tx←in{0=≢⍺:⍵ ⋄ ⍵,'  [',(⍕⍺),';]'}tx            ⍝ Add item number</code>
<code> [9]       n.pathSB.Text←tx                               ⍝ Set the enhanced text</code>
<code> [10]      ⍬</code>
<code> [11] ⍝ Display parent(s) in status bar, but only if the tree is visible</code>
<code> [12]  }</code>
</div>
<code class="header" id="listing_338">#.Laguntza.Laguntza.PolishLinkText &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PolishLinkText←{</code>
<code> [1]      '|'∊⍵:A.DLB ⍵↓⍨1+⍵⍳'|' ⍝ Link text is defined: done.</code>
<code> [2]      A.Last ⍵               ⍝ The part on the right of the last dot becomes the link text.</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_339">#.Laguntza.Laguntza.PolishName &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PolishName←{</code>
<code> [1]      (0=+/b←'_'=w←⍵):w</code>
<code> [2]      (b/w)←' '</code>
<code> [3]      w</code>
<code> [4] ⍝ Takes a names (fns or node)</code>
<code> [5] ⍝ and polishes it by replacing any _ character by a blank</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_340">#.Laguntza.Laguntza.PolishPagePattern &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PolishPagePattern←{</code>
<code> [1]  ⍝ Checks whether a page pattern is a full path (=no action)</code>
<code> [2]  ⍝ or not; it then is transformed into a minimal link.</code>
<code> [3]  ⍝ Useful for the setting of parameter.page</code>
<code> [4]      (0=≢⍵):0</code>
<code> [5]      (0=1↑0⍴⍵):⍵</code>
<code> [6]      ('#⎕'∊⍨1↑pattern):⍵</code>
<code> [7]      '*.',⍵</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_341">#.Laguntza.Laguntza.PopulateGUI &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  PopulateGUI←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       ∆Ref.n.tree.Visible←0</code>
<code> [3]       ∆Ref.n.tree.Items←{'`'⎕R''⊣⍵}¨∆Ref.d.tree[;I.Title]</code>
<code> [4]       ∆Ref.n.tree.Depth←∆Ref.d.tree[;I.Depth]</code>
<code> [5]       ∆Ref.n.tree.SelItems[0]←1</code>
<code> [6]       _←IntitialExpand ∆Ref</code>
<code> [7]       _←PopulateIndexList ∆Ref</code>
<code> [8]       ∆Ref.n.tree.Visible←1</code>
<code> [9]       ⍬</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_342">#.Laguntza.Laguntza.PopulateIndexList &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  PopulateIndexList←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       0=≢buf←2⊃⎕FREAD ∆Ref.f.(tieNo ∆index):⍬</code>
<code> [3]       ∆Ref.n.indexList.Visible←0</code>
<code> [4]       ∆Ref.n.indexList.Items←buf[;0]</code>
<code> [5]       ∆Ref.n.indexList.ReportInfo←1↓[1]buf</code>
<code> [6]       _←∆Ref.n.indexList{⎕NQ ⍺'SetColSize'⍵ ¯3}¨⍳1⊃⍴buf</code>
<code> [7]       ∆Ref.n.indexList.Visible←1</code>
<code> [8]       ⍬</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_343">#.Laguntza.Laguntza.Posn &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Posn←{</code>
<code> [1]  ⍝ Placeholder to prevent users from setting the "Posn" property</code>
<code> [2]  }</code>
</div>
<code class="header" id="listing_344">#.Laguntza.Laguntza.Power2 &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Power2←{+/⍵/2*⍳32}</code>
</div>
<code class="header" id="listing_345">#.Laguntza.Laguntza.ProcessEvents &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ProcessEvents←{</code>
<code> [1]  ⍝ ⍺ is a delay which default to ... seconds.</code>
<code> [2]  ⍝ ⍵ is a control</code>
<code> [3]       ⍺←0.5                                      ⍝ Default delay</code>
<code> [4]       delay←⍺                                    ⍝ The delay executed before "Wait" is stopped</code>
<code> [5]       rf←⍵                                       ⍝ Ref</code>
<code> [6]       rf←{'Form'≢⍵.Type:∇ ⍵.## ⋄ ⍵}rf            ⍝ If it's not a form take parent until it IS a form</code>
<code> [7]     ⍝ ↓↓ Trapping the VALUE ERROR is needed: it sometimes fails for unkown reasons...</code>
<code> [8]       _←delay{6::⍬ ⋄ _←⎕DL ⍺ ⋄ ⎕NQ ⍵ 9996}&amp;rf    ⍝ Make sure that the "Wait" call is ended after ⍺ delay</code>
<code> [9]       _←rf.Wait                                  ⍝ Enqueue</code>
<code> [10]      ⍬</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_346">#.Laguntza.Laguntza.ProcessLinks &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> md←X ProcessLinks(index vectorOfMarkdowns)</code>
<code> [1] ⍝ Process all links in `vectorOfMarkdowns`.</code>
<code> [2] ⍝ **Don't** make this an ¨ call: the :For loop makes investigating</code>
<code> [3] ⍝ any problems in the data much easier.</code>
<code> [4]  md←''</code>
<code> [5]  :For i :In index</code>
<code> [6]      buff←X i∘ProcessLinks_ i⊃,vectorOfMarkdowns</code>
<code> [7]      md,←⊂buff</code>
<code> [8]  :EndFor</code>
</div>
<code class="header" id="listing_347">#.Laguntza.Laguntza.ProcessLinks_ &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  md←X_row ProcessLinks_ md</code>
<code> [1]  ⍝ Process all links in vtv "md" (Markdown).</code>
<code> [2]   (X row)←X_row</code>
<code> [3]   flag←0</code>
<code> [4]   :If 0≠≢md</code>
<code> [5]       maskCode←{0=+/b←'`'=⍵:1 ⋄ ~{⍵∨≠\⍵}b}¨md</code>
<code> [6]   :AndIf 0&lt;+/b←~{⍵∨≠\⍵}{∨/∨/¨'~~~' '```'⍷¨⊂⍵}¨maskCode/¨md</code>
<code> [7]   :AndIf 0&lt;+/b←b∧∨/¨'→['∘⍷¨md</code>
<code> [8]       :If 1∊b2←~']'∊¨b/md                            ⍝ Missing the closing "]"?!</code>
<code> [9]           ind←b2/⍸b                                 ⍝ In case there is no closing ] it's not a link!</code>
<code> [10]          :For this :In ind</code>
<code> [11]              :If this&lt;≢1↓md</code>
<code> [12]                  :If ']'∊((this+1)⊃maskCode)/(this+1)⊃md</code>
<code> [13]                      md[this+0 1]←(∊md[this+0 1])''     ⍝ For those we catenate the two lines before we proceed.</code>
<code> [14]                      flag←1</code>
<code> [15]                  :EndIf</code>
<code> [16]              :Else</code>
<code> [17]                  :Continue</code>
<code> [18]              :EndIf</code>
<code> [19]          :EndFor</code>
<code> [20]      :Else</code>
<code> [21]          flag←1</code>
<code> [22]      :EndIf</code>
<code> [23]      :If flag</code>
<code> [24]          (b/md)←(X row)∘{⍺ ProcessLinks__⍣≡⊣⍵}¨b/md</code>
<code> [25]      :EndIf</code>
<code> [26]  :EndIf</code>
</div>
<code class="header" id="listing_348">#.Laguntza.Laguntza.ProcessLinks__ &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ProcessLinks__←{</code>
<code> [1]       (X row)←⍺</code>
<code> [2]       tx←⍵</code>
<code> [3]       b←'→['⍷tx                     ⍝ Where are the links?</code>
<code> [4]       0=+/b:tx</code>
<code> [5]       st←b⍳1                        ⍝ Starting point</code>
<code> [6]       tx←st⌽tx,' '                  ⍝ Bring to front</code>
<code> [7]       tx←ComplexLink X tx st row    ⍝ Process complex links</code>
<code> [8]       tx</code>
<code> [9]  ⍝ Process any links in tx. By default ⍵ is wrapped into a &lt;p&gt; of the "body" class.</code>
<code> [10] ⍝ You can change this. For example, for table cells:</code>
<code> [11] ⍝    ∆Ref '' ''∘ProcessLinks¨allTableCells</code>
<code> [12] ⍝ This makes sure that there is no additional markup within cells.</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_349">#.Laguntza.Laguntza.ProgressbarCreate &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ProgressbarCreate←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      ref←∆Ref.n.SB.⎕NEW'Progressbar'(('Coord' 'Prop')('Posn'(0 0))('Size'(100 100)))</code>
<code> [3]      ref.Limits←0 100</code>
<code> [4]      ref.Thumb←1</code>
<code> [5]      ref</code>
<code> [6] ⍝ Creates a progress bar as child of the STatusbar, hiding any other children.</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_350">#.Laguntza.Laguntza.ReadGuiParmsFromRegistry &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReadGuiParmsFromRegistry←{</code>
<code> [1]       ps←⍺</code>
<code> [2]       ∆Ref←⍵</code>
<code> [3]       0=≢rp←GetFullRegPath ∆Ref:⍬</code>
<code> [4]  </code>
<code> [5]       data←↑(//)⎕VFI'¯1 ¯1'RegRead rp,'Posn'</code>
<code> [6]       f←(¯1 ¯1≢data)∧(⍬ ⍬≡ps.posn)</code>
<code> [7]       _←data{⍵:⍬⊣ps.posn←⍺ ⋄ ⍬}f</code>
<code> [8]  </code>
<code> [9]       data←↑(//)⎕VFI'¯1 ¯1'RegRead rp,'Size'</code>
<code> [10]      f←(¯1 ¯1≢data)∧(⍬ ⍬≡ps.size)</code>
<code> [11]      _←data{⍵:⍬⊣ps.size←⍺ ⋄ ⍬}f</code>
<code> [12] </code>
<code> [13]      data←↑(//)⎕VFI'¯1 ¯1'RegRead rp,'SplitterPosn'</code>
<code> [14]      f←(¯1 ¯1≢data)∧(⍬ ⍬≡ps.splitterPosn)</code>
<code> [15]      _←data{⍵:⍬⊣ps.splitterPosn←⍺ ⋄ ⍬}f</code>
<code> [16] </code>
<code> [17]      ⍬</code>
<code> [18]  ⍝ Attempts to read Posn and Size of the GUI from the Registry</code>
<code> [19]  }</code>
</div>
<code class="header" id="listing_351">#.Laguntza.Laguntza.ReformatTopicPropertyResult &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ReformatTopicPropertyResult←{</code>
<code> [1] ⍝ Takes a result delivered from ∆TopicProperties function and returns a vector of vectors</code>
<code> [2] ⍝ ready to be part of a new ∆TopicProperties function (for ⎕FX that is).</code>
<code> [3]      result←⍵</code>
<code> [4]      result[;1]←{''''⎕R''''''⊣⍵}¨result[;1]</code>
<code> [5]      buf←'r⍪←'∘,¨⍕¨↓⍉⊃{('''',¨(0⊃⍵),¨'''')('''',¨(1⊃⍵),¨'''')(⍕¨2⊃⍵)(⍕¨3⊃⍵)}↓[0]result</code>
<code> [6]      buf,'r' '}'</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_352">#.Laguntza.Laguntza.RegRead &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←default RegRead path</code>
<code> [1] ⍝ Tries to read "path" from the HKCU branch in the Windows Registry.</code>
<code> [2] ⍝ If it cannot be found "default" is returned.</code>
<code> [3]  'wsh'⎕WC'OLEClient' 'WScript.Shell'</code>
<code> [4]  path←'HKCU\',path</code>
<code> [5]  r←default(wsh.RegRead{11::⍺ ⋄ ⍺⍺⊂⍵})path</code>
</div>
<code class="header" id="listing_353">#.Laguntza.Laguntza.RegWrite &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←string RegWrite path</code>
<code> [1] ⍝ Writes "string" under "path" to the HKCU branch in the Windows Registry.</code>
<code> [2]  'wsh'⎕WC'OLEClient' 'WScript.Shell'</code>
<code> [3]  path←'HKCU\',path</code>
<code> [4]  r←string(wsh.RegWrite{11 6::⍬ ⋄ ⍺⍺ ⍵ ⍺})path</code>
</div>
<code class="header" id="listing_354">#.Laguntza.Laguntza.RemoveCode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  RemoveCode←{</code>
<code> [1]       md←A.DLB ⍵</code>
<code> [2]       0=+/b←(↑¨md)∊'~`':md</code>
<code> [3]       md2←(b/md)~¨' '</code>
<code> [4]       b2←↑¨1=⍴¨∪¨md2</code>
<code> [5]       b2∧←3≤↑¨⍴¨md2</code>
<code> [6]       md←(~{⍵∨≠\⍵}b\b2)/md</code>
<code> [7]       md←∊' ',¨md</code>
<code> [8]       0=≢hits←'`.*?`'⎕S 0 1⊣md:md</code>
<code> [9]       md[∊{(↑⍵)+⍳1↓⍵}¨hits]←' '</code>
<code> [10]      md</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_355">#.Laguntza.Laguntza.RemoveCodeBlock &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> RemoveCodeBlock←{</code>
<code> [1] ⍝ ⍵ is a vector of text vectors representing a help page (markdown).</code>
<code> [2] ⍝ Strictly speaking the RegEx is not correct: it allows more than 3 leading spaces. However,</code>
<code> [3] ⍝ this is a necessity here because the code block(s) might be part of a list, and we don't</code>
<code> [4] ⍝ have the means to check this properly here. For every-day usage that should not matter.</code>
<code> [5]      '(^\s{0,}~{3,}).*?(?1)'⎕R''⍠('Mode' 'M')('DotAll' 1)⊣⍵</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_356">#.Laguntza.Laguntza.RemoveComplexLink &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  RemoveComplexLink←{</code>
<code> [1]   ⍝ ⍵ is simple text. Beginning of ⍵ is expected to be a link.</code>
<code> [2]   ⍝ Pure sub-function of RemoveLinksFromText</code>
<code> [3]       (0=≢t←⍵):t</code>
<code> [4]       w←t⍳']'</code>
<code> [5]       lt←w↑t</code>
<code> [6]       ('|'∊⍵):(A.(DLB DTB){⍵↑⍨⍵⍳']'}t↓⍨1+t⍳'|'),(w+1)↓t</code>
<code> [7]       ('.'∊lt):(PolishName A.(DLB DTB){⌽⍵↑⍨⍵⍳'.'}⌽lt),(w+1)↓t</code>
<code> [8]       (PolishName{⍵↓⍨'*'=↑⍵}{⍵↓⍨'↑'=↑⍵}2↓lt),(w+1)↓t</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_357">#.Laguntza.Laguntza.RemoveData &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> RemoveData←{</code>
<code> [1]      md←A.DLB ⍵</code>
<code> [2]      0=+/b←'['=↑¨md:md</code>
<code> [3]      b←b\'[data]:'∘{⍺≡(≢⍺)↑⍵}¨⎕C b/md</code>
<code> [4]      0=+/b:md</code>
<code> [5]      (~b)/md</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_358">#.Laguntza.Laguntza.RemoveEggTimer &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> RemoveEggTimer←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      ∆Ref.n.(form browser_sf).CursorObj←0</code>
<code> [3]      ∆Ref.n.browser.Size←100 100  ⍝ Without this trick the browser area would not show an egg timer</code>
<code> [4]      1:r←⍬</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_359">#.Laguntza.Laguntza.RemoveFunctinCalls &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> RemoveFunctinCalls←{'⍎⍎[^⍎]+⍎⍎'⎕R''⊣⍵}</code>
</div>
<code class="header" id="listing_360">#.Laguntza.Laguntza.RemoveLinksFromText &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  RemoveLinksFromText←{</code>
<code> [1]  ⍝ Takes a text vector and removes all links from it.</code>
<code> [2]  ⍝ If an alternative link text is found it is preserved.</code>
<code> [3]  ⍝ "_" become " "</code>
<code> [4]       t←⍵</code>
<code> [5]       (0=≢t):t</code>
<code> [6]       (0=+/b←'→['⍷t):t            ⍝ No links: done</code>
<code> [7]       (b t)←(st←b⍳1)⌽¨b t         ⍝ Turn around</code>
<code> [8]       t←b{⎕ML←1 ⋄ ⍺⊂⍵}t           ⍝ Split at start of links</code>
<code> [9]       t←RemoveComplexLink¨t</code>
<code> [10]      (-st)⌽↑,/t                  ⍝ Simplify and turn back</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_361">#.Laguntza.Laguntza.ReportAmbiguousLink &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReportAmbiguousLink←{</code>
<code> [1]  ⍝ ⍵ is the link</code>
<code> [2]       (∆Ref row)←⍺</code>
<code> [3]       link←⍵               ⍝ Link text and item numbers</code>
<code> [4]       ((link='*')/link)←'★'</code>
<code> [5]       r←{' AMBIGUOUS LINK: ',⍵,' '}{⍵,('['∊⍵)/']'}1↓link</code>
<code> [6]       X.∆Ref.p.userMode:r</code>
<code> [7]       _←X.∆Ref ReportAmbiguousLink_ link row</code>
<code> [8]       ⎕THIS.X.linkReport,←⊂'ambiguous'</code>
<code> [9]       r</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_362">#.Laguntza.Laguntza.ReportBrokenLink &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ReportBrokenLink←{</code>
<code> [1]       (X row)←⍺</code>
<code> [2]       link←⍵</code>
<code> [3]       ((link='*')/link)←'★'</code>
<code> [4]       r←{' INVALID LINK: ',⍵,' '}{⍵,('['∊⍵)/']'}1↓link</code>
<code> [5]       X.∆Ref.p.userMode:r</code>
<code> [6]       _←X.∆Ref ReportBrokenLink_ link row</code>
<code> [7]       ⎕THIS.X.linkReport,←⊂'broken'</code>
<code> [8]       r</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_363">#.Laguntza.Laguntza.Reset &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←Reset</code>
<code> [1]  ⍝ Deletes all Forms in HelpForms and unties all files connected to those forms</code>
<code> [2]   r←⍬</code>
<code> [3]   :If 9=⎕NC'HelpForms'</code>
<code> [4]       :If 0≠≢list←HelpForms.(⎕NL-9)</code>
<code> [5]       :AndIf 0≠≢list←(HelpForms.{'Form'≡⍵ ⎕WG'Type'}¨list)/list</code>
<code> [6]           list←HelpForms.⍎¨list</code>
<code> [7]           FilesAndDirs.DeleteFile list.∆tempFilename</code>
<code> [8]           {6::⍬ ⋄ ⎕FUNTIE ⍵.n.∆Ref.f.tieNo}¨list</code>
<code> [9]           {}{0::⍬ ⋄ ⍬⊣⍵.Close}¨list</code>
<code> [10]      :EndIf</code>
<code> [11]      {}HelpForms.(⎕EX ⎕NL-9)</code>
<code> [12]  :EndIf</code>
</div>
<code class="header" id="listing_364">#.Laguntza.Laguntza.ResetStatusbar &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ResetStatusbar←{</code>
<code> [1]      n←⍵.n</code>
<code> [2]      n.infoSB.(Caption Text)←⊂''    ⍝ Reset the status bar</code>
<code> [3]      n.infoSB.BCol←¯1               ⍝ Reset the background color</code>
<code> [4]      ⍬</code>
<code> [5] ⍝ Reset the the statusbar. ⍵ is ∆Ref</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_365">#.Laguntza.Laguntza.SaveAllHtml &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SaveAllHtml←{</code>
<code> [1]  ⍝ ⍵ is a vector with all the help pages</code>
<code> [2]      ∆Ref←⍺</code>
<code> [3]      _←∆Ref.f.tieNo{⍵ ⎕FAPPEND ⍺}¨⍵</code>
<code> [4]      ⍬</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_366">#.Laguntza.Laguntza.SaveHelpParms &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←SaveHelpParms ∆Ref</code>
<code> [1]  r←⍬</code>
<code> [2]  buff←0 2⍴⍬</code>
<code> [3]  :For name :In ' '~¨⍨↓∆Ref.p.⎕NL 2</code>
<code> [4]      value←∆Ref.p.⍎name</code>
<code> [5]      buff⍪←name value</code>
<code> [6]  :EndFor</code>
<code> [7]  buff ⎕FREPLACE ∆Ref.f.tieNo ∆Ref.f.∆parms</code>
<code> [8] ⍝Done</code>
</div>
<code class="header" id="listing_367">#.Laguntza.Laguntza.SaveSearchString &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SaveSearchString←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      ≢∆Ref.d.searchString←∪(⊂⍵),∆Ref.d.searchString</code>
<code> [3] ⍝ Save the search string ⍵, prevent clones</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_368">#.Laguntza.Laguntza.SelectItemInTreeView &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> {r}←∆Ref SelectItemInTreeView in</code>
<code> [1] ⍝ To circumvent bug &lt;00780&gt;: setting SelItems has an effect but not (always) the desired one.</code>
<code> [2]  r←⍬</code>
<code> [3]  ∆Ref.n.tree.SelItems←(≢∆Ref.n.tree.Items)⍴0</code>
<code> [4]  {}∆Ref.n.tree.ShowItem in         ⍝ Scroll to "itemNo"</code>
<code> [5]  ⎕NQ ∆Ref.n.tree 9997 ∆Ref in</code>
<code> [6] ⍝Done</code>
</div>
<code class="header" id="listing_369">#.Laguntza.Laguntza.Selfie &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←{wait}Selfie parms</code>
<code> [1]  ⍝ Runs Laguntza's own help in developer's mode.\\</code>
<code> [2]  ⍝ The right argument might be either an empty vector or a parameter</code>
<code> [3]  ⍝ space. If is is the latter than the contents is merged with the</code>
<code> [4]  ⍝ result or `CreateParms ⍬`, with the right argument taking precedence.\\</code>
<code> [5]  ⍝ **Note:** This function always forces the help system to be recompiled.</code>
<code> [6]   wait←{0&lt;⎕NC ⍵:⍎⍵ ⋄ 1}'wait'</code>
<code> [7]   {}2704⌶1</code>
<code> [8]   ⍝1 AllowRide 4711</code>
<code> [9]   ps←CreateParms parms</code>
<code> [10]  ps.helpCaption←'Laguntza''s Help'</code>
<code> [11]  ps.source←HelpHelp</code>
<code> [12]  ps.expand←'None'</code>
<code> [13]  ps.visible←1</code>
<code> [14]  r←1 New ps</code>
<code> [15]  source←GetHome'\Assets\Images\FlipDB-Team.png'</code>
<code> [16]  1 ⎕MKDIR ps.folderName,'\Assets\Images\'</code>
<code> [17]  {}source File.CopyFilesTo ps.folderName,'\Assets\Images\'</code>
<code> [18]  :If wait</code>
<code> [19]      ⎕DQ'.'</code>
<code> [20]  :EndIf</code>
<code> [21] ⍝Done</code>
</div>
<code class="header" id="listing_370">#.Laguntza.Laguntza.SeparateWords &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SeparateWords←{</code>
<code> [1]      Words←⍵</code>
<code> [2]      ((~Words∊AllowedChars ⍬)/Words)←' '</code>
<code> [3]      Words</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_371">#.Laguntza.Laguntza.SetInfoBCol &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  SetInfoBCol←{</code>
<code> [1]       ∆Ref←⍺</code>
<code> [2]       0=∆Ref.⎕NC'n':⍬                ⍝ There might not be a GUI (Method, test cases...)</code>
<code> [3]       color←⍵</code>
<code> [4]       ∆Ref.n.infoSB.BCol←color</code>
<code> [5]       ⍬</code>
<code> [6]   ⍝ Cover fns for setting the Background color of the info field in the status bar</code>
<code> [7]   ⍝ Specify ¯1 as ⍵ for default color.</code>
<code> [8]   ⍝ Specify ∆Ref.p.statusbarAlarmColor for, well, an alarming color</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_372">#.Laguntza.Laguntza.SetInfoText &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetInfoText←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      0=∆Ref.⎕NC'n':⍬        ⍝ There might not be a GUI: method calls, test cases...</code>
<code> [3]      msg←⍵</code>
<code> [4]      0=≢msg:(∆Ref.n.infoSB.Text←''){⍬}∆Ref.n.infoSB.BCol←¯1</code>
<code> [5]      ⍬⊣∆Ref.n.infoSB.Text←msg</code>
<code> [6]  ⍝ Cover fns for setting "Text" in the info field of the status bar</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_373">#.Laguntza.Laguntza.SetNoClose &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetNoClose←{</code>
<code> [1] ⍝ Use this to set the "noClose" property (`∆Ref.p.noClose`)</code>
<code> [2]      ∆Ref←⍺</code>
<code> [3]      was←∆Ref.p.noClose</code>
<code> [4]      ∆Ref.p.noClose←⍵</code>
<code> [5]      was</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_374">#.Laguntza.Laguntza.SetVisible &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetVisible←{</code>
<code> [1] ⍝ Use this to set the "visible" property (`∆Ref.p.visible`)</code>
<code> [2]      ∆Ref←⍺</code>
<code> [3]      was←∆Ref.p.visible</code>
<code> [4]      ∆Ref.p.visible←⍵</code>
<code> [5]      ∆Ref.Visible←⍵</code>
<code> [6]      was</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_375">#.Laguntza.Laguntza.SetVisibleForTreeAndIndexTab &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetVisibleForTreeAndIndexTab←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      ∆Ref.n.tree.Visible←⍵</code>
<code> [3]      ∆Ref.n.indexList.Visible←⍵</code>
<code> [4]      ⍬</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_376">#.Laguntza.Laguntza.ShowDisplayFormat &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowDisplayFormat←{⍵{(⍺.⎕DF ⍵)⊢⍕⍺}⍵.⎕DF ⎕NULL}</code>
</div>
<code class="header" id="listing_377">#.Laguntza.Laguntza.ShowEggTimer &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowEggTimer←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      0=∆Ref.⎕NC'n':⍬</code>
<code> [3]      ∆Ref.n.(form browser_sf).CursorObj←1</code>
<code> [4]      ∆Ref.n.browser.Size←0 0   ⍝ Without this trick the browser area would not show an egg timer</code>
<code> [5]      1:r←⍬</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_378">#.Laguntza.Laguntza.ShowPageNotFound &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ShowPageNotFound←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       ⍺←''             ⍝ Can be the topic identifier that did not work</code>
<code> [3]       A←∆Ref.d.A</code>
<code> [4]       html←HTML.WrapInHtml ∆Ref 2(PageNotFound ⍬)0</code>
<code> [5]       _←{0::⍬ ⋄ ⍬⊣⍵.n.browser.Document.close}∆Ref</code>
<code> [6]       _←∆Ref{0::⍬ ⋄ ⍬⊣⍺.n.browser.Document.write⊂∊⍵}html</code>
<code> [7]       ⍬</code>
<code> [8]  ⍝ Display a "Page not found" page in the right pane</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_379">#.Laguntza.Laguntza.ShowTopic &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref ShowTopic id</code>
<code> [1]  ⍝ [0] Makes the form visible.\\</code>
<code> [2]  ⍝ [1] Converts "id" into a row number pointing into `∆Ref.d.tree`. "id" can be one of:\\</code>
<code> [3]  ⍝ * A simple name. However, if this identifies more than on page only the first one is displayed.</code>
<code> [4]  ⍝ * A full path like `#.MyDoc.Ref.AllFns.MyFns`.</code>
<code> [5]  ⍝ * An integer. This is treated then as a `TopicID`. This is the recommended way.</code>
<code> [6]  ⍝   (See method `FindTopic` for an easy way to find a `TopicID`).</code>
<code> [7]  ⍝</code>
<code> [8]  ⍝</code>
<code> [9]  ⍝ [2] Makes sure that this row is displayed.\\</code>
<code> [10] ⍝ Returns a 0 in case "id" could not be identified ("Page not found" is displayed then)</code>
<code> [11] ⍝ or a 1 in case it could.</code>
<code> [12]  r←0</code>
<code> [13]  :If '.'∊id</code>
<code> [14]      bool←((-≢id)↑¨GetParentAndTopicNameAsText ∆Ref.d.tree)≡¨⊂id</code>
<code> [15]  :Else</code>
<code> [16]      bool←∆Ref.d.tree[;I.TopicName]≡¨⊂id</code>
<code> [17]  :EndIf</code>
<code> [18]  :If 0=+/bool</code>
<code> [19]      {}(⍕id)ShowPageNotFound ∆Ref</code>
<code> [20]  :Else</code>
<code> [21]      Display ∆Ref(bool⍳1)       ⍝ Show the first hit</code>
<code> [22]  :EndIf</code>
<code> [23]  ∆Ref.Visible←1</code>
</div>
<code class="header" id="listing_380">#.Laguntza.Laguntza.Size &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Size←{</code>
<code> [1]  ⍝ Placeholder to prevent users from setting the "Size" property</code>
<code> [2]  }</code>
</div>
<code class="header" id="listing_381">#.Laguntza.Laguntza.Version &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Version</code>
<code> [1]  ⍝ See also `History`</code>
<code> [2]  r←'Laguntza' '6.0.0+273' '2023-07-11'</code>
</div>
<code class="header" id="listing_382">#.Laguntza.Laguntza.WhereAreTheChildren &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  WhereAreTheChildren←{</code>
<code> [1]  ⍝ Returns a vector of booleans indicating the direct children of ⍵[0] (no grand-children).</code>
<code> [2]  ⍝ ⍵ is a vector of integers, typically "Depth" of a TreeView.</code>
<code> [3]  ⍝ ⍺ is the (optional) item number in ⍵ and defaults to 0.</code>
<code> [4]       ⍺←0</code>
<code> [5]       in←⍺</code>
<code> [6]       int←in↓⍵                       ⍝ Depth</code>
<code> [7]       (0=≢int):⍬</code>
<code> [8]       bool←{0,∧\int[0]&lt;1↓⍵}int</code>
<code> [9]       in+1+⍸(1+↑int)=bool/int</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_383">#.Laguntza.Laguntza.WindowStateNormal &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> R←WindowStateNormal</code>
<code> [1]  R←0</code>
</div>
<code class="header" id="listing_384">#.Laguntza.Laguntza.API.CloseHelp &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CloseHelp←{1:shy←##.CloseHelp ⍵}</code>
</div>
<code class="header" id="listing_385">#.Laguntza.Laguntza.API.CompileHelpFile &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CompileHelpFile←{1:shy←##.CompileHelpFile ⍵}</code>
</div>
<code class="header" id="listing_386">#.Laguntza.Laguntza.API.CreateParms &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CreateParms←{⍺←⊢ ⋄ ⍺ ##.CreateParms ⍵}</code>
</div>
<code class="header" id="listing_387">#.Laguntza.Laguntza.API.CreateStub &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CreateStub←{⍺←⊢ ⋄ 1:shy←⍺ ##.CreateStub ⍵}</code>
</div>
<code class="header" id="listing_388">#.Laguntza.Laguntza.API.FindTopic &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> FindTopic←{⍺←⊢ ⋄ ⍺ ##.FindTopic ⍵}</code>
</div>
<code class="header" id="listing_389">#.Laguntza.Laguntza.API.GetNoClose &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetNoClose←{⍺←⊢ ⋄ ⍺ ##.GetNoClose ⍵}</code>
</div>
<code class="header" id="listing_390">#.Laguntza.Laguntza.API.GetVisible &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetVisible←{⍺←⊢ ⋄ ⍺ ##.GetVisible ⍵}</code>
</div>
<code class="header" id="listing_391">#.Laguntza.Laguntza.API.Inject∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Inject∆TopicProperties←{⍺←⊢ ⋄ ⍺ ##.Inject∆TopicProperties ⍵}</code>
</div>
<code class="header" id="listing_392">#.Laguntza.Laguntza.API.LoadHelpWithSalt &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> LoadHelpWithSalt←{##.LoadHelpWithSalt ⍵}</code>
</div>
<code class="header" id="listing_393">#.Laguntza.Laguntza.API.New &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> New←{⍺←⊢ ⋄ 1:shy←⍺ ##.New ⍵}</code>
</div>
<code class="header" id="listing_394">#.Laguntza.Laguntza.API.SaveHelpSystemWithSalt &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SaveHelpSystemWithSalt←{1:shy←##.SaveHelpSystemWithSalt ⍵}</code>
</div>
<code class="header" id="listing_395">#.Laguntza.Laguntza.API.Selfie &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Selfie←{⍺←⊢ ⋄ 1:shy←⍺ ##.Selfie ⍵}</code>
</div>
<code class="header" id="listing_396">#.Laguntza.Laguntza.API.SetNoClose &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetNoClose←{⍺←⊢ ⋄ ⍺ ##.SetNoClose ⍵}</code>
</div>
<code class="header" id="listing_397">#.Laguntza.Laguntza.API.SetVisible &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetVisible←{⍺←⊢ ⋄ ⍺ ##.SetVisible ⍵}</code>
</div>
<code class="header" id="listing_398">#.Laguntza.Laguntza.API.ShowTopic &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ShowTopic←{⍺←⊢ ⋄ 1:shy←⍺ ##.ShowTopic ⍵}</code>
</div>
<code class="header" id="listing_399">#.Laguntza.Laguntza.AskString.OnConfigure &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnConfigure←{⍵[0 1 2 3],(↑⍺),(⍵[5]⌈↑1⌽⍺)}</code>
</div>
<code class="header" id="listing_400">#.Laguntza.Laguntza.File.CloseFile &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CloseFile←{</code>
<code> [1] ⍝ Close the file</code>
<code> [2]      ∆Ref←⍵</code>
<code> [3]      0=∆Ref.⎕NC'f':⍬</code>
<code> [4]      0=∆Ref.f.⎕NC'tieNo':r←⍬</code>
<code> [5]      _←⎕FUNTIE ∆Ref.f.tieNo</code>
<code> [6]      ∆Ref.f.tieNo←⍬</code>
<code> [7]      1:shy←⍬</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_401">#.Laguntza.Laguntza.File.CopyFilesTo &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CopyFilesTo←{</code>
<code> [1] ⍝ Copies ⍺ to ⍵</code>
<code> [2] ⍝ ⍺ and ⍵ can be either simple strings each being treated as a filename</code>
<code> [3] ⍝ or a vector of strings.</code>
<code> [4]      (~0 1∊⍨≡⍵):⍺ ∇¨⍵</code>
<code> [5]      rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code> [6]      {0::⍬ ⋄ ⍬⊣rf.CopyFile ⍵}⍺ ⍵</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_402">#.Laguntza.Laguntza.File.DealWithFiles &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  DealWithFiles←{</code>
<code> [1]  ⍝ Re-creates the files needed by the Laguntza GUI</code>
<code> [2]       ∆Ref←⍵</code>
<code> [3]       _←CloseFile ∆Ref</code>
<code> [4]       ∆Ref.f←⎕NS''</code>
<code> [5]       ∆Ref←EstablishFileIndexVars ∆Ref</code>
<code> [6]       ∆Ref.f.filename←GetHelpFileName</code>
<code> [7]       flag←DoesFolderExist ∆Ref.p.folderName</code>
<code> [8]       _←MakeDir⍣(~flag)⊣∆Ref.p.folderName,'\Assets\CSS'</code>
<code> [9]       _←MakeDir⍣(~flag)⊣∆Ref.p.folderName,'\Assets\Images'</code>
<code> [10]      filename←∆Ref.p.folderName,'\',∆Ref.f.filename</code>
<code> [11]      _←DeleteFile filename</code>
<code> [12]      ∆Ref.f.tieNo←filename ⎕FCREATE 0</code>
<code> [13]      _←{''⎕FAPPEND ∆Ref.f.tieNo}¨⍳10    ⍝ 10 reserved records</code>
<code> [14]      1:shy←⍬</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_403">#.Laguntza.Laguntza.File.DeleteFile &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> DeleteFile←{</code>
<code> [1] ⍝ Removes file ⍵</code>
<code> [2]      filename←⍵</code>
<code> [3]      rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code> [4]      {11::1 ⋄ 6::0 ⋄ 0⊣⍵.DeleteFile(filename~'"')1}rf</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_404">#.Laguntza.Laguntza.File.DoesFolderExist &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> DoesFolderExist←{</code>
<code> [1] ⍝ Checks whether folder ⍵ does exist or not.</code>
<code> [2] ⍝ ⍵ can be either simple text vector (= a folder name)</code>
<code> [3] ⍝ or a vector of text vectors each being a folder name.</code>
<code> [4]      (~0 1∊⍨≡⍵):∇¨⍵</code>
<code> [5]      rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code> [6]      rf.FolderExists⊂⍵</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_405">#.Laguntza.Laguntza.File.EstablishFileIndexVars &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EstablishFileIndexVars←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      ∆Ref.f.(∆parms←1+∆caption←1+∆index←1+∆Words←1+∆words←1+∆tree←1)</code>
<code> [3]      ∆Ref</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_406">#.Laguntza.Laguntza.File.GetHelpFileName &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←GetHelpFileName</code>
<code> [1]  r←'Laguntza.dcf'</code>
</div>
<code class="header" id="listing_407">#.Laguntza.Laguntza.File.GetHtmlFromFile &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetHtmlFromFile←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      ⎕FREAD ∆Ref.f.tieNo,1+10+⍵</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_408">#.Laguntza.Laguntza.File.MakeDir &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←MakeDir dir</code>
<code> [1]   ⍝ Creates a folder. Returns an IFolder object or ⍬</code>
<code> [2]   r←⍬</code>
<code> [3]   rf←⍎'FO'⎕WC⊢FO←'OLECLIENT' 'Scripting.FileSystemObject'</code>
<code> [4]   ((dir='/')/dir)←'\'</code>
<code> [5]   dir←{∧/bool←~'\\'⍷⍵:⍵ ⋄ ∇ bool/⍵}dir  ⍝ Remove one of any "\\"</code>
<code> [6]   levels←∪{⍺,'\',⍵}\'\'##.A.Split dir</code>
<code> [7]   bool←rf{((,':')≡,1↓⍵):1 ⋄ ((2='\'+.=⍵)∧'\\'≡2↑⍵):1 ⋄ (⍺.FolderExists⊂⍵):1 ⋄ 0}¨levels</code>
<code> [8]   :If ~∧/bool</code>
<code> [9]       :For path :In (~bool)/levels</code>
<code> [10]          :If ~rf.FolderExists⊂path</code>
<code> [11]              rf.CreateFolder⊂path~'"'</code>
<code> [12]          :EndIf</code>
<code> [13]      :EndFor</code>
<code> [14]  :EndIf</code>
</div>
<code class="header" id="listing_409">#.Laguntza.Laguntza.File.OpenFilesAndGetTree &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OpenFilesAndGetTree←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       _←CloseFile ∆Ref</code>
<code> [3]       f←∆Ref.p.folderName,'\',∆Ref.f.filename</code>
<code> [4]       ∆Ref.f.tieNo←f ⎕FSTIE 0</code>
<code> [5]       tree←⎕FREAD ∆Ref.f.(tieNo ∆tree)</code>
<code> [6]  </code>
<code> [7]     ⍝ ↓↓↓ Was written as text in order to overcome Dyalog bug &lt;01157&gt;</code>
<code> [8]       tree[;##.I.Parent]←{9≠⎕NC ⍵:⍵ ⋄ ⍎⍵}¨tree[;##.I.Parent]</code>
<code> [9]     ⍝ ↑↑↑ However, the refs are NOT needed for the stand-alone EXE!</code>
<code> [10] </code>
<code> [11]      tree</code>
<code> [12] ⍝ Opens all files and reads (and returns) the tree from its file.</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_410">#.Laguntza.Laguntza.GUI.AddPosnAndSizeFor &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> AddPosnAndSizeFor←{</code>
<code> [1]      +⌿⊃⍵.(Posn Size)</code>
<code> [2]  }</code>
</div>
<code class="header" id="listing_411">#.Laguntza.Laguntza.GUI.CreateActiveX &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CreateActiveX←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      n←∆Ref.n</code>
<code> [3]      n.WEBBROWSER←'WEBBROWSER'n.browser_sf.⎕WC'OCXClass' 'Microsoft Web Browser'</code>
<code> [4]      ⍬</code>
<code> [5]  ⍝ Creates just the Internet Explorer ActiveX control</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_412">#.Laguntza.Laguntza.GUI.CreateActiveXContainer &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateActiveXContainer←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]       _←CreateActiveX ∆Ref</code>
<code> [4]       ∆←⊂'WEBBROWSER'</code>
<code> [5]       ∆,←⊂'Coord' 'Prop'</code>
<code> [6]       ∆,←⊂'Size' 0 0             ⍝ Without this trick the browser area would not show an egg timer</code>
<code> [7]       ∆,←⊂'Posn' 0 0</code>
<code> [8]       ∆,←⊂'QueueEvents' 1</code>
<code> [9]       ∆,←⊂'Silent' 1</code>
<code> [10]      n.browser←⍎'wb'n.browser_sf.⎕WC ∆</code>
<code> [11]      n.browser.onTitleChange←'OnTitleChangeInWebBrowser'</code>
<code> [12]      n.browser.on9991←'On9991'</code>
<code> [13]      _←n.browser.⎕WS'Event' 'BeforeNavigate2'(FullPathToHandler'OnBeforeNavigate')</code>
<code> [14]      _←{6::⍬ ⋄ _←n.browser.Navigate⊂⍵}'about:blank'</code>
<code> [15]      _←{6::⍬ ⋄ _←n.browser.Document.Close}⍬</code>
<code> [16]      ⍬</code>
<code> [17]  ⍝ Creates the object that is the Internet Explorer ActiveX control and</code>
<code> [18]  ⍝ adds a container for that control to the subform on the right pane of the GUI.</code>
<code> [19]  }</code>
</div>
<code class="header" id="listing_413">#.Laguntza.Laguntza.GUI.CreateBrowser &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateBrowser←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]       A←∆Ref.d.A</code>
<code> [4]       ∆←⊂'SubForm'</code>
<code> [5]       ∆,←⊂'Coord' 'Prop'</code>
<code> [6]       ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [7]       ∆,←⊂'Active' 0</code>
<code> [8]       n.browser_sf←⍎'sf'∆Ref.n.form.⎕WC ∆</code>
<code> [9]       _←CreateActiveXContainer ∆Ref</code>
<code> [10]      _←CreateSplitter ∆Ref</code>
<code> [11]      _←2 ⎕NQ n.splitter'EndSplit',0 260,n.splitter.Size     ⍝ Move it</code>
<code> [12]      ∆Ref.n.splitter.Posn[1]⌈←∆Ref.p.splitterPosn[1]</code>
<code> [13]      ⍬</code>
<code> [14]  ⍝ Creates a control which displays the real help.</code>
<code> [15]  ⍝ With ∆Ref.p.format←'TEXT' an "Edit" control can be forced as a replacement.</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_414">#.Laguntza.Laguntza.GUI.CreateDevelopersMenu &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateDevelopersMenu←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]  </code>
<code> [4]       ∆Ref.p.userMode:⍬⊣n.developersMenu←⍬ ⍝ Get out if it's a RunTime</code>
<code> [5]  </code>
<code> [6]       tab←⎕UCS 9</code>
<code> [7]       eh←FullPathToHandler'##.OnMenuCmd'    ⍝ Event handler</code>
<code> [8]       n.developersMenu←⍎'dev'n.menubar.⎕WC'Menu' '&amp;Developers'('Align' 'Right')</code>
<code> [9]  </code>
<code> [10]      ∆←⊂'MenuItem'</code>
<code> [11]      ∆,←⊂'Compile Help',(⎕UCS 9),'Shift+F5'</code>
<code> [12]      ∆,←⊂'Event' 'Select'eh</code>
<code> [13]      ∆,←⊂'Accelerator'(116 1)</code>
<code> [14]      ∆,←⊂'Hint' 'All help files are re-created from scratch; then the GUI is updated'</code>
<code> [15]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [16]      n.compileHelp←⍎'compile'n.developersMenu.⎕WC ∆</code>
<code> [17] </code>
<code> [18]      ∆←⊂'MenuItem'</code>
<code> [19]      ∆,←⊂'Show topic in browser'</code>
<code> [20]      ∆,←⊂'Event' 'Select'eh</code>
<code> [21]      ∆,←⊂'Hint' 'Puts the current topic in your default browser; useful for HTML/CSS checking'</code>
<code> [22]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [23]      n.showHtmlFile←⍎'showHtmlFile'n.developersMenu.⎕WC ∆</code>
<code> [24] </code>
<code> [25]      ∆←⊂'MenuItem'</code>
<code> [26]      ∆,←⊂'Show the HTML'</code>
<code> [27]      ∆,←⊂'Event' 'Select'eh</code>
<code> [28]      ∆,←⊂'Hint' 'Shows the HTML of the WebBrowser ActiveX control '</code>
<code> [29]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [30]      n.showHtml←⍎'showHtml'n.developersMenu.⎕WC ∆</code>
<code> [31] </code>
<code> [32]      ∆←⊂'MenuItem'</code>
<code> [33]      ∆,←⊂'Create proofread document'</code>
<code> [34]      ∆,←⊂'Event' 'Select'eh</code>
<code> [35]      ∆,←⊂'Hint' 'Creates an HTML document with all the help pages useful for opening with a word processor'</code>
<code> [36]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [37]      n.proofRead←⍎'proofRead'n.developersMenu.⎕WC ∆</code>
<code> [38] </code>
<code> [39]      ∆←⊂'MenuItem'</code>
<code> [40]      ∆,←⊂'Browse internal data'</code>
<code> [41]      ∆,←⊂'Event' 'Select'eh</code>
<code> [42]      ∆,←⊂'Hint' 'Puts the internal data driving the GUI into a []ED window'</code>
<code> [43]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [44]      n.browseTree←⍎'browseTree'n.developersMenu.⎕WC ∆</code>
<code> [45] </code>
<code> [46]      n.developersMenuSep1←⍎'s1'n.developersMenu.⎕WC'Separator'</code>
<code> [47] </code>
<code> [48]      eh CreateReportSubMenu ∆Ref</code>
<code> [49] ⍝ Create the "developer" menu (only in non-user mode)</code>
<code> [50] ⍝ Offers utilities useful for developers</code>
<code> [51]  }</code>
</div>
<code class="header" id="listing_415">#.Laguntza.Laguntza.GUI.CreateEditMenu &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateEditMenu←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       tab←⎕UCS 9</code>
<code> [3]       eh←FullPathToHandler'##.OnMenuCmd'  ⍝ Event handler</code>
<code> [4]       ∆Ref.n.editMenu←⍎'edit'∆Ref.n.menubar.⎕WC'Menu' '&amp;Edit'</code>
<code> [5]       tx←'Collapse all branches in the tree'</code>
<code> [6]       ∆Ref.n.collapse←⍎'collapse'∆Ref.n.editMenu.⎕WC'MenuItem'('Collapse all',tab,'Ctrl+Shift+"-"')('Event' 'Select'eh)('Hint'tx)('Accelerator'(109 3))('HintObj'∆Ref.n.infoSB)</code>
<code> [7]       tx←'Expand all branches in the tree'</code>
<code> [8]       ∆Ref.n.expand←⍎'expand'∆Ref.n.editMenu.⎕WC'MenuItem'('Expand all',tab,'Ctrl+Shift+"+"')('Event' 'Select'eh)('Hint'tx)('Accelerator'(107 3))('HintObj'∆Ref.n.infoSB)</code>
<code> [9]  </code>
<code> [10]     ⍝ _←'f.mb.edit.s1'⍵.⎕WC'Separator'</code>
<code> [11]     ⍝ ↓↓↓ Unfortunately, "Find" won't work with the IE ActiveC control.</code>
<code> [12]     ⍝ _←'f.mb.edit.find'⍵.⎕WC'MenuItem'('Caption'('Find',tab,'Ctrl+F'))('Event' 'Select' (FullPathToHandler'##.OnFind'))</code>
<code> [13] </code>
<code> [14]      ∆Ref.p.userMode:⍬</code>
<code> [15] </code>
<code> [16]      ∆Ref.n.editMenuSep1←⍎'sep1'∆Ref.n.editMenu.⎕WC'Separator'</code>
<code> [17] </code>
<code> [18]      ∆←⊂'MenuItem'</code>
<code> [19]      ∆,←⊂'Go to row number...',tab,'Ctrl+Shift+R'</code>
<code> [20]      ∆,←⊂'Event' 'Select'eh</code>
<code> [21]      ∆,←⊂'Hint' 'Aks for a row number and then show that row'</code>
<code> [22]      ∆,←⊂'HintObj'∆Ref.n.infoSB</code>
<code> [23]      ∆,←⊂'Accelerator'(82 3)</code>
<code> [24]      ∆Ref.n.gotoRow←⍎'gotoRow'∆Ref.n.editMenu.⎕WC ∆</code>
<code> [25] </code>
<code> [26]      ∆←⊂'MenuItem'</code>
<code> [27]      ∆,←⊂'Go to next emphasized topic',tab,'Ctrl+Shift+G'</code>
<code> [28]      ∆,←⊂'Event' 'Select'eh</code>
<code> [29]      ∆,←⊂'Hint' 'Use this to go through all emphazised topics'</code>
<code> [30]      ∆,←⊂'HintObj'∆Ref.n.infoSB</code>
<code> [31]      ∆,←⊂'Accelerator'(71 3)</code>
<code> [32]      ∆Ref.n.nextBold←⍎'nextBold'∆Ref.n.editMenu.⎕WC ∆</code>
<code> [33] </code>
<code> [34]      ∆←⊂'MenuItem'</code>
<code> [35]      ∆,←⊂'Reset any emphasized topics'</code>
<code> [36]      ∆,←⊂'Event' 'Select'eh</code>
<code> [37]      ∆,←⊂'Hint' 'Undo any emphasizing done by one of the reports'</code>
<code> [38]      ∆,←⊂'HintObj'∆Ref.n.infoSB</code>
<code> [39]      ∆Ref.n.undo←⍎'unbold'∆Ref.n.editMenu.⎕WC ∆</code>
<code> [40] </code>
<code> [41]      ∆Ref.n.editMenuSep2←⍎'sep2'∆Ref.n.editMenu.⎕WC'Separator'</code>
<code> [42] </code>
<code> [43]      ∆←⊂'MenuItem'</code>
<code> [44]      ∆,←⊂'Edit (or inject) ∆TopicProperties',tab,'Ctrl+T'</code>
<code> [45]      ∆,←⊂'Event' 'Select'eh</code>
<code> [46]      ∆,←⊂'Accelerator'(84 2)</code>
<code> [47]      ∆,←⊂'Hint' 'Edit an existing or inject a new ∆TopicProperties function'</code>
<code> [48]      ∆,←⊂'HintObj'∆Ref.n.infoSB</code>
<code> [49]      ∆Ref.n.handleTopicProperties←⍎'handleTopicProperties'∆Ref.n.editMenu.⎕WC ∆</code>
<code> [50] </code>
<code> [51]      ⍬</code>
<code> [52]      ⍝ Create the "Edit" menu</code>
<code> [53]  }</code>
</div>
<code class="header" id="listing_416">#.Laguntza.Laguntza.GUI.CreateFileMenu &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateFileMenu←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       tab←⎕UCS 9</code>
<code> [3]       ∆Ref.n.fileMenu←⍎'file'∆Ref.n.menubar.⎕WC'Menu' '&amp;File'</code>
<code> [4]       ∆Ref.n.export←⍎'export'∆Ref.n.fileMenu.⎕WC'MenuItem' 'Export as HTML...'</code>
<code> [5]       ∆Ref.n.export.onSelect←FullPathToHandler'##.OnMenuCmd'</code>
<code> [6]       ∆Ref.n.fileMenuSep1←⍎'sep1'∆Ref.n.fileMenu.⎕WC'Separator'</code>
<code> [7]       tx←'Exit help',tab,'Ctrl+W'</code>
<code> [8]       ∆Ref.n.quitApp←⍎'quit'∆Ref.n.fileMenu.⎕WC'MenuItem'(tx)('Accelerator'(87 2))</code>
<code> [9]       ∆Ref.n.quitApp.onSelect←FullPathToHandler'##.OnMenuCmd'</code>
<code> [10]      ⍬</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_417">#.Laguntza.Laguntza.GUI.CreateForm &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateForm←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       ∆←⊂'Form'</code>
<code> [3]       ∆,←⊂'Caption'∆Ref.p.helpCaption</code>
<code> [4]       ∆,←⊂'Coord' 'Pixel'</code>
<code> [5]       ∆,←⊂'Posn'∆Ref.p.posn</code>
<code> [6]       ∆,←⊂'Visible'∆Ref.p.visible</code>
<code> [7]       ∆,←⊂'Event' 'Close'(FullPathToHandler'##.OnClose')</code>
<code> [8]       ∆,←⊂'HintObj' 'f.sb.info'</code>
<code> [9]       ∆,←⊂'KeepOnClose' 0</code>
<code> [10]      ∆Ref.n.form←⍎∆Ref.⎕WC ∆</code>
<code> [11]      ∆Ref.n.form.Size←∆Ref.p.size</code>
<code> [12]      ∆Ref.n.form.IconObj←##.Icons.HandleIcon ∆Ref</code>
<code> [13]      ∆Ref.n.tipField←⍎'tipfield'∆Ref.n.form.⎕WC'TipField'</code>
<code> [14]      ∆Ref.n.tipField←⍎'tipfield'∆Ref.n.form.⎕WC'TipField'</code>
<code> [15]      ∆Ref.n.form.TipObj←∆Ref.n.tipField</code>
<code> [16]      ∆Ref.n.font←⍎'font'∆Ref.n.form.⎕WC'Font' 'Verdana' 14</code>
<code> [17]      ∆Ref.n.indexFont←⍎'font'∆Ref.n.form.⎕WC'Font' 'Courier New' 16</code>
<code> [18]      ∆Ref.n.form.FontObj←∆Ref.n.font</code>
<code> [19]      ∆Ref.n.form.∆FontSizes←GetFontSizesOf ∆Ref.n.font</code>
<code> [20]      ∆Ref.n.form.onConfigure←(FullPathToHandler'OnConfigure')(200 360)</code>
<code> [21]      ∆Ref.n.form.onKeyPress←(FullPathToHandler'OnKeyPressInForm')</code>
<code> [22]      ∆Ref.n.form.CursorObj←1    ⍝ We cannot use "##.ShowEggTimer" yet</code>
<code> [23]      ∆Ref.on9996←1              ⍝ Use to quit ⎕DQ, in particular in the test cases</code>
<code> [24]      ⍬</code>
<code> [25]  ⍝ Create the Form and process "posn" and "size" parameters.</code>
<code> [26]  ⍝ "Size" can be numeric but also '75% or ('75%','30%') for example.</code>
<code> [27]  ⍝ Size and Posn passed as parms when calling the main function overule</code>
<code> [28]  ⍝ defaults which are overuled by Windows Registry.</code>
<code> [29]  }</code>
</div>
<code class="header" id="listing_418">#.Laguntza.Laguntza.GUI.CreateGui &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateGui←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       ∆Ref.n←⎕NS'∆List'</code>
<code> [3]       _←CreateForm ∆Ref</code>
<code> [4]       _←CreateHiddenButtons ∆Ref</code>
<code> [5]       _←CreateToolbar ∆Ref</code>
<code> [6]       _←CreateStatusbar ∆Ref</code>
<code> [7]       _←CreateMenus ∆Ref</code>
<code> [8]       _←CreateTabs ∆Ref</code>
<code> [9]       _←CreateTreeView ∆Ref</code>
<code> [10]      _←CreateSearch ∆Ref</code>
<code> [11]      _←CreateIndex ∆Ref</code>
<code> [12]      _←CreateBrowser ∆Ref</code>
<code> [13]      _←##.ShowEggTimer ∆Ref             ⍝ Now the objects exist</code>
<code> [14]      ∆Ref.n.∆Ref←∆Ref</code>
<code> [15]      _←EstablishTabSelectHandler ∆Ref   ⍝ Make sure that tab changes are handled</code>
<code> [16]      ∆Ref.d.currentTabIs←∆Ref.n.tree    ⍝ Used to overcome the focus problem; see OnTitleChangeInWebBrowser</code>
<code> [17]      (0=∆Ref.p.visible):⍬</code>
<code> [18]      ⍬⊣2 ⎕NQ ∆Ref.n.tree'Flush'</code>
<code> [19] ⍝ Creates the main GUI</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_419">#.Laguntza.Laguntza.GUI.CreateHelpMenu &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←CreateHelpMenu ∆Ref</code>
<code> [1]   r←⍬</code>
<code> [2]   ∆Ref.n.HelpMenu←⍎'help'∆Ref.n.menubar.⎕WC'Menu' '&amp;Help'</code>
<code> [3]   tx←'Provides information about this program'</code>
<code> [4]   flag←{82 80 160∊⍨⎕DR ⍵:1 ⋄ (,0)≢,⍵}∆Ref.p.helpAbout</code>
<code> [5]   :If flag</code>
<code> [6]       ∆Ref.n.about←flag/⍎'about'∆Ref.n.HelpMenu.⎕WC'MenuItem' 'About...'('Event' 'Select'(FullPathToHandler'##.OnMenuCmd'))('Hint'tx)</code>
<code> [7]   :EndIf</code>
<code> [8]   :If ~∆Ref.p.userMode</code>
<code> [9]       :If flag</code>
<code> [10]          ∆Ref.n.helpSep1←flag/⍎'sep1'∆Ref.n.HelpMenu.⎕WC'Separator'</code>
<code> [11]      :EndIf</code>
<code> [12]      ∆Ref.n.helpHelp←⍎'helpHelp'∆Ref.n.HelpMenu.⎕WC'MenuItem' 'Help on Laguntza'('Event' 'Select'(FullPathToHandler'##.OnMenuCmd'))('Hint'tx)</code>
<code> [13]  :EndIf</code>
</div>
<code class="header" id="listing_420">#.Laguntza.Laguntza.GUI.CreateHiddenButtons &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateHiddenButtons←{</code>
<code> [1]  ⍝ The button are used for establishiung accelerator keys only.</code>
<code> [2]       ∆Ref←⍵</code>
<code> [3]  </code>
<code> [4]       ∆←''</code>
<code> [5]       ∆,←⊂'Caption' 'Edit help function'</code>
<code> [6]       ∆,←⊂'Accelerator'(13 2)</code>
<code> [7]       ∆,←⊂'Posn'(¯5 ¯5)</code>
<code> [8]       ∆,←⊂'Size'(1 1)</code>
<code> [9]       ∆Ref.n.editHelpFnsBtn←∆Ref.n.form.⎕NEW'Button'∆</code>
<code> [10]      ∆Ref.n.editHelpFnsBtn.onSelect←'OnEditFromMainMenu'</code>
<code> [11] </code>
<code> [12] </code>
<code> [13] ⍝ We need three buttons for Ctrl+0 because the numeric Keypad generates different codes and NumLock makes also a difference:</code>
<code> [14]      ∆←''</code>
<code> [15]      ∆,←⊂'Caption' 'Restore default font size for TreeView'</code>
<code> [16]      ∆,←⊂'Accelerator'(96 2)</code>
<code> [17]      ∆,←⊂'Posn'(¯5 ¯7)</code>
<code> [18]      ∆,←⊂'Size'(1 1)</code>
<code> [19]      ∆Ref.n.restoreDefaultFontSizeForTV1←∆Ref.n.form.⎕NEW'Button'(∆,⊂'Accelerator'(48 2))</code>
<code> [20]      ∆Ref.n.restoreDefaultFontSizeForTV1.onSelect←'OnRestoreDefaultFontSizeForTV'∆Ref</code>
<code> [21]      ∆Ref.n.restoreDefaultFontSizeForTV2←∆Ref.n.form.⎕NEW'Button'(∆,⊂'Accelerator'(45 2))</code>
<code> [22]      ∆Ref.n.restoreDefaultFontSizeForTV2.onSelect←'OnRestoreDefaultFontSizeForTV'∆Ref</code>
<code> [23]      ∆Ref.n.restoreDefaultFontSizeForTV3←∆Ref.n.form.⎕NEW'Button'(∆,⊂'Accelerator'(96 2))</code>
<code> [24]      ∆Ref.n.restoreDefaultFontSizeForTV3.onSelect←'OnRestoreDefaultFontSizeForTV'∆Ref</code>
<code> [25] </code>
<code> [26] ⍝ We need two buttons for Ctrl++ and Ctrl+- because the numeric Keypad generates different codes:</code>
<code> [27]      ∆,←⊂'Caption' 'Increase font size for TreeView'</code>
<code> [28]      ∆,←⊂'Posn'(¯5 ¯9)</code>
<code> [29]      ∆,←⊂'Size'(1 1)</code>
<code> [30]      ∆Ref.n.IncreaseFontSizeForTV1←∆Ref.n.form.⎕NEW'Button'(∆,⊂'Accelerator'(107 2))</code>
<code> [31]      ∆Ref.n.IncreaseFontSizeForTV1.onSelect←'OnIncreaseDefaultFontSizeForTV'∆Ref</code>
<code> [32]      ∆Ref.n.IncreaseFontSizeForTV2←∆Ref.n.form.⎕NEW'Button'(∆,⊂'Accelerator'(187 3))</code>
<code> [33]      ∆Ref.n.IncreaseFontSizeForTV2.onSelect←'OnIncreaseDefaultFontSizeForTV'∆Ref</code>
<code> [34] </code>
<code> [35]      ∆,←⊂'Caption' 'Decrease font size for TreeView'</code>
<code> [36]      ∆,←⊂'Posn'(¯5 ¯11)</code>
<code> [37]      ∆,←⊂'Size'(1 1)</code>
<code> [38]      ∆Ref.n.DecreaseFontSizeForTV1←∆Ref.n.form.⎕NEW'Button'(∆,⊂'Accelerator'(109 2))</code>
<code> [39]      ∆Ref.n.DecreaseFontSizeForTV1.onSelect←'OnDecreaseDefaultFontSizeForTV'∆Ref</code>
<code> [40]      ∆Ref.n.DecreaseFontSizeForTV2←∆Ref.n.form.⎕NEW'Button'(∆,⊂'Accelerator'(189 2))</code>
<code> [41]      ∆Ref.n.DecreaseFontSizeForTV2.onSelect←'OnDecreaseDefaultFontSizeForTV'∆Ref</code>
<code> [42] </code>
<code> [43]      ⍬</code>
<code> [44]  }</code>
</div>
<code class="header" id="listing_421">#.Laguntza.Laguntza.GUI.CreateMenus &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateMenus←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       tab←⎕UCS 9</code>
<code> [3]       ∆Ref.n.menubar←⍎'mb'⍵.⎕WC'Menubar'</code>
<code> [4]       _←CreateFileMenu ∆Ref</code>
<code> [5]       _←CreateEditMenu ∆Ref</code>
<code> [6]       _←CreateBookmarkMenu ∆Ref</code>
<code> [7]       _←CreateHelpMenu ∆Ref</code>
<code> [8]       _←CreateDevelopersMenu ∆Ref</code>
<code> [9]       ⍬</code>
<code> [10]  ⍝ Creates the menubar, the menus and the menu items</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_422">#.Laguntza.Laguntza.GUI.CreateReportSubMenu &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateReportSubMenu←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       handler←⍺</code>
<code> [3]       n←∆Ref.n</code>
<code> [4]  </code>
<code> [5]       ∆←⊂'Menu'</code>
<code> [6]       ∆,←⊂'Reports'</code>
<code> [7]       n.reportMenu←⍎'reports'n.developersMenu.⎕WC ∆</code>
<code> [8]  </code>
<code> [9]       ∆←⊂'MenuItem'</code>
<code> [10]      ∆,←⊂'Broken links'</code>
<code> [11]      ∆,←⊂'Event' 'Select'handler</code>
<code> [12]      ∆,←⊂'Hint' 'Report all broken links in all topics'</code>
<code> [13]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [14]      n.reportBrokenLinks←⍎'reportBrokenLinks'n.reportMenu.⎕WC ∆</code>
<code> [15] </code>
<code> [16]      ∆←⊂'MenuItem'</code>
<code> [17]      ∆,←⊂'Ambiguous links'</code>
<code> [18]      ∆,←⊂'Event' 'Select'handler</code>
<code> [19]      ∆,←⊂'Hint' 'Reports all ambiguous links in all topics'</code>
<code> [20]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [21]      n.reportAmbiguousLinks←⍎'reportAmbiguousLinks'n.reportMenu.⎕WC ∆</code>
<code> [22] </code>
<code> [23]      ∆←⊂'MenuItem'</code>
<code> [24]      ∆,←⊂'TopicProperties'</code>
<code> [25]      ∆,←⊂'Event' 'Select'handler</code>
<code> [26]      ∆,←⊂'Hint' 'Reports whenever ∆TopicProperties does not return all the fns/NS found'</code>
<code> [27]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [28]      n.reportTopicProperties←⍎'reportTopicProperties'n.reportMenu.⎕WC ∆</code>
<code> [29] </code>
<code> [30]      ∆←⊂'MenuItem'</code>
<code> [31]      ∆,←⊂'Missing index entries'</code>
<code> [32]      ∆,←⊂'Event' 'Select'handler</code>
<code> [33]      ∆,←⊂'Hint' 'Reports all help topics that do not carry any index entries'</code>
<code> [34]      ∆,←⊂('HintObj'∆Ref.n.infoSB)</code>
<code> [35] </code>
<code> [36]      n.reportMissingIndexes←⍎'reportMissingIndexes'n.reportMenu.⎕WC ∆</code>
<code> [37] </code>
<code> [38]      ⍬</code>
<code> [39]  }</code>
</div>
<code class="header" id="listing_423">#.Laguntza.Laguntza.GUI.CreateSplitter &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateSplitter←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]       ∆←⊂'Splitter'</code>
<code> [4]       ∆,←⊂'SplitObj1'n.tabControl</code>
<code> [5]       ∆,←⊂'SplitObj2'n.browser_sf</code>
<code> [6]       ∆,←⊂'Align' 'Left'</code>
<code> [7]       ∆,←⊂'BCol'(3⍴0)</code>
<code> [8]       ∆,←⊂'Size'(⍬ 5)</code>
<code> [9]       ∆,←⊂'BCol' 0</code>
<code> [10]      n.splitter←⍎'spl'n.form.⎕WC ∆</code>
<code> [11]      ⍬</code>
<code> [12]  ⍝ Creates the Splitter</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_424">#.Laguntza.Laguntza.GUI.CreateStatusbar &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateStatusbar←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]       n.SB←⍎'sb'⍵.⎕WC'Statusbar'('Coord' 'Pixel')('Attach'('Bottom' 'Left' 'Bottom' 'Right'))</code>
<code> [4]       size←⍵.sb.Size</code>
<code> [5]       n.infoSB←⍎'info'n.SB.⎕WC'Statusfield'('Size'(⍬(0⌈size[1]-480)))('Attach'('Top' 'Left' 'Bottom' 'Right'))</code>
<code> [6]       n.relSB←⍎'rel'n.SB.⎕WC'Statusfield'('Size'(⍬ 130))('Attach'('Top' 'Right' 'Bottom' 'Right'))</code>
<code> [7]       n.pathSB←⍎'path'n.SB.⎕WC'Statusfield'('Size'(⍬ 330))('Attach'('Top' 'Right' 'Bottom' 'Right'))</code>
<code> [8]       n.SB.onContextMenu←'OnStatusbarContextMenu'</code>
<code> [9]       ⍬</code>
<code> [10] ⍝ Creates the statusbar and its fields</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_425">#.Laguntza.Laguntza.GUI.CreateToolbar &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CreateToolbar←{</code>
<code> [1]      ∆←⊂'Toolbar'</code>
<code> [2]      ∆,←⊂'Attach'('Top' 'Left' 'Top' 'Right')</code>
<code> [3]      ⍵.n.toolbar←⍎'tb'⍵.⎕WC ∆</code>
<code> [4]      ⍵.tb.Posn←5 0</code>
<code> [5]      ⍵.tb.Size[0]+←10</code>
<code> [6]      ⍬</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_426">#.Laguntza.Laguntza.GUI.CreateTreeView &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateTreeView←{</code>
<code> [1]       ∆Ref←⍵</code>
<code> [2]       (n p)←∆Ref.(n p)</code>
<code> [3]       ∆←⊂'TreeView'</code>
<code> [4]       ∆,←⊂'Coord' 'Prop'</code>
<code> [5]       ∆,←⊂'Posn'(0 0)</code>
<code> [6]       ∆,←⊂'Size'(100 100)</code>
<code> [7]       ∆,←⊂'Event' 9999(FullPathToHandler'##.OnUpdate')∆Ref</code>
<code> [8]       ∆,←⊂'Attach'('Top' 'Left' 'Bottom' 'Right')</code>
<code> [9]       n.treeFont←⎕NEW'Font'(↓('PName' 'Weight' 'Size'),[0.5]n.font.(PName Weight Size))</code>
<code> [10]      ∆,←⊂'Font'n.treeFont</code>
<code> [11]      n.tree←⍎'tv'n.contents_sf.⎕WC ∆</code>
<code> [12]      n.tree.onKeyPress←(FullPathToHandler'##.OnKeyPressInTreeView')∆Ref</code>
<code> [13]      n.tree.onItemUp←(FullPathToHandler'##.OnItemUpInTreeView')∆Ref</code>
<code> [14]      n.tree.onContextMenu←(FullPathToHandler'##.OnContextMenu')∆Ref</code>
<code> [15]      n.tree.onExpanding←(FullPathToHandler'##.OnExpandingInTreeView')∆Ref</code>
<code> [16]      n.tree.onRetracting←(FullPathToHandler'##.OnRetractingInTreeView')∆Ref</code>
<code> [17]      n.tree.onMouseWheel←'OnMouseWheelInTreeView'</code>
<code> [18]      n.tree.on9998←(FullPathToHandler'OnDelayedUpdate')n.tree</code>
<code> [19]      n.tree.on9997←(FullPathToHandler'On9997InTreeView')</code>
<code> [20]      n.tree.on9993←(FullPathToHandler'On9993EmphasizeSearchTerm')∆Ref</code>
<code> [21]      1=⍵.p.userMode:⍬</code>
<code> [22]      ⍬</code>
<code> [23] ⍝ Creates the treeview and expands the very first entry</code>
<code> [24]  }</code>
</div>
<code class="header" id="listing_427">#.Laguntza.Laguntza.GUI.EstablishTabSelectHandler &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EstablishTabSelectHandler←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      1⊣∆Ref.n.tabBtns ⎕WS¨⊂'Event' 'Select'(FullPathToHandler'##.OnTabSelect')</code>
<code> [3] ⍝</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_428">#.Laguntza.Laguntza.GUI.FullPathToHandler &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> FullPathToHandler←{</code>
<code> [1]      ⍺←⎕THIS</code>
<code> [2]      (2=≢⍵):((⍕⍺),'.',0⊃⍵)(1⊃⍵)</code>
<code> [3]      (⍕⍺),'.',⍵</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_429">#.Laguntza.Laguntza.GUI.GetFontSizesOf &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetFontSizesOf←{</code>
<code> [1]      font←⍵</code>
<code> [2]      size←font.Size                                 ⍝ Save default</code>
<code> [3]      smallest←10                                    ⍝ Define...</code>
<code> [4]      largest←32                                     ⍝ ... boundaries</code>
<code> [5]      sizes←font{⍵/⍨⍺{⍺.Size←⍵ ⋄ ⍵=⍺.Size}¨⍵}9↓⍳36   ⍝ Try everything between (and including) smalltest and largest</code>
<code> [6]      font.Size←size                                 ⍝ Restore default</code>
<code> [7]      sizes</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_430">#.Laguntza.Laguntza.GUI.On9997InTreeView &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> On9997InTreeView←{</code>
<code> [1]      (∆Ref in)←2↑2↓⍵</code>
<code> [2]      (¯1∊×in):⍬</code>
<code> [3]      in&gt;≢∆Ref.n.tree.SelItems:⍬  ⍝ Yes, this has happened without apparent reason!</code>
<code> [4]      ∆Ref.n.tree.SelItems[in]←1</code>
<code> [5]      ⍬</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_431">#.Laguntza.Laguntza.GUI.OnBuildDocFromAllPages &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnBuildDocFromAllPages←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      (0=≢tf←##.BuildDocFromAllPages ∆Ref):tf</code>
<code> [3]      ⎕←(⎕PW-1)⍴'-'</code>
<code> [4]      ⎕←'HTML file created; open this with a word processor for proof reading:'</code>
<code> [5]      ⎕←tf</code>
<code> [6]      tf</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_432">#.Laguntza.Laguntza.GUI.OnConfigure &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnConfigure←{rf←0⊃r←⍵ ⋄ (rf.State≠0):r ⋄ r[4]⌈←0⊃⍺ ⋄ r[5]⌈←1⊃⍺ ⋄ r}</code>
</div>
<code class="header" id="listing_433">#.Laguntza.Laguntza.GUI.OnTitleChangeInWebBrowser &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> OnTitleChangeInWebBrowser←{</code>
<code> [1] ⍝ Forces the focus to the left pane in order to overcome the strange probem that</code>
<code> [2] ⍝ otherwise the browser grabs the focus back.</code>
<code> [3]      ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code> [4]      _←⎕NQ(0⊃⍵)9991</code>
<code> [5]      0</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_434">#.Laguntza.Laguntza.GUI.PopulateToolbar &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  PopulateToolbar←{</code>
<code> [1]  ⍝ Populate the Toolbar with buttons for the three commands:</code>
<code> [2]  ⍝ "Fordward", "Next", "Bookmark".</code>
<code> [3]  ⍝ Also: creates a check box "Show navigation".</code>
<code> [4]       ∆Ref←⍵</code>
<code> [5]       ∆Ref.n.Back1←⍎'Back1'∆Ref.n.form.⎕WC'Bitmap'('File'(##.GetHome'\Assets\Images\Back_Active.bmp'))('Size'(32 32))</code>
<code> [6]       ∆Ref.n.Back3←⍎'Back3'∆Ref.n.form.⎕WC'Bitmap'('File'(##.GetHome'\Assets\Images\Back_Inactive.bmp'))('Size'(32 32))</code>
<code> [7]  </code>
<code> [8]       ∆←⊂'Button'</code>
<code> [9]       ∆,←⊂'Caption' 'Back'</code>
<code> [10]      ∆,←⊂'Event' 'Select'(FullPathToHandler'##.OnToolbarBtn')</code>
<code> [11]      ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [12]      ∆,←⊂'Tip' 'Go back to previous topic (Alt+CursorLeft)'</code>
<code> [13]      ∆,←⊂'Active' 0</code>
<code> [14]      ∆,←⊂'BtnPix'∆Ref.n.(Back1 Back1 Back3)</code>
<code> [15]      ∆,←⊂'Accelerator'(37 4)</code>
<code> [16]      ⍵.n.backBtn←⍎'tb.back'⍵.⎕WC ∆</code>
<code> [17]      ⍵.tb.back.Posn[1]+←15</code>
<code> [18] </code>
<code> [19]      ∆Ref.n.Next1←⍎'Next1'∆Ref.n.form.⎕WC'Bitmap'('File'(##.GetHome'\Assets\Images\Next_Active.bmp'))('Size'(32 32))</code>
<code> [20]      ∆Ref.n.Next3←⍎'Next3'∆Ref.n.form.⎕WC'Bitmap'('File'(##.GetHome'\Assets\Images\Next_Inactive.bmp'))('Size'(32 32))</code>
<code> [21] </code>
<code> [22]      ∆←⊂'Button'</code>
<code> [23]      ∆,←⊂'Caption' '&amp;Forward'</code>
<code> [24]      ∆,←⊂'Event' 'Select'(FullPathToHandler'##.OnToolbarBtn')</code>
<code> [25]      ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [26]      ∆,←⊂'Tip' 'Go forward one topic  (Alt+CursorRight)'</code>
<code> [27]      ∆,←⊂'Active' 0</code>
<code> [28]      ∆,←⊂'Accelerator'(39 4)</code>
<code> [29]      ∆,←⊂'BtnPix'∆Ref.n.(Next1 Next1 Next3)</code>
<code> [30]      ⍵.n.forwardBtn←⍎'tb.forward'⍵.⎕WC ∆</code>
<code> [31]      ⍵.tb.forward.Posn[1]+←15</code>
<code> [32] </code>
<code> [33]      ∆←⊂'Button'</code>
<code> [34]      ∆,←⊂'Caption' '&amp;Bookmark'</code>
<code> [35]      ∆,←⊂'Event' 'Select'(FullPathToHandler'##.OnToolbarBtn')</code>
<code> [36]      ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [37]      ∆,←⊂'Tip' 'Bookmark the current page'</code>
<code> [38]      ⍵.n.bookmarkBtn←⍎'tb.bookmark'⍵.⎕WC ∆</code>
<code> [39]      ⍵.tb.bookmark.Posn[1]+←10</code>
<code> [40] </code>
<code> [41]      ∆←⊂'Button'</code>
<code> [42]      ∆,←⊂'Caption' 'Show &amp;navigation'</code>
<code> [43]      ∆,←⊂'Event' 'Select'(FullPathToHandler'##.OnToolbarBtn')</code>
<code> [44]      ∆,←⊂'Style' 'Check'</code>
<code> [45]      ∆,←⊂'State' 1</code>
<code> [46]      ∆,←⊂'TipObj'∆Ref.n.tipField</code>
<code> [47]      ∆,←⊂'Tip' 'Toggles the visibility of the navigation bar'</code>
<code> [48]      ⍵.n.showNavigation←⍎'tb.showNavigation'⍵.⎕WC ∆</code>
<code> [49]      ⍵.tb.showNavigation.Posn[1]+←10</code>
<code> [50] </code>
<code> [51]      ⍬</code>
<code> [52]  }</code>
</div>
<code class="header" id="listing_435">#.Laguntza.Laguntza.GUI.Power2 &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Power2←{+/⍵/2*⍳32}</code>
</div>
<code class="header" id="listing_436">#.Laguntza.Laguntza.HTML.CreateDefaultNodePage &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CreateDefaultNodePage←{</code>
<code> [1]  ⍝ In case content ("html") is empty AND "row" a node we create</code>
<code> [2]  ⍝ a page that carries links to the children if there are any.</code>
<code> [3]  ⍝ There MUST be childen by definition if it's a node.</code>
<code> [4]  ⍝ Otherwise we just return `html`.</code>
<code> [5]       ∆Ref←⍺</code>
<code> [6]       (row html)←⍵                                   ⍝ Item number, content</code>
<code> [7]       0=≢row:html                                    ⍝ If "row" is empy we are done</code>
<code> [8]       0≠≢html:html                                   ⍝ If "html" is not empy we are done</code>
<code> [9]       ind←row ##.WhereAreTheChildren ∆Ref.d.tree[;##.I.Depth] ⍝ Where are the children?</code>
<code> [10]      (0∊noc←≢ind):html                              ⍝ How many are there? (0=ready)</code>
<code> [11]      names←∆Ref.d.tree[ind;##.I.Title]              ⍝ Names of children</code>
<code> [12]      lks←ind{'&lt;a class="link" href="#',(⍕⍺),'"&gt;',⍵,'&lt;/a&gt;'}¨names ⍝ wrap row HTML</code>
<code> [13]      header←⊂'&lt;h1&gt;',(↑∆Ref.d.tree[row;##.I.Title]),'&lt;/h1&gt;'</code>
<code> [14]      header,(⊂'&lt;ul class="defaultpagelist"&gt;'),({'&lt;li&gt;',⍵}¨lks),⊂'&lt;/ul&gt;'</code>
<code> [15]  }</code>
</div>
<code class="header" id="listing_437">#.Laguntza.Laguntza.HTML.CreateParameterSpace &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CreateParameterSpace←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      tmp←⎕NS''</code>
<code> [3]      tmp.∆Ref←∆Ref</code>
<code> [4]      tmp.linkReport←''            ⍝ Used to collect reports regarding links.</code>
<code> [5]      tmp</code>
<code> [6] ⍝ Returns an unnamed namespace useful to collect/deliver ∆Ref and reports.</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_438">#.Laguntza.Laguntza.HTML.EnforceSlash &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EnforceSlash←{</code>
<code> [1]      0=+/b←'\'=w←⍵:w</code>
<code> [2]      (b/w)←'/'</code>
<code> [3]      w}</code>
</div>
<code class="header" id="listing_439">#.Laguntza.Laguntza.HTML.GetTitle &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetTitle←{</code>
<code> [1] ⍝ ⍵ is a help page.</code>
<code> [2] ⍝ ← is the title of the help page (First "# ...")</code>
<code> [3]      hits←{('^\s{0,3}# .*[^\n]')⎕S 0 1⍠('Mode' 'L')⊣⍵}¨⍕¨⍵</code>
<code> [4]      bool←≢¨hits</code>
<code> [5]      0=+/bool:''</code>
<code> [6]      2↓##.A.DLB(bool⍳1)⊃⍵</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_440">#.Laguntza.Laguntza.HTML.GetTitleFromBody &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetTitleFromBody←{</code>
<code> [1] ⍝ ⍵ is a help page body (vector of text vectors). Might be empty or not contain a &lt;h1&gt; tag at all.</code>
<code> [2] ⍝ Returns either the contents of &lt;h1&gt; or ''.</code>
<code> [3]      0=≢⍵:⍵</code>
<code> [4]      0=≢buf←'&lt;h1&gt;.*&lt;/h1&gt;'⎕S'&amp;'⍠('Mode' 'D')⊣⍵:''</code>
<code> [5]      {⍵↑⍨⍵⍳'&lt;'}{⍵↓⍨1+⍵⍳'&gt;'}↑buf</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_441">#.Laguntza.Laguntza.HTML.HtmlBottomCode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> HtmlBottomCode←{</code>
<code> [1]      body←''</code>
<code> [2]      body,←⊂'&lt;/body&gt;'</code>
<code> [3]      body,←⊂'&lt;/html&gt;'</code>
<code> [4]      body</code>
<code> [5]  ⍝ Creates the bottom part of the HTML page</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_442">#.Laguntza.Laguntza.HTML.HtmlTopCode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  HtmlTopCode←{</code>
<code> [1]       (size title cssFlag)←⍵,(≢⍵)↓2 '' 1</code>
<code> [2]       body←''</code>
<code> [3]       body,←⊂'&lt;!DOCTYPE html&gt;'</code>
<code> [4]       body,←⊂'&lt;html&gt;'</code>
<code> [5]       body,←⊂'&lt;head&gt;'</code>
<code> [6]  </code>
<code> [7]       ⍝ ↓↓↓ https://blogs.msdn.microsoft.com/askie/2009/03/23/understanding-compatibility-modes-in-internet-explorer-8/</code>
<code> [8]       body,←⊂'&lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;'</code>
<code> [9]  </code>
<code> [10]      body,←⊂'&lt;title&gt;',title,'&lt;/title&gt;'</code>
<code> [11]      body,←⊂'&lt;meta charset="UTF-8"&gt;'</code>
<code> [12]      body,←⊂'&lt;style type="text/css" media="screen"&gt;'</code>
<code> [13]      body,←⍺⍺{0=⍵:'' ⋄ ⍺⍺ size}cssFlag  ⍝ Insert CSS code; makes page self-contained</code>
<code> [14]      body,←⊂'&lt;/style&gt;'</code>
<code> [15]      body,←⊂'&lt;/head&gt;'</code>
<code> [16]      body,←⊂'&lt;body&gt;'</code>
<code> [17]      body</code>
<code> [18]  ⍝ Creates the HTML code needed for the top part of the HTML page:</code>
<code> [19]  ⍝ Doc declaration, head and start of body-tag</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_443">#.Laguntza.Laguntza.HTML.HtmlTopCode1 &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  HtmlTopCode1←{</code>
<code> [1]       (∆Ref size title cssFlag)←⍵,(≢⍵)↓⍬ 2 '' 1</code>
<code> [2]       body←''</code>
<code> [3]       body,←⊂'&lt;!DOCTYPE html&gt;'</code>
<code> [4]       body,←⊂'&lt;html lang="',∆Ref.p.language,'"&gt;'</code>
<code> [5]       body,←⊂'&lt;head&gt;'</code>
<code> [6]  </code>
<code> [7]       ⍝ ↓↓↓ https://blogs.msdn.microsoft.com/askie/2009/03/23/understanding-compatibility-modes-in-internet-explorer-8/</code>
<code> [8]       body,←⊂'&lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;' ⍝ This must be the FIRST entry after &lt;head&gt; according to some sources!</code>
<code> [9]  </code>
<code> [10]      body,←⊂'&lt;title&gt;',title,'&lt;/title&gt;'</code>
<code> [11]      href←EnforceSlash ∆Ref.p.folderName</code>
<code> [12]      href,←'/'/⍨'/'≠¯1↑href</code>
<code> [13]      body,←⊂'&lt;meta name="basepath" content="',href,'"&gt;'  ⍝ We cannot use "base" because that ruins all relative links, therefore we must store the path ourselves</code>
<code> [14]      body,←⊂'&lt;meta charset="UTF-8"&gt;'</code>
<code> [15]      fn←GetCssFileName ∆Ref'screen'</code>
<code> [16]      body,←⊂'&lt;link rel="stylesheet" type="text/css" href="',fn,'" media="screen"&gt;'</code>
<code> [17]      fn←GetCssFileName ∆Ref'print'</code>
<code> [18]      body,←⊂'&lt;link rel="stylesheet" type="text/css" href="',fn,'" media="print"&gt;'</code>
<code> [19]      body</code>
<code> [20]  ⍝ Creates top part of the HTML code needed for the "head" part of the HTML page:</code>
<code> [21]  ⍝ Doc declaration, html, title and meta tags.</code>
<code> [22]  }</code>
</div>
<code class="header" id="listing_444">#.Laguntza.Laguntza.HTML.HtmlTopCode2 &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> HtmlTopCode2←{</code>
<code> [1]      '&lt;/head&gt;' '&lt;body&gt;'</code>
<code> [2]  ⍝ Creates the HTML code needed for the lower part of the "head" of the page:</code>
<code> [3]  ⍝ Closing tags (head,style), maybe embedded JavaScript and open "body"</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_445">#.Laguntza.Laguntza.HTML.MakeCssForDoc &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  MakeCssForDoc←{</code>
<code> [1]       size←⍵</code>
<code> [2]       r←''</code>
<code> [3]       r,←⊂'html {'</code>
<code> [4]       r,←⊂'font-family: "Arial";'</code>
<code> [5]       r,←⊂'font-size: 14px'</code>
<code> [6]       r,←⊂'}'</code>
<code> [7]       r,←⊂'hr {'</code>
<code> [8]       r,←⊂'color: black;'</code>
<code> [9]       r,←⊂'size 3pt;'</code>
<code> [10]      r,←⊂'}'</code>
<code> [11]      r,←⊂'h1,h2,h3,h4 {'</code>
<code> [12]      r,←⊂'font-family: "APL385 Unicode";'</code>
<code> [13]      r,←⊂'}'</code>
<code> [14]      r,←⊂'h1 {'</code>
<code> [15]      r,←⊂'font-size: 130%;'</code>
<code> [16]      r,←⊂'font-weight: bold;'</code>
<code> [17]      r,←⊂'}'</code>
<code> [18]      r,←⊂'h2 {'</code>
<code> [19]      r,←⊂'font-size: 110%;'</code>
<code> [20]      r,←⊂'border-bottom: 1pt solid silver;'</code>
<code> [21]      r,←⊂'}'</code>
<code> [22]      r,←⊂'pre {'</code>
<code> [23]      r,←⊂'font-family: "APL385 Unicode";'</code>
<code> [24]      r,←⊂'border: 1pt solid silver;'</code>
<code> [25]      r,←⊂'padding: 4pt;'</code>
<code> [26]      r,←⊂'margin: 0 5pt 0 5pt;'</code>
<code> [27]      r,←⊂'mso-no-proof:yes;'</code>
<code> [28]      r,←⊂'}'</code>
<code> [29]      r,←⊂'pre code {'</code>
<code> [30]      r,←⊂'font-family: "APL385 Unicode";'</code>
<code> [31]      r,←⊂'mso-no-proof:yes;'</code>
<code> [32]      r,←⊂'}'</code>
<code> [33]      r,←⊂'code {'</code>
<code> [34]      r,←⊂'font-family: "APL385 Unicode";'</code>
<code> [35]      r,←⊂'mso-no-proof:yes;'</code>
<code> [36]      r,←⊂'}'</code>
<code> [37]      r,←⊂'table {'</code>
<code> [38]      r,←⊂'border: solid 1px silver;'</code>
<code> [39]      r,←⊂'border-collapse: collapse;'</code>
<code> [40]      r,←⊂'}'</code>
<code> [41]      r,←⊂'td {'</code>
<code> [42]      r,←⊂'border: solid 1px silver;'</code>
<code> [43]      r,←⊂'}'</code>
<code> [44]      r,←⊂'image {'</code>
<code> [45]      r,←⊂'margin:10px;'</code>
<code> [46]      r,←⊂'border: 0px;'</code>
<code> [47]      r,←⊂'}'</code>
<code> [48]      r</code>
<code> [49]  ⍝ Creates all the CSS which is embedded into the HTML page.</code>
<code> [50]  ⍝ Makes it difficult to change but makes the document self-contained.</code>
<code> [51]  ⍝ This version is useful when the final doc is loaded with Word</code>
<code> [52]  }</code>
</div>
<code class="header" id="listing_446">#.Laguntza.Laguntza.HTML.WrapInHtml &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  WrapInHtml←{</code>
<code> [1]  ⍝ Creates HTML code representing a complete document by default.</code>
<code> [2]       (∆Ref fs body in)←⍵            ⍝ ∆Ref, Font size (1∨2∨3), help, item number</code>
<code> [3]       title←GetTitleFromBody body</code>
<code> [4]       html←HtmlTopCode1 ∆Ref fs title</code>
<code> [5]       html,←HtmlTopCode2 ⍬</code>
<code> [6]       body←∆Ref CreateDefaultNodePage in body</code>
<code> [7]       body←PolishImageLinks html body</code>
<code> [8]       html,←body</code>
<code> [9]       html,←HtmlBottomCode ⍬</code>
<code> [10]      html</code>
<code> [11]  }</code>
</div>
<code class="header" id="listing_447">#.Laguntza.Laguntza.HelpHelp.∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ∆TopicProperties←{</code>
<code> [1]  ⍝ This function is needed by the Laguntza system.</code>
<code> [2]  ⍝ You can edit this function from the Laguntza GUI via the context menu.</code>
<code> [3]  ⍝ *** NOTE:</code>
<code> [4]  ⍝     Make only changes to this function that affect the explicit result.</code>
<code> [5]  ⍝     Any other changes will eventually disappear because these functions are rebuild</code>
<code> [6]  ⍝     under program control from their explicit result under certain circumstances.</code>
<code> [7]  ⍝        This is also the reason why you should use the `active` flag to hide a topic</code>
<code> [8]  ⍝     temporarily because although just putting a `⍝` symbol in front of its line</code>
<code> [9]  ⍝     seems to have the same effect, in the long run that's not true because the</code>
<code> [10] ⍝     commented line will disappear in the event of a rebuild.</code>
<code> [11] ⍝ ----------------------------------</code>
<code> [12] ⍝ r gets a table with these columns:</code>
<code> [13] ⍝ [;0] namespace or function name.</code>
<code> [14] ⍝ [;1] caption in the tree view. If empty the namespace/fns name is taken.</code>
<code> [15] ⍝ [;2] active flag.</code>
<code> [16] ⍝ [;3] developmentOnly flag; 1=the corresponding node does not show in user mode.</code>
<code> [17]      r←0 4⍴''</code>
<code> [18]      r⍪←'Overview' '' 1 0</code>
<code> [19]      r⍪←'HowToStart' 'How to start' 1 0</code>
<code> [20]      r⍪←'Call_from_an_application' '' 1 0</code>
<code> [21]      r⍪←'Standalone_Application' 'Run as stand-alone application' 1 0</code>
<code> [22]      r⍪←'MarkUp' 'Mark-up and layout' 1 0</code>
<code> [23]      r⍪←'Links' '' 1 0</code>
<code> [24]      r⍪←'Methods' '' 1 0</code>
<code> [25]      r⍪←'Parameters' '' 1 0</code>
<code> [26]      r⍪←'Misc' '' 1 0</code>
<code> [27]      r⍪←'Tips_and_tricks' '' 1 0</code>
<code> [28]      r⍪←'Compiled_File' '' 1 0</code>
<code> [29]      r⍪←'CSS_classes' 'CSS classes' 1 0</code>
<code> [30]      r⍪←'Changing_the_layout' 'Changing the layout' 1 0</code>
<code> [31]      r⍪←'The_CSS_folder' '' 1 0</code>
<code> [32]      r⍪←'The_icon' 'Icons and images' 1 0</code>
<code> [33]      r⍪←'SALT' '' 0 0</code>
<code> [34]      r⍪←'About' 'About Laguntza' 1 0</code>
<code> [35]      r</code>
<code> [36]  }</code>
</div>
<code class="header" id="listing_448">#.Laguntza.Laguntza.HelpHelp.Links.∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ∆TopicProperties←{</code>
<code> [1]  ⍝ This function is needed by the Laguntza system.</code>
<code> [2]  ⍝ You can edit this function from the Laguntza GUI via the context menu.</code>
<code> [3]  ⍝ *** NOTE:</code>
<code> [4]  ⍝     Make only changes to this function that affect the explicit result.</code>
<code> [5]  ⍝     Any other changes will eventually disappear because these functions are rebuild</code>
<code> [6]  ⍝     under program control from their explicit result under certain circumstances.</code>
<code> [7]  ⍝        This is also the reason why you should use the `active` flag to hide a topic</code>
<code> [8]  ⍝     temporarily because although just putting a `⍝` symbol in front of its line</code>
<code> [9]  ⍝     seems to have the same effect, in the long run that's not true because the</code>
<code> [10] ⍝     commented line will disappear in the event of a rebuild.</code>
<code> [11] ⍝ ----------------------------------</code>
<code> [12] ⍝ r gets a table with these columns:</code>
<code> [13] ⍝ [;0] namespace or function name.</code>
<code> [14] ⍝ [;1] caption in the tree view. If empty the namespace/fns name is taken.</code>
<code> [15] ⍝ [;2] active flag.</code>
<code> [16] ⍝ [;3] developmentOnly flag; 1=the corresponding node does not show in user mode.</code>
<code> [17]      r←0 4⍴''</code>
<code> [18]      r⍪←'Fully_Qualified_Links' 'Fully qualified links' 1 0</code>
<code> [19]      r⍪←'Relative_Links' 'Relative Links' 1 0</code>
<code> [20]      r⍪←'Minimal_Links' 'Minimal links' 1 0</code>
<code> [21]      r⍪←'External_Links' 'External Links' 1 0</code>
<code> [22]      r</code>
<code> [23]  }</code>
</div>
<code class="header" id="listing_449">#.Laguntza.Laguntza.HelpHelp.MarkUp.∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ∆TopicProperties←{</code>
<code> [1]  ⍝ This function is needed by the Laguntza system.</code>
<code> [2]  ⍝ You can edit this function from the Laguntza GUI via the context menu.</code>
<code> [3]  ⍝ *** NOTE:</code>
<code> [4]  ⍝     Make only changes to this function that affect the explicit result.</code>
<code> [5]  ⍝     Any other changes will eventually disappear because these functions are rebuild</code>
<code> [6]  ⍝     under program control from their explicit result under certain circumstances.</code>
<code> [7]  ⍝        This is also the reason why you should use the `active` flag to hide a topic</code>
<code> [8]  ⍝     temporarily because although just putting a `⍝` symbol in front of its line</code>
<code> [9]  ⍝     seems to have the same effect, in the long run that's not true because the</code>
<code> [10] ⍝     commented line will disappear in the event of a rebuild.</code>
<code> [11] ⍝ ----------------------------------</code>
<code> [12] ⍝ r gets a table with these columns:</code>
<code> [13] ⍝ [;0] namespace or function name.</code>
<code> [14] ⍝ [;1] caption in the tree view. If empty the namespace/fns name is taken.</code>
<code> [15] ⍝ [;2] active flag.</code>
<code> [16] ⍝ [;3] developmentOnly flag; 1=the corresponding node does not show in user mode.</code>
<code> [17]      r←0 4⍴''</code>
<code> [18]      r⍪←'Paragraphs' '' 1 0</code>
<code> [19]      r⍪←'Inline_markup' 'Inline mark-up' 1 0</code>
<code> [20]      r⍪←'Code' '' 1 0</code>
<code> [21]      r⍪←'Lists' '' 1 0</code>
<code> [22]      r⍪←'Tables' '' 1 0</code>
<code> [23]      r⍪←'Headers' '' 1 0</code>
<code> [24]      r⍪←'Images' '' 1 0</code>
<code> [25]      r⍪←'Definition_lists' 'Definition lists' 1 0</code>
<code> [26]      r⍪←'Horizontal_rulers' 'Horizontal rulers' 1 0</code>
<code> [27]      r⍪←'Special_attributes' 'Special attributes' 1 0</code>
<code> [28]      r</code>
<code> [29]  }</code>
</div>
<code class="header" id="listing_450">#.Laguntza.Laguntza.HelpHelp.Methods.∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ∆TopicProperties←{</code>
<code> [1]  ⍝ This function is needed by the Laguntza system.</code>
<code> [2]  ⍝ You can edit this function from the Laguntza GUI via the context menu.</code>
<code> [3]  ⍝ *** NOTE:</code>
<code> [4]  ⍝     Make only changes to this function that affect the explicit result.</code>
<code> [5]  ⍝     Any other changes will eventually disappear because these functions are rebuild</code>
<code> [6]  ⍝     under program control from their explicit result under certain circumstances.</code>
<code> [7]  ⍝        This is also the reason why you should use the `active` flag to hide a topic</code>
<code> [8]  ⍝     temporarily because although just putting a `⍝` symbol in front of its line</code>
<code> [9]  ⍝     seems to have the same effect, in the long run that's not true because the</code>
<code> [10] ⍝     commented line will disappear in the event of a rebuild.</code>
<code> [11] ⍝ ----------------------------------</code>
<code> [12] ⍝ r gets a table with these columns:</code>
<code> [13] ⍝ [;0] namespace or function name.</code>
<code> [14] ⍝ [;1] caption in the tree view. If empty the namespace/fns name is taken.</code>
<code> [15] ⍝ [;2] active flag.</code>
<code> [16] ⍝ [;3] developmentOnly flag; 1=the corresponding node does not show in user mode.</code>
<code> [17]      r←0 4⍴''</code>
<code> [18]      r⍪←'CloseHelp' '' 1 0</code>
<code> [19]      r⍪←'CompileHelpFile' '' 1 0</code>
<code> [20]      r⍪←'CompileHelpFileInto' '' 1 0</code>
<code> [21]      r⍪←'CreateParms' '' 1 0</code>
<code> [22]      r⍪←'CreateStub' '' 1 0</code>
<code> [23]      r⍪←'FindTopic' '' 1 0</code>
<code> [24]      r⍪←'GetNoClose' '' 1 0</code>
<code> [25]      r⍪←'Inject∆TopicProperties' '' 1 0</code>
<code> [26]      r⍪←'LoadHelpWithSalt' '' 1 0</code>
<code> [27]      r⍪←'ListHelpForms' '' 1 0</code>
<code> [28]      r⍪←'New' '' 1 0</code>
<code> [29]      r⍪←'Reset' '' 1 0</code>
<code> [30]      r⍪←'SaveHelpSystemWithSalt' '' 1 0</code>
<code> [31]      r⍪←'SetNoClose' '' 1 0</code>
<code> [32]      r⍪←'GetVisible' '' 1 0</code>
<code> [33]      r⍪←'SetVisible' '' 1 0</code>
<code> [34]      r⍪←'ShowTopic' '' 1 0</code>
<code> [35]      r⍪←'Version' '' 1 0</code>
<code> [36]      r</code>
<code> [37]  }</code>
</div>
<code class="header" id="listing_451">#.Laguntza.Laguntza.HelpHelp.Misc.∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ∆TopicProperties←{</code>
<code> [1]  ⍝ This function is needed by the Laguntza system.</code>
<code> [2]  ⍝ You can edit this function from the Laguntza GUI via the context menu.</code>
<code> [3]  ⍝ *** NOTE:</code>
<code> [4]  ⍝     Make only changes to this function that affect the explicit result.</code>
<code> [5]  ⍝     Any other changes will eventually disappear because these functions are rebuild</code>
<code> [6]  ⍝     under program control from their explicit result under certain circumstances.</code>
<code> [7]  ⍝        This is also the reason why you should use the `active` flag to hide a topic</code>
<code> [8]  ⍝     temporarily because although just putting a `⍝` symbol in front of its line</code>
<code> [9]  ⍝     seems to have the same effect, in the long run that's not true because the</code>
<code> [10] ⍝     commented line will disappear in the event of a rebuild.</code>
<code> [11] ⍝ ----------------------------------</code>
<code> [12] ⍝ r gets a table with these columns:</code>
<code> [13] ⍝ [;0] namespace or function name.</code>
<code> [14] ⍝ [;1] caption in the tree view. If empty the namespace/fns name is taken.</code>
<code> [15] ⍝ [;2] active flag.</code>
<code> [16] ⍝ [;3] developmentOnly flag; 1=the corresponding node does not show in user mode.</code>
<code> [17]      r←0 4⍴''</code>
<code> [18]      r⍪←'Indexing' '' 1 0</code>
<code> [19]      r⍪←'TopicProperties' '∆TopicProperties' 1 0</code>
<code> [20]      r⍪←'Bookmarks' '' 1 0</code>
<code> [21]      r⍪←'DefaultPage' 'Default Pages' 1 0</code>
<code> [22]      r⍪←'NamesAndConventions' 'Names &amp; conventions' 1 0</code>
<code> [23]      r⍪←'Embedded_functions' 'Embedded functions' 1 0</code>
<code> [24]      r</code>
<code> [25]  }</code>
</div>
<code class="header" id="listing_452">#.Laguntza.Laguntza.HelpHelp.Parameters.∆TopicProperties &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  ∆TopicProperties←{</code>
<code> [1]  ⍝ This function is needed by the Laguntza system.</code>
<code> [2]  ⍝ You can edit this function from the Laguntza GUI via the context menu.</code>
<code> [3]  ⍝ *** NOTE:</code>
<code> [4]  ⍝     Make only changes to this function that affect the explicit result.</code>
<code> [5]  ⍝     Any other changes will eventually disappear because these functions are rebuild</code>
<code> [6]  ⍝     under program control from their explicit result under certain circumstances.</code>
<code> [7]  ⍝        This is also the reason why you should use the `active` flag to hide a topic</code>
<code> [8]  ⍝     temporarily because although just putting a `⍝` symbol in front of its line</code>
<code> [9]  ⍝     seems to have the same effect, in the long run that's not true because the</code>
<code> [10] ⍝     commented line will disappear in the event of a rebuild.</code>
<code> [11] ⍝ ----------------------------------</code>
<code> [12] ⍝ r gets a table with these columns:</code>
<code> [13] ⍝ [;0] namespace or function name.</code>
<code> [14] ⍝ [;1] caption in the tree view. If empty the namespace/fns name is taken.</code>
<code> [15] ⍝ [;2] active flag.</code>
<code> [16] ⍝ [;3] developmentOnly flag; 1=the corresponding node does not show in user mode.</code>
<code> [17]      r←0 4⍴''</code>
<code> [18]      r⍪←'cssPrintFilename' '' 1 0</code>
<code> [19]      r⍪←'cssScreenFilename' '' 1 0</code>
<code> [20]      r⍪←'expand' '' 1 0</code>
<code> [21]      r⍪←'folderName' '' 1 0</code>
<code> [22]      r⍪←'helpAbout' '' 1 0</code>
<code> [23]      r⍪←'helpCaption' '' 1 0</code>
<code> [24]      r⍪←'helpIcon' '' 1 0</code>
<code> [25]      r⍪←'helpVersion' '' 1 0</code>
<code> [26]      r⍪←'helpVersionDate' '' 1 0</code>
<code> [27]      r⍪←'isRuntime' '' 1 0</code>
<code> [28]      r⍪←'noClose' '' 1 0</code>
<code> [29]      r⍪←'page' '' 1 0</code>
<code> [30]      r⍪←'posn' '' 1 0</code>
<code> [31]      r⍪←'regPath' 'regPath    ' 1 0</code>
<code> [32]      r⍪←'reportToSession' '' 1 0</code>
<code> [33]      r⍪←'saltFolder' '' 1 0</code>
<code> [34]      r⍪←'saltFolder' '' 0 0</code>
<code> [35]      r⍪←'size' '' 1 0</code>
<code> [36]      r⍪←'source' '' 1 0</code>
<code> [37]      r⍪←'splitterPosn' '' 1 0</code>
<code> [38]      r⍪←'statusbarAlarmColor' '' 1 0</code>
<code> [39]      r⍪←'trapErrors' '' 1 0</code>
<code> [40]      r⍪←'userMode' '' 1 0</code>
<code> [41]      r⍪←'visible' '' 1 0</code>
<code> [42]      r</code>
<code> [43]  }</code>
</div>
<code class="header" id="listing_453">#.Laguntza.Laguntza.I.Depth &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Depth</code>
<code> [1]  r←0</code>
</div>
<code class="header" id="listing_454">#.Laguntza.Laguntza.I.IsNode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←IsNode</code>
<code> [1]  r←6</code>
</div>
<code class="header" id="listing_455">#.Laguntza.Laguntza.I.Parent &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Parent</code>
<code> [1]  r←4</code>
</div>
<code class="header" id="listing_456">#.Laguntza.Laguntza.I.Row &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Row</code>
<code> [1]  r←5</code>
</div>
<code class="header" id="listing_457">#.Laguntza.Laguntza.I.Title &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←Title</code>
<code> [1]  r←2</code>
</div>
<code class="header" id="listing_458">#.Laguntza.Laguntza.I.TopicName &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←TopicName</code>
<code> [1]  r←1</code>
</div>
<code class="header" id="listing_459">#.Laguntza.Laguntza.Index.CollectPageDataForKeywords &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> CollectPageDataForKeywords←{</code>
<code> [1] ⍝ Collects page name, location (parent) and row numbers in tree for all indices in a matrix.</code>
<code> [2]      (tags tree)←⍵</code>
<code> [3]      dat←tags{(⊂¨⍺),¨⍵}¨⊂¨tree[;##.I.Title]</code>
<code> [4]      tree2←(↑,/tags),↑⍪/⊃¨(≢¨tags)⍴¨⊂¨↓tree[;##.I.(Title Parent Row)]</code>
<code> [5]      tree2⌿⍨←''∘≢¨tree2[;0]         ⍝ Drop empty ones (caused by ⋄⋄)</code>
<code> [6]      tree2[⍋⊃tree2[;0];]            ⍝ Sort by indices</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_460">#.Laguntza.Laguntza.Index.GetIndices &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  r←GetIndices(keywords ∆Ref tree)</code>
<code> [1]  ⍝ Takes all keywords, extracts the indices from them and finally</code>
<code> [2]  ⍝ compiles the index table from that.</code>
<code> [3]  ⍝ Returns three items:</code>
<code> [4]  ⍝ [0]: The indices in lowercase letters (for searching purposes).</code>
<code> [5]  ⍝ [1]: The row numbers.</code>
<code> [6]  ⍝ [2]: Matrix with three columns for display only: index, title and location.</code>
<code> [7]   r←''⍬''</code>
<code> [8]   :If 0≠≢keywords</code>
<code> [9]       mat←CollectPageDataForKeywords keywords tree</code>
<code> [10]      mat[;2]←(1+≢⍕∆Ref.p.source)↓¨⍕¨mat[;2]  ⍝ Convert refs into reasonable captions</code>
<code> [11]      disp←mat[;0 1 2]                        ⍝ The display format</code>
<code> [12]      disp[⍸~{(⍵⍳⍵)=⍳≢⍵}disp[;0];0]←⊂''</code>
<code> [13]      rows←mat[;3]</code>
<code> [14]      li←⎕C mat[;0]                           ⍝ li = lower case indices; for search purposes</code>
<code> [15]      r←li rows disp                          ⍝ Compile li, row numbers in tree and display data</code>
<code> [16]  :EndIf</code>
</div>
<code class="header" id="listing_461">#.Laguntza.Laguntza.Index.NormalizeKeywords &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> NormalizeKeywords←{</code>
<code> [1]      keywords←⍵</code>
<code> [2]      (0=≢∊keywords):''⍬                 ⍝ No keywords? Done</code>
<code> [3]      keywords←##.A.DLB¨##.A.DTB¨(⊂'')~⍨'⋄'##.A.Split∊'⋄',¨keywords</code>
<code> [4]      ∪keywords                         ⍝  May contain the same index more than once by accident</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_462">#.Laguntza.Laguntza.Lint_.Browse &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> Browse←{0=≢⍵:⍬ ⋄ {⍵}(#.⎕NS'').(⎕ED&amp</code>
</div>
<code class="header" id="listing_463">#.Laguntza.Laguntza.Lint_.CheckAmbiguousLinks &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckAmbiguousLinks←{</code>
<code> [1]       ⍺←¯1</code>
<code> [2]       ∆Ref←⍵</code>
<code> [3]       _←##.ShowEggTimer ∆Ref</code>
<code> [4]       ∆Ref.n.infoSB.Text←'Looking for ambiguous links, please wait...'</code>
<code> [5]       ∆Ref.n.infoSB.BCol←∆Ref.p.statusbarAlarmColor</code>
<code> [6]       rows←⍺{¯1≡⍺:⍵ ⋄ ⍵[⍺]}∆Ref.d.tree[;##.I.Row]</code>
<code> [7]       r←∆Ref∘CheckAmbiguousLinks_¨rows</code>
<code> [8]       r⌿⍨←~0=≢¨r                        ⍝ Remove empty ones: they are okay</code>
<code> [9]       _←∆Ref ##.SetInfoText''</code>
<code> [10]      _←∆Ref ##.SetInfoBCol ¯1</code>
<code> [11]      _←##.RemoveEggTimer ∆Ref</code>
<code> [12]      0=≢r:0 1⍴''</code>
<code> [13]      r←↑,/r</code>
<code> [14]      r←(∨/¨'(ambiguous)'∘⍷¨r)/r</code>
<code> [15]      0=≢r:''</code>
<code> [16]      pl←1&lt;≢r</code>
<code> [17]      ⍪(⊂'*** ',(≢r),'ambiguous link',(pl/'s'),' in ',(⍕≢∪{⍵↑⍨⍵⍳':'}¨r),' topic',(pl/'s')),' ',¨r</code>
<code> [18] ⍝ Checks all pages (⍺ ←→ ¯1) or page(s) specified by ⍺ if ⍺ is not ¯1.</code>
<code> [19] ⍝ In that case ⍺ is treated as a vector of row numbers pointing into d.tree.</code>
<code> [20] ⍝ Returns a report that can be displayed  or analzyed by a test case.</code>
<code> [21] ⍝ First lines of the report is the header and starts with "*".</code>
<code> [22] ⍝ All following lines start with a blank.</code>
<code> [23] ⍝ Result is always a matrix with one column and zero to many rows.</code>
<code> [24]  }</code>
</div>
<code class="header" id="listing_464">#.Laguntza.Laguntza.Lint_.CheckAmbiguousLinks_ &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckAmbiguousLinks_←{</code>
<code> [1]  ⍝ Returns vector with line number (tree), full help function name</code>
<code> [2]  ⍝ and the link causing the problem.</code>
<code> [3]       fine←0 1⍴' '</code>
<code> [4]       ∆Ref←⍺</code>
<code> [5]       A←∆Ref.d.A</code>
<code> [6]       in←⍵</code>
<code> [7]       n←↑∆Ref ##.GetVarsName in</code>
<code> [8]       0=≢n:0 1⍴''                                ⍝ It's a node: nothing to check</code>
<code> [9]       0=≢body←∆Ref GetHelpBody n:fine            ⍝ The part of the page that might carry links</code>
<code> [10]      links←∆Ref IsolateLinks body               ⍝ Get just the links</code>
<code> [11]      0=≢links:fine                              ⍝ No links found?! Done!</code>
<code> [12]      type←∆Ref LookUpComplexLink¨(⊂¨links),¨in</code>
<code> [13]      (0=+/b←~type∊¯1 1):fine</code>
<code> [14]      r←((⍕in),' ',n)∘{⍺,': ',⍵}¨({⍵↑⍨⍵⍳']'}¨b/links)</code>
<code> [15]      r,¨←b/(1&lt;type)⊃¨⊂'' ' (ambiguous)'</code>
<code> [16]      ∪r</code>
<code> [17]  }</code>
</div>
<code class="header" id="listing_465">#.Laguntza.Laguntza.Lint_.CheckBrokenLinks &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckBrokenLinks←{</code>
<code> [1]       ⍺←¯1</code>
<code> [2]       ∆Ref←⍵</code>
<code> [3]       _←##.ShowEggTimer ∆Ref</code>
<code> [4]       ∆Ref.n.infoSB.Text←'Looking for broken links, please wait...'</code>
<code> [5]       ∆Ref.n.infoSB.BCol←∆Ref.p.statusbarAlarmColor</code>
<code> [6]       rows←⍺{¯1≡⍺:⍵ ⋄ ⍵[⍺]}∆Ref.d.tree[;##.I.Row]</code>
<code> [7]       r←∆Ref∘CheckBrokenLinks_¨rows</code>
<code> [8]       r⌿⍨←~0=≢¨r                        ⍝ Remove empty ones: they are okay</code>
<code> [9]       _←##.ResetStatusbar ∆Ref</code>
<code> [10]      _←##.RemoveEggTimer ∆Ref</code>
<code> [11]      0=≢r:0 1⍴''</code>
<code> [12]      r←↑,/r</code>
<code> [13]      ⍪(⊂'*** ',(⍴r),'broken links in ',(⍕⍴∪{⍵↑⍨⍵⍳':'}¨r),' topics'),' ',¨r</code>
<code> [14] ⍝ Checks all pages (⍺ ←→ ¯1) or page(s) specified by ⍺ if ⍺ is not ¯1.</code>
<code> [15] ⍝ In that case ⍺ is treated as a vector of row numbers pointing into d.tree.</code>
<code> [16] ⍝ Returns a report that can be displayed  or analzyed by a test case.</code>
<code> [17] ⍝ First line of the report is the header which starts with "*".</code>
<code> [18] ⍝ Remaining lines start with a blank.</code>
<code> [19] ⍝ Result is always a matrix with one column and zero to many rows.</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_466">#.Laguntza.Laguntza.Lint_.CheckBrokenLinks_ &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  CheckBrokenLinks_←{</code>
<code> [1]  ⍝ Returns vector with line number (tree), full page name &amp; link causing the problem.</code>
<code> [2]       fine←0 1⍴' '</code>
<code> [3]       ∆Ref←⍺</code>
<code> [4]       A←∆Ref.d.A</code>
<code> [5]       in←⍵</code>
<code> [6]       n←↑∆Ref ##.GetVarsName in</code>
<code> [7]       0=≢n:0 1⍴''                        ⍝ It's a node with a default page: nothing to check</code>
<code> [8]       body←∆Ref GetHelpBody n</code>
<code> [9]       0=≢body:fine                       ⍝ The part of the page that might carry links</code>
<code> [10]      body←n RemoveCode body</code>
<code> [11]      links←∆Ref IsolateLinks body       ⍝ Get just the links</code>
<code> [12]      0=≢links:fine                      ⍝ No links found?! Done!</code>
<code> [13]      type←∆Ref LookUpComplexLink¨(⊂¨links),¨in</code>
<code> [14]      (0=+/b←type=0):fine</code>
<code> [15]      ∪((⍕in),' ',n)∘{⍺,': ',⍵}¨({⍵↑⍨⍵⍳']'}¨b/links)</code>
<code> [16]  }</code>
</div>
<code class="header" id="listing_467">#.Laguntza.Laguntza.Lint_.CheckTopicProperty &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref CheckTopicProperty p</code>
<code> [1]   r←''</code>
<code> [2]   res←p.⍎'∆TopicProperties ⍬'        ⍝ Get the result</code>
<code> [3]   mentioned←res[;0]                  ⍝</code>
<code> [4]   vars←' '~¨⍨↓p.⎕NL 2                ⍝ All variables that exist in that NS (=help pages)</code>
<code> [5]   nodes←' '~¨⍨↓p.⎕NL 9               ⍝ All variables that exist in that NS (=help pages)</code>
<code> [6]   :If ∨/b←0=mentioned∊vars,nodes</code>
<code> [7]       r,←'  Mentioned in ∆TopicProperties but not found: '∘,¨b/mentioned</code>
<code> [8]   :EndIf</code>
<code> [9]   :If ∨/b←~vars∊mentioned</code>
<code> [10]  :AndIf 0≠≢vars2←(b/vars)~⊂'∆DefaultPage'</code>
<code> [11]      r,←'  Existing help page that is not mentionend in ∆TopicProperties: '∘,¨vars2</code>
<code> [12]  :EndIf</code>
<code> [13]  :If ∨/b←~nodes∊mentioned</code>
<code> [14]      r,←'  Existing node that is not mentionend in ∆TopicProperties: '∘,¨b/nodes</code>
<code> [15]  :EndIf</code>
<code> [16]  :If 0≠≢r</code>
<code> [17]      r←(⊂'--- Findings in ',⍕p),r</code>
<code> [18]  :EndIf</code>
</div>
<code class="header" id="listing_468">#.Laguntza.Laguntza.Lint_.GetHelpBody &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetHelpBody←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      name←⍵</code>
<code> [3]      2=⎕NC name:1↓∊##.CR,¨⍎name         ⍝ Get the variable's content</code>
<code> [4]      9≠⎕NC name:⎕SIGNAL 11</code>
<code> [5]      2≠(⍎name).⎕NC'∆DefaultPage':''</code>
<code> [6]      1↓∊##.CR,¨⍎name,'.∆DefaultPage'</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_469">#.Laguntza.Laguntza.Lint_.IsolateLinks &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  IsolateLinks←{</code>
<code> [1]       body←⍵</code>
<code> [2]       ∆Ref←⍺</code>
<code> [3]       0=+/b←'→['⍷body:''</code>
<code> [4]       body←b{⎕ML←0 ⋄ ⍺⊂⍵}body                ⍝ Split it so that every item starts with a link</code>
<code> [5]       body←2↓¨body                           ⍝ Drop "→["</code>
<code> [6]       ((0=≢¨body)/body)←'?'</code>
<code> [7]       body</code>
<code> [8]  ⍝ Takes what would become the Help and returns just the links.</code>
<code> [9]  ⍝ Returns a vector of vectors with links. Might be empty.</code>
<code> [10]  }</code>
</div>
<code class="header" id="listing_470">#.Laguntza.Laguntza.Lint_.LookUpComplexLink &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  LookUpComplexLink←{</code>
<code> [1]  ⍝ Returns the number of rows in the tree that fulfill the link</code>
<code> [2]  ⍝ or ¯1 for an external link.</code>
<code> [3]       ∆Ref←⍺</code>
<code> [4]       A←∆Ref.d.A</code>
<code> [5]       (link in)←⍵</code>
<code> [6]       link←{⍵↑⍨⍵⍳']'}link</code>
<code> [7]       0=≢link:''</code>
<code> [8]       (link2 alt)←{'|'∊⍵:'|'A.Split ⍵ ⋄ ⍵''}link</code>
<code> [9]       link2←{⍵↑⍨⌊/⍵⍳'|] '}link2</code>
<code> [10]      f←∨/'https://' 'http://'{⍺∊⍨⎕C(≢¨⍺)↑¨⊂⍵}link2</code>
<code> [11]      f:¯1</code>
<code> [12]      ≢in ##.FindTopic ∆Ref link2</code>
<code> [13]  }</code>
</div>
<code class="header" id="listing_471">#.Laguntza.Laguntza.Lint_.RemoveCode &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> RemoveCode←{</code>
<code> [1]      md←⍵</code>
<code> [2]      bool←'`'=md</code>
<code> [3]      0≠2|+/bool:md⊣⎕←⍺,' contains odd number of in-line code markers (back-ticks)'</code>
<code> [4]      md←'`.*?`'⎕R''⊣md                                                      ⍝ Remove inline code</code>
<code> [5]      '(^\s{0,3}~{3,}.*?)(?1)'⎕R''⍠('Mode' 'M')('DotAll' 1)('EOL' 'CR')⊣md   ⍝ Remove fenced blocks</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_472">#.Laguntza.Laguntza.Search.AddTextToItems &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> AddTextToItems←{</code>
<code> [1]      ⍵:⍬</code>
<code> [2]      ∆Ref←⍺</code>
<code> [3]      n←∆Ref.n</code>
<code> [4]      n.searchString.Items←∪(⊂n.searchString.Text),n.searchString.Items</code>
<code> [5]      ≢n.searchString.SelItems←(≢n.searchString.Items)↑1</code>
<code> [6] ⍝ If ⍵ is 1, the last search string is remembered</code>
<code> [7]  }</code>
</div>
<code class="header" id="listing_473">#.Laguntza.Laguntza.Search.CR &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> r←CR</code>
<code> [1]  r←⎕UCS 13</code>
</div>
<code class="header" id="listing_474">#.Laguntza.Laguntza.Search.ConvertHtmlEntities &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ConvertHtmlEntities←{</code>
<code> [1]  ⍝ Convert &amp;gt; into &gt;, &amp;lt; into &lt; and &amp;amp; into &amp;</code>
<code> [2]      r←⍵</code>
<code> [3]      r←'&amp;gt;' '&amp;lt;'⎕R(,¨'&gt;' '&lt;')⊣r</code>
<code> [4]      '&amp;amp'⎕R{'&amp;'}⊣r</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_475">#.Laguntza.Laguntza.Search.EnforceCheckOfSearchStringLength &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EnforceCheckOfSearchStringLength←{</code>
<code> [1] ⍝ ⍵ is the search string input combo.</code>
<code> [2] ⍝ Returns always ⍬.</code>
<code> [3]      ⍬⊣⎕NQ ⍵ 9999</code>
<code> [4]  }</code>
</div>
<code class="header" id="listing_476">#.Laguntza.Laguntza.Search.EnforceDelay &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> EnforceDelay←{1:shy←⎕DL ⍵}</code>
</div>
<code class="header" id="listing_477">#.Laguntza.Laguntza.Search.FullSearch &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  FullSearch←{</code>
<code> [1]       ∆Ref←⍺</code>
<code> [2]       A←∆Ref.d.A</code>
<code> [3]       (ss lf mhw sai)←⍵                          ⍝ Search String, lower case flag, match whole words only, search "as is"</code>
<code> [4]       lc←lf∘{⍺:0(819⌶)⍵ ⋄ ⍵}                     ⍝ Make fns that translates (or not) to lowercase according to "lowercase flag"</code>
<code> [5]       sai:∆Ref(lc SearchAsIs)ss</code>
<code> [6]       ss←' 'A.Split ss                           ⍝ Split</code>
<code> [7]       ss←mhw{⍺:CR,⍵,CR ⋄ ⍵}¨ss                   ⍝ Add CR if mhw</code>
<code> [8]       words←∆Ref ReadWords lf                    ⍝ Get all words from file</code>
<code> [9]       ss2←lc ss</code>
<code> [10]      bool←∧/¨ss2∘{∨/¨⍺⍷¨⊂⍵}¨words               ⍝ Perform the search</code>
<code> [11]      ls←⍸bool                                   ⍝ Lines with hits</code>
<code> [12]      (0=≢ls):⍬ ⍬                                ⍝ Nothing found?</code>
<code> [13]      fqn←∆Ref GetFullyQualifiedNamesForDisplay ls</code>
<code> [14]      ls fqn</code>
<code> [15] ⍝ Performs a full text search on all help pages.</code>
<code> [16] ⍝ Result is either (⍬ ⍬) if nothing could be found or:</code>
<code> [17] ⍝ A two-item vector. Each such item contains:</code>
<code> [18] ⍝ [0] Row number pointing into ∆Ref.d.t.</code>
<code> [19] ⍝ [1] Fully qualified name for display purposes.</code>
<code> [20]  }</code>
</div>
<code class="header" id="listing_478">#.Laguntza.Laguntza.Search.GetFullyQualifiedNamesForDisplay &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  GetFullyQualifiedNamesForDisplay←{</code>
<code> [1]  ⍝ Create partially qualified names for display purposes, meaning that dots are replaced by slashes.</code>
<code> [2]       ∆Ref←⍺</code>
<code> [3]       rows←⍵</code>
<code> [4]       pqn←⍕¨∆Ref∘##.GetParentOf¨rows</code>
<code> [5]       pqn←(1+≢⍕↑∆Ref.d.tree[;##.I.Parent])↓¨pqn</code>
<code> [6]       pqn←pqn{0=≢⍺:⍵ ⋄ ⍺,'/',⍵}¨∆Ref.d.tree[rows;##.I.TopicName]</code>
<code> [7]       0=≢pqn:''</code>
<code> [8]       {0=+/b←'.'=d←⍵:d ⋄ (b/d)←'/' ⋄ d}¨pqn  ⍝ Replace . by /</code>
<code> [9]   }</code>
</div>
<code class="header" id="listing_479">#.Laguntza.Laguntza.Search.GetState &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> GetState←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      n←∆Ref.n</code>
<code> [3]      itemNo←⍵</code>
<code> [4]      ref←n.search_sf.list           ⍝ Create reference</code>
<code> [5]      state←ref.GetItemState itemNo  ⍝ Get all state</code>
<code> [6]      ⌽(32⍴2)⊤state                  ⍝ convert to Booleans</code>
<code> [7] ⍝ Returns the ItemState for the TreeView as a bit vector</code>
<code> [8]  }</code>
</div>
<code class="header" id="listing_480">#.Laguntza.Laguntza.Search.OnSearch &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  OnSearch←{</code>
<code> [1]       ∆Ref←##.Get∆Ref 0⊃⍵</code>
<code> [2]       n←∆Ref.n</code>
<code> [3]       _←##.ShowEggTimer ∆Ref</code>
<code> [4]       _←∆Ref ##.SetInfoText'Performing search...'</code>
<code> [5]       _←ResetList ∆Ref</code>
<code> [6]       ref←n.search_sf</code>
<code> [7]       _←EnforceDelay 0.2</code>
<code> [8]       sa←1                                   ⍝ 1: Ignore container in search</code>
<code> [9]       buff←⍕n.searchString.Text</code>
<code> [10]      sa,←⊂⍕##.A.DMB⍣(~n.searchAsIs.State)⊣buff   ⍝ 2: Search string</code>
<code> [11]      sa,←n.fullTextSearchFlag.State         ⍝ 3: full text search</code>
<code> [12]      sa,←n.ignoreCaseFlag.State             ⍝ 4: lower case flag</code>
<code> [13]      sa,←n.matchWholeWord.State             ⍝ 5: Match whole words only</code>
<code> [14]      sa,←n.searchAsIs.State                 ⍝ 6: Search "as is"</code>
<code> [15]      ∆Ref.s.searchString←n.searchString.Text</code>
<code> [16]      ∆Ref.s.ignoreCase←n.ignoreCaseFlag.State</code>
<code> [17]      ∆Ref.s.matchWholeWord←n.matchWholeWord.State</code>
<code> [18]      ∆Ref.s.fullTextSearchFlag←n.fullTextSearchFlag.State</code>
<code> [19]      ∆Ref.s.searchAsIs←n.searchAsIs.State</code>
<code> [20]      (lines names)←∆Ref Search sa           ⍝ Perform the search</code>
<code> [21]      _←##.RemoveEggTimer ∆Ref</code>
<code> [22]      (0=≢lines):0⊣HandleNotFound ∆Ref       ⍝ Nothing found?</code>
<code> [23]      _←∆Ref AddTextToItems(⊂n.searchString.Text)∊n.searchString.Items</code>
<code> [24]      _←∆Ref ##.SaveSearchString n.searchString.Text</code>
<code> [25]      _←∆Ref ##.SetInfoText'"',(0⊃∆Ref.d.searchString),'" was found ',(⍕≢lines),' time',(1&lt;≢lines)/'s'</code>
<code> [26]      ref.list.Items←∆Ref.d.tree[lines;##.I.Title]   ⍝ Display the titles ...</code>
<code> [27]      ref.list.ReportInfo←⍪PolishLocation¨names      ⍝ ... and the location</code>
<code> [28]      _←ref{⍺.list.SetColSize ⍵ ¯3}¨0 1      ⍝ Ensure proper column width</code>
<code> [29]      ref.list.lines←lines                   ⍝ Save for callbacks</code>
<code> [30]      _←0 SetState⍨∆Ref(1,1↓∆Ref GetState 0) ⍝ Set appropriate state as well</code>
<code> [31]      (0⊃ref.list.SelItems)←1                ⍝ Select first item</code>
<code> [32]      _←ref.list.ItemDown 1                  ⍝ Fire...</code>
<code> [33]      _←ref.list.ItemUp 1                    ⍝ ...event</code>
<code> [34]      _←⎕NQ ref.list'GotFocus'               ⍝ Force focus to the list</code>
<code> [35]      _←⎕NQ ref.list 9999 ¯1                 ⍝ Force update</code>
<code> [36]      0</code>
<code> [37] ⍝ Performs the actual search and shows what needs to be shown</code>
<code> [38]  }</code>
</div>
<code class="header" id="listing_481">#.Laguntza.Laguntza.Search.PolishLocation &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> PolishLocation←{</code>
<code> [1]      '/'∊⍵:(1+⍵⍳'/')↓⍵</code>
<code> [2]      ''</code>
<code> [3]  }</code>
</div>
<code class="header" id="listing_482">#.Laguntza.Laguntza.Search.ReadWords &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ReadWords←{</code>
<code> [1]      ∆Ref←⍺</code>
<code> [2]      lf←⍵                                       ⍝ Lowercase flag</code>
<code> [3]      recNo←lf⊃∆Ref.f.(∆Words ∆words)</code>
<code> [4]      ⎕FREAD ∆Ref.f.tieNo recNo</code>
<code> [5]  }</code>
</div>
<code class="header" id="listing_483">#.Laguntza.Laguntza.Search.ResetList &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> ResetList←{</code>
<code> [1]      ∆Ref←⍵</code>
<code> [2]      n←∆Ref.n</code>
<code> [3]      n.reportList.Items←''                   ⍝ Reset the ...</code>
<code> [4]      n.reportList.ReportInfo←0 0⍴' '         ⍝ ...list</code>
<code> [5]      ⍬</code>
<code> [6]  }</code>
</div>
<code class="header" id="listing_484">#.Laguntza.Laguntza.Search.SearchAsIs &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code>  {r}←∆Ref(lc SearchAsIs)ss</code>
<code> [1]  ⍝ Performs a "search as is". That means that the contents of "Search for" is not treated as a word or list</code>
<code> [2]  ⍝ of words but is treated "as is". It also means that we cannot use the list of pre-compiled words.</code>
<code> [3]  ⍝ Therefore every single help page must be examined; that makes this type of search slow.</code>
<code> [4]  ⍝ `lc` is a function that does lowercase or not depending on the parameters the user has specified.</code>
<code> [5]   r←⍬ ⍬                                                      ⍝ Means: nothing found</code>
<code> [6]   ∆Ref{6:: ⋄ ⍺.n.infoSB.Visible←⍵}0</code>
<code> [7]   (list allPages)←##.CollectHelpPages ∆Ref</code>
<code> [8]   allPages{0=≢⍵:⍵ ⋄ ↑,/⍵}¨←allPages</code>
<code> [9]   :If 0≠≢list</code>
<code> [10]      allPages←lc allPages</code>
<code> [11]      allPages←ConvertHtmlEntities allPages</code>
<code> [12]      ss2←lc ss</code>
<code> [13]      lines←⍸{∨/ss2∘⍷⍵}¨allPages</code>
<code> [14]      list←list[lines]</code>
<code> [15]      :If 0≠≢lines</code>
<code> [16]          list←(1+≢⍕∆Ref.p.source)↓¨list</code>
<code> [17]          list←{l←⍵ ⋄ (('.'=l)/l)←'/' ⋄ l}¨list</code>
<code> [18]          r←lines list</code>
<code> [19]      :EndIf</code>
<code> [20]  :EndIf</code>
<code> [21] </code>
<code> [22]  {}∆Ref ##.SetInfoText''</code>
<code> [23]  ∆Ref{6:: ⋄ ⍺.n.infoSB.Visible←⍵}1</code>
</div>
<code class="header" id="listing_485">#.Laguntza.Laguntza.Search.SetState &mdash; 100%<a class="float-right no-print no-underline top-links" href="#top" title="Go to the top of the document">&#8607;</a><a  class="float-right no-print no-underline top-links" href="#partly-covered" title="Go to the beginning of 'Partly-covered'">↑</a></code>
<div class="code-block"><code> SetState←{</code>
<code> [1]      itemNo←⍵</code>
<code> [2]      (∆Ref states)←⍺</code>
<code> [3]      state←{2⊥⍉⌽⍵}states                            ⍝ Convert to Int</code>
<code> [4]      ∆Ref.n.search_sf.list.SetItemState itemNo ⍺    ⍝ Set the state</code>
<code> [5]  ⍝ ⍺[0] is ∆Ref</code>
<code> [6]  ⍝ ⍺[1] is vector of booleans representing the states of a particular item</code>
<code> [7]  }</code>
</div>
<div id="footer">
<hr>
<p>Created by "CodeCoverage" version 0.10.3+52 from 2023-06-23</p>
</div>

</body>
</html>
